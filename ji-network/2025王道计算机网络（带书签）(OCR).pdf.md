# 2025年  

# 计算机网络考研复习指导  

王道论坛组编王道官方版本，仅限内部使用！  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/b00f83e6a4ea227cc967c9335f98a1a0b73b50ac72ac7f4cf3274856cf8132f9.jpg)  
Publishing House of Electronics Industry 北京·BEIJING  
# 内容简介  

本书是计算机专业硕士研究生入学考试“计算机网络”课程的复习用书，内容包括计算机网络体系结构、物理层、数据链路层、网络层、传输层、应用层等。本书严格按照最新计算机考研大纲的计算机网络部分的要求编写，对大纲所涉及的知识点进行集中梳理，力求内容精练、重点突出、深入浅出。本书精选各名校的历年考研真题，并给出详细的解题思路，力求实现讲练结合、灵活掌握、举一反三的功效。  

本书可作为考生参加计算机硕士专业研究生入学考试的复习用书，也可作为计算机专业学生学习计算机网络课程的辅导用书。  

未经许可，不得以任何方式复制或抄袭本书之部分或全部内容。  

版权所有，侵权必究。  

# 图书在版编目（CIP）数据  

2025年计算机网络考研复习指导/王道论坛组编：一北京：电子工业出版社，2024.1ISBN978-7-121-46720-2  

I. $_{\odot2}$ 1Ⅱ. $\textcircled{\scriptsize{1}}$ 王·ⅢI $\textcircled{\scriptsize{1}}$ 计算机网络一研究生一入学考试一自学参考资料IV. $\textcircled{\scriptsize{1}}$ TP393中国国家版本馆CIP数据核字（2023）第223603号  

责任编辑：谭海平  

印刷：山东华立印务有限公司  

装订：山东华立印务有限公司出版发行：电子工业出版社北京市海淀区万寿路173信箱邮编：100036开本：787×10921/16印张：19.5字数：549千字版次：2024年1月第1版印次：2024年1月第1次印刷定价：71.00元  

凡所购买电子工业出版社图书有缺损问题，请向购买书店调换。若书店售缺，请与本社发行部联系，联系及邮购电话：（010）88254888，88258888。质量投诉请发邮件至zilts@phei.com.cn，盗版侵权举报请发邮件至dbqq@phei.com.cn。本书咨询联系方式：（010）88254552，tan02@phei.com.cn。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/0238ee2166b0fe28784732fd0bf8f82402479272141566a83fe9c31a3e8cd36a.jpg)  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/6ff9fdace43f01ed507b907a4ee67ce6d263508a96de9a9e9e69e5e0a34673bc.jpg)  
【关于兑换配套课件的说明】  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/68fa6780de037c4c029cfc5ebe88830f68336d5efa6073ec7de1281ea88d277b.jpg)  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/a5b7606264b4eae736b0a594fde2392ee1c432cbb43213bd5bbc977fb927de34.jpg)  

# 配套资源内容  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/1e2bd201ead26532451bd7e53a4c13632a66da34cb5f50d03cf322db0682ac88.jpg)  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/da01ccd5e1ba174822f1c217ddc01f4430b623a5d8a90464f0971649f9083087.jpg)  

1.凭兑换码兑换相应课程部分选择题的视频以及B站免费课程的课件。2.B站免费课程不是2025版付费课程，但差别不大，详情请咨询客服。3.兑换码贴于封面右下角，刮开涂 层可见。4.兑换截止时间为2024年12月31日。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f9f48b550169267f0ab7d3ec43e1c3f811ed2bd88f22486f0a1edf5a94fcb06c.jpg)  

1.盗版书无兑换码请勿购买。

2.免费视频非王道最新网课。

3.免费视频不包含答疑服务。  
# 前言  

由王道论坛（cskaoyan.com）组织名校状元级选手编写的“王道考研系列”辅导书，不仅参考了国内外的优秀教辅资料，而且结合了高分选手的独特复习经验，包括对考点的讲解以及对习题的选择和解析。“王道考研系列”单科辅导书共有如下四本：  

《2025年数据结构考研复习指导》《2025年计算机组成原理考研复习指导》《2025年操作系统考研复习指导》《2025年计算机网络考研复习指导》  

我们还围绕这套书开发了一系列赢得众多读者好评的计算机考研课程，包括考点精讲、习题详解、暑期强化训练营、冲刺串讲、伴学督学和全程答疑服务等，读者可扫描封底的二维码加客服微信咨询。对于基础较为薄弱的读者，相信这些课程和服务能助你一臂之力。此外，我们在B站免费公开了本书配套的基础课程，读者可凭兑换码获取课程的课件及部分选择题的讲解视频。基础课程升华了单科辅导书中的考点讲解，强烈建议读者结合使用。  

在冲刺阶段，我们还将出版如下两本冲刺用书：·《2025年计算机专业基础综合考试冲刺模拟题》·《2025年计算机专业基础综合考试历年真题解析》  

深入掌握专业课的内容没有捷径，考生也不应抱有任何侥幸心理。只有扎实打好基础，踏实敌题巩固，最后灵活致用，才能在考研时取得高分。我们希望本套辅导书能够指导读者复习，但是学习仍然要靠自己，高分无法建立在空中楼阁之上。对想要继续在计算机领域深造的读者来说，认真学习和扎实掌握计算机专业的四门重要专业课是最基本的前提。  

“王道考研系列”是计算机考研学子口碑相传的辅导书，自2011版首次推出以来，始终占据同类书销量的榜首，这就是口碑的力量。有这么多学长的成功经验，相信只要读者合理地利用输导书，并且采用科学的复习方法，就一定能够收获属于自已的那份回报。  

“不包就业、不包推荐，培养有态度的程序员。”王道训练营是王道团队打造的线下魔鬼式编程训练营。打下编程功底、增强项目经验，彻底转行入行，不再迷茫，期待有梦想的你！  

参与本书编写工作的人员主要有赵霖、罗乐、徐秀瑛、张鸿林、赵淑芬、赵淑芳、罗庆学、赵晓宇、喻云珍、余勇、刘政学等。予人玫瑰，手有余香，王道论坛伴你一路同行！  

对本书的任何建议，或发现有错误，欢迎扫码联系我们，以便及时改正优化。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/9331488f54249da542814bc572d93b05a194f747e432ee3145ad2ae5560f7484.jpg)  
# 致读者  

# 关于王道单科辅导书使用方法的道友建议  

我是“二战考生”，2012年第一次考研成绩333分（专业代码408，成绩81分），痛定思痛后决心再战。潜心复习了半年后终于以392分（专业代码408，成绩124分）考入上海交通大学计算机系，这半年里我的专业课成绩提高了43分，成了提分主力。从未达到录取线到考出比较满意的成绩，从蒙头乱撞到有了首己明确的复习思路，我想这也是为什么风华哥从诸多高分选手中选择我给大家介绍经验的一个原因吧。  

整个专业课的复习是围绕王道辅导书展开的，从一遍、两遍、三遍看单科辅导书的积累提升，到做8套模拟题时的强化巩固，再到看思路分析时的醍醐灌顶。王道辅导书能两次押中算法原题固然有运气成分，但这也从侧面说明编者的编写思路和选题方向与真题很接近。  

下面说一说我的具体复习过程。  

每天划给专业课的时间是3～4小时。第一遍仔细看课本，看完一章做一章单科辅导书上的习题（红笔标注错题），这一遍共持续2个月。第二遍主攻单科辅导书（红笔标注重难点），辅看课本。第二遍看单科辅导书和课本的速度快了很多，但感觉收获更多，常有温故知新的感觉，理解更深刻。（风华注：建议这里再速看第三遍，特别针对错题和重难点。模拟题做完后再跳看第四遍。）  

以上是打基础阶段，注意：单科辅导书和课本我仔细精读了两遍，以便尽量弄懂每个知识点和习题。大概11月上旬开始做模拟题和思路分析，期间遇到不熟悉的地方不断回头查阅单科辅导书和课本。8套模拟题的考点覆盖得很全面，所以大家做题时如果忘记了某个知识点，千万不要慌张，赶紧回去看这个知识点，最后的模拟就是查漏补缺。模拟题一定要严格按考试时间（3小时）去做，注意应试技巧，做完试题后再回头研究错题。算法题的最优解法不太好想，如果实在没思路，建议直接“暴力”解决，结果正确也能有10分，总比苦拼出15分来而将后面比较好拿分的题耽误了好（这是我第一次考研的切身教训）。最后剩了几天看标注的错题，第三遍跳看单科辅导书，考前一夜浏览完网络，踏实地睡着了·…·  

考完专业课，走出考场终于长舒一口气，考试情况也心中有数。回想这半年的复习，耐住了寂寞和诱惑，雨雪风霜从未间断地跑去自习，考研这人生一站终归没有辜负我的良苦用心。佛教徒说世间方物生来平等，都要落人春华秋实的代谢中去：辩证唯物主义认为事物作为过程存在，凡是存在的终归要结束。你不去为活得多姿多彩而拼搏，真到了和青春说再见时，你是否会可惜虚柱了青春？风华哥说过，我们都是有梦想的青年，我们正在逆袭，你呢？  

感谢风华哥的信任，给我这个机会为大家分享专业课复习经验，作为一个铁杆道友在王道受益匪浅，也借此机会回报王道论坛。祝大家金榜题名！  
# 王道训练营  

王道是道友们考研路上值得信赖的好伙伴，十多年来陪伴了数百万计算机考研人，不离不弃。王道尊重的不是考研这个行当，而是考研学生的精神和梦想。考研可能是同学们实现梦想的起点，但专业功底和学习能力更是受用终生的资本，它决定了未来在技术道路上能走多远。从考研图书，到辅导课程，再到编程培训，王道只专注于计算机考研及编程领域。  

计算机专业是一个靠实力吃饭的专业。王道团队中很多人的经历或许和现在的你们相似，也经历过本科时的迷茫，无非是自知能力太弱，以致底气不足。学历只是敲门砖，同样是名校硕 士，有人如鱼得水，最终成为“Offer帝”，有人却始终难入“编程与算法之门”，再次体会迷茫的痛苦。我们坚信一个写不出合格代码的计算机专业学生，即便考上了研究生，也只是给未来的失业判了个“缓期执行”。我们也希望所做的事情能帮助同学们少走弯路。  

考研结束后的日子，或许是一段难得的提升编程能力的连续时光，趁着还有时间，应该去弥补本科期间应掌握的能力，缩小与“科班大佬们”的差距。  

把参加王道训练营视为一次对自己的投资，投资自身和未来才是最好的投资。  

# 王道训练营简介  

# 1.面向就业  

希望转行就业，但编程能力偏弱的学生。  

考研并不是人生的唯一出路，努力拼搏奋斗的经历总是难忘的，但不论结果如何，都不应有太大的遗憾。不少考研路上的“失败者”在王道都到达了自己在技术发展上的新里程碑，我们相信一个肯持续努力、积极上进的学生一定会找到自已正确的人生方向。  

再不抓住当下，未来或将持续迷茫，逝去了的青春不复返。在充分竞争的技术领域，当前的能力决定了你能找一份怎样的工作，踏实的态度和学习的能力决定了你未来能走多远。  

王道训练营致力于给有梦想、肯拼搏、敢奋斗的道友提供最好的平台！  

# 2.面向硕士  

希望提升能力，刚考上计算机相关专业的准硕士  

考研逐年火爆，能考上名校确实是重要的转折，但硕士文凭早已不再稀缺。考研高分并不等于高薪Offer，学历也不能保证你拿到好Offer，名校的光环能让你获得更多面试机会，但真正要拿到好Ofer，比拼的是实力。同为名校硕士，Ofer的成色可能干差万别，有人轻松拿到腾讯、阿里、抖音、百度等优秀公司的Ofer，有人面试却屡屡碰壁，最后只能“将就”签约。  

人生中关键性的转折点不多，但往往能对自己的未来产生深远的影响，甚至决定了你未来的走向，高考、选专业、考研、找工作都是如此，把握住关键转折点需要眼光和努力。  

# 3.报名要求  

·具有本科学历，愿意通过奋斗去把握自己的人生，愿意重回高三冲刺式的学习状态。·完成开课前的作业，用作业考察态度，合格者才能获得最终的参加资格，宁缺滥！对于意志不够坚定的同学而言，这些作业也算是设置的一道门槛，决定了是否有参加的资格。  
作业完成情况是最重要的考核标准，我们不会歧视跨度大的同学，坚定转行的同学往往会更努力。跨度大、学校弱这些是无法改变的标签，唯一可以改变的就是通过持续努力来提升自身的技能，而通过高强度的短期训练是完全有可能逆袭的，太多的往期学员已有过证明。  

# 4.学习成效  

迅速提升编程能力，结合项目实战，逐步打下坚实的编程基础，培养积极、主动的学习能力。以动手编程为驱动的教学模式，解决你在编程、思维上的不足，也为未来的深入学习提供方向指导，掌握学习编程的方法，引导进入“编程与算法之门”。  

道友们在训练营里从“菜鸟”逐步成长，训练营中不少往期准硕士学员后来陆续拿到了阿里、腾讯、抖音、百度、美团、小米等一线互联网大厂的Offer。这就是竞争力！  

# 王道训练营优势  

这里都是道友，他们信任王道，乐于分享与交流，氛围好而纯粹。  

一起经历过考研训练的生活、学习，大家很快会成为互帮互助的好战友，相互学习、共同进步，在转行的道路上，这就是最好的圈子。正如某期学员所言：“来了你就发现，这里无关程序员以外的任何东西，这是一个过程，一个对自己认真、对自己负责的过程。”  

考研绝非人生的唯一出路，给自已换一条路走，去职场上好好发展或许会更好。即便考上研究生也不意味着高枕无忧，人生的道路还很漫长。  

王道团队成员皆具有扎实的编程功底，他们用自己的技术和态度去影响训练营的学员，尽可能指导学员走上正确的发展道路是对道友信任的回报，也是一种责任！  

王道训练营是一个平台，网罗王道论坛上有梦想、有态度的青年，并为他们的梦想提供土壤和圈子。王道始终相信“物竞天择，适者生存”，这里的生存不是指简简单单地活着，而是指活得有价值、活得有态度！  

# 王道训练营课程  

王道训练营开设4种班型：  

LinuxC和 $\mathrm{C++}$ 短期班（ $.40{\sim}45$ 天，初试后开课，复试冲刺）·JavaEE方向（4个月，武汉校区）Linux $\mathrm{C}/\mathrm{C++}$ 方向（4个月，武汉校区)·Python大数据方向（3个半月，直播授课或深圳校区）  

短期班的作用是在初试后及春节期间，快速提升学员的编程水平和项目经验，给复试、面试加成。其他3科班型既面向有就业需求的学员，又适合想提升能力或打算继续考研的学员。  

要想了解王道训练营，可以关注王道论坛“王道训练营”版面，或者扫码加老师微信。  
# 目录  

# 第1章计算机网络体系结构  

1.1计算机网络概述  

1.1.1计算机网络的概念1.1.2计算机网络的组成1.1.3计算机网络的功能21.1.4 电路交换、报文交换与分组交换 3 1.1.5计算机网络的分类51.1.6计算机网络的性能指标61.1.7 本节习题精选 8 1.1.8 答案与解析· 10  

1.2计算机网络体系结构与参考模型  

1.2.1计算机网络分层结构141.2.2计算机网络协议、接口、服务的概念151.2.3 ISO/OSI TCP/IP模型 17 1.2.4 本节习题精选 22 1.2.5 答案与解析 25  

1.3本章小结及疑难点  

# 第2章物理层  

# 2.1通信基础  

2.1.1基本概念·312.1.2 信道的极限容量 33 2.1.3编码与调制 34 2.1.4本节习题精选 36 2.1.5答案与解析 39  

# 2.2传输介质  

2.2.1双绞线、同轴电缆、光纤与无线传输介质 43 2.2.2 物理层接口的特性 45 2.2.3本节习题精选 46 2.2.4答案与解析 47  

2.3物理层设备  

2.3.1中继器 48 2.3.2集线器 48 2.3.3本节习题精选 49 2.3.4答案与解析 ·50 2.4本章小结及疑难点 5  
# 第3章数据链路层53  

# 3.1数据链路层的功能53  

3.1.1数据链路层所处的地位543.1.2为网络层提供服务553.1.3链路管理·553.1.4 封装成帧与透明传输 55 3.1.5流量控制553.1.6 差错检测 56 3.1.7 本节习题精选 56 3.1.8答案与解析 .57  

# 3.2组帧  

3.2.1字符计数法 58 3.2.2字节填充法 58 3.2.3零比特填充法 58 3.2.4 违规编码法 59 3.2.5本节习题精选593.2.6 答案与解析 59  

# 3.3差错控制 60  

3.3.1检错编码 60 3.3.2 纠错编码 61 3.3.3 本节习题精选 62 3.3.4答案与解析 63  

# 3.4流量控制与可靠传输机制65  

3.4.1流量控制与滑动窗口机制653.4.2可靠传输机制 66 3.4.3本节习题精选 70 3.4.4答案与解析 74  

# 3.5介质访问控制80  

3.5.1信道划分介质访问控制803.5.2随机访问介质访问控制833.5.3轮询访问：令牌传递协议 89 3.5.4本节习题精选 89 3.5.5答案与解析 94  

# 3.6局域网 100  

3.6.1局域网的基本概念和体系结构1003.6.2 以太网与1EEE802.3 101 3.6.3 IEEE802.11无线局域网 104 3.6.4VLAN基本概念与基本原理1073.6.5本节习题精选 109 3.6.6答案与解析  
3.7广域网  

3.7.1广域网的基本概念1153.7.2PPP协议 116 3.7.3本节习题精选 117 3.7.4答案与解析 118  

# 3.8数据链路层设备  

$^{*}3.8.1$ 网桥的基本概念1193.8.2以太网交换机 120 3.8.3本节习题精选 122 3.8.4答案与解析 124  

3.9本章小结及疑难点 26  

# 第4章网络层128  

# 4.1网络层的功能28  

4.1.1异构网络互连1294.1.2 路由与转发 130 4.1.3网络层提供的两种服务1304.1.4SDN的基本概念1324.1.5拥塞控制1334.1.6 本节习题精选 134 4.1.7 答案与解析 136  

# 4.2 IPV4 39  

4.2.1 IPv4分组 139 4.2.2 IPv4地址与NAT 141 4.2.3 划分子网与路由聚合 144 4.2.4网络层转发分组的过程1474.2.5地址解析协议（ARP）1484.2.6 动态主机配置协议（DHCP） 150 4.2.7 网际控制报文协议（ICMP） 151 4.2.8 本节习题精选 152 4.2.9 答案与解析 164  

# 4.3 IPV6  

4.3.1IPv6的特点 179 4.3.2IPv6数据报的基本首部1804.3.3 IPv6地址 181 4.3.4 IPv 4 IPv 6 182 4.3.5 本节习题精选 182 4.3.6 答案与解析 183  

# 4.4路由算法与路由协议 184  

4.4.1路由算法 84 4.4.2分层次的路由选择协议 186 4.4.3路由信息协议（RIP）1864.4.4 开放最短路径优先（OSPF）协议 189 4.4.5 边界网关协议（BGP） 190 4.4.6 本节习题精选 192 4.4.7 答案与解析 198  
# 4.5IP多播 203  

4.5.1多播的概念 203 4.5.2IP多播地址 203 4.5.3在局域网上进行硬件多播2034.5.4IGMP与多播路由协议2044.5.5 本节习题精选 204 4.5.6 答案与解析· 205  

# 4.6移动IP 206  

4.6.1移动IP的概念 206 4.6.2移动IP通信过程 206 4.6.3本节习题精选 207 4.6.4答案与解析 208  

# 4.7网络层设备208  

4.7.1冲突域和广播域 208 4.7.2路由器的组成和功能2094.7.3 路由表与分组转发 210 4.7.4 本节习题精选 211 4.7.5 答案与解析 214  

4.8本章小结及疑难点 215  

# 第5章传输层219  

# 5.1传输层提供的服务  

5.1.1传输层的功能2195.1.2 传输层的寻址与端口 220 5.1.3无连接服务与面向连接服务2215.1.4 本节习题精选 222 5.1.5 答案与解析 223  

# 5.2UDP协议  

5.2.1UDP数据报2245.2.2 UDP检验 226 5.2.3 本节习题精选 227 5.2.4答案与解析 229  

# 5.3TCP协议 3  

5.3.1TCP协议的特点 231 5.3.2TCP报文段 231 5.3.3TCP连接管理2335.3.4 TCP可靠传输 236 5.3.5TCP流量控制2375.3.6TCP拥塞控制2385.3.7 本节习题精选 241 5.3.8 答案与解析 250  
5.4本章小结及疑难点  

# 第6章应用层62  

# 6.1网络应用模型262  

6.1.1客户/服务器模型2626.1.2P2P模型 263 6.1.3本节习题精选 263 6.1.4答案与解析 264  

# 6.2域名系统（DNS）265  

6.2.1 层次域名空间 265 6.2.2域名服务器2666.2.3 域名解析过程 267 6.2.4 本节习题精选 269 6.2.5 答案与解析 270  

# 6.3文件传输协议（FTP） 272  

6.3.1FTP的工作原理2726.3.2控制连接与数据连接2736.3.3 本节习题精选 274 6.3.4 答案与解析 276  

# 6.4电子邮件78  

6.4.1电子邮件系统的组成结构2786.4.2电子邮件格式与MIME2806.4.3 SMTP和POP3 281 6.4.4本节习题精选 282 6.4.5答案与解析 283  

# 6.5万维网（WWW） 285  

6.5.1WWW的概念与组成结构2856.5.2 超文本传输协议（HTTP） 286 6.5.3本节习题精选 290 6.5.4答案与解析 293  

6.6本章小结及疑难点 297  

# 参考文献298  
# 第1章计算机网络体系结构  

# 【考纲内容】  

（一）计算机网络概述计算机网络的概念、组成与功能；计算机网络的分类：计算机网络的性能指标二）计算机网络体系结构与参考模型计算机网络分层结构：计算机网络协议、接口、服务的概念：ISO/OSI TCP/IP模型  

# 【复习提示】  

本章主要介绍计算机网络体系结构的基本概念，读者可以在理解的基础上适当地记忆。重点掌握网络的分层结构（包括5层和7层结构），尤其是ISO/OSI参考模型各层的功能，以及相关协议、接口和服务等概念。熟悉有关网络的各种性能指标，特别是时延、带宽、速率等的计算。  

# 1.1计算机网络概述  

# 1.1.1计算机网络的概念  

一般认为，计算机网络是一个将众多分散的、自治的计算机系统，通过通信设备与线路连接起来，由功能完善的软件实现资源共享和信息传递的系统。  

计算机网络（简称网络）由若干结点（node，或译为节点）和连接这些结点的链路（link）组成。网络中的结点可以是计算机、集线器、交换机或路由器等。网络之间还可通过路由器互连构成一个覆盖范围更广的计算机网络，这样的网络称为互连网（internet）。于是，我们可以这样理解：网络把许多计算机连在一起，而互连网则把许多网络通过路由器连在一起。  

请读者注意以下两个意思相差很大的名词：internet和Internet。  

internet（互连网）是一个通用名词，泛指由多个计算机网络互连而成的计算机网络。在这些网络之间可以使用任意的通信协议作为通信规则，不一定非要使用TCP/IP协议。  

Internet（互联网或因特网）则是一个专用名词，指当前全球最大的、开放的、由众多网络和路由器互连而成的特定计算机网络，它采用TCP/IP协议族作为通信规则。  

# 1.1.2计算机网络的组成  

从不同的角度看，可将计算机网络的组成分为如下几类。  
1）从组成部分看，计算机网络主要由硬件、软件、协议三大部分组成。硬件主要由主机（也称端系统）、通信链路（如双绞线、光纤）、交换设备（如路由器、交换机等）和通信处理机（如网卡）等组成。软件主要包括各种实现资源共享的软件和方便用户使用的各利工具软件（如E-mail程序、FTP程序、聊天程序等）。协议是计算机网络的核心，如同交通规则制约汽车驾驶一样，协议规定了网络传输数据时所遵循的规范。  

2）从工作方式看，计算机网络（这里主要指Intermet，即互联网）可分为边缘部分和核心部分。边缘部分由所有连接到互联网上的供用户直接使用的主机组成，用来进行通信（如传输数据、音频或视频）和资源共享；核心部分由大量网络和连接这些网络的路由器组成，它为边缘部分提供连通性和交换服务。图1.1给出了这两部分的示意图。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/287998ad20487ffe1402b983737c30bf30a87d0899b167101b7b13670e260760.jpg)  
图1.1互联网的核心部分与边缘部分  

3）从功能组成看，计算机网络由通信子网和资源子网组成。通信子网由各种传输介质、通信设备和相应的网络协议组成，它使网络具有数据传输、交换、控制和存储的能力，实现联网计算机之间的数据通信。资源子网是实现资源共享功能的设备及其软件的集合，向网络用户提供共享其他计算机上的硬件资源、软件资源和数据资源的服务。  

# 1.1.3计算机网络的功能  

计算机网络的功能很多，现今的很多应用都与网络有关。主要有以下五大功能。  

# 1.数据通信  

数据通信是计算机网络最基本和最重要的功能，用来实现联网计算机之间各种信息的传输：并联系分散在不同地理位置的计算机，进行统一的调配、控制和管理。例如，文件传输、电子邮件等应用，离开了计算机网络就无法实现。  

# 2.资源共享  

资源共享既可是软件共享、数据共享，又可是硬件共享。它使计算机网络中的资源互通有无、分工协作，从而极大地提高了硬件资源、软件资源和数据资源的利用率。  

# 3.分布式处理  

当计算机网络中的某个计算机系统负荷过重时，可将其处理的某个复杂任务分配给网络中的其他计算机系统，从而利用空闲计算机资源来提高整个系统的利用率。  

# 4.提高可靠性  

计算机网络中的各台计算机可以通过网络互为替代机。  

# 5.负载均衡  

将工作任务均衡地分配给计算机网络中的各台计算机。  
除了以上几大主要功能，计算机网络还可实现电子化办公与服务、远程教育、娱乐等功能，满足了社会的需求，方便了人们的学习、工作和生活，具有巨大的经济效益。  

# 1.1.4 电路交换、报文交换与分组交换  

在网络核心部分起重要作用的是路由器（router），它对收到的分组进行存储转发来实现分组交换。要了解分组交换的原理，首先就要学习电路交换的相关概念。  

# 1.电路交换  

最典型的电路交换网是传统电话网，如图1.2所示。从通信资源分配的角度看，交换就是按照某种方式动态地分配传输线路的资源。电路交换分为三步：连接建立、数据传输和连接释放。在进行数据传输前，两个结点之间必须先建立一条专用（双方独占）的物理通信路径（由通信双方之间的交换设备和链路逐段连接而成），该路径可能经过许多中间结点。在数据传输过程中，这一物理通信路径始终被用户独占，直到通信结束后才被释放。  

在电路交换的整个通信阶段，比特流连续地从源点直达终点，就好像在一个管道中传送。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f245e6639db9fb4e87d89db234663c1b92adb3022eb928c2b1f53e57f1c3bbcc.jpg)  
图1.2电路交换示意图  

电路交换技术的优点如下：  

1）通信时延小。因为通信线路为通信双方专用，数据直达，所以传输时延非常小。2）有序传输。双方通信时按发送顺序传送数据，不存在失序问题。3）没有冲突。不同的通信双方拥有不同的信道，不会出现争用物理信道的问题。4）适用范围广。电路交换既适用于传输模拟信号，又适用于传输数字信号。5）实时性强。通信双方之间的物理通路一旦建立，双方就可随时通信。6）控制简单。电路交换的交换设备（交换机等）及控制均较简单。  

电路交换技术的缺点如下：  

1）建立连接时间长。电路交换的平均连接建立时间对计算机通信来说太长。2）线路利用率低。物理通路被通信双方独占，即使线路空闲，也不能供其他用户使用。3）灵活性差。物理通路中的任何一点出现故障，就必须重新拨号建立新的连接。4）难以规格化。不同类型、不同规格、不同速率的终端很难相互进行通信。5）难以实现差错控制。中间结点不具备存储和检验数据的能力，无法发现并纠正错误。  

注意，在电路交换中，电路建立后，除源结点和目的结点外，电路上的任何结点都采取“直通方式”接收数据和发送数据，即不存在存储转发所耗费的时间。  

# 2.报文交换  

# 命题追踪报文交换网中存储转发、数据传送时间的计算（2013）  

数据交换的单位是报文，用户数据加上源地址、目的地址等信息后，后封装成报文（message）。报文交换采用存储转发技术，整个报文先传送到相邻的结点，全部存储后查找转发表，转发到下一个结点，如此重复，直至到达目的结点。每个报文都可单独选择到达目的结点的路径。  
报文交换技术的优点如下：  

1）无须建立连接。通信前无须建立连接，没有建立连接时延，用户可随时发送报文。2）动态分配线路。交换设备存储整个报文后，选择一条合适的空闲线路，转发报文。3）线路可靠性高。若某条传输路径发生故障，则可重新选择另一条路径传输数据。4）线路利用率高。报文在哪段链路上传送时才占用这段链路的通信资源。5）提供多目标服务。一个报文可以同时发送给多个目的地址。  

报文交换技术的缺点如下：  

1）转发时延高。交换结点要将报文整体接收完后，才能查找转发表转发到下一个结点。 2）缓存开销大。报文的大小没有限制，这就要求交换结点拥有较大的缓存空间。3）错误处理低效。报文较长时，发生错误的概率相对更大，重传整个报文的代价也很大。  

# 3.分组交换  

# 命题追踪分组交换网中存储转发、数据传送时间的计算（2010、2013、2023）  

分组交换也采用存储转发技术，但解决了报文交换中报文过长的问题。若报文太长，则对交换结点的缓存容量就有很大的需求，在错误处理方面也比较低效。源结点在发送之前，先把较长的报文划分成若干较小的等长数据段，在每个数据段前面添加一些由必要控制信息（如源地址、目的地址和编号信息等）组成的首部，构成分组（Packet），如图1.3所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/2d299f322302399b30b0f2b21d0337245ceeccac10e0720f8635d7b7c8877980.jpg)  
图1.3构成分组的过程  

源结点将分组发送到分组交换网中，分组交换网中的分组交换机收到一个分组后，先将其缓存，然后从其首部中提取目的地址，据此查找自己的转发表，再后将分组转发给下一个分组交换机。经过多个分组交换机的存储转发后，分组最终到达目的结点。  

分组交换技术的优点如下：  

1）无建立时延。通信前无须建立连接，没有建立连接时延，用户可随时发送分组。  

2）线路利用率高。分组在哪段链路上传送时才占用这段链路的通信资源。相比采用电路交 换传送突发式的计算机数据，分组交换的通信线路利用率大大提高。  

3）简化了存储管理（相对于报文交换）。因为分组的长度固定，相应缓冲区的大小也固定，在交换结点中存储器的管理通常被简化为对缓冲区的管理，相对比较容易。  

4）加速传输。分组是逐个传输的，可以使后一个分组的存储操作与前一个分组的转发操作并行，这种流水线方式减少了报文的传输时间。此外，传输一个分组比传输一次报文所需的缓冲区小得多，这样，因缓冲区不足而等待发送的概率及时间必然也少得多。  

5）减小了出错概率和重发数据量。因为分组较短，其出错概率必然减小，所以每次重发的数据量也就大大减少，这样不仅提高了可靠性，而且减小了传输时延。  

分组交换技术的缺点如下：  

1）存在存储转发时延。尽管分组交换比报文交换的传输时延小，但相对于电路交换仍存在  
存储转发时延，且其结点交换机必须具有更强的处理能力。2）需要传输额外的信息量。每个小数据段都要加上控制信息以构成分组，这使得传送的信息量增大了  $5\%\!\sim\!10\%$  ，进而使得控制复杂，降低了通信效率，增大了处理的时延。 3）当分组交换网采用数据报服务时，可能出现失序、丢失或重复分组的情况，分组到达目的结点时，要对分组按编号进行排序等工作，而这些工作很麻烦。若采用虚电路服务，则虽然没有失序问题，但有呼叫建立、数据传输和虚电路释放三个过程。  

图1.4给出了三种数据交换方式的比较。当要传送的数据量很大且其传送时间远大于呼叫时间时，采用电路交换较为合适。当端到端的通路由多段链路组成时，采用分组交换传送数据较为 合适。从提高整个网络的信道利用率看，报文交换和分组交换优于电路交换，其中分组交换比报文交换的时延小，尤其适合计算机之间的突发式数据通信。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/cc1c6c84bafb4c42ddde56da97766fa80096e449b7643d1105d033c641008b5a.jpg)  
图1.4三种数据交换方式的比较  

# 1.1.5计算机网络的分类  

# 1.按分布范围分类  

1）广域网（WAN）。广域网的任务是提供长距离通信，运送主机所发送的数据，其覆盖范围通常是直径为几十到几千千米的区域。广域网是互联网的核心部分。连接广域网的各结点交换机的链路一般都是高速链路，具有较大的通信容量。  

2）城域网（MAN)。城域网的覆盖范围可以跨越几个街区甚至整个城市，覆盖区域的直径为 $5{\sim}50\mathrm{km}$ 。城域网大多采用以太网技术，因此有时也常并入局域网的范围讨论。  

3）局域网（LAN）。局域网一般用主机通过高速线路相连，覆盖范围较小，通常是直径为几十到几千米的区域。传统上，局域网使用广播技术，而广域网使用交换技术。  

4）个人区域网（PAN)。个人区域网是指在个人工作的地方将消费电子设备（如平板电脑、智能手机等）用无线技术连接起来的网络，也称无线个人区域网（WPAN）。  

# 2.按传输技术分类  

1）广播式网络。所有联网计算机都共享一个公共通信信道。当一台计算机利用共享通信信道发送报文分组时，所有其他计算机都会“收听”到这个分组。接收到该分组的计算机将通过检查目的地址来决定是否接收该分组。局域网基本上都采用广播式通信技术，广域  
两中的元绒、上生通后两网给世木用厂猫式通后权不。  

2）点对点网络。每条物理线路连接一对计算机。若通信的两台主机之间没有直接连接的线路，则它们之间的分组传输就要通过中间结点进行存储和转发，直至目的结点。  

# 3.按拓扑结构分类  

网络拓扑结构是指由网中结点（路由器、主机等）与通信线路之间的几何关系表示的网络结构，主要指通信子网的拓扑结构。按网络的拓扑结构，可分为总线形、星形、环形和网状网络等，如图1.5所示。星形、总线形和环形网络多用于局域网，网状网络多用于广域网。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/03dad756ed141050172e537aa8bcf856a949704d26cadf944b7715839d605a68.jpg)  
图1.5几种不同的网络拓扑结构  

1）总线形网络。用单根传输线把计算机连接起来。优点是建网容易、增/减结点方便、节省线路。缺点是重负载时通信效率不高、总线任意一处对故障敏感。2）星形网络。每个终端或计算机都以单独的线路与中央设备相连。中央设备一般是交换机或路由器。优点是便于集中控制和管理。缺点是成本高、中央设备对故障敏感。3）环形网络。所有计算机接口设备连接成一个环。环形网络最典型的例子是令牌环局域网。环既可以是单环，又可以是双环，环中信号是单向传输的。4）网状网络。一般情况下，每个结点至少有两条路径与其他结点相连，多用在广域网中。其有规则型和非规则型两种。优点是可靠性高。缺点是控制复杂、线路成本高。  

以上4种基本的网络拓扑结构可以互连为更复杂的网络。  

# 4.按使用者分类  

1）公用网（PublicNetwork）。指电信公司出资建造的大型网络。“公用”的意思是指所有愿意按电信公司的规定缴纳费用的人都可使用这种网络。2）专用网（PrivateNetwork）。指某个部门为满足本单位特殊业务的需要而建造的网络。这种网络不向本单位外的人提供服务，如铁路、电力、军队等部门的专用网。  

# 5.按传输介质分类  

传输介质可分为有线和无线两大类，因此网络可分为有线网络和无线网络。有线网络又可分为双绞线网络、同轴电缆网络等，而无线网络又可分为蓝牙、微波、无线电等类型。  

# 1.1.6计算机网络的性能指标  

性能指标从不同方面度量计算机网络的性能。常用的性能指标如下。  

1）速率（Speed）。指连接到网络上的结点在数字信道上传送数据的速率，也称数据传输速率、数据传输率、数据率或比特率，单位为b/s（比特/秒）或bit/s（有时也写为bps）。当数据率较高时，可用 $\mathrm{{kb/s}}$  $(\mathrm{k}=10^{3}$ )、 $\mathrm{{Mb/s}}$  $(\mathbf{M}=10^{6})$ ）或Gb/s（ $\mathrm{{(G}}\mathrm{{=}}{10}^{\mathrm{{9}}}\mathrm{{)}}$ ）表示。2）带宽（Bandwidth）。带宽原本表示通信线路允许通过的信号频率范围，单位是赫兹 $\mathrm{(Hz}$ 但在计算机网络中，带宽表示网络的通信线路所能传送数据的能力，是数字信道所能传送的“最高数据传输速率”的同义语，单位是比特/秒（b/s）。  
3）吞吐量（Throughput）。指单位时间内通过某个网络（或信道、接口）的实际数据量。吞吐量常用在对实际网络的测量中，受网络带宽的限制。  

4）时延（Delay）。指数据（一个报文或分组）从网络（或链路）的一端传送到另一端所需的总时间，它由4部分构成：发送时延、传播时延、处理时延和排队时延。  

# 命题追踪分组交换网中各种时延的计算（2010、2013、2023）  

发送时延，也称传输时延。结点将分组的所有比特推向链路所需的时间，即从发送分组的第一个比特算起，到该分组的最后一个比特发送完毕所需的时间。发送时延 $=$ 分组长度/发送速率传播时延。电磁波在信道（传输介质）中传播一定的距离所花的时间，即一个比特从链路的一端传播到另一端所需的时间。传播时延 $=$ 信道长度/电磁波在信道上的传播速率  

# 注意  

区分传输时延和传播时延。传输时延是路由器将分组推出所需的时间，是分组长度和链路传输速率的函数。传播时延是一个比特从一台路由器传播至另一台路由器所需的时间，是两台路由器之间距离的函数，而与分组长度或链路传输速率无关。  

处理时延。数据在交换结点为存储转发而进行的一些必要处理所花的时间。例如，分析分组的首部、从分组中提取数据、差错检验或查找合适的路由等。排队时延。分组在进入路由器后要先在输入队列中排队等待处理。路由器确定转发 端口后，还要在输出队列中排队等待转发。这就产生了排队时延。  

因此，数据在网络中经历的总时延就是以上4部分时延之和：总时延 $=$ 发送时延 $^+$ 传播时延 $^+$ 处理时延 $^+$ 排队时延  

# 注意  

处理时延和排队时延通常可忽略不计（除非另有说明）。  

5）时延带宽积。指发送端发送的第一个比特即将到达终点时，发送端已发出了多少比特，又称以比特为单位的链路长度，即时延带宽积 $=$ 传播时延 $\times$ 信道带宽。  

如图1.6所示，考虑一个代表链路的圆柱形管道，其长度表示链路的传播时延，横截面积表示链路带宽，则时延带宽积表示该管道可以容纳的比特数量。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/e564fa3d8c71bff7066a52d237c4d5c1866dd55d3140f45a2653a5b0f92a936d.jpg)  
图1.6链路就像一条空心管道  

6）往返时延（Round-TripTime，RTT）。指从发送端发出一个短分组，到发送端收到来自接收端的确认（接收端收到数据后立即发送确认）总共经历的时延。在互联网中，往返时延还包括各中间结点的处理时延、排队时延及转发数据时的发送时延。  

7）信道利用率。用以指出某个信道有百分之多少的时间是有数据通过的。信道利用率 $=$ 有数据通过时间/（有+无）数据通过时间  
# 1.1.7 本节习题精选  

# 一、单项选择题  

01.计算机网络可被理解为（）  

A.执行计算机数据处理的软件模块B.由自治的计算机互连起来的集合体C.多个处理器通过共享内存实现的紧耦合系统D.用于共同完成一项任务的分布式系统  

02.计算机网络最基本的功能是（）  

A.数据通信B.资源共享C.分布式处理D.信息综合处理  

03.下列不属于计算机网络功能的是（）  

A.提高系统可靠性B.提高工作效率C.分散数据的综合处理D.使各计算机相对独立  

04.计算机网络从逻辑功能上可划分为（）  

A.局域网和广域网B.本地计算机网和通信网C.通信子网和资源子网D.服务器和客户机  

05.下列关于网络中的计算机的描述中正确的是（）。  

A.各自独立，没有联系B.拥有独立的操作系统C.互相干扰D.拥有共同的操作系统  

06.计算机网络可分为通信子网和资源子网。下列属于通信子网的是（）  

I.网桥II.交换机IIL.计算机软件IV.路由器A.I、II、IVB.ⅡI、II、IVC.I、II、IVD.I、II、IⅢI  

07.下列设备属于资源子网的是（）  

A.计算机软件B.网桥C.交换机D.路由器  

08.就交换技术而言，以太网采用的是（）  

A.分组交换技术B.电路交换技术C.报文交换技术D.混合交换技术  

09.为了使数据在网络中传输时延最小，首选的交换方式是（）。A.电路交换 B.报文交换 C.分组交换 D.信元交换

 10.分组交换相比报文交换的主要改进是（）  

A.差错控制更加完善B.路由算法更加简单C.传输单位更小且有固定的最大长度D.传输单位更大且有固定的最大长度  

11.下列（）是分组交换网络的缺点。  

A.信道利用率低 B.附加信息开销大 C.传播时延大D.不同规格的终端很难相互通信  

12.不同的数据交换方式有不同的性能。为了使数据在网络中的传输时延最小，首选的交换方式是( $\textcircled{\scriptsize{1}}$ ）；为保证数据无差错地传送，不应选用的交换方式是（ $\circledcirc$ ）；分组交换对报文交换的主要改进是（ $\textcircled{3}$ ），这种改进产生的直接结果是（ $\textcircled{4}$ )。  

$\textcircled{\scriptsize{1}}$  A.电路交换 B.报文交换 C.分组交换  $\circledcirc$  A.电路交换 B.报文交换 C.分组交换  
$\textcircled{3}$ A.传输单位更小且有固定的最大长度B.传输单位更大且有固定的最大长度C.差错控制更完善  

$\textcircled{4}$ A.降低了误码率B.提高了数据传输速率C.减少传输时延D.增加传输时延  

13.下列说法中，（）是数据报方式的特点。  

A.同一报文的不同分组可以经过不同的传输路径通过通信子网B.同一报文的不同分组到达目的结点时顺序是确定的C.适合于短报文的通信D.同一报文的不同分组在路由选择时只需要进行一次  

14.计算机网络分为广域网、城域网和局域网，其划分的主要依据是（）。  

A.网络的作用范围B.网络的拓扑结构C.网络的通信方式D.网络的传输介质  

15.计算机网络拓扑结构主要取决于它的（）A.资源子网B.路由器C.通信子网D.交换机  

16.假设主机A和B之间的链路带宽为100Mbps，主机A的网卡速率为1Gbps，主机B的网卡速率为10MbpS，主机A给主机B发送数据的最高理论速率为（）。  

A. 1Mbps B.I10Mbps C.100Mbps D.1Gbps  

17.有一个点对点链路的长度为 $50\mathrm{km}$ ，若数据在此链路上的传播速率为 $2{\times}10^{8}\mathrm{m/s}$ ，要使发送512B分组的发送时延和传播时延相等，则该链路的带宽是（）。  

A.2.05Mb/s B.4.1Mb/s C.16.38Mb/s D.32.76Mb/s  

18.在下图所示的采用存储转发方式的分组交换网中，主机A向B发送两个长度为1000B的分组，路由器处理单个分组的时延为 $10\mathrm{ms}$ （假设路由器同时最多只能处理一个分组，若在处理某个分组时有新的分组到达，则存入缓存区），忽略链路的传播时延，所有链路的数据传输速率为1MIb/s，则分组从A发送开始到B接收完为止，需要的时间至少是（）  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/0599e3bb7376d9325b3af8d1d2d3d4d31fc305089b651df6b8ffaa47ed4ad24c.jpg)  

A.34ms B.36ms C.38ms D.52ms  

19.【2010统考真题】在下图所示的采用“存储一转发”方式的分组交换网络中，所有链路的数据传输速率为 $100\,\mathrm{{Mb/s}}$ 分组大小为1000B，其中分组头大小为20B。若主机H1向主机H2发送一个大小为980000B的文件，则在不考虑分组拆装时间和传播延迟的情况下，从H1发送开始到H2接收完为止，需要的时间至少是（）。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/7230d3bf0874fdc5ce4e19ed1b98345626804179eccd95a2347b315864e07c8f.jpg)  

A.80ms B.  $80.08\mathrm{ms}$  C.80.16ms D.  $80.24\mathrm{ms}$  

20.【2013统考真题】主机甲通过一个路由器（存储转发方式）与主机乙互连，两段链路的数据传输速率均为 $10\mathrm{Mb/s}$ 主机甲分别采用报文交换和分组大小为106的分组交换向主机乙发送一个大小为8Mb（ $1\mathrm{M}\!=\!10^{6}$ ）的报文。若忽略链路传播延迟、分组头开销和分组拆装时间，则两种交换方式完成该报文传输所需的总时间分别为（）。  
A. $800\mathrm{ms}$ 、 $1600\mathrm{ms}$ B. $801\mathrm{ms}$ 、 $1600\mathrm{ms}$ C.  $1600\mathrm{ms}$  、  $800\mathrm{ms}$  D.  $1600\mathrm{ms}$  、801ms  

21.【2023统考真题】某无噪声理想信道带宽为 $4\mathrm{MHz}$ ，采用QAM调制，若该信道的最大数据传输速率是 $48\mathrm{Mb/s}$ ，则该信道采用的QAM调制方案是（）。  

A.QAM-16 B.QAM-32 C. QAM-64 D.QAM-128  

# 二、综合应用题  

01.假定有一个通信协议，每个分组都引入100字节的开销用于首部和组帧。现在使用这个协议发送 $10^{6}$ 字节的数据，但在传送过程中有一个字节被破坏，因而包含该字节的那个分组被丢弃。试对1000字节和20000字节的分组的有效数据大小分别计算“开销 $^+$ 失”字节的总数目。为使“开销 $^{+,}$ 丢失”字节的总数目最小，分组数据大小的最佳值是七多少？  

02.考虑一个最大距离为 $2\mathrm{km}$ 的局域网，当带宽为多大时，传播时延（传播速率为 $2{\times}10^{8}\mathrm{m/s}$ 一等于100B分组的发送时延？对于512B分组，结果又如何？  

03.在两台计算机之间传输一个文件有两种可行的确认策略。第一种策略把文件截成分组，接收方逐个确认分组，但就整体而言，文件没有得到确认。第二种策略不确认单个分组，但当文件全部收到后，对整个文件予以确认。讨论这两种方式的优缺点。  

# 1.1.8 答案与解析  

# 一、单项选择题  

01.B  

计算机网络是由自治计算机互连起来的集合体，其中包含三个关键点：自治计算机、互连、集合体。自治计算机由软件和硬件两部分组成，能完整地实现计算机的各种功能；互连是指计算机之间能实现相互通信：集合体是指所有使用通信线路及互连设备连接起来的自治计算机的集合。选项C和D分别指多机系统和分布式系统。  

02.A  

计算机网络的功能包括数据通信、资源共享、分布式处理、信息综合处理、负载均衡、提高可靠性等，但其中最基本的功能是数据通信功能，数据通信功能也是实现其他功能的基础。  

03.D  

计算机网络的三大主要功能是数据通信、资源共享和分布式处理。计算机网络使各计算机之间的联系更加紧密而非相对独立。  

04.C 计算机网络从逻辑功能上可分为资源子网和通信子网两部分。  

05.B  

计算机网络是一些互连的、自治的计算机系统的集合。各计算机拥有独立的操作系统和硬件资源，它们之间是有联系的，通过网络协议和通信介质进行数据交换和资源共享。  

06.A  

资源子网主要由计算机系统、终端、联网外部设备、各种软件资源和信息资源等组成。资源子网负责全网的数据处理业务，向网络用户提供各种网络资源与网络服务。通信子网由通信控制处理机、通信线路和其他通信设备组成，任务是完成网络数据传输、转发等。  
由此可知，网桥、交换机和路由器都属于通信子网，只有计算机软件属于资源子网。  

07.A  

通信子网对应于OS参考模型的下三层，包括物理层、数据链路层和网络层。通过通信子网互连在一起的计算机负责运行对信息进行处理的应用程序，是网络中信息流动的源和宿，向网络用户提供可共享的硬件、软件和信息资源，构成资源子网。网桥、交换机、路由器都属于通信子网中的硬件设备。  

08.A  

在以太网中，数据以帧的形式传输。源端用户的较长报文需分为若干数据块，这些数据块在各层中还要加上相应的控制信息，在网络层中是分组，在数据链路层中是以太网的帧。以太网的用户在会话期间只是断续地使用以太网链路。  

09.A  

电路交换虽然建立连接的时延较大，但在数据传输期间一直占据链路，实时性更强，传输时延小。报文交换和分组交换都基于存储转发交换方式，无须事先建立连接，就可动态地分配通信资源，提高了线路利用率，但也引入了存储转发时延和额外的控制开销，因此实时性较差。  

10. C  

相对于报文交换而言，分组交换将报文划分为一个个具有固定最大长度的分组，以分组为单位进行传输。  

11.B  

分组交换要求将数据分成等长的小数据段，每段中都要加上控制信息（如目的地址），因此传送数据的总开销较大。相比其他交换方式，分组交换信道利用率高。传播时延取决于传播介质及收发双方的距离。对各种交换方式，不同规格的终端都很难相互通信，因此不是分组交换的缺点。  

12.A、A、A、C  

本题综合考查几种数据交换方式的特点。电路交换方式的优点是传输时延小、通信实时性强，适用于交互式会话类通信：但其缺点是对突发性通信不适应，系统效率低，不具备存储数据的能力，不能平滑网络通信量，不具备差错控制的能力，无法纠正传输过程中发生的数据差错。  

报文交换和分组交换都采用存储转发，传送的数据都要经过中间结点的若干存储、转发才能到达目的地，因此传输时延较大。报文交换传送数据的长度不固定且较长，分组交换要将传送的长报文分割为多个固定且长度有限的分组，因此传输时延较报文交换的要小。  

13.A  

数据报方式是一种无连接的分组交换技术，它先将报文拆分成若干较小的数据段，加上地址等控制信息后构成分组，这样做虽然会增加一些控制开销，但并不意味着数据报方式只适合于短报文的通信。数据报方式提供尽最大努力的交付，不保证可靠性，分组可能出错或丢失，网络为每个分组独立地选择路由，转发的路径可能不同，因此分组不一定按序到达目的结点。  

14.A  

按分布范围分类：广域网、城域网、局域网、个人区域网。按拓扑结构分类：星形网络、总线形网络、环形网络、网状网络。按传输技术分类：广播式网络、点对点网络。  
按使用者分类：公用网、专用网。  

按数据交换技术分类：电路交换网、报文交换网、分组交换网。因此，根据网络的覆盖范围可将网络主要分为广域网、城域网和局域网。  

15.C  

拓扑结构主要是指通信子网的拓扑结构。通信子网包括物理层、数据链路层、网络层，而集线器、交换机和路由器分别工作在物理层、数据链路层和网络层。  

16.B  

主机A给主机B发送数据的最高理论速率取决于链路带宽及主机A、主机B的网卡速率中最小者，因为它是数据传输的瓶颈。所以，最高理论速率为10Mbps。  

17.C  

该链路的传播时延 $\mathrm{\Omega}=50\mathrm{km}/(2{\times}10^{8}\mathrm{m/s})=250\upmu\mathrm{s}$ ，因为发送时延等于传播时延，所以该链路的带宽（最大的数据发送速率）应为 $(512{\times}8{\mathrm{b}})/250{\upmu}{\mathrm{s}}=16.38{\mathrm{M}}{\mathrm{b}}/{\mathrm{s}}$  

18.B  

分组长度为1000B，所有链路的数据传输速率为 $1\mathrm{M}\mathrm{b}/\mathrm{s}$ ，因此，每段链路的发送时延为 $1000\mathrm{{B}\!+\!1\,\!M\!b/s=8m s}$ ，第一个分组从A到达B的时间为 $8+10+8=26{\mathrm{ms}}$ ，此后又经过 $10\mathrm{ms}$ ，第二个分组才到达B，所以总时间为 $26+10=36\mathrm{{ms}}$ ，下图是传送过程的时空图。此题还可扩展为发送更多分组的情况。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/a59ca58ef6b9e1ff8fb879ab9a7d3510d75c488bbace7238f8d712f3fadc82aa.jpg)  

19.C  

分组大小为1000B，分组首部大小为20B，则分组携带的数据大小为980B，文件长度为980000B，需拆分为1000个分组，加上首部后，每个分组的大小为1000B，共需传送的数据量为11MB。因为所有链路的数据传输速率相同，所以文件传输经过最短路径时所需的时间最少，最短路径经过2个分组交换机。  

当 $t\!=\!1\mathrm{M}\!\times\!8/(100\mathrm{M}\mathrm{b/s})\!=\!80\mathrm{ms}$ 时，H1发送完最后一个比特。  

当H1发送完最后一个分组时，该分组需要经过2个分组交换机的转发，在2次转发完成后，所有分组均到达H2。每次转发的时间为 $t_{0}\,{=}\,1\mathrm{K{\times}}8/(100\mathrm{M}\mathrm{b/s})\,{=}\,0.08\mathrm{ms}$  

因此，在不考虑分组拆装时间和传播时延的情况下，当 $t\!=\!80\mathrm{ms}+2t_{0}\!=\!80.16\mathrm{ms}$ 时，H2接收完文件，即所需的时间至少为 $80.16\mathrm{ms}$  

【另解】分组交换的传输过程类似于流水线的方式，因此本题也可采用流水线的思路。在连续传输的过程中，每个存储转发设备在同一时刻发送不同的分组，这类似于不同的部件在同一时刻执行不同的指令。所有链路的数据传输速率相同，表示各流水段的时间相同，设为 $r$ ，最短路径有3段链路，则传输 $m$ 个分组需要的时间 $t=3r+(m-1){\times}r.$ 。也就是说，第一个分组从流水线中流出所需的时间为 $3r$ ，当第一个分组从流水线中流出后，每隔时间 $r$ 就从流水线中流出一个分组。求得 $r\!=\!0.08\mathrm{ms}$ ，因此 $t\!=\!3r+(m\!-\!1)\!\times\!r\!=\!3\!\times\!0.08+(1000-1)\!\times\!0.08=80.16\mathrm{ms}\,\mathrm{s}$  

20.D  

传输图为：甲一路由器  

在题中没有明确说明的情况下，不考虑排队时延和处理时延，只考虑发送时延和传播时延，本题中忽略传播时延，因此只针对报文交换和分组交换计算发送时延。  
计算报文交换的发送时延。报文交换直接传输信息，其发送时延是每个结点转发报文的时间。而对于每个结点，均有发送时延 $T\!=\!8\mathbf{M}\mathbf{b}\!+\!10\mathbf{M}\mathbf{b}/\mathrm{s}=\!0.8\mathrm{s}$ ，因为数据从甲发出，又被路由器转发1次，因此共有2个发送时延，所以总发送时延为1.6s，即报文交换的总时延为1.6s。  

计算分组交换的发送时延。简单画出前3个分组的发送时间示意图，如下所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/bbea219c8bd6e8fcf583889319ab13e04590b7af2ddbf273bbfa548ef7280ba4.jpg)  

时刻0：甲开始发送分组1。时刻 $r$ ：路由器开始发送分组1，甲开始发送分组2。时刻 $2r$ 分组1到达，路由器开始发送分组2，甲开始发送分组3·可以看出，分组1到达乙所需的时间为 $2r$ ，当分组1到达后，每隔时间 $r$ 就有一个分组到达。参考2010年真题的流水线思路，甲和乙通过一个路由器相连，也就是2个流水段，两段链路的数据传输速率相同，表示流水段的时间相同，即 $r\!=\!10\mathrm{k}\flat\!\!-\!\!10\mathrm{M}\flat/\mathrm{s}\!=\!1\mathrm{ms}$ ，则传输 $m$ 个分组所需的时间 $t\!=\!2r+(m\!-\!1)\!\times\!r$ ，因为忽略分组头开销，分组数 $m\!=\!8\mathbf{M}\mathbf{b}\!\div\!10\mathbf{k}\mathbf{b}\!=\!800$ ，所以得出总发送时延 $t\!=\!2+(800-1)\!\times\!1\!=\!80\,1\mathrm{ms}.$  

21.C  

本题实际考查奈奎斯特定理，只需求出一个码元调制出的符号个数 $V$ 即可。根据奈奎斯特定理，最大数据传输速率 $=2W\mathrm{log}_{2}V\,{=}\,48\mathrm{M}\mathrm{b}/\mathrm{s}$  $W\,{=}\,4\mathrm{MHz}$ ，求出 $V\!=\!2^{6}\!=\!64$  

# 二、综合应用题  

01.【解答】  

设 $D$ 是分组数据的大小，需要的分组数目 $=10^{6}/D$ ，开销 $=100\!\times\!N$ （被丢弃分组的首部也已计入开销），因此“开销 $^+$ 丢失” $=100\!\times\!10^{6}/D\!+D.$  

当 $D\!=\!1000$ 时，“开销 $^+$ 丢失” $\mathrm{\Sigma}=100{\times}10^{6}/1000+1000=1010000\mathrm{B}$ 当 $D\!=\!20000$ 时，“开销 $^+$ 丢失” $\mathrm{\Sigma}=100{\times}10^{6}/20000+20000=25000\mathrm{B}$ 设“开销 $^+$ 丢失”字节总数目为y， $y=10^{8}/D+D$ ，求微分有 $\mathrm{d}y/\mathrm{d}D\!=\!1-10^{8}/D^{2}\,_{\circ}$ 当 $D\!=\!10^{4}$ 时， $\mathrm{d}y/\mathrm{d}D\!=\!0$ ，所以分组数据大小的最佳值是 $10000\mathrm{B}$  

02.【解答】  

传播时延  $\mathrm{\Omega}=2{\times}10^{3}\mathrm{m/(}2{\times}10^{8}\mathrm{m/s)}=10^{-5}\mathrm{s}=10{\upmu}\mathrm{s}.$  

1）分组大小为100B：假设带宽大小为  $x$  ，要使传播时延等于发送时延，带宽  $x\,{=}\,100\mathrm{B}/10\upmu\mathrm{s}\,{=}\,10\mathrm{MB/s}\,{=}\,80\mathrm{M}\mathrm{b/s}$  

2）分组大小为512B：  

假设带宽大小为  $y$  ，要使传播时延等于发送时延，带宽  $y\,{=}\,512\mathrm{B}/10\upmu\mathrm{s}\,{=}\,51.2\mathrm{MB/s}\,{=}\,409.6\mathrm{MB/s}$  

因此，带宽应分别等于 $80\mathrm{M}\mathrm{b/s}$ 和 $409.6\mathrm{M}\mathrm{b}/\mathrm{s}$  

03.【解答】  

若网络容易丢失分组，则对每个分组逐一进行确认较好，此时仅重传丢失的分组。另一方面若网络高度可靠，则在不发生差错的情况下，仅在整个文件传送的结尾发送一次确认，以减少确认次数，进而节省带宽。不过，即使只有单个分组去失，也要重传整个文件。  
# 1.2计算机网络体系结构与参考模型  

# 1.2.1计算机网络分层结构  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/96aa5fefc2bfd988ed66f2d6416a1098a86c3623d25175b86cac320a265ba74c.jpg)  

网络体系结构的定义（2010）  

计算机网络的各层及其协议的集合称为网络的体系结构（Architecture）。换言之，计算机网络的体系结构就是这个计算机网络及其所应完成的功能的精确定义。要强调的是，这些功能究竟是用何种硬件或软件完成的，是一个遵循这种体系结构的实现（Implementation）问题。体系结构是抽象的，而实现则是具体的，是真正在运行的计算机硬件和软件。计算机网络体系结构通常都具有可分层的特性，它将复杂的大系统分成若干较容易实现的层次。  

分层的基本原则如下：  

1）每层都实现一种相对独立的功能，降低大系统的复杂度。  

2）各层之间的接口自然清晰，易于理解，相互交流尽可能少。  

3）各层功能的精确定义独立于具体的实现方法，可以采用最合适的技术来实现，  

4）保持下层对上层的独立性，上层单向使用下层提供的服务。  

5）整个分层结构应能促进标准化工作。  

在计算机网络分层结构中，第 $n$ 层中的活动元素通常称为第 $n$ 层实体。具体来说，实体指任何可发送或接收信息的硬件或软件进程，通常是某个特定的软件模块。不同机器上的同一层称为对等层，同一层的实体称为对等实体。第 $n$ 层实体实现的服务为第 $n+1$ 层所用。在这种情况下，第 $n$ 层称为服务提供者，第 $n+1$ 层则服务于用户。  

在计算机网络体系结构中，对等层之间传送的数据单位称为该层的协议数据单元（PDU），第 $n$ 层的PDU记为 $n$ -PDU。各层的PDU都分为数据和控制信息两部分。  

服务数据单元（SDU)：为完成用户所要求的功能而传送的数据。第 $n$ 层的SDU记为 $n$ SDU。协议控制信息（PCI)：控制协议操作的信息。第 $n$ 层的PCI记为 $n$ PCI  

每层的协议数据单元都有一个通俗的名称，如物理层的PDU称为比特流，数据链路层的PDU称为顿，网络层的PDU称为分组，传输层的PDU称为报文段。  

当在各层之间传输数据时，将从第 $n+1$ 层收到的PDU作为第 $n$ 层的SDU，加上第 $n$ 层的PCI，就封装成了第 $n$ 层的PDU，交给第 $n-1$ 层后作为SDU发送，接收方接收时做相反的处理因此可知三者的关系为 $n{\mathrm{-SDU}}+n{\mathrm{-CI}}=n{\mathrm{-PDU}}\,{=}\,(n-1)$ -SDU，其变换过程如图1.7所示。  

具体地，层次结构的含义包括如下几方面：  

1）第 $n$ 层的实体不仅要使用第 $n-1$ 层的服务来实现自身定义的功能，而且要向第 $n+1$ 层提供本层的服务，该服务是第 $n$ 层及其下面各层提供的服务总和。  

2）最低层只提供服务，是整个层次结构的基础：最高层面向用户提供服务。3）上一层只能通过相邻层间的接口使用下一层的服务，而不能调用其他层的服务。  

4）当两台主机通信时，对等层在逻辑上有一个直接信道，表现为能直接将信息传送到对方。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/b77b831057ee90ae6a2d9b9cae1dcbd0c76b5de0a6deea4a2c4d15026db44075.jpg)  
图1.7网络各层数据单元的联系  

# 1.2.2计算机网络协议、接口、服务的概念  

# 1.协议  

要在网络中做到有条不紊地交换数据，就必须遵循一些事先约定好的规则，其规定了所交换数据的格式及有关的同步问题。为了在网络中进行数据交换而建立的这些规则、标准或约定称为网络协议（NetworkProtocol），是控制在对等实体之间进行通信的规则的集合，是水平的。不对等实体之间是没有协议的，如用TCP/IP协议栈通信的两个结点A和结点B，结点A的传输层和结点B的传输层之间存在协议，但结点A的传输层和结点B的网络层之间不存在协议。  

协议由语法、语义和同步三部分组成  

# 命题追踪同步的定义（2020）  

1）语法。数据与控制信息的格式。例如，TCP报文段格式就是由TCP协议的语法定义的。  

2）语义。即需要发出何种控制信息、完成何种动作及做出何种应答。例如，在建立TCP连接的三次握手时所执行的操作就是由TCP协议的语义定义的。  

3）同步（或时序）。执行各种操作的条件、时序关系等，即事件实现顺序的详细说明。例如，建立TCP连接的三次握手操作的时序关系就是由TCP协议的同步定义的。  

# 2.接口  

同一结点内相邻两层的实体交换信息的逻辑接口称为服务访问点（ServiceAccessPoint，SAP）。每层只能为紧邻的层之间定义接口，而不能跨层定义接口。服务是通过SAP提供给上层使用的，第 $n$ 层的SAP就是第 $n+1$ 层可以访问第 $n$ 层服务的地方。例如，在本书描述的5层体系结构中，数据链路层的服务访问点为帧的“类型”字段，网络层的服务访问点为IP数据报的“协议”字段，传输层的服务访问点为“端口号”字段。  

# 3.服务  

服务是指下层为紧邻的上层提供的功能调用，是垂直的。对等实体在协议的控制下，使得本层能为上层提供服务，但要实现本层协议，还需要使用下层提供的服务。当上层使用下层提供的服务时，必须与下层交换一些命令，这些命令称为服务原语。  
OSI参考模型将原语划分为四类：  

1）请求（Reguest）。由服务用户发往服务提供者，请求完成某项工作。2）指示（Indication）。由服务提供者发往服务用户，指示用户做某件事情。3）响应（Response）。由服务用户发往服务提供者，作为对指示的响应。  

4）证实（Confirmation）。由服务提供者发往服务用户，作为对请求的证实。  

这四类原语用于不同的功能，如建立连接、传输数据和断开连接等。有应答服务包括全部四类原语，而无应答服务则只有请求和指示两类原语。四类原语的关系如图1.8所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c465c00fecdaace844348a56599b0bfb30ca06ba294b146e002eeb1081a634b4.jpg)  
图1.8四类原语的关系  

注意，协议和服务概念上是不一样的。首先，只有本层协议的实现才能保证向上一层提供服务。本层的服务用户只能看见服务而无法看见下面的协议，即下面的协议对上层的服务用户是透明的。其次，协议是“水平的"，即协议是控制对等实体之间通信的规则。但是，服务是“垂真的”，即服务是由下层通过层间接口向上层提供的。另外，并非在一层内完成的全部功能都称为服务，只有那些能够被高一层实体“看得见”的功能才称为服务。  

协议、接口、服务三者之间的关系如图1.9所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/626bd9b77ec2839f6bcc9d127b243ba971ad814f5bd6d44cd4ca7a6a1070033c.jpg)  
图1.9协议、接口、服务三者之间的关系  

计算机网络提供的服务可按以下三种方式分类。  

（1）面向连接服务与无连接服务  

在面向连接服务中，通信前双方必须先建立连接，分配相应的资源（如缓冲区），以保证通信能正常进行，传输结束后释放连接和占用的资源。因此这种服务可分为连接建立、数据传输和连接释放三个阶段。例如，TCP就是一种面向连接服务的协议。  

在无连接服务中，通信前双方不需要先建立连接，需要发送数据时可直接发送，将每个带有目的地址的包（报文分组）传送到线路上，由系统选定路线进行传输。这种服务常被描述为“尽最大努力交付”，是一种不可靠的服务。例如，IP、UDP就是一种无连接服务的协议。  

# （2）可靠服务和不可靠服务  

可靠服务是指网络具有纠错、检错、应答机制，能保证数据正确、可靠地传送到目的地。不可靠服务是指网络只是尽量让数据正确、可靠地传送到目的地，是一种尽力而为的服务。  

对于提供不可靠服务的网络，其网络的正确性、可靠性要由应用或用户来保障。例如，用户收到信息后要判断信息的正确性，若不正确，则用户就要把出错信息报告给信息的发送者，以便发送者采取纠正措施。通过用户的这些措施，可将不可靠服务变成可靠服务。  
（3）有应答服务和无应答服务  

有应答服务是指接收方在收到数据后向发送方给出相应的应答，该应答由传输系统内部自动实现，而不由用户实现。发送的应答既可以是肯定应答，又可以是否定应答，通常在接收到的数据有错误时发送否定应答。例如，文件传输服务就是一种有应答服务。  

无应答服务是指接收方收到数据后不自动给出应答。若需要应答，则由高层实现。例如，对于WWW服务，客户端收到服务器发送的页面文件后不给出应答。  

# 1.2.3ISO/OSI TCP/IP模型  

# 1.OSI参考模型  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/e61874f66877634089b440c5badd16d8f1dc349ad0cb374eb5585eaf353af0a5.jpg)  

OSI参考模型的通信子网各层所包含的中继设备（2016）  

国际标准化组织（ISO）提出的网络体系结构模型称为开放系统互连参考模型（OSI/RM），通常简称为OSI参考模型。OSI参考模型有7层，自下而上依次为物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。低三层统称通信子网，是为联网而附加的通信设备，完成数据的传输功能；高三层统称资源子网，相当于计算机系统，完成数据的处理等功能。传输层承上启下。0SI参考模型的层次结构如图1.10所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/0007f90cfeedff7909c783165de40e20f9808e61a22237bdf22d1010c48418c4.jpg)  
图1.10OSI参考模型的层次结构  

下面详述OSI参考模型各层的功能。  

# 命题追踪OSI参考模型的层次结构（2013、2014、2017、2019）  

（1）物理层（Physical Layer）  

物理层的传输单位是比特，功能是在物理介质上为数据端设备透明地传输原始比特流。物理层主要定义数据终端设备（DTE）和数据通信设备（DCE）的物理与逻辑连接方法。  

物理层接口标准很多，如EIA-232C、EIA/TIARS-449、CCITT的X.21等。图1.11表示的是两个通信结点及它们间的一段通信链路，物理层主要研究以下内容  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/95bdedaa52206e2c534c5ce90c2d9a507b96d7293774f6465464cbfd14036917.jpg)  
图1.11两个通信结点及它们间的一段通信链路  

$\textcircled{\scriptsize{1}}$ 通信链路与通信结点的连接需要一些电路接口，物理层规定了这些接口的一些参数，如机械形状和尺寸、交换电路的数量和排列等，例如笔记本电脑上的网线接口。  
$\textcircled{2}$ 物理层规定了通信链路上所传输的信号的意义和电气特征。例如，若规定信号X代表数字0，则当结点传输0时就发出信号X，而当结点接收到信号X时就知道收到的是0。  

注意，传输信息所用的一些物理介质（如双绞线、光缆、无线信道等）并不在物理层协议之内，而在物理层协议下面。因此，有人将物理介质当作第0层。  

（2）数据链路层（Data Link Layer）  

# 命题追踪OSI参考模型的数据链路层的功能（2022）  

数据链路层的传输单位是顿。两台主机之间的数据传输总是在一段一段的链路上传送的，这就需要使用专门的链路层协议。数据链路层将网络层交来的IP分组封装成顿，并且可靠地传输到相邻结点的网络层。主要作用是加强物理层传输原始比特流的功能，将物理层提供的可能出错的物理连接改造为逻辑上无差错的数据链路，使之对网络层表现为一条无差错的链路。  

因为外界噪声的干扰，所以原始的物理连接在传输比特流时可能发生错误。如图1.11所示，结点A想向结点B传输数字0，于是发出信号X：但在传输过程中受到于扰，信号X变成了信号Y，而信号Y又刚好代表1，结点B接收到信号Y时，误以为结点A传送了数字1，从而发生差错。数据链路层协议应能检测出这些差错，然后将收到的错误信息丢弃。  

如图1.11所示，在两个相邻结点之间传送数据时，结点A的发送速率可能比结点B的接收速率快，若不加以控制，则结点B就会丢充很多来不及接收的正确数据，造成传输线路效率下降。流量控制可以协调两个结点的速率，使结点A的发送速率刚好是结点B的接收速率。  

广播式网络在数据链路层还要处理新的问题，即如何控制对共享信道的访问。数据链路层的一个特殊子层一一介质访问子层就是专门处理这个问题的。  

典型的数据链路层协议有SDLC、HDLC、PPP、STP和帧中继等。  

（3）网络层（Network Layer）  

网络层的传输单位是数据报。它关心的是通信子网的运行控制，主要任务是将网络层的协议数据单元（分组）从源结点传输到目的结点，为分组交换网上的不同主机提供通信服务。关键问题是对分组进行路由选择，并实现流量控制、拥塞控制、差错控制和网际互连等功能。  

# 注意  

无论是在哪一层传送的数据单元，都可以笼统地用“分组”来表示。  

如图1.12所示，当结点A向结点B传输一个分组时，既可经过边a、C、g，又可经过边b、h,有多条可以选择的路由，而网络层的作用是根据网络的情况，利用相应的路由算法计算出一条合适的路径，使这个分组可以顺利地到达结点B。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/64b7691ecbb524c8f922741a5e0d7779d28ceed9a6a1897443247262e677bc2b.jpg)  
图1.12某网络结构图  

流量控制与数据链路层的流量控制的含义一样，都是协调A的发送速率和B的接收速率。  

差错控制是通信结点之间约定的特定检错规则，接收方根据该规则检查接收到的分组是否出错，若出错，则能纠错就纠错，不能纠错就丢弃，确保向上层提交的数据都是无误的。  
若图1.12中的结点都来不及接收分组而丢弃大量分组，导致结点间无法正常通信，那么网络就处于拥塞状态。网络层要采取措施来缓解这种拥塞，这就是拥塞控制。  

互联网是由大量异构网络通过路由器相互连接起来的。互特网使用的网络层协议是无连接的网际协议（IP）和许多种路由选择协议，因此互联网的网络层也称网际层或IP层。  

网络层的协议有IP、IPX、ICMP、IGMP、ARP、RARP、RIP和OSPF等。  

（4）传输层（Transport Layer）  

# 命题追踪OSI参考模型的传输层的功能（2009）  

传输层也称运输层，负责主机中两个进程之间的通信，功能是为端到端连接提供可靠的传输服务，即为端到端连接提供流量控制、差错控制、服务质量、数据传输管理等服务。  

数据链路层提供的是点到点通信，传输层提供的是端到端通信，两者不同。  

通俗地说，点到点可理解为主机和主机之间的通信，一个点是指一个硬件地址或IP地址，网络中参与通信的主机是通过硬件地址或IP地址来标识的：端到端通信是指运行在不同主机内的两个进程之间的通信，一个进程由一个端口来标识，所以称为端到端通信。  

通过传输层的屏蔽，高层用户看不到通信子网的交替和变化。因为一台主机可同时运行多个进程，所以传输层具有复用和分用的功能。复用是指多个应用层进程可同时使用下面传输层的服务，分用是指传输层将收到的信息分别交付给上面应用层中相应的进程。  

传输层的协议有TCP、UDP。（5）会话层（Session Layer）  

# 命题追踪OSI参考模型的会话层的功能（2019）  

会话层充许不同主机上的各个进程之间进行会话。这种服务主要为表示层实体或用户进程建立连接，并在连接上有序地传输数据，这就是会话，也称建立同步（SYN）。会话层负责管理主机间的会话进程，包括建立、管理和终正进程间的会话。会话层包含一种称为检查点的机制来维持可靠会话，使通信会话在通信失效时从检查点继续恢复通信，即断点下载的原理。  

（6）表示层（Presentation Layer）  

# 命题追踪OSI参考模型的表示层的功能（2013）  

表示层主要处理在两个通信系统中交换信息的表示方式。不同机器采用的编码和表示方法不同，为了使不同表示方法的数据和信息之间能够互相交换，表示层采用抽象的标准方法定义数据结构，并采用标准的编码形式。此外，数据压缩、加密和解密也是表示层的功能。  

（7）应用层（Application Layer）  

应用层是OSI参考模型的最高层，是用户与网络的接口。应用层为特定类型的网络应用提供访向OS参考模型环境的手段。用户的实际应用多种多样，这就要求应用层采用不同的应用协议来解决不同类型的应用要求，因此应用层是最复杂的一层，使用的协议也最多。典型的协议有用于文件传送的FTP、用于电子邮件的SMTP、用于万维网的HTTP等。  

# 2.TCP/IP模型  

# 命题追踪TCP/IP模型的各层的顺序（2021）  

TCP/IP模型从低到高依次为网络接口层（对应OSI参考模型的物理层和数据链路层）、网际层、传输层和应用层（对应OSI参考模型的会话层、表示层和应用层）。TCP/IP因为得到广泛应用而成为事实上的国际标准。TCP/IP模型的层次结构及各层的主要协议如图1.13所示。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c14a9addbd31bfab185f7ddf31fee34a7a506bbe4d93206e83711b8f80157e3f.jpg)  
图1.13TCP/IP模型的层次结构及各层的主要协议  

网络接口层的功能类似于OSI参考模型的物理层和数据链路层。它表示与物理网络的接口，但实际上TCP/IP本身并未真正描述这一部分，只是指出主机必须使用某种协议与网络连接，以便在其上传输IP分组。具体的物理网络既可是各种类型的局域网，如以太网、令牌环网、令牌总线网等，又可是诸如电话网、SDH、X.25、帧中继和ATM等公共数据网络。网络接口层的作用是从主机或结点接收IP分组，并将它们发送到指定的物理网络上。  

# 命题追踪TCP/IP模型的网际层的功能（2011、2021）  

网际层（主机-主机）是TCP/IP体系结构的关键部分，功能上它与OSI参考模型的网络层非常相似。网际层将分组发往任何网络，并为其独立地选择合适的路由，但不保证各个分组有序地到达，各个分组的有序和可靠交付由高层负责。网际层定义了标准的分组格式和协议，即IP。当前采用的IP是第4版，即IPv4，它的下一版本是IPv6。  

传输层（应用-应用或进程-进程）的功能同样与OSI参考模型中的传输层类似，即使得发送端和目的端主机上的对等实体进行会话。传输层主要使用以下两种协议：  

1）传输控制协议（Transmission Control Protocol，TCP）。它是面向连接的，传输数据之前必须先建立连接，能够提供可靠的交付。数据传输的单位是报文段。2）用户数据报协议（UserDatagramProtocol，UDP）。它是无连接的，不保证提供可靠的交付，只能提供“尽最大努力交付”。数据传输的单位是用户数据报。  

应用层（用户-用户）包含所有的高层协议，如虚拟终端协议（Telnet）、文件传输协议（FTP）域名解析服务（DNS）、电子邮件协议（SMTP）和超文本传输协议（HTTP）。  

由图1.13可以看出，IP是互联网中的核心协议；TCP/IP可为各式各样的应用提供服务（所everything over IP），TCP/IP IP（所谓IPovereverything）。因此，互联网才会发展到今天的规模。  

# 3.TCP/IP模型与OSI参考模型的比较  

TCP/IP模型与OSI参考模型有许多相似之处。  

首先，二者都采取分层的体系结构，且分层的功能也大体相似，  

其次，二者都是基于独立的协议栈的概念。  

最后，二者都可解决异构网络的互连，实现不同厂家生产的计算机之间的通信。  

两个模型除了具有这些基本的相似之处，也有很多差别。  

第一，OSI参考模型的最大贡献是精确定义了三个主要概念：服务、协议和接口，这与现代的面向对象程序设计思想非常吻合。而TCP/IP模型在这三个概念上没有明确区分。  
第二，OSI参考模型是7层模型，而TCP/IP模型是4层结构。TCP/IP模型将OSI参考模型的表示层和会话层的功能合并到了应用层，还将数据链路层和物理层合并为网络接口层。  

第三，OSI参考模型先有模型，后有协议规范，通用性良好，适合描述各种网络。TCP/IP模型正好相反，即先有协议栈，后建立模型，因此不适合任何其他的非TCP/IP网络。  

第四，OSI参考模型在网络层支持无连接和面向连接的通信，但在传输层仅有面向连接的通信。而TCP/P模型认为可靠性是端到端的向题，因此它在网际层仅有一种无连接的通信模式，但传输层支持无连接和面向连接两种模式。这个不同点常常作为考查点。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/a20b555348c66a1d86d4fd42dd6992721d73608bd7121635c924dba4b9b8c816.jpg)  
图1.14TCP/IP模型与OSI参考模型的层次对应关系  

OSI参考模型和TCP/IP模型都不是完美的，对二者的批评都很多。OSI参考模型的设计者从一开始就试图建立一个全世界的计算机网络都要遵循的统一标准。从技术角度看，他们追求一种完美的理想状态，导致基于OSI参考模型的软件效率极低。OSI参考模型缺之市场与商业动力，结构复杂，运行效率低，这是它未能达到预期目标的重要原因。  

学习计算机网络时，我们往往采取折中的办法，即综合OSI参考模型和TCP/IP模型的优点，采用一种如图1.15所示的只有5层协议的体系结构，本书也采用这种体系结构进行讨论。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/ec6112de998bfabbd24993f5950da08fa636670fe503551cad0412179dfdb9ac.jpg)  
图1.15网络的5层协议体系结构模型  

# 命题追踪应用层DNS报文逐层封装的关系（2021）  

最后简单介绍使用协议栈进行通信的数据传输过程。每个协议栈的顶端都是一个面向用户的接口，下面各层是为通信服务的协议。用户传输的数据通常是用户能够理解的自然语言，通过应用层将自然语言转化为用于通信的通信数据。通信数据到达传输层，作为传输层的数据部分（传输层SDU），加上传输层的控制信息（传输层PCI），组成传输层的PDU：下放到网络层后，就成为网络层的SDUJ，加上网络层的PCI，又组成了网络层的PDU；下放到数据链路层..·就这样层层下放，层层包裹，最后形成的数据包通过通信线路传输，到达接收方结点协议栈，接收方逆向逐层地拆开“包裹”，然后将收到的数据提交给用户，如图1.16所示。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/0c26307fd09bd47a50dd8f5a89155680090dda15a93f2b1ab530a1e0943cba84.jpg)  
图1.16协议栈的通信过程示例  

# 1.2.4 本节习题精选  

# 单项选择题  

01.（）不是对网络模型进行分层的目标。  

A.提供标准语言B.定义功能执行的方法C.定义标准界面D.增加功能之间的独立性  

02.将用户数据分成一个个数据块传输的优点不包括（）  

A.减少延迟时间B.提高错误控制效率C.使多个应用更公平地使用共享通信介质D.有效数据在协议数据单元（PDU）中所占比例更大  

03.协议是指在（）之间进行通信的规则或约定。  

A.同一结点的上下层B.不同结点C.相邻实体D.不同结点对等实体  

04.OSI参考模型中的实体指的是（）  

A.实现各层功能的规则B.上下层之间进行交互时所要的信息C.各层中实现该层功能的软件或硬件D.同一结点中相邻两层相互作用的地方  

05.在OSI参考模型中，第 $n$ 层与它之上的第 $n+1$ 层的关系是（）。  

A.第 $n$ 层为第 $n+1$ 层提供服务B.第  $n+1$  层为从第  $n$  层接收的报文添加一个报头 C.第 $n$ 层使用第 $n+1$ 层提供的服务D.第 $n$ 层和第 $n+1$ 层相互没有影响  

06.关于计算机网络及其结构模型，下列几种说法中错误的是（）  

A.世界上第一个计算机网络是ARPAnetB.Inter met ARPAnet C.国际标准化组织（ISO）设计出了OSI/RM参考模型，即实际执行的标准D.TCP/IP参考模型分为4个层次  

07.（）是计算机网络中OSI参考模型的3个主要概念。  

A.服务、接口、协议B.结构、模型、交换C.子网、层次、端口D.广域网、城域网、局域网  
08.描述网络协议三要素的是（）。  

A.数据格式、编码、信号电平B.数据格式、控制信息、速度匹配C.语法、语义、同步 D.编码、控制信息、同步  

09.TCP通信双方通过“三报文握手”建立连接，这属于网络协议三要素中的（）。  

A.语义B.时序C.服务D.语法  

10.下图描述的网络协议要素是（）  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/41c81872330ac21a3a43488629f87709f2960b68f661e24d59526f91e6a2da5d.jpg)  
题10图IPv4数据报的首部格式  

I.语法II.语义III.时序（同步）A.仅IB.仅ⅡIC.仅IIID.I、ⅡI和III  

11.下列关于OSI参考模型的描述中，错误的是（）。  

A.OSI参考模型定义了开放系统的层次结构B.OSI参考模型定义了各层所包括的可能的服务C.OSI参考模型作为一个框架协调组织各层协议的制定D.OSI参考模型定义了各层接口的实现方法  

12.负责将比特转换成电信号进行传输的层是（）A.应用层B.网络层C.数据链路层D.物理层

13.下列选项中不属于OSI参考模型中物理层功能的是（）  

A.比特0和1使用何种电信号表示C.传输能否在两个方向上同时进行B.1个比特持续多长时间D.避免快速发送方“淹没”慢速接收方  

14.OSI参考模型中的数据链路层不具有（）功能。A.物理寻址B.流量控制C.差错检验D.拥塞控制

15.下列能够最好地描述OSI参考模型的数据链路层功能的是（）。  

A.提供用户和网络的接口B.处理信号通过介质的传输C.控制报文通过网络的路由选择D.保证数据正确的顺序和完整性  

16.当数据由端系统A传送至端系统B时，不参与数据封装工作的是（）  

A.物理层B.数据链路层C.网络层D.表示层  

17.在OSI参考模型中，实现端到端的应答、分组排序和流量控制功能的协议层是（）。A.会话层C.传输层D.数据链路层  

18.在ISO/OSI参考模型中，可同时提供无连接服务和面向连接服务的是（）A.物理层B.数据链路层C.网络层D.传输层  
19.在OSI参考模型中，当两台计算机进行文件传输时，为防止中间出现网络故障而重传整个文件的情况，可通过在文件中插入同步点来解决，这个动作发生在（）。  

A.表示层B.会话层C.网络层D.应用层

20.数据的格式转换及压缩属于OSI参考模型中（）的功能。A.应用层B.表示层C.会话层D.传输层  

21.OSI参考模型中（）通过设置检验点，使通信双方在通信失效时可从检验点恢复通信。A.传输层C.表示层D.会话层  

22.下列说法中正确描述了OSI参考模型中数据的封装过程的是（）。  

A.数据链路层在分组上仅增加了源物理地址和目的物理地址B.网络层将高层协议产生的数据封装成分组，并增加第三层的地址和控制信息C.传输层将数据流封装成数据帧，并增加可靠性和流控制信息D.表示层将高层协议产生的数据分割成数据段，并增加相应的源和目的端口信息  

23.在OSI参考模型中，提供流量控制功能的层是第（ $\textcircled{\scriptsize{1}}$ ）层；提供建立、维护和拆除端到端的连接的层是（ $\circledcirc$ )；为数据分组提供在网络中路由的功能的是（ $\textcircled{3}$ )；传输层提供( $\textcircled{4}$ 一的数据传送；为网络层实体提供数据发送和接收功能及过程的是（ $\circledast$ 一  

$\textcircled{\scriptsize{1}}$ A.1、2、3B.2、3、4C. 3、4、5D.4、5、6 $\circledcirc$ A.物理层B.数据链路层C.会话层D.传输层 $\textcircled{3}$ A.物理层B.数据链路层C.网络层D.传输层 $^{(4)}$ A．主机进程之间B.网络之间C.数据链路之间D.物理线路之间 $\circledast$ A.物理层B.数据链路层C.会话层D.传输层  

24.在OSI参考模型中，（）利用通信子网提供的服务实现两个进程之间的端到端通信。  

A.网络层B.传输层C.会话层D.表示层  

25.互联网采用的核心技术是（）  

A.TCP/IPB.局域网技术C.远程通信技术D.光纤技术  

26.在TCP/IP模型中，（）处理关于可靠性、流量控制和错误校正等问题。  

A.网络接口层B.网际层C.传输层D.应用层  

27.上下邻层实体之间的接口称为服务访问点，应用层的服务访问点也称（）  

A.用户接口B.网卡接口C.IP地址D.MAC地址  

28.在OSI参考模型中，各层都有差错控制过程，指出以下每种差错发生在哪些层中。噪声使传输链路上的一个0变成1或一个1变成0（ $\textcircled{\scriptsize{1}}$ )。收到一个序号错误的目的顿（ $\circledcirc$ ).一台打印机正在打印，突然收到一个错误指令要打印头回到本行的开始位置（ $\textcircled{3}$ )。  

$\textcircled{\scriptsize{1}}$ A.物理层B.网络层C.数据链路层D.会话层 $\circledcirc$ A.物理层B.网络层C.数据链路层D.会话层 $\textcircled{3}$ A.物理层B.网络层C.应用层D.会话层  

29.【2009统考真题】在OSI参考模型中，自下而上第一个提供端到端服务的层是（）。A.数据链路层B.传输层C.会话层D.应用层

30.【2010统考真题】下列选项中不属于网络体系结构所描述的内容是（）。  

A.网络的层次B.每层使用的协议C.协议的内部实现细节D.每层必须完成的功能31.【2011统考真题】TCP/IP参考模型的网络层提供的是（）  
A.无连接不可靠的数据报服务B.无连接可靠的数据报服务C.有连接不可靠的虚电路服务D.有连接可靠的虚电路服务  

32.【2013统考真题】在0SI参考模型中，功能需由应用层的相邻层实现的是（）。A.对话管理B.数据格式转换C.路由选择D.可靠数据传输33.【2014统考真题】在0SI参考模型中，直接为会话层提供服务的是（）A.应用层B.表示层C.传输层D.网络层  

34.【2016统考真题】在OSI参考模型中，路由器、交换机（Switch）、集线器（Hub）实现的最高功能层分别是（）  

A.2、2、1B.2、2、2C.3、2、1D.3、2、2  

35.【2017统考真题】假设OSI参考模型的应用层欲发送400B的数据（无拆分），除物理层和应用层外，其他各层在封装PDU时均引入20B的额外开销，则应用层的数据传输效率约为（）。  

A.  $80\%$  B.  $83\%$  C.  $87\%$  D.  $91\%$  36.【2019统考真题】0SI参考模型的第5层（自下而上）完成的主要功能是（）A.差错控制B.路由选择C.会话管理D.数据表示转换37.【2020统考真题】下图描述的协议要素是（）  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/23c3705a4c2ad4577ee22067d8916e21fd1732aed0e79158915597c9f9229040.jpg)  

1.语法I1.语义III.时序A.仅IB.仅1ⅡIC.仅IIID.I、ⅡI和III  

38.【2021统考真题】在TCP/IP参考模型中，由传输层相邻的下一层实现的主要功能是（）。  

A.对话管理B.路由选择C.端到端报文段传输D.结点到结点流量控制  

39.【2022统考真题】在ISO/OSI参考模型中，实现两个相邻结点间流量控制功能的是（）A.物理层B.数据链路层C.网络层D.传输层  

# 1.2.5 答案与解析  

单项选择题  

01.B  

分层属于计算机网络体系结构的范畴，选项A、C和D均是网络模型分层的目的，而分层的目的不包括定义功能执行的具体方法。  

02.D  

将用户数据分成一个个数据块传输，因为每块均需加入控制信息，所以实际上会使有效数据在PDU中所占的比例更小。其他各项均为其优点。  

03.D 协议是为对等层实体之间进行逻辑通信而定义的规则的集合。  
04. C  

实体是指每一层中实现该层功能的软件或硬件，可以是程序、模块、子程序或设备。  

05.A  

服务是指下层为紧邻的上层提供的功能调用，每层只能调用紧邻下层提供的服务（通过服务访问点），而不能跨层调用。  

06.C  

国际标准化组织（ISO）设计了开放系统互连参考模型（OSI/RM)，即7层网络参考模型，但实际执行的国际标准是TCP/IP标准。  

07. A  

计算机网络要做到有条不素地交换数据，就必须遵守一些事先约定的原则，这些原则就是协议。在协议的控制下，两个对等实体之间的通信使得本层能够向上一层提供服务。要实现本层协议，还要使用下一层提供的服务，而提供服务就是交换信息，交换信息就需要通过接口，所以说服务、接口、协议是0SI参考模型的3个主要概念。  

08. C  

描述网络协议的三要素是语法、语义和同步。  

09.B  

网络协议三要素中的时序（或称同步）定义了通信双方的时序关系，TCP通信双方通过“三报文握手”建立连接，它规定发送SYN、ACK和SYN+ACK报文的先后顺序。  

10.A  

网络协议三要素中的语法定义所交换信息的格式，所以IPv4首部格式体现了语法的要素。  

11.D  

OSI参考模型不仅划分了层次结构，还定义了各层可能提供的服务，但并未规定协议的具体实现，而是描述了一些概念和原则，用来协调和组织各层所用的协议。OSI参考模型并未定义各层接口的实现方法，而把具体的实现细节留给了各个协议和标准，D错误。  

12.D 物理层为数据链路层提供二进制流的传输服务，涉及信号的编码、解码和同步等，D正确。  

13.D  

避免快速发送方“淹没”慢速接收方，描述的是流量控制的作用，属于数据链路层或传输层的功能。物理层只负责透明地传送比特流，不涉及流量控制的功能，D错误。  

14.D  

数据链路层在不可靠的物理介质上提供可靠的传输，作用包括物理寻址、组帧、流量控制、差错检验、数据重发等。网络层和传输层才具有拥塞控制的功能。  

15.D  

OSI参考模型的数据链路层向上提供可靠的传输服务，在差错检测的基础上，增加了顿编号、确认和重传机制，因此保证了数据正确的顺序和完整性。A是应用层的功能，B是物理层的功能，C是网络层的功能。学习3.1节后，对本题的理解将更深刻。  

16.A  

物理层以0、1比特流的形式透明地传输数据链路层提交的顺。网络层和表示层都为上层提交的数据加上首部，数据链路层为上层提交的数据加上首部和尾部，然后提交给下一层。物理层不存在下一层，自然也就不用封装。  
17.C  

只有传输层及以上各层的通信才能称为端到端，选项B、D错。会话层管理不同主机间进程的对话，而传输层实现应答、分组排序和流量控制功能。  

18.C  

本题容易误选D。ISO/OSI参考模型在网络层支持无连接和面向连接的通信，但在传输层仅支持面向连接的通信；TCP/IP模型在网络层仅有无连接的通信，而在传输层支持无连接和面向连接的通信。两类协议栈的区别是联考的考点，而这个区别是常考点。  

19.B  

在OSI参考模型中，会话层的两个主要服务是会话管理和同步。会话层使用检验点使通信会话在通信失效时从检验点继续恢复通信，实现数据同步。  

20.B  

OSI参考模型表示层的功能有数据解密与加密、压缩、格式转换等。  

21.D  

会话层的主要功能是建立、管理和终止进程间的会话，以及使用检查点（或称检验点）使会话在通信失效时从检验点继续恢复通信，实现数据同步。  

22.B  

数据链路层在分组上除增加源和目的物理地址外，也增加控制信息；传输层的PDU不称为倾；表示层不负责将高层协议产生的数据分割成数据段，负责增加相应源和目的端口信息的应是传输层。选项B正确描述了OSI参考模型中数据的封装过程，数据经过网络层后，只是增加了第三层PCI。  

23. $\textcircled{\scriptsize{1}}$ B、 $\circledcirc$ D、 $\textcircled{3}$ C、 $\textcircled{4}$ A、 $\circledast$ B  

在计算机网络中，流量控制指的是通过限制发送方发出的数据流量，使得其发送速率不超过接收方接收速率的一种技术。流量控制功能可存在于数据链路层及其之上的各层中。目前提供流量控制功能的主要是数据链路层、网络层和传输层。不过，各层的流量控制对象不一样，各层的流量控制功能是在各层实体之间进行的。  

在OSI参考模型中，物理层实现比特流在传输介质上的透明传输；数据链路层将有差错的物理线路变成无差错的数据链路，实现相邻结点之间即点到点的数据传输。网络层的主要功能是路由选择、拥塞控制和网际互连等，实现主机到主机的通信；传输层实现主机的进程之间即端到端的数据传输。  

下一层为上一层提供服务，而网络层的下一层是数据链路层，所以为网络层实体提供数据发送和接收功能及过程的是数据链路层。  

24.B  

在OSI参考模型中，数据链路层提供链路上相邻结点之间的逻辑通信，网络层提供主机之间的逻辑通信，传输层在运行于不同主机上的进程之间（即端到端）提供逻辑通信。  

25.A  

协议是网络上计算机之间进行信息交换和资源共享时共同遵守的约定，没有协议的存在，网络的作用也就无从谈起。在互联网中应用的网络协议是采用分组交换技术的TCP/IP，它是互联网的核心技术。  

26.C  

TCP/IP模型的传输层提供端到端的通信，并且负责差错控制和流量控制，可以提供可靠的面向连接服务或不可靠的无连接服务。  
27.A  

在同一系统中相邻两层的实体交换信息的逻辑接口称为服务访问点（SAP）， $N$ 层的SAP是 $N+1$ 层可以访问 $N$ 层服务的地方。SAP用于区分不同的服务类型。在5层体系结构中，数据链路层的服务访问点为帧的“类型”字段，网络层的服务访问点为IP数据报的“协议”字段，传输层的服务访问点为“端口号”字段，应用层的服务访问点为“用户接口”。  

28. A、C、C  

1）物理层。物理层负责正确、透明地传输比特流（0，1）。2）数据链路层。数据链路层的PDU称为顿，帧的差错检测是数据链路层的功能。3）应用层。打印机是向用户提供服务的，运行的是应用层的程序。  

29.B  

传输层提供应用进程之间的逻辑通信（通过端口号），即端到端的通信。数据链路层负责相邻结点之间的通信，这个结点包括交换机和路由器等数据通信设备，且这些设备不能称为端系统。网络层负责主机到主机的逻辑通信。因此，答案为选项B。  

30. C  

计算机网络的各层及其协议的集合称为体系结构，分层就涉及对各层功能的划分，因此A、B、D正确。体系结构是抽象的，它不包括各层协议的具体实现细节。在讲解网络层次时，仅涉及各层的协议和功能，而内部实现细节没有提及。内部实现细节是由具体设备厂家确定的。  

31.A  

TCP/IP的网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务。考察IP首部，若是面向连接的，则应有用于建立连接的字段，但是首部中没有；若提供可靠的服务，则至少应有序号和检验和两个字段，但是IP分组头中也没有（IP首部中只有首部检验和）。通常有连接、可靠的应用是由传输层的TCP实现的。  

32.B  

在OSI参考模型中，应用层的相邻层是表示层，它是OSI参考模型七层协议的第六层。表示层的功能是表示出用户看得懂的数据格式，实现与数据表示有关的功能。主要完成数据字符集的转换、数据格式化及文本压缩、数据加密和解密等工作。  

33.C  

直接为会话层提供服务的是会话层的下一层，即传输层，答案为选项C。  

34.C  

集线器是一个多端口的中继器，工作在物理层。以太网交换机是一个多端口的网桥，工作在数据链路层。路由器是网络层设备，实现网络模型的下三层，即物理层、数据链路层和网络层。题中，Rl、Switch和Hub分别是路由器、交换机和集线器，实现的最高层功能分别是OSI参考模型中的网络层（第3层）、数据链路层（第2层）和物理层（第1层）。  

35.A  

OSI参考模型共7层，除去物理层和应用层，剩5层。它们向PDU引入  $20\mathrm{B}{\times}5\,{=}\,100\mathrm{B}$  的额 外开销。应用层是最高层，因此其数据传输效率为 $\mathrm{400B/500B}=80\%.$  

36.C  

OSI参考模型自下而上分别为物理层、数据链路层、网络层、传输层、会话层、表示层和应用层。第5层为会话层，它的主要功能是管理和协调不同主机上各种进程之间的通信（对话），即负责建立、管理和终止应用程序之间的会话，这也是会话层得名的原因。  
37. C  

协议由语法、语义和时序（又称同步）三部分组成。语法规定了通信双方彼此“如何讲”即规定了传输数据的格式。语义规定了通信双方彼此“讲什么”，即规定了所要完成的功能，如通信双方要发出什么控制信息、执行的动作和返回的应答。时序规定了信息交流的次序。由图可知发送方与接收方依次交换信息，体现了协议三要素中的时序要素。  

# 38.B  

TCP/IP模型中与传输层相邻的下一层是网际层。TCP/IP的网际层使用一种尽力而为的服务，它将分组发往任何网络，并为其独立选择合适的路由，但不保证各个分组有序到达，B正确。TCP/IP认为可靠性是端到端的问题（传输层的功能），因此它在网际层仅有无连接、不可靠的通信模式，无法完成结点到结点的流量控制（OSI参考模型的网络层具有该功能）。端到端的报文段传输为传输层的功能。对话管理在TCP/IP中属于应用层的功能。A、C和D错误。  

# 39.B  

在OSI参考模型中，数据链路层、网络层、传输层都具有流量控制功能，数据链路层是相邻结点之间的流量控制，网络层是整个网络中的流量控制，传输层是端到端的流量控制。  

# 1.3 本章小结及疑难点  

1.互联网使用的IP协议是无连接的，因此其传输是不可靠的。这样容易使人们感到互联网很不可靠。为什么当初不把互联网的传输设计为可靠的呢？  

传统电信网的主要用途是电话通信，且普通电话机不是智能的，因此电信公司必须花费巨大的代价将电信网设计得非常可靠，以保证用户的通信质量。  

数据的传送显然必须可靠。当初设计ARPAnet时，很重要的讨论内容之一是“谁应当负责数据传输的可靠性？”一种意见是主张像电信网那样，由通信网络负责数据传输的可靠性（因为电信网的发展史及技术水平已经证明，人们可将网络设计得相当可靠）。另一种意见则主张由用户主机负责数据传输的可靠性，理由是这样可使计算机网络便宜、灵活。  

计算机网络的先驱认为，计算机网络和电信网的一个重大区别是终端设备的性能差别很大。于是，他们采用了“端到端的可靠传输”策略，即在传输层使用面向连接的TCP协议，这样既能使网络部分价格便宜且灵活可靠，又能保证端到端的可靠传输。  

# 2.端到端通信和点到点通信有什么区别？  

本质上说，由物理层、数据链路层和网络层组成的通信子网为网络环境中的主机提供点到点的服务，而传输层为网络中的主机提供端到端的通信。  

直接相连的结点之间的通信称为点到点通信，它只提供一台机器到另一台机器之间的通信，不涉及程序或进程的概念。同时，点到点通信并不能保证数据传输的可靠性，也不能说明源主机与目的主机之间是哪两个进程正在通信，这些工作都由传输层来完成。  

端到端通信建立在点到点通信的基础上，由一段段点到点通信信道构成，以完成应用程序（进程）之间的通信。“端”是指用户程序的端口，端口号标识了应用层中的不同进程。  

# 3.如何理解传输速率和传播速率？  

传输速率是指主机或路由器在数字信道上发送数据的速率，也称传输率、数据率或比特率，单位是比特/秒（b/s），或干比特/秒（kb/s）、兆比特/秒（Mb/s）、吉比特/秒（Gb/s）等。  
# 注意  

在通信领域中表示速率时， $\mathbf{k}\!=\!10^{3}$  $\mathrm{M}\!=\!10^{6}$  $G\!=\!10^{9}$  $\mathrm{T}=10^{12}$ 。表示存储容量或文件大小时， $\mathtt{K}\!=\!2^{10}\!=\!1024$  $\scriptstyle\mathbf{M}\,=\,2^{20}$  $\mathrm{G}\!=\!2^{30}$  $\mathrm{T}\!=\!2^{40}$ ，这与通信领域中的表示方式不同。  

传播速率是指电磁波在信道中传播的速率，单位是米/秒（ $._{\mathrm{m/s}}$ ）或千米/秒（ $(\mathrm{km}/\mathrm{s})$  

在图1.17中，假定链路的传播速率为 $2{\times}10^{8}\mathrm{m/s}$ ，这相当于电磁波在该介质中 $1\upmu\mathrm{s}$ 可向前传播 $200\mathrm{m}$ 。若链路带宽为 $1\mathrm{{Mb/s}}$ ，则主机在 $1\upmu\mathrm{s}$ 内可向链路发送1比特的数据。当 $t\!=\!0$ 时，开始向链路发送数据：当 $t\!=\!1\upmu\mathrm{s}$ 时，信号传播到 $200\mathrm{m}$ 处，注入链路1比特：当 $t\!=\!2\upmu\mathrm{s}$ 时，信号传播到 $400\mathrm{m}$ 处，注入链路共2比特：当 $t\!=\!3\upmu\mathrm{s}$ 时，信号传播到 $600\mathrm{m}$ 处，注入链路共3比特。  

从图1.17可以看出，在一段时间内链路中有多少比特取决于带宽（或传输速率），而1比特“跑”了多远取决于传播速率。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/0f85059af28cb65ea81407dcb3fc5444431a016956a56fcf332ccd22ecceba5f.jpg)  
图1.17传输速率、带宽和传播速率三者的区别  
# 第2章物理层  

# 【考纲内容】  

（一）通信基础  

信道、信号、带宽、码元、波特、速率、信源与信宿等基本概念：奈奎斯特定理与香农定理：编码与调制：电路交换、报文交换与分组交换：数据报与虚电路  

（二）传输介质双绞线、同轴电缆、光纤与无线传输介质：物理层接口的特性  

（三）物理层设备  

中继器：集线器  

# 【复习提示】  

物理层考虑的是怎样才能在连接各台计算机的传输介质上传输数据比特流，而不是具体的传输介质。本章概念较多，易出选择题，复习时应抓住重点，如奈奎斯特定理和香农定理的应用、编码与调制技术、数据交换方式，以及电路交换、报文交换与分组交换技术等。  

# 2.1 通信基础  

# 2.1.1基本概念  

# 1.数据、信号与码元  

通信的目的是传输信息，如文字、图像和视频等。数据是指传送信息的实体。信号则是数据的电气或电磁表现，是数据在传输过程中的存在形式。数据和信号都有模拟或数字之分： $\textcircled{\scriptsize{1}}$ 模拟数据（或模拟信号）的取值是连续的； $\textcircled{2}$ 数字数据（或数字信号）的取值是离散的。  

在通信系统中，常用一个固定时长的信号波形（数字脉冲）表示一位 $k$ 进制数字，代表不同离散数值的基本波形就称为码元。码元是数字通信中数字信号的计量单位，这个时长内的信号称为 $k$ 进制码元，而该时长称为码元宽度。1码元可携带若干比特的信息量。例如，在使用二进制编码时，只有两种不同的码元：一种代表0状态，另一种代表1状态。  

# 2.信源、信道与信宿  

图2.1所示为一个单向通信系统的模型，实际的通信系统大多数是双向的，可进行双向通信。  
数据通信系统主要划分为信源、信道和信宿三部分。信源是产生和发送数据的源头，信宿是接收数据的终点，它们通常都是计算机或其他数字终端装置。信道是信号的传输介质，一条双向通信的线路包含一个发送信道和一个接收信道。发送端信源发出的信息需要通过变换器转换成适合在信道上传输的信号，而通过信道传输到接收端的信号首先由反变换器转换成原始信息，然后发送给信宿。噪声源是信道上的噪声及分散在通信系统其他各处的噪声的集中表示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/d49cc4d7da6d319d17512b142cd5e47536c50eba359e66e26492dd13c96427b0.jpg)  
图2.1通信系统模型  

信道按传输信号形式的不同，分为传送模拟信号的模拟信道和传送数字信号的数字信道两大类；信道按传输介质的不同分为无线信道和有线信道。  

信道上传送的信号有基带信号和宽带信号之分。基带信号首先将数字信号1和0直接用两利不同的电压表示，然后送到数字信道上传输（称为基带传输）；宽带信号首先将基带信号进行调制，形成频分复用模拟信号，然后送到模拟信道上传输（称为宽带传输）。  

数据传输方式分为串行传输和并行传输。事行传输是指逐比特地按序依次传输，并行传输是指若干比特通过多个通信信道同时传输。串行传输适用于长距离通信，如计算机网络。并行传输适用于近距离通信，常用于计算机内部，如CPU与主存之间。  

从通信双方信息的交互方式看，可分为三种基本方式：1）单向通信。只有一个方向的通信而没有反方向的交互，如无线电广播、电视广播等。2）半双工通信。通信双方都可发送或接收信息，但任何一方都不能同时发送和接收信息。3）全双工通信。通信双方可同时发送和接收信息。单向通信只需一个信道，而半双工通信或全双工通信都需要两个信道，每个方向一个信道。  

# 3.速率、波特与带宽  

速率是指数据传输速率，表示单位时间内传输的数据量，常有两种描述形式。  

# 命题追踪调制速率的概念（2014）  

1）码元传输速率。又称波特率，表示单位时间内数字通信系统所传输的码元数（也称调制速率或符号速率），单位是波特（Baud)。1波特表示数字通信系统每秒传输1个码元。码元既可以是多进制的，又可以是二进制的，码元速率与进制数无关。  

2）信息传输速率。又称比特率，表示单位时间内数字通信系统传输的二进制码元数（即比特数），单位是比特/秒（b/s）。  

# 注意  

波特和比特是两个不同的概念，但波特率与比特率在数量上又有一定的关系。若一个码元携带 $n$ 比特的信息量，则波特率 $M$ Baud对应的比特率为 $\begin{array}{r}{M n\,{\sf b}/{\sf s}_{\circ}}\end{array}$  

在模拟信号系统中，带宽（又称频率带宽）用来表示某个信道所能传输信号的频率范围，即最高频率与最低频率之差，单位是赫兹（H）。在计算机网络中，带宽用来表示网络的通信线路所能传输数据的能力，即最高数据率；显然，此时带宽的单位不再是Hz，而是b/s。  
# 2.1.2信道的极限容量  

任何实际的信道都不是理想的，信号在信道上传输时会不可避免地产生失真。但是，只要接收端能够从失真的信号波形中识别出原来的信号，这种失真对通信质量就没有影响。但是，若信号失真很严重，则接收端就无法识别出每个码元。码元的传输速率越高，或者信号的传输 距离越远，或者噪声干扰越大，或者传输介质的质量越差，接收端波形的失真就越严重。  

# 1.奈奎斯特定理（奈氏准则）  

# 命题追踪  

# 无噪声信道的最大数据传输速率（2009、2022、2023）  

具体的信道所能通过的频率范围总是有限的。信号中的许多高频分量往往不能通过信道，否则在传输中就会衰减，导致接收端收到的信号波形失去码元之间的清晰界限，这种现象称为码间串扰。奈奎斯特定理规定：在理想低通（没有噪声、带宽有限）信道中，为了避免码间串扰，极限码元传输速率为 $2W$ 波特，其中 $W$ 是信道的频率带宽（单位为 $\mathrm{Hz}$ 。若用 $V$ 表示每个码元的离散电平数目（码元的离散电平数目是指有多少种不同的码元，若有16种不同的码元，则需要4个二进制位，因此数据传输速率是码元传输速率的4倍），则极限数据率为  

理想低通信道下的极限数据传输速率 $=2W\log_{2}V$ （单位为b/s）  

对于奈氏准则，有以下结论：  

1）在任何信道中，码元传输速率是有上限的。若传输速率超过上限，则会出现严重的码间串扰问题，使得接收端不可能完全正确地识别码元。2）信道的频带越宽（即通过的信号高频分量越多），就越可用更高的速率有效地传输码元。3）奈氏准则给出了码元传输速率的限制，但并未限制信息传输速率，即未对一个码元可以对应多少个二进制位给出限制。  

因为码元传输速率受奈氏准则制约，所以要提高数据传输速率，就要设法使每个码元携带更多比特的信息量，此时需要采用多元制的调制方法。  

# 2.香农定理  

# 命题追踪有噪声信道的实际数据传输速率（2016）  

实际的信道会有噪声，噪声是随机产生的。香农定理给出了带宽受限且有高斯噪声干扰的信道的极限数据传输速率，当用该速率传输数据时，不会产生误差。香农定理定义为  

信道的极限数据传输速率 $=W\mathrm{log}_{2}(1+S/N)$ （单位为b/s）  

式中， $W$ 为信道的频率带宽（单位为 $\mathrm{Hz}$ )， $S$ 为信道内所传输信号的平均功率， $N$ 为信道内的高斯噪声功率。SIN为信噪比，即信号的平均功率与噪声的平均功率之比，信噪比 $=10\mathrm{log}_{10}(S/N)$ （单位为dB）。例如，当 $S/N\!=\!10$ 时，信噪比为10dB；而当 $S/N\!=\!1000$ 时，信噪比为30dB。  

# 命题追踪信道数据传输速率的影响因素分析（2014）  

对于香农定理，有以下结论：  

1）信道的带宽或信道中的信噪比越大，信息的极限传输速率越高。2）对一定的传输带宽和一定的信噪比，信息传输速率的上限是确定的。3）只要信息传输速率低于信道的极限传输速率，就能找到某种方法实现无差错的传输。4）香农定理得出的是极限信息传输速率，实际信道能达到的传输速率要比它低不少。  
# 命题追踪奈氏准则和香农定理的对比分析（2017）  

奈氏准则只考虑了带宽与极限码元传输速率之间的关系，而香农定理不仅考虑了带宽，也考虑了信噪比。这从另一个侧面表明，一个码元对应的二进制位数是有限的。  

# 2.1.3编码与调制  

信号是数据的具体表示形式，数据无论是数字的还是模拟的，为了传输的目的，都要转换成信号。将数据转换为模拟信号的过程称为调制，将数据转换为数字信号的过程称为编码。  

数字数据可通过数字发送器转换为数字信号传输，也可通过调制器转换成模拟信号传输；同样，模拟数据可通过PCM编码器转换成数字信号传输，也可通过放大器调制器转换成模拟信号传输。这样，就形成了如下4种编码与调制方式。  

# 1.数字数据编码为数字信号  

数字数据编码用于基带传输中，即在基本不改变数字数据信号频率的情况下，直接传输数字信号。具体用什么样的数字信号表示0及用什么样的数字信号表示1，就是所谓的编码。编码的规则有多种，只要能有效区分0和1即可。常用的数字数据编码有以下几种，如图2.2所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/6328c430a19cd2ee823cbd2821a49bdecf3d765b187fe98e01a4fe7bd2d22cac.jpg)  
图2.2常用的数字数据编码  

1）归零（RZ）编码。用高电平表示1、低电平表示0（或者相反），每个码元的中间均跳变到零电平（归零），接收方根据该跳变调整本方的时钟基准，这就为收发双方提供了自同步机制。因为归零需要占用一部分带宽，所以传输效率受到了一定的影响。  

# 命题追踪 非归零编码和反向非归零编码的波形记忆（2015）  

2）非归零（NRZ）编码。与RZ编码的区别是不用归零，一个时钟全部用来传输数据，编码效率最高。但NRZ编码的收发双方存在同步问题，为此需要双方都带有时钟线。  

3）反向非归零（NRZI）编码。与NRZ编码的区别是用电平的跳变表示O、电平保持不变表示1。跳变信号本身可作为一种通知机制。这种编码方式集成了前两种编码的优点，既能传输时钟信号，又能尽量不损失系统带宽。USB2.0的编码方式就是NRZI编码。  
# 命题追踪曼彻斯特编码的波形记忆（2013、2015）  

4）曼彻斯特编码。每个码元的中间都发生电平跳变，电平跳变既作为时钟信号（用于同步），又作为数据信号。可用向下跳变表示1、向上跳变表示0，或者采用相反的规定。  

# 命题追踪差分曼彻斯特编码的波形记忆（2021）  

5）差分曼彻斯特编码。每个码元的中间都发生电平跳变，与曼彻斯特编码不同的是，电平跳变仅表示时钟信号，而不表示数据。数据的表示在于每个码元开始处是否有电平跳变：无跳变表示1，有跳变表示0。差分曼彻斯特编码拥有更强的抗干扰能力。  

曼彻斯特编码和差分曼彻斯特编码在每个码元的中间都发生电平跳变，相当于将一个码元一分为二，编码速率是码元速率的2倍，二者所占的频带宽度是原始基带宽度的2倍。标准以太网使用的就是曼彻斯特编码，而差分曼彻斯特编码则被广泛用于宽带高速网中。  

# 2.模拟数据编码为数字信号  

主要包括三个步骤，即采样、量化和编码，常用于对音频信号进行编码的PCM编码。  

首先介绍采样定理：在将模拟信号转换成数字信号时，假设原始信号中的最大频率为f，那么采样率f采必须大于或等于最大频率  $f$  的2倍，才能保证采样后的数字信号完整保留原模拟信 号的信息（只需记住结论）。另外，采样定理又称奈奎斯特定理。  

1）采样是指对模拟信号进行周期性扫描，将时间上连续的信号变成时间上离散的信号。  

2）量化是指将采样得到的电平幅值按照一定的分级标度转换为对应的数值并取整，这样就将连续的电平幅值转换为了离散的数字量。采样和量化的实质就是分割和转换。  

3）编码是指将量化得到的离散整数转换为与之对应的二进制编码。  

# 3.数字数据调制为模拟信号  

数字数据调制技术在发送端将数字信号转换为模拟信号，而在接收端将模拟信号还原为数字信号，分别对应于调制解调器的调制和解调过程。图2.3中显示了数字调制的三种方式。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/fdf0f699eda49c38bad96dea6527302a5202b07e045d5b6c0970c2d0b46c0000.jpg)  
图2.3数字调制的三种方式  
# 命题追踪采用调幅技术时码元的比特位数（2022）  

1）调幅（AM）或幅移键控（ASK)。通过改变载波的振幅来表示数字信号1和0。例如，用有载波和无载波输出分别表示1和0。这种方式比较容易实现，但抗干扰能力差。  

2）调频（FM）或频移键控（FSK）。通过改变载波的频率来表示数字信号1和0。例如，用频率 $f_{1}$ 和频率f分别表示1和0。这种方式容易实现，抗干扰能力强，目前应用较广泛。  

# 命题追踪采用调相技术时比特率和波特率的转化（2011）  

3）调相（PM）或相移键控（PSK)。通过改变载波的相位来表示数字信号1和0，又分为绝对调相和相对调相。例如，用相位0和 $\pi$ 分别表示1和0，是一种绝对调相方式。  

# 命题追踪采用QAM技术时码元的比特位数（2009、2023）  

4）正交幅度调制（QAM)。在频率相同的前提下，将AM与PM结合起来，形成叠加信号。设波特率为 $B$ ，采用 $m$ 个相位，每个相位有 $n$ 种振幅，则该QAM的数据传输速率 $R$ 为  

$R\!=\!B\mathrm{log}_{2}(m n)$ （单位为 ${\tt b}/{\tt s}$  

# 4.模拟数据调制为模拟信号  

为了实现传输的有效性，可能需要较高的频率。这种调制方式还可使用频分复用（FDM）技术，充分利用带宽资源。电话机和本地局交换机采用模拟信号传输模拟数据的编码方式。  

# 2.1.4 本节习题精选  

# 一、单项选择题  

01.下列说法中正确的是（）。  

A.信道与通信电路类似，一条可通信的电路往往包含一个信道B.调制是指把模拟数据转换为数字信号的过程C.信息传输速率是指通信信道上每秒传输的码元数D.在数值上，波特率等于比特率与每符号所含的比特数的比值  

02.影响信道最大传输速率的因素主要有（）。  

A.信道带宽和信噪比B.码元传输速率和噪声功率C.频率特性和带宽D.发送功率和噪声功率  

03.（）被用于计算机内部的数据传输。  

A.串行传输 B.并行传输 C.同步传输 D.异步传输  

04.下列有关曼彻斯特编码的叙述中，正确的是（）  

A.每个信号起始边界作为时钟信号有利于同步B.将时钟与数据取值都包含在信号中C.这种编码机制特别适合传输模拟数据D.每位的中间不跳变表示信号的取值为0  

05.在数据通信中使用曼彻斯特编码的主要原因是（）  

A.实现对通信过程中传输错误的恢复B.实现对通信过程中收发双方的数据同步C.提高对数据的有效传输速率D.提高传输信号的抗干扰能力  

06.不含同步信息的编码是（）  

I.非归零编码II.曼彻斯特编码III.差分曼彻斯特编码B.仅ⅡC.仅1ⅡI、IⅢID.I、ⅡI、IⅢI  
07.波特率等于（）。  

A.每秒可能发生的信号变化次数B.每秒传输的比特数C.每秒传输的周期数D.每秒传输的字节数  

08.测得一个以太网的数据波特率是40MBaud，那么其数据率是（）A.10Mb/s B.20Mb/s C.40Mb/s D.80Mb/s  

09.某信道的波特率为1000Baud，若令其数据传输速率达到4kb/s，则一个信号码元所取的有效离散值个数为（）。  

A.2B.4C.8D.16

10.下图是某比特串的曼彻斯特编码信号波形，则该比特串为（）  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/6b68793abcec242f229241dffe6474a7de5ffcf9af8728b98132c5de16f07fbe.jpg)  

A.00110110 B.10101101 C.01010010 D.11000101  

11.已知某信道的信息传输速率为64kb/s，一个载波信号码元有4个有效离散值，则该信道的波特率为（）。  

A.16kBaud B.32kBaud C.64kBaud D.128kBaud  

12.有一个无噪声的 $8\mathrm{kHz}$ 信道，每个信号包含8级，每秒采样24k次，那么可以获得的最大传输速率是（）。  

A.24kb/s B.32kb/s C.48kb/s D.72kb/s  

13.对于某带宽为 $4000\mathrm{Hz}$ 的低通信道，采用16种不同的物理状态来表示数据。按照奈奎斯特定理，信道的最大传输速率是（）。  

A.4kb/sB.8kb/sC.16kb/sD.32kb/s

14.二进制信号在信噪比为127：1的4kHz信道上传输，最大数据传输速率可以达到（）。A.28000b/s B.8000b/s C.4000b/s D.无限大  

15.电话系统的典型参数是信道带宽为 $3000\mathrm{Hz}$ ，信噪比为 $30\mathrm{dB}$ ，该系统的最大数据传输速率为（）。  

A.3kb/s B.6kb/s C.30kb/s D.64kb/s  

16.一个传输数字信号的模拟信道的信号功率是0.14W，噪声功率是0.02W，频率范围为 $3.5\,\mathrm{{\sim}}$ 3.9MHz，则该信道的最高数据传输速率是（）  

A.1.2Mb/s B.2.4Mb/s C.11.7Mb/s D.23.4Mb/s  

17.采用8种相位，每种相位各有两种幅度的QAM调制方法，在1200Baud的信息传输速率下能达到的数据传输速率为（）。  

A.2400b/s B.3600b/s C.9600b/s D.4800b/s

 18.一个信道每1/8s采样一次，传输信号共有16种变化状态，最大数据传输速率是（）。A.16b/s B.32b/s C.48b/s D.64b/s  

19.根据采样定理，在对连续变化的模拟信号进行周期性采样时，只要采样率大于或等于有效信号的最高频率或其带宽的（）倍，采样值便可包含原始信号的全部信息。  

A.0.5 B.1 C.2 D.4  

20.将1路模拟信号分别编码为数字信号后，与另外7路数字信号采用同步TDM方式复用到一条通信线路上。1路模拟信号的频率变化范围为 $0\sim1\mathrm{kHz}$ ，每个采样点采用PCM方式编码为4位的二进制数，另外7路数字信号的数据率均为 $7.2\mathrm{kb/s}_{\circ}$ 复用线路需要的最小通信能力是（）。A.7.2kb/s B.8kb/s C.64kb/s D.512kb/s  
21.用PCM对语音进行数字量化，若将声音分为128个量化级，采样率为8000次/秒，则 一路话音需要的数据传输速率为（）。  

A.56kb/s B.64kb/s C.128kb/s D.1024kb/s  

22.【2009统考真题】在无噪声的情况下，若某通信链路的带宽为3kHz，采用4个相位，每 个相位具有4种幅度的QAM调制技术，则该通信链路的最大数据传输速率是（）。  

A.12kb/s B.24kb/s C.48kb/s D.96kb/s  

23.【2011统考真题】若某通信链路的数据传输速率为  $2400{\mathrm{b/s}}$  采用4个相位调制，则该链 路的波特率是（）。  

A.600Baud B.1200Baud C.4800Baud D.9600Baud

 24.【2013统考真题】下图为10BaseT网卡接收到的信号波形，则该网卡收到的比特串是（）  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/05438a7d9625fd76c7920f2e7cf8bae04857fa9478a2c958b219d077ca95ff55.jpg)  

A.00110110 B.10101101 C.01010010 D.11000101  

25.【2014统考真题】在下列因素中，不影响信道数据传输速率的是（）A.信噪比B.频率带宽C.调制速率D.信号传播速度  

26.【2015统考真题】使用两种编码方案对比特流01100111进行编码的结果如下图所示，编码1和编码2分别是（）  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/008dc014fc21376c1081f90bd0b03f7b6b3db834d0f9094a2dee2a8051b34f08.jpg)  

A.NRZ编码和曼彻斯特编码B.NRZ编码和差分曼彻斯特编码C.NRZI编码和曼彻斯特编码D.NRZI编码和差分曼彻斯特编码  

27.【2016统考真题】如下图所示，若连接R2和R3链路的频带宽度为 $8\mathrm{kHz}$ ，信噪比为30dB，该链路实际数据传输速率约为理论最大数据传输速率的 $50\%$ ，则该链路的实际数据传输速率约为（）。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/7ea6862245381fb5f7ed101033d1f107c1fa9ffa04041f8d4285d4cb97e01a3c.jpg)  

A.8kb/s B.20kb/s C.40kb/s D.80kb/s  

28.【2017统考真题】若信道在无噪声情况下的极限数据传输速率不小于信噪比为30dB条件下的极限数据传输速率，则信号状态数至少是（）。  

A.4 B.8 C.16 D.32

 29.【2021统考真题】下图为一段差分曼彻斯特编码信号波形，该编码的二进制串是（）。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/fe5831a276a820aa360fd98a1acec32df63a5a3a20c84893ba6387cdd20f04da.jpg)  

A.10111001 B.11010001 C.00101110 D.10110110  
30.【2022统考真题】在一条带宽为 $200\mathrm{kHz}$ 的无噪声信道上，若采用4个幅值的ASK调制，则该信道的最大数据传输速率是（）。义  

A.200kb/s B.400kb/s C.  $800\mathrm{kb/s}$  D.  $1600\mathrm{kb/s}$  

31.【2023统考真题】在下图所示的分组交换网络中，主机H1和H2通过路由器互连，2段链路的带宽均为 $100\,\mathrm{{Mb/s}}$ ，时延带宽积（即单向传播时延 $\times$ 带宽）均为 $1000\mathrm{b}$ 。若H1向H2发送一个大小为1MB的文件，分组长度为1000B，则从H1开始发送的时刻起到H2收到文件全部数据时刻止，所需的时间至少是（）。（注： $1\mathrm{M}=10^{6}.$  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f1b0258e0244adc718fcdffcf37baff88e65ee48b972644a1da355c537d53796.jpg)  

A.80.02ms B.80.08ms C.80.09ms D.80.10ms  

# 二、综合应用题  

01.如下图所示，主机A和B都通过 $10\mathrm{Mb/s}$ 的链路连接到交换机S。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/deb4a63c1ed4e3da3ee073487d58a639850a0c531eb948f0395a8b96d89a4052.jpg)  

每条链路上的传播时延都是 $20\upmu\mathrm{s}.$ S是一个存储转发设备，它在接收完一个分组 $35\upmu\mathrm{s}$ 后开始转发收到的分组。试计算将10000比特从A发送到B所需的总时间。  

1）作为单个分组。2）作为两个5000比特的分组一个紧接着另一个发送。  

02.一个分组交换网采用虚电路方式转发分组，分组的首部和数据部分分别为 $h$ 位和 $p$ 位。现有 $L$ （ $L\gg p$ 且 $L$ 为 $p$ 的倍数）位的报文通过该网络传送，源点和终点之间的线路数为 $k$ ，每条线路上的传播时延为 $d$ 秒，数据传输速率为 $b\,\textrm{\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\textmu\text$ ，虚电路建立连接的时间为 $s$ 秒，每个中间结点有 $m$ 秒的平均处理时延。求源点开始发送数据直至终点收到全部数据所需的时间。  

# 2.1.5 答案与解析  

一、单项选择题  

01.D  

信道不等于通信电路，一条可双向通信的电路往往包含两个信道：一个是发送信道，一个是接收信道。另外，多个通信用户共用通信电路时，每个用户在该通信电路都有一个信道，因此A错误。调制是将数据转换为模拟信号的过程，B错误。C明显错误。“比特率”在数值上和“波特率”的关系如下：波特率 $,=$ 比特率/每符号含的比特数，D正确。  

02.A  

根据香农定理，影响信道最大传输速率的因素主要有信道带宽和信噪比，而信噪比与信道内所传输的平均信号功率和噪声功率有关，数值上等于二者之比。  

03.B  

并行传输的特点：距离短、速度快。串行传输的特点：距离长、速度慢。所以在计算机内部（距离短）传输时应选择并行传输。同步、异步传输是通信方式，而不是传输方式。  

04.B  

曼彻斯特编码将时钟和数据包含在信号中，在传输数据的同时，也将时钟一起传输给对方，码元中间的跳变作为时钟信号，不同的跳变方式作为数据信号，A错误、B正确。每个码元的中间都发生电平跳变，D错误。曼彻斯特编码最适合传输二进制数字信号，C错误。  
05.B  

曼彻斯特编码用码元中间的电平跳变来表示每个比特，可方便收发双方根据跳变来同步时钟，而不需要额外的时钟信号，B正确。  

06.A  

非归零编码是最简单的一种编码方式，它用低电平表示0，用高电平表示1，或者采用相反的表示方式。因为各个码元之间并没有间隔标志，所以不包含同步信息。曼彻斯特编码和差分曼彻斯特编码都将每个码元分成两个相等的时间间隔，码元的中间跳变也作为收发双方的同步信息，所以不需要额外的同步信息，实际应用较多，但它们所占的频带宽度是原始基带宽度的2倍。  

07. A  

波特率表示信号每秒变化的次数（注意和比特率的区别）。  

08.B  

因为以太网采用曼彻斯特编码，每位数据（1比特，对应信息传输速率）都需要两个电平（两个脉冲信号，对应码元传输速率）来表示，因此波特率是数据率的2倍，得数据率为 $(40\mathbf{M}\mathbf{b}/\mathrm{s})/2\!=\!20\mathbf{M}\mathbf{b}/\mathrm{s}.$  

# 注意  

曼彻斯特编码的每个比特需要两个信号周期，信号率是数据率的2倍，编码效率是 $50\%$  

09.D  

比特率 $=$ 波特率 $\times\mathrm{log}_{2}n$ ，若一个码元含有 $k$ 比特的信息量，则表示该码元所需的不同离散值为 $n\!=\!2^{k}$ 个。波特率数值上等于比特率/每码元所含比特数，因此每码元所含比特数 $=4000/1000=4$ 比特，有效离散值的个数为 $2^{4}\!=\!16$  

10.A  

在曼彻斯特编码中，可用向下跳变表示1、向上跳变表示0，或者采用相反的表示。因此，该比特串可能是 $0011\,0110$ 或 $1100\;1001$ ，因此选A。  

11.B  

一个码元若取 $2^{n}$ 个不同的离散值，则含有 $n$ 比特的信息量。本题中，一个码元所含的信息量为2比特，因为数值上波特率 $=$ 比特率/每码元所含比特数，所以波特率为 $(64/2)\mathbf{k}=32$ 2kBaud。  

12. C  

无噪声的信号应该满足奈奎斯特定理，即最大数据传输速率 $=\!2W\log_{2}\!V$ 比特/秒。将题中的数据代入，得到答案是 $48\,\mathrm{kb}/\mathrm{s}$ 。注意题中给出的每秒采样 $24\mathrm{kHz}$ 是无意义的，因为超过了波特率的上限 $2W=$ 16kBaud，所以选项D是错误答案。  

13.D  

根据奈奎斯特定理，题中 $W{=}\ensuremath{4000\mathrm{Hz}}$ ，最大码元传输速率 $=2W\!=\!8000\mathrm{{Ba}}$ lud，16种不同的物理状态可以表示 $\log_{2}16\!=\!4$ 比特的数据，所以信道的最大传输速率 $=8000{\times}4\,{=}\,32\,\mathrm{kb/s}$  

14.B  

根据香农定理，最大数据率 $\begin{array}{r}{z\!=\!W\mathrm{log}_{2}(1+S/N)\!=\!4000\!\times\!\mathrm{log}_{2}(1+127)\!=\!280000\mathrm{b}/\mathrm{s},}\end{array}$ ，容易误选A。注意题中“二进制信号”的限制后，依据奈奎斯特定理，最大数据传输速率 $=2H\mathrm{log}_{2}V=2{\times}4000{\times}\mathrm{log}_{2}2=$  $8000\mathrm{b/s}$ ，两个上限中取小者，因此答案为B。  
# 注意  

若给出了码元与比特数之间的关系，则需受两个公式的共同限制。关于香农定理和奈奎斯特定理的比较，请参考本章中的疑难点。  

15.C  

信噪比S/N常用分贝（dB）表示，数值上等于 $10\mathrm{log}_{10}(S/N)\mathrm{dB}$ 。依题意有 $30\,{=}\,10\,{\log}_{10}(S/N)$ 解出 $S/N\!=\!1000$ 。根据香农定理，最大数据传输速率 $=3000\mathrm{log}_{2}(1+S/N)\approx30\mathrm{kb/s}.$  

16.A  

带宽受限且有噪声的信道应用香农定理来计算信道容量。最高数据传输速率 $\mathbf{\beta}=$  $=W\mathrm{log}_{2}(1+S/N)$ ，其中，信道带宽 $W\,{=}\,3.9\,{-}\,3.5\,{=}\,0.4\mathrm{MHz}$ ，信号功率 $S=0.14\mathrm{W}$ ，噪声功率 $N\,{=}\,0.02\,\mathrm{W}$ ，代入得 $1.2\mathrm{M}\mathrm{b}/\mathrm{s}$  

17.D  

每个信号有 $8\!\times\!2=\!16$ 种变化，每个码元携带 $\log_{2}\!16\!=\!4$ 比特的信息，则信息传输速率为 $1200\times$  $4\,{=}\,4800\mathrm{b/s}$  

18.B  

由题意知采样率为 $8\mathrm{Hz}$ 。有16种变化状态的信号可携带4比特的数据，因此最大数据传输速率为 ${8\!\times\!4}\,{=}\,32\mathrm{b/s}$  

19.C  

根据采样定理（又称奈奎斯特定理或奈氏准则），若采样率低于有效信号最高频率的2倍，则会出现频谱混叠现象，导致原始信号无法完全恢复。  

20. C  

1路模拟信号的最大频率为 $1\mathrm{kHz}$ ，根据采样定理可知采样率至少为 $2\mathrm{kHz}$ ，每个样值编码为4位二进制数，所以数据传输速率为 $8\mathrm{{kb}/\mathrm{{s}.}}$ 。复用的每条支路的数字信号的速率要相等，而另7路数字信号的速率均低于 $8\mathrm{{kb}/\mathrm{{s}}}$ ，所以它们均要采用脉冲填充方式，将数据率提高到8b/s，然后复用这8路信号，需要的通信能力为 $8\mathrm{{kb}/\mathrm{{s}}\times8\,{=}\,64\mathrm{{kb}/\mathrm{{s}}\,\mathrm{{e}}}}$  

21. A  

声音信号需要128个量化级，因此每采样一次就需要 $\log_{2}\!128\!=\!7$ 比特来表示，每秒采样8000次，一路话音需要的数据传输速率为 $8000\!\times\!7\!=\!56\mathrm{kb/s}$  

22.B  

采用4个相位，每个相位有4种幅度的QAM调制方法，每个信号有16种变化，传输4比特的数据。根据奈奎斯特定理，信息的最大传输速率为 $2W\log_{2}\!V\!=\!2\!\times\!3\!\mathrm{k}\!\times\!4\!=\!24\mathrm{k}\mathrm{b}/\mathrm{s}\,\mathrm{\texttimes}$  

23.B  

波特率 $B$ 与数据传输速率 $C$ 的关系为 $\scriptstyle C=B\log_{2}N,$  $N$ 为一个码元所取的离散值个数。采用4种相位，即可以表示4种变化，因此一个码元可携带 $\log_{2}\!4\!=\!2$ 比特的信息。于是，该链路的波特率 $=$ 比特率/每码元所含比特数 $=\!2400/2\!=\!1200$ 波特。  

24.A  

10BaseT即p $10\mathrm{Mb/s}$ 的以太网，采用曼彻斯特编码，将一个码元分成两个相等的间隔，前一个间隔为低电平，而后一个间隔为高电平，表示码元1；码元0正好相反。也可采用相反的规定。因此，对应的比特串可以是 $0011\;0110$ 或 $1100\ 1001$  

25.D  

由香农定理可知，信噪比和频带宽度都可限制信道的极限传输速率，A和B错误。码元速率也称调制速率，它也直接限制数据传输速率，C错误。信道传输速率实际上是信号的发送速率，而信号的传播速率是信号在信道上传播的速率，它与信道的发送速率无关，答案为D。  
26.A  

NRZ是最简单的串行编码技术，它用两个电压来代表两个二进制数，如高电平表示1、低电平表示O，题中编码1符合。NRZI用电平的一次翻转来表示O，用与前一个NRZI电平相同的电平表示1。曼彻斯特编码将一个码元分成两个相等的间隔，前一个间隔为高电平，后一个间隔为低电平，表示1：0的表示方式正好相反，题中编码2符合。  

27. C  

香农定理给出了带宽受限且有高斯白噪声干扰的信道的极限数据传输速率，香农定理定义为：信道的极限数据传输速率 $=W\log_{2}(1+S/N)$ ，单位为 ${\tt b}/{\tt s}$ 。其中， $S/N$ 为信噪比，即信号的平均功率和噪声的平均功率之比，信噪比 $=10\mathrm{log}_{10}(S/N),$ ，单位为dB，当 $S/N\ =1000$ 时，信噪比为30dB。则该链路的实际数据传输速率约为 $50\%\times W\log_{2}(1+S/N)\,{=}\,50\%\times8\mathrm{k}\times\log_{2}(1+1000)\,{=}\,40\mathrm{k}\mathrm{b}/\mathrm{s}.$  

28.D  

可用奈奎斯特采样定理计算无噪声情况下的极限数据传输速率，用香农第二定理计算有噪信道极限数据传输速率。 $2W\,\log_{2}\!N\!\geqslant\!W\!\log_{2}\!(1+S/N)$ ， $W$ 是信道带宽， $N$ 是信号状态数，SIN是信噪比。将数据代入公式得 $N{\geqslant}32$ 。分贝数 $=10\log_{10}(S/N)$  

29.A  

差分曼彻斯特编码常用于局域网传输，其规则是：若码元为1，则前半个码元的电平与上一码元的后半个码元的电平相同；若码元为0，则情形相反。差分曼彻斯特编码的特点是，在每个时钟周期的起始处，跳变则说明该比特是0，不跳变则说明该比特是1。根据题图，第1个码元的信号波形因缺乏上一码元的信号波形，无法判断是0还是1，但根据后面的信号波形，可以求出第 $2\!\sim\!8$ 个码元为0111001。  

30.C.  

根据奈奎斯特定理，最大数据传输速率 $=2W\log_{2}V$ ，4个幅值的ASK调制说明有4个幅度，将  $V\!=\!4$  代入得  $800\mathrm{kb/s}$  

31.D  

文件大小为1MB，分组长度为1000B，分组数量为 $1\mathrm{MB\div}1000\mathrm{B}=1000$ ，一个分组从H1到H2所需的时间 $=\mathrm{HI}$ 的发送时延 $t_{1}+\mathrm{HI}$ 到路由器的传播时延 $t_{2}+$ 路由器的发送时延 $t_{3}+$ 路由器到H2的传播时延 $t_{4}$ ，其中 $t_{1}=t_{3}=1000\mathbf{B}\div100\mathbf{M}\mathbf{b}/\mathbf{s}=0.08\mathbf{ms},$ t2=14=1000b÷100Mb/s=0.01ms。因此，一个分组从H1到H2所需的时间为 $(0.08+0.01){\times}2=0.18\mathrm{ms}$ ，H1发送前999个分组所需的时间为 $999{\times}1=79.92\mathrm{ms}$ ，总时间等于发送前999个分组的时间加上最后一个分组从H1到H2的时间，即所需的时间至少为 $79.92+0.18=80.10\mathrm{ms}$  

# 二、综合应用题  

01.【解答】  

1）每条链路的发送时延是  $10000/(10\mathrm{{Mb/s})}\,{=}\,1000\upmu\mathrm{{s}}$  总传送时间等于 $2\!\times\!1000+2\!\times\!20+35\!=\!2075\upmu\mathrm{s}\circ$ 2）解法一：作为两个分组发送时，下面列出了各种事件发生的时间表。 $T\!=\!0$ 开始 $T\!=\!500$ A完成分组1的发送，开始发送分组2 $T\!=\!520$ 分组1完全到达S  
$T\!=\!555$ 分组1从S起程前往B $T\!=\!1000$ A结束分组2的发送 $T\!=\!1055$ 分组2从S起程前往B $T\!=\!1075$ 分组2的第1位开始到达B $T\!=\!1575$ 分组2的最后1位到达B  

解法二：此题属于分组交换各过程中时间不等长的情况，类似于不等长流水段的情况，为避免出错，建议画出对应的时空图。根据题意可分为5个流水段，各流水段的时间分别为 $500\upmu\mathrm{s}$  $20\upmu\mathrm{s}$  $35\upmu\mathrm{s}$  $500\upmu\mathrm{s}$  $20\upmu\mathrm{s}$ ，共有2个分组，注意不同分组的相同流水段不能重叠，画出的时空图如下图所示。本题只有2个分组，不用流水线的方法也可求得结果，但当分组数量更多时，采用流水线的方法并画出时空图得出计算规律，才不容易出错。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/14c7871d16194d81aeb32c8cbabbe3bc2e97a0bc8fcd9d37f07a0cb3af273d57.jpg)  

# 02.【解答】  

整个传输过程的总时延 $=$ 连接建立时延 $^+$ 源点发送时延 $^+$ 中间结点的发送时延 $^+$ 中间结点的处理时延 $^+$ 传播时延。  

虚电路的建立时延已给出，为 $s$ 秒。  

源点要将 $L$ 位报文分割成分组，分组数 $=L/p$ ，每个分组的长度为 $(h+p)$ ，源点要发送的数据量 $=(h+p)L/p$ ，所以源点的发送时延 $\,=\,(h+p)L/(p b)$ 秒。  

每个中间结点的发送时延 $\,=\!(h\!+\!p)/b$ 秒，源点和终点之间的线路数为 $k$ ，所以有k-1个中间结点，因此中间结点的发送时延 $\,=\!(h\!+\!p)\!(k\!-\!1)/b$ 秒。  

中间结点的处理时延 $\scriptstyle=m(k-1)$ 秒，传播时延 $\ =k d$ 秒。所以源结点开始发送数据直至终点收到全部数据所需的时间 $\begin{array}{r l}{\mathrm{~}}&{{}=s+(h+p)L/(p b)+(h+p)(k-1)/b+m(k-1)+k d}\end{array}$ 秒。  

# 2.2 传输介质  

# 2.2.1 双绞线、同轴电缆、光纤与无线传输介质  

传输介质也称传输媒体，是数据传输系统中发送器和接收器之间的物理通路。传输介质可分为： $\textcircled{\scriptsize{1}}$ 导向传输介质，指铜线或光纤等，电磁波被导向为沿着固体介质传播： $\circledcirc$ 非导向传输介质，指自由空间（空气、真空或海水)，电磁波在非导向传输介质中的传输称为无线传输。  

# 1.双绞线  

双绞线是最常用的传输介质，在局域网和传统电话网中普遍使用。双绞线由两根采用一定规则并排绞合、相互绝缘的铜导线组成。绞合可减少对相邻导线的电磁干扰。为了进一步提高抗电 磁干扰的能力，还可在双绞线的外面加上一层金属丝编织成的屏蔽层，这就是屏蔽双绞线（STP）。无屏蔽层的双绞线称为非屏蔽双绞线（UTP）。双绞线的结构如图2.4所示。  

双绞线的价格便宜，模拟传输和数字传输都可使用双绞线，通信距离一般为几干米到数十干米。双绞线的带宽取决于铜线的粗细和传输的距离。距离太远时，对于模拟传输，要用放大器放大衰减的信号；对于数字传输，要用中继器来对失真的信号进行整形。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/3a619194921245e780d0ffe50a3003bdc096f8ead04f90c663789508bfd94971.jpg)  
图2.4双绞线的结构  

# 2.同轴电缆  

同轴电缆由内导体、绝缘层、网状编织屏蔽层和塑料外层构成，如图2.5所示。同轴电缆一般分为两类： $\textcircled{\scriptsize{1}}$ 50Q同输电缆，主要用于传送基带数字信号，在早期局域网中应用广泛： $\circledcirc$ 75Q同轴电缆，主要用于传送宽带信号，在有线电视系统中应用广泛。因为外导体屏蔽层的作用，所以同轴电缆具有良好的抗干扰特性而被广泛用于传输较高速率的数据。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f83aba72a656e91cbd56efb07284b51198d458300a656b4cbf4727da4a90f39f.jpg)  
图2.5同轴电缆的结构  

随着技术的发展和集线器的出现，在局域网领域基本上都采用双绞线作为传输介质。  

# 3.光纤  

光纤通信是指利用光导纤维（简称光纤）传递光脉冲来进行通信。有光脉冲表示1，无光脉冲表示0。可见光的频率约为 $10^{8}\mathrm{MHz}$ ，因此光纤通信系统的带宽极大。  

光纤主要由纤芯和包层构成（见图2.6），纤芯很细，直径仅为 $8\!\sim\!100\upmu\mathrm{m}$ ，包层较纤芯有较低的折射率，光波通过纤芯进行传导。当光线从高折射率的介质射向低折射率的介质时，其折射角将大于入射角。因此，只要入射角大于某个临界角，就会出现全反射，即光线碰到包层时就会折射回纤芯，这个过程不断重复，光也就沿着光纤传输下去。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c31445185d6237de4247e897a7799344b5db3b959ae64e145a7362d9f491e11d.jpg)  
图2.6光波在纤芯中的传播  

利用光的全反射特性，可让从不同角度入射的多条光线在一根光纤中传输，这种光纤称为多模光纤（见图2.7），多模光纤的光源为发光二极管。光脉冲在多模光纤中传输时遂渐展宽，造成失真，因此多模光纤只适合近距离传输。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/080cf89791186e918919cd964321ccd192440fb467f8c03c0ee6e92df8ed3a93.jpg)  
图2.7多模光纤  
当光纤的直径减小到只有一个光的波长时，光纤就像一根波导那样，可使光线一直向前传播，而不产生多次反射，这样的光纤就是单模光纤（见图2.8）。单模光纤的纤芯很细，直径只有几微米，制造成本较高。同时，单模光纤的光源是定向性很好的半导体激光器，因此单模光纤的衰减较小，可传输数干米甚至数十干米而不必采用中继器，适合远距离传输。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/03c389f0abce206bef77a5089dfa39ac538e0ae63477808ab3557b5a1a9110bb.jpg)  
图2.8单模光纤  

光纤不仅具有通信容量非常大的优点，而且具有如下特点：  

1）传输损耗小，中继距离长，对远距离传输特别经济。2）抗雷电和电磁干扰性能好，在有大电流脉冲干扰的环境下这尤为重要。3）无串音干扰，保密性好，不易被窃听或截取数据。4）体积小，重量轻，在现有电缆管道已拥塞不堪的情况下这特别有利。  

# 4.无线传输介质  

无线通信已广泛用于蜂窝移动电话领域。随着便携式计算机的出现，以及军事、野外等特殊场合对移动联网的需要，促进了移动通信的发展，现在无线局域网的应用已非常普遍。  

# （1）无线电波  

无线电波具有较强的穿透能力，可以传输很长的距离，因此广泛用于通信领域，如无线手机通信、计算机网络中的无线局域网（WLAN）等。因为无线电波使信号向所有方向散播，所以有效距离范围内的接收设备无须对准某个方向，就可与无线电波发射者进行通信连接，大大简化了通信连接。这也是无线电波传输的最重要优点之一。  

（2）微波、红外线和激光  

目前高带宽的无线通信主要使用三种技术：微波、红外线和激光，它们都需要在发送方和接收方之间有一条视线通路，有很强的方向性，沿直线传播。不同的是，红外通信和激光通信将要传输的信号分别转换为各自的信号格式，即红外光信号和激光信号，再直接在空间中传播。  

微波通信的频率较高，频段范围也很宽，载波频率通常为 $2\!\sim\!40\mathrm{GHz}$ ，因此通信信道的容量大。例如，一个带宽为2MHz的频段可容纳500条语音线路，若用来传输数字信号，则数据率可达数兆比特/秒。与通常的无线电波不同，微波通信的信号是沿直线传播的，因此在地面上的传播距离有限，超过一定距离后就要使用中继站来接力。  

卫星通信利用地球同步卫星作为中继来转发微波信号，可以克服地面微波通信距离的限制3三颗相隔 $120^{\circ}$ 的同步卫星几乎就能覆盖整个地球表面，因此基本能实现全球通信。卫星通信的优点是通信容量大、距离远、覆盖广，缺点是保密性差、端到端传播时延长。  

# 2.2.2物理层接口的特性  

物理层考虑的是如何在连接各种计算机的传输介质上传输比特流，而不指具体的传输介质。网络中的硬件设备和传输介质的种类繁多，通信方式也各不相同。物理层应尽可能屏蔽这些差异，让数据链路层感觉不到这些差异，使数据链路层只需考虑如何完成本层的协议和服务。  
# 命题追踪物理层接口的特性的内容（2018）  

物理层的主要任务是确定与传输介质的接口有关的一些特性：1）机械特性。指明接口所用接线器的形状和尺寸、引脚数目和排列、固定和锁定装置等。2）电气特性。指明在接口电缆的各条线上的电压范围、传输速率和距离限制等。3）功能特性。指明某条线上出现的某一电平的电压的意义，以及每条线的功能。  

# 命题追踪物理层接口的过程特性的内容（2012）  

4）过程特性，也称规程特性。指明对不同功能的各种可能事件的出现顺序。  

# 2.2.3 本节习题精选  

# 单项选择题  

01.双绞线是用两根绝缘导线绞合而成的，绞合的目的是（）。A.减少干扰B.提高传输速度C.增大传输距离D.增大抗拉强度

02.在电缆中采用屏蔽技术带来的好处主要是（）  

A.减少信号衰减 B.减少电磁干扰辐射 C.减少物理损坏D.减少电缆的阻抗  

03.利用一根同轴电缆互连主机构成以太网，则主机间的通信方式为（）。A.全双工B.半双工C.单工D.不确定

04.同轴电缆比双绞线的传输速率更快，得益于（）  

A.同轴电缆的铜芯比双绞线粗，能通过更大的电流B.同轴电缆的阻抗比较标准，减少了信号的衰减 C.同轴电缆具有更高的屏蔽性，同时有更好的抗噪声性D.以上都正确  

05.不受电磁干扰和噪声影响的传输介质是（）  

A.屏蔽双绞线 B.非屏蔽双绞线 C.光纤 D.同轴电缆  

06.多模光纤传输光信号的原理是（）  

A.光的折射特性B.光的发射特性C.光的全反射特性D.光的绕射特性  

07.以下关于单模光纤的说法中，正确的是（）。  

A.光纤越粗，数据传输速率越高B.若光纤的直径减小到只有光的一个波长大小，则光沿直线传播C.光源是发光二极管或激光D.光纤是中空的  

08.下列关于卫星通信的说法中，错误的是（）  

A卫星通信的距离长，覆盖的范围广 B.使用卫星通信易于实现广播通信和多址通信C.卫星通信的好处在于不受气候的影响，误码率很低 D.通信费用高、延时较大是卫星通信的不足之处  

09.某网络在物理层规定，信号的电平用 $+10\mathrm{V}\sim+15\mathrm{V}$ 表示二进制0，用-10V\~-15V表示二进制1，电线长度限于 $15\mathrm{m}$ 以内，这体现了物理层接口的（）。A.机械特性B.功能特性C.电气特性D.规程特性  
10.当描述一个物理层接口引脚处于高电平时的含义时，该描述属于（）A.机械特性B.电气特性C.功能特性D.规程特性11.【2012统考真题】在物理层接口特性中，用于描述完成每种功能的事件发生顺序的是（）。A.机械特性B.功能特性C.过程特性D.电气特性12.【2018统考真题】下列选项中，不属于物理层接口规范定义范畴的是（）A.接口形状B.引脚功能C.物理地址D.信号电平  

# 2.2.4 答案与解析  

单项选择题  

01.A  

绞合可以减少两根导线相互的电磁干扰。  

02.B 屏蔽层的主要作用是提高电缆的抗干扰能力  

03.B  

传统以太网采用广播的方式发送信息，同一时间只充许一台主机发送信息，否则各主机之间就形成冲突，因此主机间的通信方式是半双工。全双工是指通信双方可同时发送和接收信息。单工是指只有一个方向的通信而没有反方向的交互。  

04.C  

同轴电缆以硬铜线为芯，外面包一层绝缘材料，绝缘材料的外面再包一层密织的网状导体，导体的外面又覆盖一层保护性的塑料列壳。这种结构使得它具有更高的屏蔽性，从而既有很高的带宽，又有很好的抗噪性。因此，同轴电缆的带宽更高得益于它的高屏蔽性。  

05.C 光纤抗雷电和电磁干扰性能好，无串音干扰，保密性好。  

06.C 多模光纤传输光信号的原理是光的全反射特性。  

07.B 光纤的直径减小到与光线的一个波长相同时，光纤就如同一个波导，光在其中没有反射，而沿直线传播，这就是单模光纤。  

08.C 卫星通信有成本高、传播时延长、受气候影响大、保密性差、误码率较高的特点。  

09.C  

本题易误选功能特性。规定各条线上的电压范围，以及电缆长度的限制，属于电气特性。而功能特性指明某条线上出现的某一电平的电压表示何种意义，以及每条线的功能（数据线、控制线、时钟线）。例如，数据线上的电压 $+11\mathrm{V}$ 表示二进制1，就属于功能特性。  

物理层的功能特性指明某条线上出现的某一电平的电压表示何种意义，以及每条线的功能。  

11.C 物理层的过程特性指明对于不同功能的各种可能事件的出现顺序。  
12.C  

物理层的接口规范主要分为4种：机械特性、电气特性、功能特性、过程特性。机械特性规定连接所用设备的规格，如A所说的接口形状。电气特性规定各条线上的电压范围、阻抗匹配等，如D所说的信号电平。功能特性规定线路上出现的电平表示何种意义及每条线的功能，如B所说的引脚功能。C中的物理地址是MAC地址，它属于数据链路层的范畴。  

# 2.3物理层设备  

# 2.3.1中继器  

中继器的主要功能是整形、放大并转发信号，以消除信号经过一长段电缆后产生的失真和衰减，使信号的波形和强度达到所需的要求，进而扩大网络传输的距离。其原理是信号再生（而非简单地放大衰减的信号）。中继器有两个端口，数据从一个端口输入，从另一个端口发出。端口仅作用于信号的电气部分，而不管是否有错误数据或不适于网段的数据。  

中继器是用来扩大网络规模的最简单的廉价互连设备。中继器两端的网络部分是网段，而不是子网，使用中继器连接的几个网段仍是一个局域网。中继器若出现敌障，则对相邻两个网段的工作都产生影响。因为中继器工作在物理层，所以不能连接两个具有不同速率的局域网。  

# 注意  

若某个网络设备有存储转发功能，则认为它能连接两个不同的协议；若该网络设备无存储转发功能，则认为它不能连接两个不同的协议。中继器没有存储转发功能，因此它不能连接两个速率不同的网段，中继器两端的网段一定要使用同一个协议。  

从理论上讲，中继器的使用数目是无限的，网络因而也可无限延长。但事实上这是不可能的，因为网络标准中对信号的延迟范围做了具体规定，中继器只能在该范围内进行有效的工作，否则会引起网络敌障。例如，在采用粗同轴电缆的10BASE5以太网规范中，互相串联的中继器的个数不能超过4个，而且用4个中继器事联的5段通信介质中，只有3段可以挂接计算机，其余2段只能用作扩展通信范围的链路段，不能挂接计算机。这就是所谓的“5-4-3规则”。  

# 注意  

放大器和中继器都起放大作用，只不过放大器放大的是模拟信号，其原理是放大衰减的信号，而中继器放大的是数字信号，其原理是整形再生衰减的信号。  

# 2.3.2集线器  

集线器（Hub）实质上是一个多端口的中继器。当Hub工作时，一个端口接收到数据信号后，因为信号在从端口到Hub的传输过程中已有衰减，所以Hub便对该信号进行整形放大，使之再生（恢复）到发送时的状态，紧接着转发到其他所有（除输人端口外）处于工作状态的端口。若同时有两个或多个端口输入，则输出时将发生冲突，致使这些数据都无效。从Hubb的工作方式可以看出，它在网络中只起信号放大和转发作用，自的是扩大网络的传输范围，而不具备信号的定向传送能力，即信息传输的方向是固定的，是标准的共享式设备。  
使用Hub组网灵活，它将所有结点的通信集中在以其为中心的结点上，由Hub组成的网络是共享式网络，但逻辑上仍是总线网。Hu品b的每个端口连接的是同一网络的不同网段，同时Hub也只能在半双工状态下工作，网络的吞吐率因而受到限制。  

# 命题追踪中继器和集线器对冲突域/广播域的划分（2010、2020）  

# 注意  

集线器不能分割冲突域，集线器的所有端口都属于同一个冲突域。集线器在一个时钟周期内只能传输一组信息，当一台集线器连接的机器数目较多且多台机器经常需要同时通信时，将导致信息冲突，使得集线器的工作效率很差。例如，一个带宽为10MIb/s的集线器上连接了8台计算机，当这8台计算机同时工作时，每台计算机所真正拥有的带宽为 $10/8\mathrm{{M}\mathrm{{b}/\mathrm{{s}=1.25\mathrm{{M}\mathrm{{b}/\mathrm{{s}.}}}}}}$  

# 2.3.3 本节习题精选  

# 单项选择题  

01.下列关于物理层设备的叙述中，错误的是（）  

A.中继器仅作用于信号的电气部分B.利用中继器来扩大网络传输距离的原理是它将衰减的信号进行了放大C.集线器实质上相当于一个多端口的中继器D.物理层设备连接的几个网段仍是一个局域网  

02.转发器的作用是（）。  

A.放大信号B.转发帧C.存储帧D.寻址  

03.两个网段在物理层进行互连时要求（）  

A.数据传输速率和数据链路层协议都可以不同B.数据传输速率和数据链路层协议都要相同C.数据传输速率要相同，但数据链路层协议可以不同D.数据传输速率可以不同，但数据链路层协议要相同  

04.为了使数字信号传输得更远，可采用的设备是（）A.中继器B.放大器C.网桥D.路由器  

05.以太网遵IEEE802.3标准，用粗缆组网时每段的长度不能大于 $500\mathrm{m}$ ，超过 $500\mathrm{m}$ 时就要分段，段间相连利用的是（）。  

A.网络适配器B.中继器C.调制解调器D.网关  

06.在粗缆以太网中可通过中继器扩充网段，中继器最多可有（）。  

A.3个 B.4个 C.5个 D.无限个  

07.由集线器连接多台设备构成的网络在物理上和逻辑上的结构分别是（）  

A.总线形、环形B.网状、星形C.总线形、星形D.星形、总线形  

08.用集线器连接的工作站集合（）  

A.同属一个冲突域，也同属一个广播域B.不同属一个冲突域，但同属一个广播域C.不同属一个冲突域，也不同属一个广播域D.同属一个冲突域，但不同属一个广播域  

09.中继器可以用来连接（）  
A.不同类型的局域网B.不同速率的局域网C.不同介质的局域网D.不同协议的局域网  

10.若有5台计算机连接到 $10\mathrm{Mb/s}$ 的集线器上，则每台计算机分得的平均带宽至多为（）。A. 2Mb/s B.5Mb/s C.10Mb/s D.50Mb/s 11.当集线器的一个端口收到数据后，将其（）。  

A.从所有端口广播出去B.从除输入端口外的所有端口广播出去C.根据目的地址从合适的端口转发出去D.随机选择一个端口转发出去  

12.下列关于中继器和集线器的说法中，不正确的是（）。  

A.二者都工作在OSI参考模型的物理层B.二者都可以对信号进行放大和整形C.通过中继器或集线器互连的网段数量不受限制D.中继器通常只有2个端口，而集线器通常有4个或更多端口  

# 2.3.4 答案与解析  

# 单项选择题  

01.B 中继器的原理是将衰减的信号再生而不是放大，连接后的网段仍然属于同一个局域网。  

02. A  

转发器是物理层设备，不能识别数据链路层的顿，也无寻址功能，只具有放大信号的功能。  

03.C  

物理层是OSI参考模型的第一层，它建立在物理通信介质的基础上，作为与通信介质的接口。当物理层互连时，各种网络的数据传输速率若不同，则可能出现以下两种情况： $\textcircled{\scriptsize{1}}$ 发送方的速率高于接收方，接收方来不及接收导致溢出（因为物理层没有流量控制），数据丢失。 $\circledcirc$ 接收方的速率高于发送方，不会出现数据丢失的情况，但效率极低。  

综上所述，数据传输速率必须相同。注意，物理层互连成功，只表明这两个网段之间可以互相传送物理层信号，但物理层设备只能转发物理信号，不能识别数据链路层协议，所以并不能保证可以互相传送数据链路层的顿。因此，数据链路层协议可以不同。要达到在数据链路层互连互通的目的，就要求数据传输速率和数据链路层协议都相同。  

04. A  

放大器通常用于远距离地传输模拟信号，但它同时会放大噪声，引发失真。中继器用于数字信号的传输，其工作原理是信号再生，因此会减少失真。网桥用来连接两个网段以扩展物理网络的覆盖范围。路由器是网络层的互连设备，可以实现不同网络的互连。  

# 05.B  

中继器的主要功能是将信号复制、整形和放大再转发出去，以消除信号经过一长段电缆而造成的失真和衰减，使信号的波形和强度达到所需的要求，进而扩大网络传输的距离，原理是信号再生，因此选B，其他三项显然有点大材小用。  

06.B  

中继器或集线器有“5-4-3规则”，其中“5”表示5个网段，“4”表示4个中继器或集线器，“3”表示3个网段为主机段。也就是说，在一个由中继器或集线器互连的网络中，任意发送方和接收方最多只能经过4个中继器、5个网段。  
07.D  

集线器将多个设备连接在以它为中心的结点上，因此使用它的网络在物理拓扑上属于星形结构。当集线器工作时，一个端口接收到数据信号后，集线器将该信号整形放大，紧接着转发到其他所有处于工作状态的端口。集线器不具备交换机所具有的交换表，所以它发送数据时是没有针对性的，而采用广播方式发送。因此，使用集线器的星形以太网逻辑上仍然是总线网。  

08.A  

集线器的功能是将从一个端口收到的数据通过所有其他端口转发出去。集线器在物理层上扩大了网络的覆盖范围，但无法解决冲突域（第二层交换机可解决）与广播域（第三层交换机可解决）的问题，而且增大了冲突的范围。注意，冲突域和广播域的概念涉及后面章节的内容。  

# 09.C  

因为物理层设备没有存储转发功能，所以中继器不能连接不同速率的局域网，也不能连接不同数据链路层协议的局域网（连接后要能达到正常通信的目的）。中继器可以连接不同介质的局域网，如光纤和双绞线，只要它们具有相同的速率和协议。  

10. A  

集线器以广播的方式将信号从除输入端口外的所有端口输出，因此任意时刻只能有一个端口的有效数据输入。理想情况（无冲突）下，每秒通过集线器的数据量都是10Mb，假设5台计算机占用相同大小的时间片来收发数据，则平均带宽的上限为 $10\mathrm{{M}\mathrm{{b}/\mathrm{{s}\cdot\mathrm{{5}}}}}\,{=}\,2\mathrm{{M}\mathrm{{b}/\mathrm{{s}}}}$ 。若有多台计算机同时发送数据，则会导致每台计算机实际获得的平均带宽低于2Mb/s。  

11.B  

集线器没有寻址功能，一个端口接收到数据信号后，从其他所有端口转发出去。  

12.C  

中继器和集线器均工作在物理层，集线器本质上是一个多端口中继器，它们都能对信号进行放大和整形。因为中继器不仅传送有用信号，而且传送噪声和冲突信号，因此互相串联的个数只能在规定的范围内进行，否则网络将不可用。注意“5-4-3规则”。  

# 2.4本章小结及疑难点  

1.传输介质是物理层吗？传输介质和物理层的主要区别是什么？  

传输介质并不是物理层。因为传输介质在物理层的下面，而物理层是体系结构的第一层，所以有时称传输介质为0层。在传输介质中传输的是信号，但传输介质并不知道所传输的信号代表什么。也就是说，传输介质不知道所传输的信号什么时候是1、什么时候是0。但是，物理层因为规定了电气特性，所以能够识别所传送的比特流。图2.9描述了上述概念。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/2f1f5f2c0d7fe7203bffb23547955323749cf1e817aa2ce960cb455a03143dca.jpg)  
图2.9传输介质与物理层  
# 2.什么是基带传输、频带传输和宽带传输？三者的区别是什么？  

在计算机内部或在相邻设备之间近距离传输时，可不经过调制就在信道上直接进行的传输方式称为基带传输。它通常用于局域网。数字基带传输就是在信道中直接传输数字信号，且传输介质的整个带宽都被基带信号占用，双向地传输信息。最简单的方法是用两个高低电平来表示二进制数字，常用的编码方法有不归零编码和曼彻斯特编码。例如，要传输1010，低电平代表0，高电平代表1，那么在基带传输下，1010需要向通信线路传输（高、低、高、低电平）。  

用数字信号对特定频率的载波进行调制（数字调制），将其变成适合传送的信号后再进行传输，这种传输方式就是频带传输。当采用远距离传输或无线传输时，数字信号必须用频带传输技术进行传输。利用频带传输，不仅解决了电话系统传输数字信号的问题，而且可以实现多路复用，进而提高传输信道的利用率。同样传输1010，经过调制，一个码元对应4个二进制位，假设码元A代表1010，那么在模拟信道上传输码元A就相当于传输1010。  

借助频带传输，可将链路分解成两个或多个信道，每个信道可携带不同的信号，这就是宽带传输。宽带传输中所有的信道能同时互不干扰地发送信号。例如，对信道进行频分复用，划分为2个互不相关的子信道，分别在两个子信道上同时进行频带传输，链路容量就会大大增加。  

3.奈氏准则和香农定理的主要区别是什么？这两个定理对数据通信的意义是什么？  

奈氏准则指出，码元传输的速率是受限的，不能任意提高，否则接收端就不能正确判定码元所携带的比特数据（因为码元之间存在相互干扰）。奈氏准则是在理想条件下推导出来的。在实际条件下，最高码元传输速率要比理想条件下得出的数值小很多。  

值得注意的是，奈氏准则并未限制信息传输速率。要提高信息传输速率，就必须使每个码元能够携带许多比特的信息。但是，码元所载的比特数确定后，信道的极限数据率也就确定了。  

香农定理给出了信息传输速率的极限，即对于一定的传输带宽（单位为Hz）和一定的信噪比，信息传输速率的上限是确定的，这个极限不能突破。要想提高信息传输速率，要么设法提高传输线路的带宽，要么设法提高信道的信噪比，此外没有其他任何办法。  

香农定理告诉我们，要得到无限大的信息传输速率，只有两个办法：要么使用无限大的传输带宽（这显然不可能），要么使信号的信噪比无限大，即采用没有噪声的信道或使用无限大的发送功率（这显然也不可能）。注意，奈氏准则和香农定理中“带宽”的单位都是 $\mathrm{Hz}$  

4.信噪比为SIN，为什么还要取对数 $10\mathrm{log}_{10}(S/N)?$ 1）数字形式表示，如噪声功率为1，信号功率为100，信噪比为 $100/1\,{=}\,100$ 2）同样还是上面这些数字，以分贝形式表示的信噪比为 $10\mathrm{log}_{10}(S/N)\,{=}\,10\mathrm{log}_{10}100\,{=}\,20\mathrm{dB}\,.$  

二者在数值上等价。区别在于，前者没有单位，后者必须加dB（分贝）。采用分贝表示的原因：很多时候，信号要比噪声强得多，如信号比噪声强10亿倍，若用数值表示，则1后面有9个0，很容易丢失0；若用分贝表示，则仅为90dB，因此要简单得多，且不容易出错。分贝对于表示特别大或特别小的数值极为方使，在通信领域中用途很广。  
# 第3章数据链路层  

# 【考纲内容】  

（一）数据链路层的功能  

（二）组帧  

（三）差错控制  

检错编码：纠错编码  

（四）流量控制与可靠传输机制流量控制、可靠传输与滑动窗口机制：停止-等待协议：后退 $N$ 帧协议（GBN）：选择重传协议（SR）  

（五）介质访问控制  

1.信道划分：频分复用、时分复用、波分复用、码分复用2.随机访问：ALOHA协议：CSMA协议：CSMA/CD协议：CSMA/CA协议3.轮询访问：令牌传递协议  

（六）局域网局域网的基本概念与体系结构：以太网与IEEE802.3；IEEE802.11无线局域网：VLAN的基本概念与基本原理  

（七）广域网广域网的基本概念：PPP协议  

以太网交换机及其工作原理  

# 【复习提示】  

本章是历年考试中考查的重点。要求在了解数据链路层基本概念和功能的基础上，重点掌握滑动窗口机制、三种可靠传输协议、各种MAC协议，特别是CSMA/CD协议、CSMA/CA协议和以太网顿格式，以及局域网的争用期和最小帧长的概念、二进制指数退避算法。此外，中继器、网卡、集线器、网桥和局域网交换机的原理及区别也要重点掌握。  

# 3.1数据链路层的功能  

数据链路层的主要任务是实现帧在一段链路上或一个网络中进行传输。数据链路层协议有多种，但有三个基本问题则是共同的，即封装成顿、透明传输和差错检测。  

数据链路层使用的信道主要有两种：  
1）点对点信道，使用一对一的通信方式。PPP协议则是目前使用最广泛的点对点协议。2）广播信道，这种信道上连接的主机很多，使用一对多的广播通信方式。采用共享广播信道的有线局域网普遍使用CSMA/CD协议，而无线局域网则使用CSMA/CA协议。  

# 3.1.1数据链路层所处的地位  

下面使用两台主机通过互联网进行通信的例子来了解数据链路层所处的地位，如图3.1所示。局域网1中的主机H1经过路由器R1、广域网及路由器R2连接到局域网2中的主机H2。主机H1和H2都有完整的五层协议栈，而路由器在转发分组时仅使用协议栈的下三层。当主机H1向H2发送数据时，从协议的层次上看，数据的流动如图3.2所示。数据进入路由器后要先从物理层上到网络层，在转发表中我到下一跳的地址后，再下到物理层转发出去。因此，数据从主机H1送到主机H2需要在路径中的各结点的协议栈向上和向下流动多次。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/e7e297fbb0520613c7252ae1f3530980f5248c701458e45dd8079c49662f2683.jpg)  
图3.1主机H1向H2发送数据  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/25920ca739682fceb5264e70ee939f8d7abe7feee0fa034448b85f86ab86b5f8.jpg)  
图3.2从层次上看数据的流动  

当我们学习数据链路层时，通常可以只关心协议栈中水平方向的各数据链路层。于是，当主机H1向主机H2发送数据时，可以想象数据就是在各相关设备的数据链路层之间沿水平方向传送的。如图3.3所示，即通过以下这样的链路：H1的链路层 $\to\!\mathrm{R1}$ 的链路层 $\to\!\mathbb{R}2$ 的链路层一H2的链路层，其中三段不同的数据链路可能采用不同的数据链路层协议。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/ffb78b2e18190098f64fcc494beb631836f32110a4006eb8b1a6412e30626310.jpg)  
图3.3只考虑数据在数据链路层的流动  

下面介绍点对点信道的一些基本概念，某些概念对广播信道也是适用的。  

1）链路。指从一个结点到相邻结点的一段物理线路。当进行数据通信时，两台计算机之间的通信路径往往要经过许多段这样的链路。可见链路只是一条路径的组成部分。  

2）数据链路。当在一条链路上传送数据时，除了需要链路本身，还需要一些必要的通信协议来控制这些数据的传输，把实现这些协议的硬件和软件加到链路上，就构成了数据链  
路。有时也把上面所说的链路称为物理链路，而把数据链路称为逻辑链路。  

3）顿。数据链路层对等实体之间进行逻辑通信的协议数据单元。数据链路层把网络层下交的数据构成帧发送到链路上，并把接收到的帧中的数据取出并上交给网络层。  

# 3.1.2为网络层提供服务  

数据链路层通常可以为网络层提供如下三种服务：  

1）无确认的无连接服务。源主机发送帧时不需要先建立链路连接，目的主机收到帧时不需要发回确认。数据传输的可靠性由高层负责。适用于误码率较低的信道，如以太网。  

2）有确认的无连接服务。源主机发送帧时不需先建立链路连接，但目的主机收到帧时必须发回确认。源主机在所规定的时间内未收到确定信号时，就重传丢失的帧，以提高传输的可靠性。该服务适用于误码率较高的信道，如无线通信。  

3）有确认的面向连接服务。顿传输过程分为三个阶段：建立链路、传输顿、释放链路。目的主机对收到的每一个帧都要返回确认。该服务适用于可靠性要求较高的场合。  

# 注意  

有连接就一定要有确认，即不存在无确认的面向连接的服务。  

# 3.1.3链路管理  

数据链路层连接的建立、维持和释放过程称为链路管理，它主要用于面向连接的服务。链路两端的结点要进行通信，必须首先确认对方已处于就绪状态，并交换一些必要的信息以对顺序号初始化，然后才能建立连接，在传输过程中要能维持连接，而在传输完毕后要释放该连接。  

# 3.1.4 封装成帧与透明传输  

封装成顿是指在一段数据的前后分别添加首部和尾部，构成顿，顺是数据链路层的数据传送单元。顿长等于帧的数据部分长度加上首部和尾部的长度。首部和尾部中含有很多控制信息，它们的一个重要作用是确定帧的界限，即顿定界。接收方能从接收到的二进制比特流中区分出帧的起始与终止，即帧同步。如在HDLC协议中，用标识位F（01111110）来标识帧的开始和结束。在通信过程中，检测到帧标识位F即认为其是顿的开始，然后一旦检测到帧标识位F即表示顿的结束。HDLC标准帧格式如图3.4所示。为了提高帧的传输效率，应当使帧的数据部分的长度尽可能地大于首部和尾部的长度，但随着帧长的增加，传输差错发生的概率也随之提高，发生差错时重传的代价也越大，因此每种链路层协议都规定了帧的数据部分的长度上限，即最大传送单元。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/cf66d2f1d0b40f4535ac0e51bb07fdcdfe8a22a900b11a84e927a41c2f9190f7.jpg)  
图3.4HDLC标准帧格式  

若在数据中恰好出现与顺定界符相同的比特组合（会误认为“传输结束”而丢弃后面的数据），则要采取有效的措施来解决这个问题，即透明传输。更确切地说，透明传输是指不论所传的数据是什么样的比特组合，都能够按原样无差错地在这个数据链路上传输。  

# 3.1.5流量控制  

因为链路两端结点的工作速率和缓存空间存在差异，所以发送方的发送能力可能大于接收方的接收能力，此时若不适当限制发送方的发送速率，前面来不及接收的帧将被后面不断发送来的倾“淹没”，造成顿的丢失而出错。因此，流量控制实际上就是限制发送方的发送速率，使之不超过接收方的接收能力。这个过程需通过某种反馈机制，使发送方知道在什么情况下可以接着发送下一帧，而在什么情况下必须暂停发送，以等待收到某种反馈信息后继续发送。  
在OSI体系结构中，数据链路层具有流量控制的功能。而在TCP/IP体系结构中，流量控制功能被移到了传输层。它们控制的对象不同。对数据链路层来说，控制的是相邻结点之间的数据链路上的流量，而对传输层来说，控制的则是从源端到目的端之间的流量。  

# 3.1.6 差错检测  

因为信道噪声等原因，顿在传输过程中可能会出现错误，这些错误分为位错和顿错  

1）位错：帧中某些位出现差错，通常采用循环冗余检验（CRC）来发现位错。2）顿错：帧丢失、顿重复或帧失序等错误，它们都属于传输差错。  

过去OSI的观点是：必须让数据链路层向上提供可靠传输。因此在CRC检错的基础上，增加了帧编号、确认和重传机制。收到正确的帧就要向发送方发送确认。发送方在一定期限内若未收到对方的确认，就认为出现了差错，因此进行重传，直到收到确认为止。现在，在通信质量较差的无线传输中，数据链路层依然使用确认和重传机制，向上提供可靠的传输服务。  

对于通信质量良好的有线链路，数据链路层已不再使用确认和重传机制，即不要求向上提供可靠传输的服务，而仅需进行CRC检错，目的是将有差错的帧丢弃，保证上交的帧都是正确的，而对出错的顿的重传任务则由高层协议（如传输层TCP协议）完成。  

# 3.1.7 本节习题精选  

# 单项选择题  

01.下列不属于数据链路层功能的是（）  

A.帧定界B.电路管理C.差错控制D.流量控制  

02.下列不属于数据链路层功能的是（）  

A.透明传输B.差错检测C.可靠传输D.拥塞控制  

03.数据链路层协议的功能不包括（）  

A.定义数据格式B.提供结点之间的可靠传输C.控制对物理传输介质的访问D.为终端结点隐蔽物理传输的细节  

04.为了避免传输过程中帧的丢失，数据链路层采用的方法是（）A.帧编号机制 B.循环冗余检验码C.海明码 D.计时器超时重发 05.数据链路层为网络层提供的服务不包括（）  

A.无确认的无连接服务B.有确认的无连接服务C.无确认的面向连接服务D.有确认的面向连接服务  

06.对于信道比较可靠且对实时性要求高的网络，数据链路层采用（）比较合适。  

A.无确认的无连接服务B.有确认的无连接服务C.无确认的面向连接服务D.有确认的面向连接服务  

07.流量控制实际上是对（）的控制。  

A.发送方的数据流量B.接收方的数据流量C.发送、接收方的数据流量D.链路上任意两结点间的数据流量  

08．下述协议中，（）不是数据链路层的标准。A.ICMP B. HDLC C.PPP D.SLIP  
# 3.1.8 答案与解析  

单项选择题  

01.B  

数据链路层的主要功能包括：如何将二进制比特流组织成数据链路层的帧：如何控制帧在物理信道上的传输，包括如何处理传输差错：在两个网络实体之间提供数据链路的建立、维护和释放；控制链路上帧的传输速率，以使接收方有足够的缓存来接收每个帧。这些功能对应为顿定界、差错检测、链路管理和流量控制。电路管理功能由物理层提供。  

02.D  

拥塞控制是网络层或传输层的功能，用于防止过多的分组注入网络而导致网络性能下降。  

03.D  

数据链路层的主要功能包括组顿，组帧即定义数据格式，A正确。数据链路层在物理层提供的不可靠的物理连接上实现结点到结点的可靠性传输，B正确。控制对物理传输介质的访向由数据链路层的介质访问控制（MAC）子层完成，C正确。为终端结点隐蔽物理传输的细节是物理层的功能，数据链路层不必考虑如何实现无差别的比特传输，D错误。  

04. D  

为防止在传输过程中帧丢失，在可靠的数据链路层协议中，发送方对发送的每个数据顿设计一个计时器，当计时器到期而该帧的确认帧仍未到达时，发送方将重发该帧。为保证接收方不会接收到重复帧，需要对每个发送的帧进行编号；海明码和循环究余检验码都用于差错控制。  

05.C  

连接是建立在确认机制基础之上的，因此数据链路层没有无确认的面向连接服务。一般情况下，数据链路层会为网络层提供三种可能的服务：无确认的无连接服务、有确认的无连接服务、有确认的面向连接服务。  

06.A  

无确认的无连接服务是指源机器向目标机器发送独立的帧，目标机器并不对这些帧进行确认。事先并不建立逻辑连接，事后也不用释放逻辑连接。若因线路上有噪声而造成某一帧丢失，则数据链路层并不检测这样的丢帧现象，也不回复。当错误率很低时，这类服务非常合适，这时恢复任务可留给上面的各层来完成。这类服务对实时通信也非常合适，因为实时通信中数据的迟到比数据损坏更不好。  

07. A  

流量控制是通过限制发送方的数据流量而使发送方的发送速率不超过接收方接收速率的一种技术。流量控制功能并不是数据链路层独有的，其他层上也有相应的控制策略，只是各层的流量控制对象是在相应层的实体之间进行的。  

08.A  

ICMP是网络层协议，PPP是在SLIP基础上发展而来的，都是数据链路层协议。  

# 3.2 组帧  

发送方依据一定的规则将网络层递交的分组封装成帧（也称组帧）。数据链路层之所以要将比特组合成以帧为单位传输，是为了在出错时只重发出错的帧，而不必重发全部数据，从而提高效率。组帧主要解决帧定界、顿同步、透明传输等问题。实现组帧的方法通常有以下4种。  
# 注意  

组帧时既要加首部，又要加尾部。原因是，在网络中信息是以帧为最小单位进行传输的，所以接收方要正确地接收顿，就必须清楚该倾在一串比特流中从哪里开始到哪里结束（因为接 收方收到的是一串比特流，没有首部和尾部是不能正确区分帧的）。而分组（即IP数据报）仅是包含在顿中的数据部分（后面将详细讲解），所以不需要加尾部来定界。  

# 3.2.1字符计数法  

字符计数法是指在顺首部使用一个计数字段来记录该帧所含的字节数（包括计数字段自身所占用的1个字节），如图3.5所示。当接收方读出顿首部的字节计数值时，就知道后面跟随的字节数，从而确定帧结束位置。因为帧与帧之间是连续传输的，所以也能确定下一顺的开始位置。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/18cc49d5bb85480e0fc592ac0552950e0a6fde483285e113ce24cf11aa21335f.jpg)  
图3.5字符计数法  

这种方法最大的问题在于若计数字段出错，即失去帧边界划分的依据，则接收方就无法判断所传输帧的结束位和下一帧的开始位，收发双方将失去同步，造成灾难性后果。  

# 3.2.2字节填充法  

字节填充法使用特定字节来定界一帧的开始与结束，在图3.6的例子中，控制字符SOH放在倾的最前面，表示帧的开始，控制字符EOT表示顺的结束。为了使信息位中出现的特殊字符不被误判为帧的首尾定界符，可在特殊字符之前填充一个转义字符ESC来加以区分（注意，转义字符是ASCII码中的控制字符，是一个字符，而非“E”“S”“C”三个字符的组合），以实现数据的透明传输。接收方收到转义字符后，就知道其后面紧跟的是数据信息，而不是控制信息。  

在图3.6(a)所示的字符帧中，帧的数据段中出现EOT或SOH字符，发送方在每个EOT或SOH字符前再插入一个ESC字符［见图3.6(b)」，接收方收到数据后会自己册除这个插入的ESC字符，结果仍得到原来的数据[见图3.6（c)]。这也正是字符填充法名称的由来。若转义字符ESC也出现在数据中，则解决方法仍是在转义字符前插入一个转义字符。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/8bc622f7582e5fe4c3b6569bf04fcef4d549661a5ba94591071cdb9feec74e46.jpg)  
图3.6字节填充法  

# 3.2.3零比特填充法  

# 命题追踪HDLC协议中的比特填充法（2013）  

零比特填充法允许数据帧包含任意个数的比特，它使用一个特定的比特串 $0111110$ 来标志一顿的开始和结束，如图3.7所示。为了不使数据字段中出现的比特流01111110被误判为帧的首尾标志，发送方先扫描整个数据字段，每遇到5个连续的“1”，就自动在其后插入一个“0”。经过这种比特填充后，就可保证数据字段中不会出现6个连续的“1”。接收方做该过程的逆操作，即每收到5个连续的“1”，就自动删除后面紧跟的“0”，以恢复原始数据。在数据链路层早期使用的HDLC协议中，便是采用这种比特填充的首尾标志法来实现透明传输的。  
（a）原始数据011011110010(b)线上数据011011111011111011111010010填充的位（c）接收方删除填0110111 1111110010 充位后的数据图3.7比特填充法  

零比特填充法很容易由硬件来实现，性能优于字节填充法  

# 3.2.4违规编码法  

在物理层进行比特编码时，常采用违规编码法。例如，曼彻斯特编码方法将数据比特“1”编码成“高-低”电平对，将数据比特“0”编码成“低-高”电平对，而“高一高”电平对和“低一低”电平对在数据比特中是违规的（即没有采用），因此可借用这些违规编码序列来定界顿的起始和终止。局域网IEEE802标准就采用了这种方法。违规编码法不采用任何填充技术便能实现数据的透明传输，但只适用于采用余编码的特殊编码环境。广  

因为字符计数法中计数字段的脆弱性和字节填充法实现上的复杂性与不兼容性，所以自前较常用的组帧方法是零比特填充法和违规编码法。  

# 3.2.5本节习题精选  

# 一、单项选择题  

01.【2013统考真题】HDLC协议对0111110001111110组帧后，对应的比特串为（）。  

A.011111000011111010 B.011111000111110101111110 C.01111100011111010 D.011111000111111001111101  

# 二、综合应用题  

01.在一个数据链路协议中使用下列字符编码A01000111; B11100011; ESC11100000; FLAG01111110  

在使用下列组帧方法的情况下，说明为传送4个字符A、B、ESC、FLAG所组织的帧而实际发送的二进制位序列（使用FLAG作为首尾标志，ESC作为转义字符）。  

1）字符计数法。 2）使用字节填充法。3）使用零比特填充法。  

# 3.2.6 答案与解析  

# 一、单项选择题  

01.A  

HDLC协议对比特串组帧时，HDLC数据帧以比特模式 $0111\,1110$ 标识每个帧的开始和结束，因此在帧数据中只要出现5个连续的位“1”，就在输出的位流中填充一个“0”。因此，组帧后的比特串为011111000011111010（下画线部分为新增的0）。  
# 二、综合应用题  

# 01.【解答】  

1）第一字节为所传输的字符计数5，转换为二进制为00000101，后面依次为A、B、ESC、FLAG的二进制编码：0000010101000111111000111110000001111110  

2）首尾标志位FLAG（01111110），在所传输的数据中，若出现控制字符，则在该字符前插入转义字符ESC（11100000）：0111111001000111111000111110000011100000111000000111111001111110  

3）首尾标志位FLAG（01111110），在所传输的数据中，若连续出现5个“1"，则在其后插入“0”：  

01111110 01000111 110100011 11100000001111101001111110  

# 3.3差错控制  

实际通信链路都不是理想的，比特在传输过程中可能产生差错，1可能变成0，0也可能变成1，这就是比特差错。比特差错是传输差错中的一种，本节仅讨论比特差错。  

通常利用编码技术进行差错控制，主要有两类：自动重传请求（AutomaticRepeatreQuest，ARQ）和前向纠错（Forward Error Correction，FEC）。在ARQ方式中，当接收方检测到差错时，就设法通知发送方重发，直到收到正确的数据为止。在FEC方式中，接收方不但能发现差错，而且能确定错误的位置并加以纠正。因此，差错控制又可分为检错编码和纠错编码。  

# 3.3.1 检错编码  

检错编码都采用冗余编码技术，核心思想是在有效数据（信息位）被发送前，按某种关系附加一定的余位，构成一个符合某一规则的码字后发送。当要发送的有效数据变化时，相应的冗余位也随之变化，使得码字遵从不变的规则。接收方根据收到的码字是否仍符合原规则来判断是否出错。常见的检错编码有奇偶检验码和循环见余码。  

# 1.奇偶检验码  

奇偶检验码是奇检验码和偶检验码的统称，是一种最基本的检错码。它由 $n-1$ 位数据和1位检验位组成，检验位的取值（0或1）将使整个检验码中“1”的个数为奇数或偶数。  

1）奇检验码：附加一个检验位后，码长为 $n$ 的码字中“1”的个数为奇数。2）偶检验码：附加一个检验位后，码长为 $n$ 的码字中“1”的个数为偶数。  

例如，7位数据1001101对应的奇检验码为10011011，对应的偶检验码为10011010。它只能检测奇数位的出错情况，但不知道哪些位错了，也不能发现偶数位的出错情况。  

2.循环冗余码  

（Cyclic Redundancy Code，CRC）检错技术。  

循环冗余码（CRC）检错的基本思想：1）收发双方约定生成多项式 $G(x)$ （最高位和最低位必须为1)。 $k$ 位位串可视为阶数为 $k\!-\!1$ 的  
多项式的系数序列。例如，可用多项式 $x^{3}+x^{2}+1$ 表示位串1101。2）发送方基于待发送的数据和 $G(x)$ ，计算出余码，将余码附加到数据后面一起发送。3）接收方收到数据和冗余码后，通过 $G(x)$ 来计算收到的数据和冗余码是否产生差错  

假设一个待传送 $m$ 位的数据，CRC运算产生一个 $r$ 位的冗余码，称为顿检验序列（FCS)。这样形成的帧将由 $m+r$ 位组成。在所要发送的数据后面增加 $r$ 位冗余码，虽然增大了传输开销，但是可以进行差错检测，这种代价往往是值得的。这个带检验码的帧刚好能被预先确定的多项式 $G(x)$ 整除。接收方用相同的多项式去除收到的帧，若无余数，则认为无差错。  

# 命题追踪循环余码的计算（2023）  

假设一段 $m$ 位数据，则计算余码的步骤如下：1）加0。假设 $G(x)$ 的阶为 $r$ ，在数据后面加 $r$ 个 $0$ ，相当于乘以 $2^{r}$  

2）模2除。利用模2除法，用 $G(x)$ 对应的二进制串去除1）中计算得出的数据串，得到的余数即为冗余码（共 $r$ 位，前面的0不可省略）。  

按照模2运算规则，加法不进位，减法不借位，相当于对应位进行逻辑异或运算。  

冗余码的计算举例。假设数据 $M\!=\!101001$ （即 $m\!=\!6$ )，除数 $G(x)\!=\!1101$ （即 $r\!=\!3\,.$ ），经模2除法运算后的结果是：商 $Q\,{=}\,110101$ （这个商没什么用），余数 $R\!=\!001$ 。因此，发送出去的数据为 $101001\;001$ （即 $2^{r}M+\mathrm{FCS}$ )，共有 $m+r$ 位，运算过程如图3.8所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/7fe3ce6cca99d7917138341845afea8f15d743f93b7222c8dc023eca16fb4d69.jpg)  
图3.8循环冗余码的运算过程  

发送方的FCS生成和接收方的CRC检验都是由硬件实现的，处理非常迅速，不会影响数据的传输。若在传输过程中无差错，则经过CRC检验后得出的余数 $R$ 肯定为0。但是，若出现误码，则余数 $R$ 仍为0的概率极低。因此，通过CRC检错技术，可以近似地认为“凡是接收方数据链路层接受的顿均无差错”。也就是说，凡是接收方数据链路层接受的帧，我们都能以非常接近1的概率认为这些帧在传输过程中未产生差错；而接收方丢弃的顿虽然曾经收到，但最终因为有差错而被丢弃，即未被接受。  

# 注意  

循环冗余码（CRC）是具有纠错功能的，只是数据链路层仅使用了它的检错功能，检测到帧出错则直接丢弃，是为了方便协议的实现，因此本节将CRC放在检错编码中介绍。  

# 3.3.2纠错编码  

最常见的纠错编码是海明码，其实现原理是在有效信息位中加入几个检验位形成海明码，并把海明码的每个二进制位分配到几个奇偶检验组中。某一位出错后，就会引起有关的几个检验位的值发生变化，这不但可以发现错位，而且能指出错位的位置，为自动纠错提供依据。  
现以数据码1010为例讲述海明码的编码原理和过程  

（1）确定海明码的位数设 $n$ 为有效信息的位数， $k$ 为检验位的位数，则信息位 $n$ 和检验位 $k$ 应满足  

$$
n+k\leqslant2^{k}-1
$$  

海明码位数 $n+k=7\!\leqslant\!2^{3}\!-\!1$ 成立，则 $n,\;k$ 有效。设信息位为 $D_{4}D_{3}D_{2}D_{1}$ （1010)，共4位，检验位为 $P_{3}P_{2}P_{1}$ ，共3位，对应的海明码为 $H_{7}H_{6}H_{5}H_{4}H_{3}H_{2}H_{1}$  

（2）确定检验位的分布规定检验位 $P_{i}$ 在海明位号为 $2^{i-1}$ 的位置上，其余各位为信息位，因此有：  

$P_{1}$ 的海明码位号为 $2^{i-1}\!=\!2^{0}\!=\!1$ ，即 $H_{1}$ 为 $P_{1}$  $P_{2}$ 的海明码位号为 $2^{i-1}\!=\!2^{1}\!=\!2$ ，即 $H_{2}$ 为 $P_{2}$  $P_{3}$ 的海明码位号为 $2^{i-1}\!=\!2^{2}\!=\!4$ ，即 $H_{4}$ 为 $P_{3}$  

将信息位按原来的顺序插入，则海明码各位的分布如下：  

$$
\begin{array}{c c c c c c c c}{{H_{7}}}&{{H_{6}}}&{{H_{5}}}&{{H_{4}}}&{{H_{3}}}&{{H_{2}}}&{{H_{1}}}\\ {{D_{4}}}&{{D_{3}}}&{{D_{2}}}&{{P_{3}}}&{{D_{1}}}&{{P_{2}}}&{{P_{1}}}\end{array}
$$  

（3）分组以形成检验关系  

每个数据位用多个检验位进行检验，但要满足条件：被检验数据位的海明位号等于检验该数据位的各检验位海明位号之和。另外，检验位不需要再被检验。分组形成的检验关系如下。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f963b4fdaa3d709ead387b3b915ec9d6919e696e045e6a79d41c56bbe2ccb151.jpg)  

（4）检验位取值  

检验位 $P_{i}$ 的值为第 $i$ 组（由该检验位检验的数据位）所有位求异或。  

根据（3）中的分组有  

$P_{1}\!=\!D_{1}\oplus D_{2}\oplus D_{4}\!=\!0\oplus1\oplus1\!=\!0$   $P_{2}\!=\!D_{1}\oplus D_{3}\oplus D_{4}\!=\!0\oplus0\oplus1\!=\!1$   $P_{3}\!=\!D_{2}\oplus D_{3}\oplus D_{4}\!=\!1\oplus0\oplus1\!=\!0$  

所以，1010对应的海明码为1010010（下画线为检验位，其他为信息位）。  

（5）海明码的检验原理  

每个检验组分别利用检验位和参与形成该检验位的信息位进行奇偶检验检查，构成 $k$ 个检验方程：  

$$
\begin{array}{c}{S_{1}\!=\!P_{1}\oplus D_{1}\oplus D_{2}\oplus D_{4}}\\ {S_{2}\!=\!P_{2}\oplus D_{1}\oplus D_{3}\oplus D_{4}}\\ {S_{3}\!=\!P_{3}\oplus D_{2}\oplus D_{3}\oplus D_{4}}\end{array}
$$  

若 $S_{3}S_{2}S_{1}$ 的值为“000”，则说明无错：否则说明出错，且这个数就是错误位的位号，如 $S_{3}S_{2}S_{1}\!=\!001$ 说明第1位出错，即 $H_{1}$ 出错，直接将该位取反就达到了纠错的自的。  

# 3.3.3 本节习题精选  

# 一、单项选择题  

01.下列有关数据链路层差错控制的叙述中，错误的是（）  
A.数据链路层只能提供差错检测，而不提供对差错的纠正B.奇偶检验码只能检测出错误而无法对其进行修正，也无法检测出双位错误 C.CRC检验码可以检测出所有的单比特错误D.海明码可以纠正一位差错  

02.下列属于奇偶检验码特征的是（）  

A.只能检查出奇数个比特的错误 B.能检查出任意个比特的错误 C.比CRC检验更可靠 D.只能检查出偶数个比特的错误  

03.字符S的ASCI编码从低到高依次为1100101，采用奇检验，在下述收到的传输后字符中，错误（）不能检测。  

A.11000011 B.11001010 C.11001100 D.11010011 04.为了纠正2比特的错误，编码的海明码的码距应该为（）。A.2B.3C.4D.505.对于10位要传输的数据，若采用海明码检验，则需要增加的余信息位数是（）。A.3 B.4 C.5 D.6 06.下列关于循环冗余检验的说法中，（）是错误的。  

A.带 $r$ 个检验位的多项式编码可以检测到所有长度小于或等于 $r$ 的突发性错误B.通信双方可以无须商定就直接使用多项式编码C.CRC检验可以使用硬件来完成D.有一些特殊的多项式，因为其有很好的特性，而成了国际标准  

07.要发送的数据是1101011011，采用CRC检验，生成多项式是10011，那么最终发送的数据应是（)。  

A. 11010110111010 B. 11010110110110 C.11010110111110 D.11110011011100  

08.【2023统考真题】若甲向乙发送数据时采用CRC检验，生成多项式为  $G(X)\!=\!X^{4}\!+X\!+1\,^{6}$  （即  $G=10011$ ），则乙方接收到比特串（）时，可以断定其在传输过程中未发生错误。  

A.101110000 B.101110100 C.101111000 D.101111100  

# 二、综合应用题  

01.在数据传输过程中，若接收方收到的二进制比特序列为10110011010，收发双方采用的生成多项式为 $G(x)\!=\!x^{4}+x^{3}+1$ ，则该二进制比特序列在传输中是否出错？若未出错，则发送数据的比特序列和CRC检验码的比特序列分别是什么？  

# 3.3.4 答案与解析  

# 一、单项选择题  

01.A  

链路层的差错控制有两种基本策略：检错编码和纠错编码。常见的纠错码有海明码，它可以纠正一位差错。CRC检验码可以检测出所有的单比特错误（记住该结论即可）。  

02.A  

奇偶检验的原理是通过增加余位来使得码字中“1”的个数保持为奇数或偶数的编码方法，它只能检查出奇数个比特的错误。  

03.D  

既然采用奇检验，那么传输的数据中1的个数若是偶数则可检测出错误，若1的个数是奇数则检测不出错误。  
04.D  

海明码“纠错” $d$ 位，需要码距为 $2d+1$ 的编码方案；“检错” $d$ 位，则只需码距为 $d+1$  

05.B  

在 $k$ 比特信息位上附加 $r$ 比特余信息，构成 $k+r$ 比特的码字，必须满足 $2^{r}\!\geqslant\!k\!+r\!+1$ 。若 $k$ 的取值小于或等于11且大于4，则 $r\!=\!4$  

06.B  

在使用多项式编码时，发送方和接收方必须预先商定一个生成多项式。发送方按照模2除法，得到检验码，在发送数据时将该检验码加到数据后面。接收方收到数据后，也需要根据该生成多项式来验证数据的正确性。选项A是正确结论，了解即可，无须掌握证明过程。  

07.C  

假设一个帧有 $m$ 位，其对应的多项式为 $G(x)$ ，则计算余码的步骤如下：  

$\textcircled{\scriptsize{1}}$ 加0。假设 $G(x)$ 的阶为 $r$ ，在帧的低位端加上 $r$ 个0  

$\circledcirc$ 模2除。利用模2除法，用 $G(x)$ 对应的数据串除 $\textcircled{\scriptsize{1}}$ 中计算出的数据串，得到的余数即为冗余码（共 $r$ 位，前面的0不可省略）。  

多项式以2为模运算。按照模2运算规则，加法不进位，减法不借位，它刚好是异或操作。乘 除法类似于二进制运算，只是在做加减法时按模2规则进行。  

08.D  

观察选项：除后4位外，前5位都为10111，可知发送方发送的数据部分为10111，列式求得余数部分为1100，因此发送方发送的帧串为101111100。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/313343887cf4fcd6a6592d0548dcd87dda9ca9e9cd66e1d8fc627b2ce0efd076.jpg)  

二、综合应用题  

01.【解答】  

根据题意，生成多项式 $G(x)$ 对应的二进制比特序列为11001。进行如下的二进制模2除法，被除数为10110011010，除数为11001：  

所得余数为0，因此该二进制比特序列在传输过程中未出现差错。发送数据的比特序列是1011001，CRC检验码的比特序列是1010。  

# 注意  
# 3.4流量控制与可靠传输机制  

在数据链路层中，流量控制机制和可靠传输机制是交织在一起的。  

# 3.4.1流量控制与滑动窗口机制  

流量控制是指由接收方控制发送方的发送速率，使接收方有足够的缓冲空间来接收每个帧。常见的流量控制方法有两种：停止-等待协议和滑动窗口协议。数据链路层和传输层均有流量控制的功能，它们都用到了滑动窗口协议，但也有所区别，主要体现如下：  

1）数据链路层控制的是相邻结点之间的流量，而传输层控制的是端到端的流量。  

2）数据链路层的控制手段是接收方收不下就不返回确认。传输层的控制手段是接收方通过确认报文段中的窗口值来调整发送方的发送窗口。  

# 1.停止-等待流量控制基本原理  

停止-等待流量控制是一种最简单的流量控制方法。发送方每次只充许发送一个帧，接收方每接收一个顿都要反馈一个应答信号，表示可以接收下一帧，发送方收到应答信号后才能发送下一顿。若发送方没有收到接收方反馈的应答信号，则需要一直等待。发送方每发送完一个帧，就进入等待接收方确认信息的过程中，因而传输效率很低。  

# 2.滑动窗口流量控制基本原理  

滑动窗口流量控制是一种更高效的流量控制方法。在任意时刻，发送方都维持一组连续的允许发送帧的序号，称为发送窗口；同时接收方也维持一组连续的允许接收帧的序号，称为接收窗口。发送窗口表示在还未收到对方确认信息的情况下，发送方最多还能发送多少个顺和哪些顺。同理，在接收方设置接收窗口是为了控制可以接收哪些倾和不可以接收哪些顺。  

图3.9给出了发送窗口的工作原理，图3.10给出了接收窗口（ $W_{\mathrm{T}}{=}\,1$ ）的工作原理  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/248725a206d61268b973ecf8d7a386b827f85a708e4466f48aca92b0595310cb.jpg)  
图3.9发送窗口控制发送方的发送速率：（a)允许发送 $_{0\sim4}$ 号共5个帧：（b)允许发送 $1\!\sim\!4$  号共4个帧；(c)不允许发送任何帧；(d)允许发送  $5{\sim}7$  号共3个帧  
发送方每收到一个按序确认的确认帧，就将发送窗口向前滑动一个位置。这样，就有一个新的序号落入发送窗口，序号落入发送窗口内的数据帧可以继续发送。当窗口内没有可以发送的帧（即窗口内的帧全部是已发送但未收到确认的帧）时，发送方就停止发送。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/9d828f694c1132f7e08e7c2789e1420a756d8816e676452e1fb324f88be8ccd3.jpg)  
图3.10 $W_{\mathrm{R}}\!=\!1$ 的接收窗口的意义  

接收方每收到一个序号落入接收窗口的数据顿，就充许将该帧收下，然后将接收窗口向前滑动一个位置，并发回确认。这样，就有一个新的序号落入接收窗口，序号落入接收窗口内的数据倾即为准备接收的帧。若收到的帧落在接收窗口之外，则一律丢弃。  

滑动窗口具有以下重要特性：  

1）只有接收窗口向前滑动（同时接收方发送了确认）时，发送窗口才有可能（只有发送方收到确认后才一定）向前滑动。  

# 命题追踪滑动窗口协议的窗口大小的关系（2019）  

2）从滑动窗口的概念看，停止-等待协议、后退  $N$  帧协议和选择重传协议只在发送窗口大小  

与接收窗口大小上有所差别：停止-等待协议：发送窗口  $W_{\mathrm{T}}\!=\!1$  ，接收窗口  $W_{\mathbb{R}}\!=\!1$  后退 $N$ 帧协议：发送窗口 $W_{\mathrm{T}}\!>\!1$ ，接收窗口 $W_{\mathbb{R}}\!=\!1$ 。选择重传协议：发送窗口  $W_{\mathrm{T}}\!>\!1$  ，接收窗口  $W_{\mathbb{R}}\!>\!1$  若采用  $n$  比特对帧编号，则后两种滑动窗口协议还需满足  $W_{\mathrm{{T}}}+W_{\mathrm{{R}}}\leqslant2^{n}$  

3）当接收窗口的大小为1时，可保证帧的有序接收。4）在数据链路层的滑动窗口协议中，窗口大小在传输过程中是固定的（与传输层不同）。  

# 3.4.2可靠传输机制  

可靠传输是指发送方发送的数据都能被接收方正确地接收，通常采用确认和超时重传两种机制来实现。确认是指接收方每收到发送方发来的数据顺，都要向发送方发回一个确认顺，表示已正确地收到该数据帧。超时重传是指发送方在发送一个数据顿后就启动一个计时器，若在规定时简内没有收到所发送数据顺的确认顿，则重发该数据顿，直到发送成功为止。  

使用这两种机制的可靠传输协议称为自动重传请求（ARQ），它意味着重传是自动进行的，接收方不需要对发送方发出重传请求。在ARQ协议中，数据帧和确认帧都必须编号，以区分确认帧是对哪个帧的确认，以及哪些帧还未确认。ARQ协议分为三种：停止-等待（Stop-and-Wait）协议、后退 $N$ 帧（Go-Back-N）协议和选择重传（SelectiveRepeat）协议。值得注意的是，这三种可靠传输协议的基本原理并不仅限于数据链路层，还可应用到其上各层。  
在有线网络中，链路的误码率较低，为了降低开销，并不要求数据链路层向其上层提供可靠传输服务，即使出现了误码，可靠传输的问题也由其上层处理。而无线网络的链路易受干扰，误码率较高，因此要求数据链路层必须向其上层提供可靠传输服务。  

# 1.单帧滑动窗口与停止-等待协议（S-W）  

在停止-等待协议中，发送方每次只能发送一个帧，当发送方收到接收方的确认帧之后，才可以发送下一个帧。从滑动窗口的角度看，停止-等待协议的发送窗口和接收窗口大小均为1。  

在停止-等待协议中，除数据帧丢失外，还可能出现以下两种差错： $\textcircled{\scriptsize{1}}$ 到达接收方的数据帧可能已遭破坏，接收方利用前面介绍的差错检测技术检出后，简单地将该帧丢弃。为了应付这种可能的情况，发送方装备了计时器。在一个帧发送后，发送方等待确认，当计时器超时的时候，若仍未收到确认，则重发该数据帧。如此重复，直到该数据顿正确到达为止。 $\textcircled{2}$ 数据顿正确而确认帧被破坏，此时接收方已收到正确的数据帧，但发送方收不到确认顿，因此发送方会重传已被接收的数据顿，接收方收到相同的数据顿时会丢弃该帧，并重传一个该帧对应的确认帧。  

对于停止-等待协议，因为每发送一个数据帧就停止并等待，所以用1比特来编号就已足够。发送的帧交替地用0和1来标识，确认顿分别用ACK0和ACK1来表示，当收到的确认顿有误时，就重传已发送的数据帧。若连续出现相同序号的数据帧，则表明发送方进行了超时重传。若连续出现相同序号的确认顿，则表明接收方收到了重复帧。  

此外，为了超时重传和判定重复帧的需要，发送方和接收方都要设置一个顿缓冲区。当发送方发送完数据帧时，必须在其发送缓存中保留该数据帧的副本，这样才能在出现差错时进行重传。只有在收到对方发来的确认顿ACK后，方可清除该副本。  

停止-等待协议的信道利用率很低。为了提高传输效率，产生了连续ARQ协议（后退  $N$  帧协 议和选择重传协议），发送方可连续发送多个帧，而不是每发完一个帧就停止等待确认。  

# 2.多帧滑动窗口与后退 $N$ 顿协议（GBN）  

# 命题追踪GBN协议的工作原理（2009）  

在后退 $N$ 帧协议中，发送方可在未收到确认顿的情况下，将序号在发送窗口内的多个数据帧全部发送出去。后退 $N$ 倾的含义是：发送方发送 $N$ 个数据帧后，若发现这 $N$ 个帧的前一个数据顾在计时器超时的时候仍未收到其确认信息，则该顺被判为出错或去失，此时发送方不得不重传该出错帧及随后的 $N$ 个顿。这意味着，接收方只允许按顺序接收帧。  

# 命题追踪GBN确认号的含义/捎带确认的应用（2017）  

如图3.11所示，发送方向接收方发送数据帧。发送方发完0号帧后，可以继续发送后续的1号帧、2号帧等。发送方每发送完一个数据帧，就要为该帧设置超时计时器。因为连续发送了许多顿，所以确认帧必须指明是对哪个帧的确认。为了降低开销，GBN协议充许接收方进行累积确 认，即充许接收方不需要每收到一个正确的数据帧就立即发回一个确认帧，而可在连续收到多个正确的数据顿后，对最后一个数据帧发回确认信息，也就是说，对某个数据帧的确认就代表该数据帧和之前所有的顿均已正确无误地收到。ACKn表示对 $n$ 号帧的确认，表示接收方已正确收到 $n$ 号帧及之前的所有顺，下次期望收到 $n+1$ 号帧（也可能是0号顿）。接收方只按序接收数据顺。图中，虽然在有差错的2号帧之后接着收到了正确的6个数据帧，但接收方必须将这些帧丢弃。  
接收方虽然丢弃了这些未按序出现的无差错帧，但应重发已发送的最后一个确认顿ACK1（这是为了防止已发送的确认帧ACK1去失）。  

# 命题追踪GBN超时重传的分析（2017）  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f3d8ffa553e14eac7cd68cf2198b841bed3882b8f8397d4235957d13e95a1280.jpg)  
图3.11GBN协议的工作原理：对出错数据帧的处理  

# 命题追踪GBN发送窗口的意义/最大尺寸（2017）  

若采用  $n$  比特对顿编号，则其发送窗口  $W_{\mathrm{T}}$  应满足  $1\!<\!W_{\mathrm{T}}\!\leqslant\!2^{n}\!-\!1$  。若  $W_{\mathrm{T}}$  大于  $2^{n}\!-\!1$  ，则会造 成接收方无法分辨新数据帧和旧数据帧（参考本章末的疑难点1）。  

后退 $N$ 顿协议的接收窗口 $W_{\mathrm{R}}\!=\!1$ ，可保证按序接收数据帧。  

不难看出，后退 $N$ 帧协议一方面因连续发送数据帧而提高了信道利用率，另一方面在重传时又必须重传原来已正确到达的顺（仅因这些倾的前面有一顺出错），因此这种做法会降低传送效率。当信道误码率较大时，后退 $N$ 帧协议不一定优于停止-等待协议。  

# 3.多帧滑动窗口与选择重传协议（SR）  

为了进一步提高信道的利用率，可以设法只重传出现差错和计时器超时的数据帧，但此时必须加大接收窗口，以便先收下失序但正确到达且序号仍落在接收窗口内的那些数据顿，等到所缺序号的数据帧收齐后，再一并送交上层。这就是选择重传协议。  

# 命题追踪选择重传协议的工作原理（2011）  

为了使发送方仅重传出错的帧，接收方不能再采用累积确认，而要对每个正确接收的数据帧逐一进行确认。显然，选择重传协议比后退 $N$ 帧协议更复杂，且接收方需要设置足够的帧缓冲区（帧缓冲区的数目等于接收窗口的大小而非序号数目，因为接收方不能接收序号在窗口下界以下或窗口上界以上的帧）来暂存那些失序但正确到达且序号落在接收窗口内的数据帧。每个发送缓冲区对应一个计时器，当计时器超时的时候，缓冲区的帧就重传。另外，选择重传协议还采用了比上述其他协议更有效的差错处理策略，即一旦接收方检测到某个数据帧出错，就向发送方发送一个否定顿NAK，要求发送方立即重传NAK指定的数据顿。在图3.12中，2号顿丢失后，接收方仍可正常接收并缓存之后收到的数据顺，待发送方超时重传2号顺并被接收方成功接收后，接 收窗口就可向前移动，而当发送方收到2号顿的确认后，发送窗口就可向前移动。在某个时刻，接收方检测到10号帧出错，向发送方发出否定帧NAK10，在此期间接收方仍可正常接收并缓存之后收到的顿，发送方收到否定帧NAK10后立即重传10号帧。  

选择重传协议的接收窗口 $W_{\mathrm{R}}$ 和发送窗口 $W_{\mathrm{T}}$ 都大于1，一次可以发送或接收多个帧。若采用 $n$ 比特对顿编号，需满足条件 $\textcircled{\scriptsize{1}}$ ： $W_{\mathrm{{R}}}+W_{\mathrm{{T}}}\!\leqslant\!2^{n}$ （否则，在接收方的接收窗口向前移动后，若有一个或多个确认帧丢失，则发送方就会超时重传之前的旧数据顿，接收窗口内的新序号与之前的旧序号出现重叠，接收方就无法分辨是新数据帧还是重传的旧数据帧）。此外，还应满足条件 $\circledcirc$  $W_{\mathrm{{R}}}\leqslant W_{\mathrm{{T}}}$ （否则，若接收窗口大于发送窗口，则接收窗口永远不可能填满，接收窗口多出的空间就毫无意义)。由 $\textcircled{\scriptsize{1}}$ 和 $\circledcirc$ 不难得出 $W_{\mathbb{R}}\!\leqslant\!2^{n-1}$ 。一般情况下， $W_{\mathbb{R}}$ 和 $W_{\mathrm{T}}$ 的大小是相同的。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/de59299ec42c47f7749328137b7d85d10deaadf593f80970a3170cc75da885a2.jpg)  
图3.12SR协议的工作原理：对超时和出错数据帧的处理  

# 4.信道利用率的分析  

信道利用率是指信道的效率。从时间角度看，信道效率是对发送方而言的，是指发送方在一个发送周期（从发送方开始发送分组到收到第一个确认分组所需的时间）内，有效发送数据的时间与整个发送周期之比。本节之所以使用分组的PDU名称而不使用帧，是为了更具通用性。  

（1）停止-等待协议的信道利用率  

# 命题追踪停止-等待协议下信道利用率的计算（2018、2020）  

停止-等待协议的优点是简单，缺点是信道利用率太低。下面用图3.13来分析这个问题。假定在发送方和接收方之间有一个直通的信道来传送分组。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/32c2e5a6d87213d9c91d0cbc5b5ea99f663b7a7cf0a460c11b9a131bd28a37f8.jpg)  
图3.13停止-等待协议中数据帧和确认帧的发送时间关系  

发送方发送分组的发送时延为 $T_{\mathrm{{D}}}$ 。显然， $T_{\mathrm{{D}}}$ 等于分组长度除以数据传输速率。假定分组正确到达接收方后，接收方处理分组的时间可以忽略不计，同时立即发回确认。接收方发送确认分组的发送时延为 $T_{\mathrm{A}}$ （通常可以忽略不计）。再假设发送方处理确认分组的时间也可以忽略不计，那么发送方经过时间 ${T_{\mathrm{{D}}}}\ +{\mathrm{{RTT}}}+{T_{\mathrm{{A}}}}$ 后就可再发送下一个分组，其中RTT是往返时延。因为仅在 $T_{\mathrm{{D}}}$ 内才用来发送数据分组，因此停止-等待协议的信道利用率 $U$ 为  

$$
U\,{=}\,\frac{T_{\mathrm{D}}}{T_{\mathrm{D}}+\mathrm{RT}+T_{\mathrm{A}}}
$$  

假定某个信道的 $\mathrm{RTT}=20\mathrm{ms}$ 。分组长度是1200比特，数据传输速率是 $1\mathrm{{Mb/s}}$ 。若忽略处理时间和 $T_{\mathrm{A}}$ ，则可算出信道利用率 $U\!=\!5.66\%$ 。若把数据传输速率提高到 $10\mathrm{Mb/s}$ ，则 $U\!=\!0.0596\%$ 由此可知，当往返时延RTT大于分组发送时延 $\mathit{T}_{\mathrm{{D}}}$ 时，信道利用率就非常低。  
（2）连续ARQ协议的信道利用率  

命题追踪三种滑动窗口协议的信道利用率比较（2023）  

连续ARQ协议采用流水线传输（见图3.14），即发送方可连续发送多个分组。这样，只要发送窗口足够大，就可使信道上有数据持续流动。显然，这种方式能获得很高的信道利用率。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/8e812ae1175819652438ba38e40f983c2fad2ab762a531a9c6ad028e526082e0.jpg)  
图3.14连续ARQ协议的流水线传输可提高信道利用率  

命题追踪GBN协议下信道利用率与发送窗口大小的关系（2012、2015、2017）  

假设连续ARQ协议的发送窗口为 $n$ ，即发送方可连续发送 $n$ 个分组，分为两种情况1D $n T_{\mathrm{D}}\,{<}\,T_{\mathrm{D}}\,{+}\,{\mathrm{RTT}}\,{+}\,T_{\mathrm{A}}$ ：即在一个发送周期内可以发送完 $n$ 个分组，信道利用率为  

$$
U={\frac{n T_{\mathrm{{D}}}}{T_{\mathrm{{D}}}+\mathrm{{RTT}}+T_{\mathrm{{A}}}}}
$$  

2) $n T_{\mathrm{D}}\,{\geqslant}\,T_{\mathrm{D}}\,{+}\,\mathrm{RTT}+T_{\mathrm{A}}$ ：即在一个发送周期内发不完（或刚好发完） $n$ 个分组，对于这种情况，只要不发生差错，发送方就可不间断地发送分组，信道利用率为1。  

命题追踪滑动窗口协议的数据传输速率的计算（2009、2010、2014）  

此外，“信道平均（实际）数据传输速率 $=$ 信道利用率 $.\times$ 信道带宽（最大数据传输速率）”，或者“信道平均（实际）数据传输速率 $=$ 发送周期内发送的数据量/发送周期”。  

本节习题中有不少关于信道利用率和数据传输速率的计算，读者可以结合习题学习。  

# 3.4.3 本节习题精选  

# 一、单项选择题  

01.下列有关停止一等待协议的叙述中，错误的是（）  

A.从滑动窗口角度看，发送窗口的尺寸为1 B.从滑动窗口角度看，接收窗口的尺寸为1C.仅用1比特给数据帧编号D.有较高的信道利用率  

02.下列情况中，会使停止-等待协议的效率变得很低的是（）。  

A.当源主机和目的主机之间的距离很近而且数据传输速率很高时B.当源主机和目的主机之间的距离很远而且数据传输速率很高时C.当源主机和目的主机之间的距离很近而且数据传输速率很低时D.当源主机和目的主机之间的距离很远而且数据传输速率很低时  

03.在简单的停止一等待协议中，当帧出现丢失时，发送方会永远等待下去，解决这种死锁现象的办法是（）。  

A.差错检验B.帧序号C.NAK机制D.超时机制04.在停止一等待协议中，为了让接收方能判断所收到的数据帧是否重复，采用（）的方法。  
A.帧编号 B.检错码 C.重传计时器 D.NAK顿  

05.一个信道的数据传输速率为4kb/s，单向传播时延为 $30\mathrm{ms}$ ，若使停止-等待协议的信道最大利用率达到 $80\%$ ，则要求的数据帧长至少为（）  

A.160比特B.320比特C.560比特D.960比特  

06.主机甲采用停止-等待协议向主机乙发送数据，数据传输速率是 $6\mathrm{k}\mathrm{b}/\mathrm{s}$ ，单向传播时延是 $100\mathrm{ms}$ ，忽略确认帧的发送时延。若信道的利用率为 $40\%$ ，则数据帧的长度为（）。  

A.240比特B.320比特C.600比特D.800比特

07.在停止-等待协议中，若发送方发送的数据帧中途丢失，则可能发生的情况是（）。  

A.接收方发送NAK帧，请求重发此帧 B.发送方在经过超时时间后未收到ACK帧，自动重发此帧C.接收方在经过超时时间后，向发送方发送ACK帧，请求重发此帧D.发送方继续发送后续帧，直到经过超时时间后未收到ACK帧，重发此帧  

08.下列关于连续ARQ的说法中，错误的是（）  

A.发送方可以连续发送若干数据帧，而不是发完一个数据帧就停下来等待确认帧B.发送方收到了接收方发来的确认帧，还可以接着发送数据帧C.相比停止-等待协议，连续ARQ因为减少了等待时间，所以提高了信道利用率D.接收方可以不按序接收数据帧  

09.数据链路层采用后退 $N$ 顿协议方式，进行流量控制和差错控制，发送方已经发送了编号0～6的帧。当计时器超时的时候，只收到对1、3和5号帧的确认，发送方需要重传的帧的数目是（）。  

A.1 B.2 C.5 D.6  

10.数据链路层采用后退 $N$ 顿协议，发送方已经发送了编号从0到6的顿。当计时器超时的时候，只收到对1、2、4号帧的确认，发送方需要重传的帧的数目是（）。  

A.1 B.2 C.5 D.6  

11.数据链路层采用了后退 $N$ 帧协议（GBN），若发送窗口的大小是32，则至少需要（）位的序列号才能保证协议不出错。  

A.4 B.5 C.6 D.7  

12.若采用后退 $N$ 帧的ARQ协议进行流量控制，帧编号字段为7位，则发送窗口的最大长度为()。  

A.7 B.8 C. 127 D.128  

13.一个使用选择重传协议的数据链路层，若采用5位的帧序列号，则可以选用的最大接收窗口是()。  

A.15 B.16 C. 31 D.32

 14.对于窗口大小为 $n$ 的滑动窗口，最多可以有（）帧已发送但没有确认。A. 0 B.n-1 C. n D. n/2

 15.对于选择重传协议，顿采用5位编号，接收窗口大小为14，则发送窗口最大为（）。A.14 B.16 C. 18 D. 31

 16.对无序接收的滑动窗口协议，若序号位数为  $n$  ，则接收窗口最大尺寸为（ A.  $2^{n}\!-1$  B.2n C.2n-1 D.  $2^{n-1}$  

17.采用滑动窗口机制对两个相邻结点A和B的通信过程进行流量控制。假定帧的序号长度为4，发送窗口和接收窗口的大小都是7，使用累积确认。当A发送编号为0、1、2、3这四个帧后，而B接收了这4个帧，但仅应答了0、3两个帧，此时发送窗口将要发送的帧序号为（ $\textcircled{\scriptsize{1}}$ ）；若采用选择重传协议来进行流量控制，则充许发送方在收到应答之前连续发出多个帧；若帧的序号长度为 $k$ 比特，则接收窗口的大小（ $\circledcirc$ 一 $2^{k-1}$  
$\textcircled{\scriptsize{1}}$ A.2B.3C.2D.5 $\circledcirc$  A.  $<$  B.  $>$  C. ≥ D.  

18.流量控制是实现发送方和接收方速度一致的机制，实现这种机制所采取的措施是（）。  

A.增大接收方接收速度C.接收方向发送方反馈信息B.减小发送方发送速度D.增加双方的缓冲区  

19.假设两台主机之间采用后退 $N$ 帧协议传输数据，数据传输速率为16kb/s，单向传播时延为 $250\mathrm{ms}$ ，数据帧的长度是128字节，确认顿的长度也是128字节，为使信道利用率达到最高，则帧序号的比特数至少为（）。  

A.2B.3C.4D.5

20.在下列滑动窗口机制中，理论上可以达到 $100\%$ 信道利用率的是（）I.停止-等待协议Ⅱ.后退 $N$ 顿协议III.选择重传协议A. 1 B.IⅡI C.III D.ⅡI和IⅢI  

21.数据链路层采用选择重传协议进行流量控制，发送方在收到0～3号帧的确认后，又收到了5号帧的确认，发送窗口内还有其他帧未发送，且未发生超时，则发送方将（）。  

A.重传4号帧 B.重传5号帧 C.接收该确认帧并继续发送剩下的帧D.停止发送并等待超时  

22.【2009统考真题】数据链路层采用了后退 $N$ 帧（GBN）协议，发送方已经发送了编号为0～7的帧。当计时器超时的时候，若发送方只收到0、2、3号帧的确认，则发送方需要重发的帧数是（）。  

A.2B.3C.4D.5  

23.【2011统考真题】数据链路层采用选择重传协议（SR）传输数据，发送方已发送0～3号数据顿，现已收到1号顿的确认，而0、2号帧依次超时，则此时需要重传的顿数是()。  

A.1 B.2 C.3 D.4  

24.【2012统考真题】两台主机之间的数据链路层采用后退 $N$ 帧协议（GBN）传输数据：数据传输速率为16kb/s，单向传播时延为 $270\mathrm{ms}$ ，数据帧长范围是 $128\sim512$ 字节，接收方总是以与数据帧等长的帧进行确认。为使信道利用率达到最高，帧序号的比特数至少为（)。  

A. 5 B.4 C.3 D. 2  

25.【2014统考真题】主机甲与主机乙之间使用后退 $N$ 帧协议（GBN）传输数据，主机甲的发送窗口尺寸为1000，数据帧长为1000字节，信道带宽为 $100\,\mathrm{{Mb/s}}$ ，主机乙每收到一个数据帧，就立即利用一个短帧（忽略其传输延迟）进行确认，若主机甲和主机乙之间的单向传播时延是 $50\mathrm{ms}$ ，则主机甲可以达到的最大平均数据传输速率约为（）。  

A.10Mb/s B.20Mb/s C. 80Mb/s D.100Mb/s  

26.【2015统考真题】主机甲通过 $128\mathrm{kb/s}$ 卫星链路，采用滑动窗口协议向主机乙发送数据，链路单向传播时延为  $250\mathrm{ms}$  ，帧长为1000字节。不考虑确认帧的开销，为使链路利用率 不小于 $80\%$ ，帧序号的比特数至少是（）。  

A.3 B.4 C.7 D.8  
27.【2018统考真题】主机甲采用停止-等待协议向主机乙发送数据，数据传输速率是3kb/s，单向传播时延是 $200\mathrm{ms}$ ，忽略确认帧的传输时延。当信道利用率等于 $40\%$ 时，数据帧的长度为()。  

A.240比特 B.400比特 C.480比特 D.800比特  

28.【2019统考真题】对于滑动窗口协议，若分组序号采用3比特编号，发送窗口大小为5 则接收窗口最大是（）。  

A.2B.3C.4D.5  

29.【2020统考真题】假设主机甲采用停止-等待协议向主机乙发送数据帧，数据帧长与确认颅长均为1000B，数据传输速率是 $10\mathbf{k}\mathbf{b}/\mathbf{s}$ ，单项传播延时是 $200\mathrm{ms.}$ 则主机甲的最大信道利用率为（）。  

A.  $80\%$  B.  $66.7\%$  C.  $44.4\%$  D.  $40\%$  

30.【2023统考真题】假设通过同一条信道，数据链路层分别采用停止-等待协议、GBN协 议和SR协议（发送窗口和接收窗口相等）传输数据，三个协议的数据帧长相同，忽略确认帧长，帧序号位数为3比特。若对应三个协议的发送方最大信道利用率分别是 $U_{1}$  $U_{2}$ 和 $U_{3}$ ，则 $U_{1}$ 、 $U_{2}$ 和 $U_{3}$ 满足的关系是（）。  

A.  $U_{1}{\leqslant}U_{2}{\leqslant}U_{3}$  B.  $U_{1}{\leqslant}U_{3}{\leqslant}U_{2}$  C.  $U_{2}{\leqslant}U_{3}{\leqslant}U_{1}$  D.  $U_{3}{\leqslant}U_{2}{\leqslant}U_{1}$  

# 二、综合应用题  

01.在选择重传协议中，设序号用3比特编号，发送窗口 $W_{\mathrm{T}}\,{=}\,6$ ，接收窗口 $W_{\mathrm{R}}\!=\!3$ 。试找出一种情况，使得在此情况下协议不能正确工作。

02.假设一个信道的数据传输速率为5kb/s，单向传播时延为 $30\mathrm{ms}$ ，那么帧长在什么范围内，才能使用于差错控制的停止-等待协议的效率至少为 $50\%$ ？（忽略确认帧的发送时延。）

03.假定信道的数据传输速率为 $100\mathrm{{kb}/\mathrm{{s}}}$ ，单程传播时延为 $250\mathrm{ms}$ ，每个数据顿的长度均为2000位，且不考虑确认帧长、首部和处理时间等开销，为了达到最大的传输效率，试问倾的序号应为多少位？此时的信道利用率是多少？

04.在数据传输速率为 $50\mathrm{k}\mathrm{b}/\mathrm{s}$ 的信道上传送长度为1kbit的帧，总是采用捐带确认，帧序号长度为3bit，单向传播延迟为 $270\mathrm{ms}$ 。对于下面三种协议，信道的最大利用率是多少？1）停止-等待协议。2）后退 $N$ 帧协议。3）选择重传协议（假设发送窗口和接收窗口相等）。

05.对于下列给定条件，不考虑差错重传，停止-等待协议的实际数据传输速率是多少？ $R\!=$ 传输速率（ $16\mathrm{Mb/s}$ 1 $S{=}$ 信号传播速率（ $200\mathrm{m}/\upmu\mathrm{s}$  $D\!=$  接收主机和发送主机之间传播距离（  $200\mathrm{m}$   $T\!=$ 创建帧的时间（ $2\upmu\mathrm{s}$ 1 $F{=}$ 每帧的长度（500bit） $N{=}$ 每帧中的数据长度（450bit） $A=$ 确认帧ACK的帧长（80bit） $64\mathrm{k}\mathrm{b}/\mathrm{s}$  很短的确认帧（忽略确认帧的发送时延）。信道的单向传播延时为 $270\mathrm{ms}$ 大小分别为1、7、17和117的情况，甲方的实际数据传输速率分别为多少？

07.【2017统考真题】甲乙双方均采用后退 $N$ 帧协议（GBN）进行持续的双向数据传输，且双方始终采用捎带确认，帧长均为1000B。 $S_{x,y}$ 和 $R_{x,y}$ 分别表示甲方和乙方发送的数据帧，其中 $x$ 是发送序号， $y$ 是确认序号（表示希望接收对方的下一帧序号），数据帧的发送序号和确认序号字段均为3比特。信道传输速率为 $100\,\mathrm{{Mb/s}}$ ， $\scriptstyle{\mathrm{RT}}\,=\,0.96{\mathrm{ms}}.$ 下图给出了甲方发送数据帧和接收数据帧的两种场景，其中 $t_{0}$ 为初始时刻，此时甲方的发送和确认序号均为0， $t_{1}$ 时刻甲方有足够多的数据待发送。  
请回答下列问题。  

1）对于图（a)， $t_{0}$ 时刻到 $t_{1}$ 时刻期间，甲方可以断定乙方已正确接收的数据帧数是多少？正确接收的是哪几个帧（请用 $S_{x,y}$ 形式给出）？  

2）对于图（a）：从 $t_{1}$ 时刻起，甲方在不出现超时且未收到乙方新的数据帧之前，最多还可以发送多少个数据帧？其中第一个帧和最后一个帧分别是哪个（请用 $S_{x,y}$ 形式给出）？  

3）对于图（b)，从 $t_{1}$ 时刻起，甲方在不出现新的超时且未收到乙方新的数据帧之前，需要重发多少个数据帧？重发的第一个帧是哪个帧（请用 $S_{x,y}$ 形式给出）？  

4）甲方可以达到的最大信道利用率是多少？  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/1fc96e55455404b22d11233015997883832dbe53af3a033a13613f25bbed4c09.jpg)  

# 3.4.4 答案与解析  

# 一、单项选择题  

01.D  

根据停止-等待协议的信道利用率 $U$ 的公式  

数据帧的发送时延信道利用率 $U=$ 数据帧的发送时延 $^+$ 往返时延+确认帧的发送时延  

可知，当往返时延大于数据帧的发送时延时，信道利用率非常低。  

02.B  

根据信道利用率的计算公式，当数据传输速率很高时，数据帧的发送时间很短：当源主机和目的主机的距离很远时，往返时延很大，此时的信道利用率很低。  

03.D  

在停止-等待协议中，发送方设置了计时器，在发送一个帧后，发送方等待确认，若在计时器计满时仍未收到确认，则再次发送相同的顿，以免陷入永久的等待。  
04. A  

在停止-等待协议中，使用1位来编号即可。若连续出现相同序号的数据帧，则表明发送方进行了超时重传：若连续出现相同序号的确认帧，则表明接收方收到了重复帧。  

05. D  

设 $C$ 为数据传输速率， $L$ 为帧长， $R$ 为单程传播时延。停止-等待协议的信道最大利用率为(L/C)/ $(L/C+2R)\!=\!L/(L+2R C)\!=\!L/(L+2\!\times\!30\mathrm{ms}\!\times\!4\mathrm{kb/s})\!=\!80\%$ ，得出 $L\,{=}\,960\,\mathrm{bit}$  

06.B  

本题忽略确认帧的发送时延，所以信道利用率 $=$ 数据顿的发送时延/数据帧的发送时延 $^+$ 往返时延） $=0.4$ ，解得数据帧的发送时延为 $4/30s$ ，所以数据帧的长度为 $6\mathrm{kb/s}\!\times\!4/30\mathrm{s}=800\mathrm{bit}.$  

07.B  

停止-等待协议使用确认和重传机制，发送方每发送完一个帧，就要停下来等待接收方发回的确认帧，收到确认顿后才能发送下一帧，经过超时时间后未收到ACK帧则自动重传。  

08.D  

连续ARQ协议分为GBN协议和SR协议。SR的接收窗口大于1，接收方可以先收下失序但序号仍落在接收窗口内的那些数据顿。GBN的接收窗口等于1，接收方必须按序接收数据帧。  

09.A  

GBN一般采用累积确认，因此收到了对5号帧的确认意味着接收方已收到 $1\!\sim\!5$ 号顿，因此发送方仅需要重传6号帧，即需要重传的帧的数目是1。  

10.B  

后退 $N$ 顿协议采用累积确认，确认的最后一个顿是4号顿，表示4号帧及4号顿之前的数据帧都已被正确接收，所以只需重传5号帧和6号帧这两个数据帧。  

11.C  

对于滑动窗口协议，序列号个数要大于或等于窗口数（发送窗口大小 $^+$ 接收窗口大小），所以在后退 $N$ 帧的协议中，序列号个数不小于“发送窗口大小+1”，题中发送窗口大小是32，那么序列号个数最少应该是33个。所以最少需要6位的序列号才能达到要求。  

12.C  

接收窗口整体向前移动时，新窗口中的序列号和旧窗口的序列号产生重叠，致使接收方无法区别发送方发送的帧是重发帧还是新帧，因此在后退 $N$ 帧的ARQ协议中，发送窗口 $W_{\mathrm{T}}\!\leqslant\!2^{n}\!-\!1$ 本题中 $n\!=\!7$ ，因此发送窗口的最大长度是127。  

13.B  

在选择重传协议中，若用 $n$ 比特对帧编号,则发送窗口和接收窗口的大小关系为 $1<W_{\mathrm{R}}\leqslant W_{\mathrm{T}}$ 还需满足 $W_{\mathrm{R}}+W_{\mathrm{T}}\leqslant2^{n}$ ，所以接收窗口的最大尺寸不超过序号范围的一半，即 $W_{\mathrm{{R}}}\leqslant2^{n-1}$  

14.B  

在连续ARQ协议中，发送窗口大小 $\leqslant$ 窗口总数-1。例如，窗口总数为8，编号为 $_{0\sim7}$ ，假设这8个帧都已发出，下一轮又发出编号 $_{0\sim7}$ 的8个帧，接收方将无法判断第二轮发的8个帧到底是重传帧还是新顿，因为它们的序号完全相同。另一方面，对于后退 $N$ 帧协议，发送窗口大小可以等于窗口总数-1，因为它的接收窗口大小为1，所有的帧保证按序接收。因此对于窗口大小为 $n$ 的滑动窗口，其发送窗口大小最大为 $n-1$ ，即最多可以有 $n-1$ 帧已发送但没有确认。  

15.C  

在选择重传协议中，若用 $n$ 比特对帧编号,则发送窗口和接收窗口的大小关系为 $1<W_{\mathrm{R}}\leqslant W_{\mathrm{T}}$ 此外还需满足 $W_{\mathrm{{R}}}+W_{\mathrm{{T}}}\!\leqslant\!2^{n}$ ，所以发送窗口的最大尺寸为 $2^{5}\!-\!14\!=\!32-\!14\!=\!18$  
16.D  

本题未直接告知使用的是选择重传协议，而是通过间接方式给出的。题目说无序接收的滑动窗口协议，表示接收窗口大于1，所以使用的是选择重传协议，接收窗口最大尺寸为 $2^{n-1}$  

17.C、D  

1）发送窗口大小为7意味着发送方在没有收到确认之前可以连续发送7个帧，因为发送方A已经发送编号为 $_{0\sim3}$ 的四个帧，所以下一个帧将是编号为4的帧。  

2）当帧的序号长度为 $k$ 比特时，对于选择重传协议，接收窗口 $W_{\mathrm{{R}}}\!\leqslant\!2^{k-1}$  

18.C  

实现流量控制的常用方法是滑动窗口协议，它让接收方把自己的接收窗口大小反馈给发送万，以调节发送方的发送窗口大小，避免发送方因发送速度过快而导致接收方来不及接收。  

19.C  

为使信道利用率最高（即 $100\%$ ），要让发送方在一个发送周期内持续发送帧，不能出现发送窗口内的帧发完但还未收到第一个顿的确认帧的情况。发送周期 $=$ 发送一个数据帧的时间 $^+$ 往返时延 $^+$ 发送一个确认帧的时间，发送一个数据帧或确认帧的时间均为 $128\mathrm{B}{\div}16\mathrm{kb/s}=64\mathrm{ms}$ 发送周期 $\mathsf{\Omega}=64\mathsf{m}\mathrm{s}+250\mathsf{m}\mathrm{s}\times2+64\mathsf{m}\mathrm{s}=628\mathsf{m}\mathrm{s}\,\mathrm{s}$ 、为保证发送方持续发送帧，在一个发送周期内至少要发送的帧数为 $628\mathrm{ms}/64\mathrm{ms}=10$ ，即发送窗口大小至少为10，所以帧序号至少采用4比特。  

20.D  

信道利用率 $=$ 发送周期内用于发送数据顿的时间/发送周期，其中发送周期 $=$ 发送一个数据帧的时间 $^+$ 往返时延 $^+$ 发送一个确认倾的时间。停止-等待协议的发送窗口为1，不可能达到 $100\%$ 的信道利用率：后退 $N$ 帧协议和选择重传协议只要发送窗口够大，都有可能达到 $100\%$ 的信道利用率。  

21.C  

在选择重传协议中，接收方对正确收到的每个数据帧单独进行确认，不要求收到的数据顺是有序的。依题意，接收方已正确收到 $_{0\sim3}$ 号和5号数据顿，但不确定4号数据帧是否收到。因为没有发生超时，发送方不进行重传，所以接收该确认帧并继续发送剩下的数据帧。  

22.C  

在GBN协议中，当接收方检测到某个顿出错时，会简单地丢弃该顿及所有的后续顿，发送方超时后需重传该数据帧及所有的后续帧。注意，在GBN协议中，接收方一般采用累积确认的方式，即接收方对按序到达的最后一个分组发送确认，因此本题中收到3的确认帧就表示编号为0、1、2、3的帧已接收，而此时发送方未收到1号帧的确认只能代表确认顿在返回的过程中丢失，而不代表1号帧未到达接收方。因此需要重传的帧为编号是4、5、6、7的帧。  

23.B  

在选择重传协议中，接收方逐个确认正确接收的分组，不管接收到的分组是否有序，只要正确接收就发送选择ACK分组进行确认，因此ACK分组不再具有累积确认的作用。对于这一点，要特别注意与GBN协议的区别。此题中只收到1号顿的确认，0、2号顿超时，因为对1号帧的确认不具累积确认的作用，所以发送方认为接收方未收到0、2号顿，于是重传这两顺。  

24.B  

连续ARQ的信道利用率：  

发送窗口大小 $\times$ 数据帧长/数据传输速率发送窗口大小/数据传输速率（数据帧长/数据传输速率） $^{\prime\times2+}$ RTT2/数据传输速率 $^+$ RTT/数据帧长  
从上述公式可知，数据顺长越大，信道利用率就越高。数据帧长是不确定的，范围 $128\!\sim\!512\mathrm{B}$ 在计算最小窗口数时，为了保证无论数据帧长如何变化，信道利用率都能达到 $100\%$ ，应以128B的顿长计算。因此，当最短的帧长都能达到 $100\%$ 的信道利用率时，发送更长的数据帧也都能达到 $100\%$ 的信道利用率。若以512B的帧长计算，则求得的最小窗口数在128B的帧长下，达不到 $100\%$ 的信道利用率。首先计算出发送一个顿的时间 $128\!\times\!8/(16\!\times\!10^{3})\!=\!64\mathrm{ms}$ ：发送一个顿到收到确认帧为止的总时间 $64+270\!\times\!2+64\!=\!668{\mathrm{ms}}$ ：这段时间总共可发送 $668/64\!=\!10.4$ 帧，即发送窗口≥11，而接收窗口 $=1$ ，所以至少需要用4位比特进行编号。  

25.C  

考虑制约甲方的数据传输速率的因素。首先，信道带宽能直接制约数据的传输速率，传输速率一定是小于或等于信道带宽的。其次，因为甲方和乙方之间采用后退 $N$ 帧协议传输数据，要考虑发送一个数据到接收到它的确认之前，最多能发送多少数据，甲方的最大传输速率受这两个条件的约束，所以甲方的最大传输速率是这两个值中的小者。甲方的发送窗口尺寸为1000，即收到第一个数据的确认前，最多能发送1000个数据帧，即 $1000{\times}1000\mathrm{B}\,{=}\,1\mathrm{MB}$ 的内容，而从发送第一个帧到接收到它的确认的时间是一个帧的发送时间加上往返时间，即 $1000\mathrm{B}\!+\!100\mathrm{M}\mathrm{b}/\mathrm{s}+50\mathrm{ms}+50\mathrm{ms}=0.10008\mathrm{s}$ ，此时的最大传输速率为 $1\mathrm{MB/0.10008s\!\approx\!10MB/s\!=\!80M b/s.}$ 信道带宽为 $100\mathrm{Mb/s}$ ，因此答案为 $\operatorname*{min}\{80\mathrm{Mb/s},$  $100\mathrm{{M}\mathrm{{b}/\mathrm{{s}\}=80\mathrm{{M}\mathrm{{b}/\mathrm{{s}\circ}}}}}$  

26.B  

按发送周期思考，从开始发送顿到收到第一个确认帧为止，用时为 $T\!=$ 第一个帧的发送时延 $^+$ 第一个帧的传播时延 $^+$ 确认倾的发送时延 $^+$ 确认倾的传播时延，这里忽略确认倾的发送时延。因此 $T\!\!=\!1000\mathrm{B}\!\div\!\!128\mathrm{kb/s}+\mathrm{RTT}\!=\!0.5625\mathrm{s}$ ，接着计算在 $T$ 内需要发送多少数据才能满足利用率不小于 $80\%$ 。设数据大小为 $L$ 字节，则 $(L\dot{+}128\mathrm{k}\mathrm{b}/\mathrm{s})/T\geqslant0.8$ ，得 $L\!\geqslant\!7200\mathrm{B}$ ，即在一个发送周期内至少要发7.2个帧才能满足要求，设需要编号的比特数为 $n$ ，则 $2^{n}\!-\!1\!\geqslant\!7.2$ ，因此 $n$ 至少为4。  

# 27. D  

信道利用率 $=$ 传输帧的有效时间/传输倾的周期。假设帧的长度为 $x$ 比特。对于有效时间，应该用顿的大小除以数据传输速率，即 $x{\div}3\mathrm{k}\mathrm{b}/\mathrm{s}$ 。对于帧的传输周期，应包含4部分：帧在发送方的发送时延、帧从发送方到接收方的单程传播时延、确认帧在接收方的发送时延、确认帧从接收方到发 送方的单程传播时延。这4个时延中，因为题目中说“忽略确认帧的传输时延”，所以不计算确认顿的传输时延（传输时延也称发送时延，注意与传播时延区分）。所以帧的传输周期由三部分组成：首先是顿在发送方的发送时延 $x{\div}3\,\mathrm{kb}/\mathrm{s}$ ，其次是帧从发送方到接收方的单程传播时延 $200\mathrm{ms}$ ，最后是确认帧从接收方到发送方的单程传播时延 $200\mathrm{ms}$ ，三者相加得周期为 $x^{\div}3\mathrm{k}\mathsf{b}/\mathsf{s}+400\mathsf{m}\mathsf{s}$ 。代入信道利用率的公式得 $x\!=\!800\mathrm{bit}$  

28.B  

从滑动窗口的概念来看，停止-等待协议：发送窗口大小 $=1$ ，接收窗口大小 $=1$ ：后退 $N$ 帧协议：发送窗口大小 $>1$ ，接收窗口大小 $=1$ ：选择重传协议：发送窗口大小 $>1$ ，接收窗口大小 $>1$ 。在选择重传协议中，还需满足：接收窗口大小 $\leqslant$ 发送窗口大小；发送窗口大小 $^+$ 接收窗口大小 $\leqslant2^{n}$ 。根据以上规则，采用3比特编号，发送窗口大小为5，接收窗口大小应 $\leqslant3$ 。  

# 29.D  

发送数据帧和确认帧的时间均为 $t\!=\!1000\!\times\!\!8\mathrm{b}\!\div\!10\mathrm{kg}\!/\mathrm{s}\!=\!800\mathrm{ms}\,.$ 发送周期为 $T=800{\mathrm{ms}}+200{\mathrm{ms}}+800{\mathrm{ms}}+200{\mathrm{ms}}=2000{\mathrm{ms}}.$ 信道利用率为 $t/T\times100\%\,{=}\,800/2000\,{=}\,40\%.$  
30.B  

信道利用率 $\scriptstyle{U=n\times T_{\mathrm{D}}/T}$ ，其中 $n$ 是发送窗口的大小， $T_{\mathrm{{D}}}$ 是发送一个数据帧的时间， $T$ 是一个数据帧的发送周期。在 $T_{\mathrm{{D}}}$ 和 $T$ 确定的情况下， $n$ 越大，信道利用率就越大。设顿序号的比特数为 $k$ ，则停止-等待协议的发送窗口 $W_{\mathrm{T1}}\!=\!1$ ；GBN协议的发送窗口 $W_{\mathrm{T2}}\!=\!2^{k}\!-\!1$ ；SR协议的发送窗口 $W_{\mathrm{T3}}$ 总是 ${\leqslant}2^{k}\mathbf{-}1$ ，通常取 $2^{k-1}$ ， $W_{\mathrm{T}1}\!\leqslant\!W_{\mathrm{T}3}\!\leqslant\!W_{\mathrm{T}2}$ ，因此 $U_{1}{\leqslant}U_{3}{\leqslant}U_{2}$ 。  

# 二、综合应用题  

01.【解答】  

对于选择重传协议，接收窗口和发送窗口的尺寸需满足：接收窗口尺寸  $W_{\mathrm{R}}+$  发送窗口尺寸  $W_{\mathrm{T}}\leqslant2^{n}$ ，而题中给出的数据是 $W_{\mathrm{R}}+W_{\mathrm{T}}\!=\!9\!\geqslant\!2^{3}$ ，所以是无法正常工作的。举例如下：  

发送方： $\mathrm{~0~1~2~3~4~5~6~7~0~1~2~3~4~5~6~7~0~}$ 接收方： $0\;1\;2\;3\;4\;5\;6\;7\;0\;1\;2\;3\;4\;5\;6\;7\;0$  

发送方发送 $_{0\sim5}$ 号共6个数据帧时，因发送窗口已满，发送暂停。接收方收到所有数据帧，对每个顿都发送确认帧，并期待后面的6、7、0号顿。若所有的确认帧都未到达发送方，经过发送方计时器控制的超时时间后，发送方再次发送之前的6个数据帧，而接收方收到0号帧后，无法判断是新的数据顿还是重传的旧的数据帧。  

02.【解答】  

设数据帧长为 $L$ 。在停止-等待协议中，发送数据帧的时间为 $L/B$ ，发送完数据顿后等待确认的时间为 $2R$ 。要使协议的效率至少为 $50\%$ ，要求信道利用率 $U$ 至少为 $50\%$ ，则  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/3372e82970f91594d6242b2f2a7e89e3c4d785f85308163d976b7463637bf99a.jpg)  

解得 $L\!\geqslant\!2R B\!=\!2\!\times\!5000\!\times\!0.03\mathrm{bit}\!=\!300\mathrm{bit}\circ$  

因此，当帧长大于或等于300bit时，停止-等待协议的效率至少为 $50\%$  

# 03.【解答】  

$\mathrm{RTT\!=\!250\!\times\!2\!=\!5000\!\mathrm{ms\!=\!0.5s}}$  一个帧的发送时间等于 $2000\mathrm{bit}\!\div\!100\mathrm{kpc}\!=\!20\!\times\!10^{-3}\mathrm{s}\!=\!0.02\mathrm{s}\!\circ\!$  

一个帧发送完后经过一个单程时延到达接收方，再经过一个单程时延发送方收到确认顿，从而可以继续发送，因此要使传输效率最大，就要让发送方继续地发送帧。设发送窗口等于 $x$ ，则  

$$
0.02s\times x\,{=}\,0.02s+\mathrm{RTT}\,{=}\,0.52s
$$  

解得 $x\!=\!26$ ，即发送窗口取26即可。因为 $16<26<32$ ，所以帧序号应为5位。在使用连续ARQ的情况下，发送窗口的最大值是31，大于26，可以不间断地发送帧，此时信道利用率是 $100\%$  

# 04.【解答】  

最大信道利用率即每个传输周期内每个协议可发送的最大顿数。由题意，数据帧的长度为1kbit，信道的数据传输速率为 $50\mathrm{kb}/\mathrm{s}$ ，因此信道的发送时延为 $1/50s\!=\!0.02s$ ，另外信道端到端的传播时延 $=0.27s$ 。本题中的确认帧是销带的（通过数据帧来传送），因此每个数据帧的传输周期为 $(0.02+0.27+0.02+0.27)\mathrm{s}=0.58\mathrm{s}$  

1）在停止-等待协议中，发送方每发送一帧，都要等待接收方的应答信号，之后才能发送下一顿；接收方每接收一帧，都要反馈一个应答信号，表示可接收下一帧。其中用于发送数据帧的时间为 $0.02s$ 。因此，信道的最大利用率为 $0.02/0.58=3.4\%$  

2）在后退 $N$ 帧协议中，接收窗口尺寸为1，若采用 $n$ 比特对帧编号，则其发送窗口的尺寸 $W$ 满足 $1<W\leqslant2^{n}\!-\!1$ 。发送方可以连续再发送若干数据顺，直到发送窗口内的数据帧都发送完毕。若收到接收方的确认顿，则可以继续发送。若某个帧出错，则接收方只是简 单地丢弃该帧及所有的后续帧，发送方超时后需重传该数据帧及所有的后续数据帧，根据题目条件，在达到最大传输速率的情况下，发送窗口的大小应为 $2^{n}\!-\!1\!=\!7$ ，此时在第一顿的数据传输周期0.58s内，实际连续发送了7帧（考虑极限情况，0.58s后接收方只收到0号帧的确认，此时又可以发出一个新帧，这样依次下去，取极限即是每个传输周期0.58s内发送了7帧），因此此时的最大信道利用率为 $7{\times}0.02/0.58\!=\!24.1\%$  
3）选择重传协议的接收窗口尺寸和发送窗口尺寸都大于1，可以一次发送或接收多个帧。若采用  $n$  比特对帧编号，则窗口尺寸应满足：接收窗口尺寸  $^+$  发送窗口尺寸  $\leqslant2^{n}$  ，当发送窗 口与接收窗口尺寸相等时，应有接收窗口尺寸 $\leqslant\!2^{n^{-1}}$ 且发送窗口尺寸 $\leqslant2^{n-1}$ 。发送方可以连续发送若干数据帧，直到发送窗口内的数据帧都发送完毕。若收到接收方的确认帧则可以继续发送。若某个帧出错，则接收方只是简单地丢弃该帧，发送方超时后需重传 该数据帧。  

和2）问中的情况类似，唯一不同的是为达到最大信道利用率，发送窗口大小应为 $2^{n-1}\!=\!4$ 因此，此时的最大信道利用率为 $4\!\times\!0.02/0.58\!=\!13.8\%.$  

05.【解答】  

对于停止-等待协议，  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/de00778ed848587c99f5d467409f700efcaa693ee69e75aed2a071d432f0307d.jpg)  

06.【解答】  

要注意题中的单位。数据帧的长度为512B，即 $512{\times}8\mathrm{bit}\!=\!4.096\mathrm{kbit}$ ，一个数据帧的发送时延为 $4.096/64\!=\!0.064s$ 。因此一个发送周期为 $0.064+2\!\times\!0.27\!=\!0.604s.$  

当发送窗口为1时，甲方的实际数据传输速率为 $1\!\times\!4.096/0.604\!=\!6.8\mathrm{k}\mathrm{b}/\mathrm{s}.$ 当发送窗口为7时，甲方的实际数据传输速率为 $7{\times}4.096/0.604\,{=}\,47.5\mathrm{Rb/s\,\circ}$  

当发送窗口大于 $0.604/0.064$ ，即大于或等于10时，就能保证甲方在信道上持续发送数据。因此发送窗口为17和117时，信道的利用率达到 $100\%$ ，甲方的实际数据传输速率为 $64\mathrm{k}\mathrm{b}/\mathrm{s}$  

07.【解答】  

1) $t_{0}$ 时刻到 $t_{1}$ 时刻期间，甲方可以断定乙方已正确接收3个数据帧，分别是 $S_{0,\,0}$ 、 $S_{1,0}$  $S_{2,\,0}$ 。 $R_{3,\,3}$ 说明乙方发送的数据帧序号是3，即希望甲方发送序号3的数据帧，说明乙方已经接收序号为 $_{0\sim2}$ 的数据帧（注意，这个确认序号是期望接收对方的下一帧的序号)。  

2）从 $t_{1}$ 时刻起，甲方最多还可以发送5个数据帧，其中第一个帧是 $S_{S,\,2}$ ，最后一个数据帧是 $S_{1,\,2}$ 。发送序号3位，有8个序号，在GBN协议中，发送窗口 $+~1\leqslant$ 序号总数，所以这里发送窗口取最大值7。此时已发送 $S_{3,\,0}$ 和 $S_{4,\,1}$ ，所以最多还可以发送5个帧（数据帧以序号01234567.01234567，··的规律发送，但初始时只有0123456落在发送窗口内，之后随着发送方不断收到确认，发送窗口也不断向前滑动）。  

3）甲方需要重发3个数据顿，重发的第一个帧是 $S_{2,3}$ 。在GBN协议中，发送方发送 $N$ 顺后，检测出错，则需要发送出错帧及其之后的帧。 $S_{2,\,0}$ 超时，所以重发的第一帧是 $S_{2}$ 。已收到  
乙方的 $R_{2}$ 帧，所以帧号应为3。  

4）甲方可以达到的最大信道利用率 $U$ 是  

$$
\frac{\frac{1}{100\times10^{-6}}}{\mathrm{RTT}+\frac{\frac{1}{100\times10^{-3}}\times1}{\frac{1}{100\times10^{-4}}\times\frac{1}{1000}\times2^{-6}}}{\mathrm{pH}+\frac{1}{\frac{1}{100\times10^{-6}}\times\frac{1}{1000}\times2^{-6}}\times2}=\frac{7\times\frac{8\times1000}{100\times10^{-6}}}{0.96\times10^{-3}+\frac{8\times1000}{100\times10^{-6}}\times2}\times100\%=50\%
$$  

信道利用率 $U{=}$ 发送数据帧的时间/从开始发送第一个数据帧到收到第一个确认帧的时间= $N{\times}T_{\mathrm{d}}/(T_{\mathrm{d}}+\mathrm{RTT}+T_{\mathrm{a}}),$ 其中， $N$ 取发送窗口的最大值， $T_{\mathrm{d}}$ 是发送一个数据帧的时间，RTT是往返时间， $T_{\mathrm{a}}$ 是发送一个确认帧的时间。这里采用悄带确认， $T_{\mathrm{d}}\,{=}\,T_{\mathrm{a}}$  

# 3.5介质访问控制  

介质访问控制所要完成的主要任务是，为使用介质的每个结点隔离来自同一信道上其他结点所传送的信号，以协调活动结点的传输。图3.15是广播信道的通信方式，结点A、B、C、D、E共享广播信道，假设A要与C通信，B要与D通信，因为它们共用一条信道，若不加控制，则两对结点之间的通信可能会因互相干扰而失败。用来决定广播信道中信道分配的协议属于数据链路层的一个子层，称为介质访问控制（Medium Access Control，MAC）子层。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/9ca053d64d3e0454a486ca2d0596abec10117566cb04d939d349516482e06b37.jpg)  
图3.15广播信道的通信方式  

常见的介质访问控制方法有信道划分介质访问控制、随机访问介质访问控制和轮询访问介质访问控制。其中前者是静态划分信道的方法，而后两者是动态分配信道的方法。  

# 3.5.1信道划分介质访问控制  

信道划分介质访问控制将使用同一传输介质的多个设备的通信隔离开来，把时域和频域资源合理地分配给这些设备。信道划分介质访问控制通过复用技术实现。所谓复用，是指在发送端把多个发送方的信号组合在一条物理信道上进行传输，在接收端把收到的复用信号分离出来，并发送给对应的接收方，如图3.16所示。当传输介质的带宽超过传输单个信号所需的带宽时，通过在一条介质上传输多个信号，还能提高传输系统的利用率。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/db2b663112711b7fbd103f843c6340fe46b6a5abd6a2b395f3b85c66372e3d9a.jpg)  
图3.16复用原理示意图  
信道划分的实质是通过分时、分频、分码等方法，将原来的一个广播信道，逻辑上分为几个用于在两个结点之间进行通信的互不干扰的子信道，即将广播信道转变为若干个点对点信道。  

信道划分介质访问控制分为以下4种。  

# 1.频分复用（FDM）  

频分复用（Frequency Division Multiplexing，FDM），每个子频带作为一个子信道，每对用户使用一个子信道进行通信，如图3.17所示。所有用户在同一时间占用不同的频带资源。每个子信道分配的频带可不相同，但它们的总和不能超过信道的总频带。在实际应用中，为了防止子信道之间互相干扰，相邻信道间还要加入“隔离频带”。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/97ee383c310e7a88c1fad36132c6e33425721806fd85d6e745c3a2f5bee9b126.jpg)  
图3.17频分复用的原理示意图  

分复用的优点在于充分利用了传输介质的带宽，系统效率较高，实现也较容易。  

# 2.时分复用（TDM）  

时分复用（Time Division Multiplexing，TDM）时间片，称为TDM顿，每个用户在每个TDM帧中占用固定序号的时隙，每个用户所占用的时隙周期性地出现（其周期就是TDM的长度），所有用户在不同的时间占用同样的信道资源，如图3.18所示。TDM帧实际上是一段固定长度的时间，它与数据链路层的顿不是同一个概念。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/eeb2deb249d0dcde4ed543762681f37459cd83d3337b43692dc71503e9e57355.jpg)  
图3.18时分复用的原理示意图  

从某个时刻来看，时分复用信道上传送的仅是某对用户之间的信号：从某段时间来看，传送的是按时间分割的复用信号。因为时分复用是按固定次序给用户分配时隙的，当用户在某段时间暂无数据传输时，其他用户也无法使用这个暂时空闲的线路资源，所以时分复用后的信道利用率不高。统计时分复用（StatisticTDM，STDM）又称异步时分复用，它是对TDM的一种改进。STDM倾与TDM帧不同，它并不固定分配时隙，而按需动态分配时隙，当用户有数据要传送时，才会分配到STDM帧中的时隙，因此可以提高线路的利用率。例如，假设线路的数据传输速率为 $6000\mathrm{b/s}$ ，3个用户的平均速率都为 $2000{\mathrm{b/s}}$ ，当采用TDM方式时，每个用户的最高速率为 $2000\mathrm{b/s}$ 而在STDM方式下，每个用户的最高速率可达 $6000\mathrm{b/s}$  

# 3.波分复用（WDM)  

波分复用（Wavelength Division Multiplexing，WDM）即光的频分复用，它在一根光纤中传输多种不同波长（频率）的光信号，因为波长不同，各路光信号互不干扰，最后用光分用器将各路波长分解出来。因为光波处于频谱的高频段，有很大的带宽，所以可以实现多路的波分复用。  
# 4.码分复用（CDM)  

码分复用（Code Division Multiplexing，CDM）复用方式。与FDM和TDM不同，它既共享信道的频率，又共享时间。  

实际上，（Code Division Multiple Access，CDMA），其原理是将每个比特时间再划分成 $m$ 个短的时间槽，称为码片（Chip），通常 $m$ 的值是64或128，下例中为简单起见，设 $m$ 为8。每个站点被指派一个唯一的 $m$ 位码片序列。发送1时，站点发送它的码片序列；发送0时，站点发送该码片序列的反码。当两个或多个站点同时发送时，各路数据在信道中线性相加。为了从信道中分离出各路信号，要求各个站点的码片序列相互正交。  

简单理解就是，A站向C站发出的信号用一个向量来表示，B站向C站发出的信号用另一个向量来表示，两个向量要求相互正交。向量中的分量，就是所谓的码片。  

下面举例说明CDMA的原理。  

令向量 $s$ 表示A站的码片向量， $\pmb{T}$ 表示B站的码片向量。假设A站的码片序列被指派为00011011，则A站发送00011011就表示发送比特1，发送11100100就表示发送比特0。为了方便计算，将码片中的0写为-1，将1写为 $+1$ ，因此A站的码片序列是 $(-1\,{-}1\,{-}1\,{+}1\,{+}1\,{-}1\,{+}1\,{+}1\,)$  

不同站的码片序列相互正交，即向量 $s$ 和 $\pmb{T}$ 的规格化内积为0：  

$$
S\mathbf{\cdot}T\equiv\frac{1}{m}\sum_{i=1}^{m}S_{i}T_{i}=0
$$  

任何站的码片向量和该码片向量自身的规格化内积都是1：  

$$
S\bullet S={\frac{1}{m}}\sum_{i=1}^{m}S_{i}S_{i}={\frac{1}{m}}\sum_{i=1}^{m}S_{i}^{2}={\frac{1}{m}}\sum_{i=1}^{m}(\pm1)^{2}=1
$$  

任何站的码片向量和该码片反码的向量的规格化内积都是-1：  

$$
S\bullet\overline{{S}}=\frac{1}{m}\sum_{i=1}^{m}S_{i}\,\overline{{S_{i}}}=-\frac{1}{m}\sum_{i=1}^{m}S_{i}^{2}=-1
$$  

令向量  $\pmb{T}$  为  $\left(-1-\!\!1+\!\!1-\!\!1+\!\!1+\!\!1+\!\!1-\!\!1\,\right)$  8  

当A站向C站发送数据1时，就发送了向量 $\left(-1-\!1-\!1+\!1+\!1-\!1+\!1+\!1\,\right)$  

当B站向C站发送数据0时，就发送了向量 $(+1+1-1+1-1-1-1+1)$  

两个向量在公共信道上叠加，实际上是线性相加，得到  

$$
S+\overline{{{T}}}=\left(\begin{array}{c c c c c c c}{{0}}&{{0}}&{{-2}}&{{2}}&{{0}}&{{-2}}&{{0}}&{{2}}\end{array}\right)
$$  

# 命题追踪码分复用中数据分离的计算（2014）  

到达C站后，进行数据分离，若要得到来自A站的数据，则C站就必须知道A站的码片序列，让 $s$ 与 $s+\bar{T}$ 进行规格化内积。根据叠加原理，其他站点的信号都在内积的结果中被过滤掉，内积的相关项都是0，而只剩下A站发送的信号，得到  

$$
S\bullet(S+\overline{{{T}}})=1
$$  

所以A站发出的数据是1。同理，若要得到来自B站的数据，则  

$$
T\bullet(S+{\overline{{T}}})=-1
$$  

因此从B站发送过来的信号向量是一个反码向量，代表0。  

规格化内积是线性代数中的内容，它在得到两个向量的内积后，再除以向量的分量的个数。下面举一个直观的例子来理解频分复用、时分复用和码分复用。  
假设A站要向C站运输黄豆，B站要向C站运输绿豆，A站和B站与C站之间有一条公共 的道路，可类比为广播信道。在频分复用方式下，公共道路被划分为两个车道，分别提供给A站到C站的车和B站到C站的车通行，两类车可同时通行，但都只分到了公共车道的一半，因此频分复用（波分复用也一样）共享时间而不共享空间。在时分复用方式下，先让A站到C站的车走一趟，再让B站到C站的车走一趟，两类车交替地使用公共车道，因此时分复用共享空间，但不共享时间。码分复用与另外两种信道划分方式极为不同，在这种方式下，黄豆与绿豆放在同一辆车上运送，到达C站后，由C站负责把车上的黄豆和绿豆分开，因此码分复用既共享空间，又共享时间。  

码分复用技术具有频谱利用率高、抗干扰能力强、保密性强、语音质量好等优点，还可以减少投资及降低运行成本，主要用于无线通信系统，特别是移动通信系统。  

# 3.5.2随机访问介质访问控制  

# 命题追踪信道划分与随机访问介质访问控制的特点（2014）  

在随机访问协议中，不采用集中控制方式解决发送信息的次序问题，所有用户都能根据自己的意愿随机地发送信息，占用信道的全部速率。在总线形网络中，当有两个或多个用户同时发送信息时，就会产生帧冲突（也称碰撞），导致所有冲突用户的发送均以失败告终。为了解决随机访问发生的冲突，每个用户需要按照一定的规则反复地重传它的帧，直到该帧无冲突地通过，这些规则就是随机访问介质访问控制协议，其核心思想是：胜利者通过争用获得信道，进而获得信息的发送权。因此，随机访问介质访问控制协议又称争用型协议。  

可见，若采用信道划分机制，则结点之间的通信要么共享空间，要么共享时间，要么共享空间和时间：而若采用随机访向控制机制，则结点之间的通信既不共享时间，又不共享空间。因此，随机介质访向控制实质上是一种将厂播信道转换为点到点信道的机制。  

# 1.ALOHA协议  

ALOHA ALOHA ALOHA。  

（1）纯ALOHA协议  

纯ALOHA协议的基本思想是，当总线形网络中的任何站点需要发送数据时，可以不进行任何检测就发送数据。若在一段时间内未收到确认，则该站点就认为传输过程中发生了冲突。发送站点需要等待一段时间后再发送数据，直至发送成功。  

图3.19表示一个纯ALOHA协议的工作原理。每个站均可自由地发送数据帧，假定所有帧都是定长的，帧长不用比特而用发送这个帧所需的时间来表示，图中用 $T_{0}$ 表示这段时间。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/ae9a115a7e4fbb1e8ae3ec162449673ea9bdc2251aced1d68bb09e49b721c595.jpg)  
图3.19纯ALOHA协议的工作原理  
在图3.19的例子中，当站1发送帧1时，其他站都未发送数据，所以站1的发送必定是成功的。但随后站2和站 $N\!-\!1$ 发送的顺2和顺3在时间上重叠了一部分（即发生了冲突）。发生冲突的各站都必须进行重传，但并不能马上进行重传，因为这样做必然导致继续发生冲突。因此，让各站等待一段随机的时间，然后进行重传。若再次发生冲突，则需要再等待一段随机的时间，直到重传成功为止。图中其余一些顿的发送情况是，帧4发送成功，而帧5和帧6发生冲突。  

纯ALOHA网络的吞吐量很低，为了克服这个缺点，便产生了时隙ALOHA协议。  

（2）时隙ALOHA协议  

时隙ALOHA协议同步各站点的时间，将时间划分为一段段等长的时隙（Slot），规定站点只能在每个时隙开始时才能发送帧，发送一帧的时间必须小于或等于时隙的长度。这样做避免了用户发送数据的随意性，降低了产生冲突的可能性，提高了信道的利用率。  

图3.20表示两个站的时隙ALOHA协议的工作原理。每个帧到达后，一般都要在缓存中等待一段小于时隙 $T_{0}$ 的时间，才能发送出去。当在一个时隙内有两个或两个以上的帧到达时，在下一个时隙将产生冲突。冲突后重传的策略与纯ALOHA协议的情况相似。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/eab8d419e4bb0d1523f4496ef9b820a30d21ab1ae79b7a85d33598e667eac4dc.jpg)  
图3.20时隙ALOHA协议的工作原理  

# 2.CSMA协议  

ALOHA网络发生冲突的概率很大。若每个站点在发送前都先监听公用信道，发现信道空闲后再发送，则会大大降低冲突的可能性，从而提高信道的利用率，载波监听多路访问（CarrierSenseMultiple AccesS，CSMA）。CSMA ALOHA一种改进协议，它与ALOHA协议的主要区别是多了一个载波监听装置。  

根据监听方式和监听到信道忙后的处理方式的不同，CSMA协议分为三种。  

# （1）1-坚持CSMA  

1-坚持CSMA的基本思想是：当站点要发送数据时，首先监听信道：若信道空闲，则立即发送数据；若信道忙，则继续监听直至信道空闲。“坚持”的含义是监听到信道忙时，继续坚持监听信道；“1”的含义是监听到信道空闲时，立即发送帧的概率为1。  

# （2）非坚持CSMA  

非坚持CSMA的基本思想是：当站点要发送数据时，首先监听信道；若信道空闲，则立即发送数据；若信道忙，则放弃监听，等待一个随机的时间后，再重新监听。  

非坚持CSMA协议在监听到信道忙时就放弃监听，因此降低了多个站点等待信道空闲后同时发送数据导致冲突的概率，但也增加了数据在网络中的平均时延。  

# (3)  $p$  -坚持CSMA  

$p$ -坚持CSMA只适用于时分信道，其基本思想是：当站点要发送数据时，首先监听信道；若信道忙，则持续监听（即等到下一个时隙再监听），直至信道空闲；若信道空闲，则以概率 $p$ 发送数据，以概率 $1\!-\!p$ 推迟到下一个时隙再继续监听；直到数据发送成功。  

$p$ -坚持CSMA检测到信道空闲后，以概率 $p$ 发送数据，以概率 $1\!-\!p$ 推迟到下一个时隙继续监听，目的是降低1-坚持CSMA中多个站点检测到信道空闲时同时发送帧的冲突概率；采用坚 持“监听”的目的是，克服非坚持CSMA中因随机等待造成的延迟时间较长的缺点。因此， $p-$ 坚持CSMA协议是非坚持CSMA协议和1-坚持CSMA协议的折中。  
三种不同类型的CSMA协议比较如表3.1所示。  

表3.1三种不同类型的CSMA协议比较
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/ab84e37ae6367358ae2338fa8eca6764402a28f7d79e8aa56a3fff0a09f8d685.jpg)  

# 3.CSMA/CD协议  

# 命题追踪CSMA/CD协议的特点（2015）  

载波监听多路访问/冲突检测（CSMA/CD）协议是CSMA协议的改进方案，适用于总线形网络或半双工网络环境。对于全双工网络，因为全双工采用两条信道，分别用来发送和接收，在任何时候，发收双方都可以发送或接收数据，不可能产生冲突，所以不需要CSMA/CD协议。  

载波监听是指每个站点在发送前和发送过程中都必须不停地检测信道，在发送前检测信道是为了获得发送权，在发送过程中检测信道是为了及时发现发送的数据是否发生冲突。站点要在发送数据前先监听信道，只有信道空闲时才能发送。冲突检测（CollisionDetection）就是边发送边监听的，若监听到了冲突，则立即停止数据发送，等待一段随机时间后，重新开始尝试发送数据。  

CSMA/CD的工作流程可简单地概括为“先听后发，边听边发，冲突停发，随机重发”。  

# 命题追踪信道发生冲突的最短、最长时间的分析（2010）  

电磁波在总线上的传播速率总是有限的。因此，当某时刻发送站检测到信道空闲时，信道不一定空闲。如图3.21所示，设 $\tau$ 为单程传播时延。当 $t=0$ 时，A站发送数据。当 $t=\tau-\delta$ 时，A站发送的数据还未到达B站，因为B站检测到信道空闲而发送数据。经过时间 $\delta/2$ 后，即当 $t=\tau-\delta/2$ 时，A站发送的数据和B站发送的数据发生冲突，但这时A站和B站都不知道。当 $t=\tau$ 时，B站检测到冲突，于是停止发送数据。当 $t=2\tau-\delta$ 时，A站检测到冲突，也停止发送数据。显然，CSMA/CD中的站不可能同时进行发送和接收，因此采用CSMA/CD协议的以太网只能进行半双工通信。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/ae240d111343b3cca19a39fb51a2804acf5f10feb02fe6219bbbe3043615b345.jpg)  
图3.21传播时延对载波监听的影响  
从图3.21不难看出，A站在开始发送数据后最多经过时间 $2\,\tau$ （端到端传播时延的2倍）就能知道有没有发生冲突（当 $\delta\!\to\!0$ 时）。因此，把以太网的端到端往返时间 $2\tau$ 称为争用期（又称冲突窗口）。每个站在自己发送数据后的一小段时间内，存在发生冲突的可能性，只有经过争用期这段时间还未检测到冲突时，才能确定这次发送不会发生冲突。  

# 命题追踪CSMA/CD最短帧长的理解和相关计算（2009、2016、2019、2022）  

现在考虑一种情况：某站发送一个很短的顿，但在发送完之前并未检测出冲突。假定这个帧在继续向前传播到达目的站之前和别的站发送的帧发生了冲突，因此目的站将收到有差错的帧（当然会把它丢弃）。然而，发送站却不知道发生了冲突，因此不会重传这个顿。为了避免发生这种情况，以太网规定了一个最短顿长（争用期内可发送的数据长度）。在争用期内若检测到冲突，则站就停止发送，此时已发送出去的数据一定小于最短帧长，因此凡长度小于这个最短帧长的帧，就都是因为冲突而异常中止的无效顿。最短帧长的计算公式为  

# 最短帧长 $=$ 总线传播时延 $\times$ 数据传输速率 $^{\times2}$  

例如，以太网规定 $51.2\upmu\mathrm{s}$ 为争用期的长度。对于10Mb/s的以太网，在争用期内可发送512bit，即64B。当以太网发送数据时，若前64B未发生冲突，则后续数据也不会发生冲突（表示已成功抢占信道）。换句话说，若发生冲突，则一定在前64B。因为一旦检测到冲突就立即停止发送，所以这时发送出去的数据一定小于64B。于是，以太网规定最短帧长为64B，凡长度小于64B的帧，就都是因为冲突而异常中止的无效顿，收到这种无效帧时应立即丢弃。  

若只发送小于64B的帧，如40B的帧，则需要在MAC子层中于数据字段的后面加一个整数字节的填充字段，以保证以太网的MAC帧的长度不小于64B。  

# 命题追踪二进制指数退避算法的应用（2023）  

一旦发生冲突，参与冲突的两个站点紧接着再次发送就没有意义，若坚持这样做，则将导致无休止的冲突。CSMA/CD采用截断二进制指数退避算法来确定冲突后重传的时机，它让发生冲突的站点在停止发送后，推迟一个随机的时间再重新发送。算法精髓如下：  

1）确定基本退避时间，一般取2倍的总线端到端的传播时延 $2\,\tau$ （即争用期）。  

2）从离散的整数集合 $[0,1,\cdots,(2^{k}\!-\!1)]$ 中随机取出一个数，记为 $r$ ，重传所需推迟的时间就是 $r$ 倍的争用期，即 $2r\tau_{\circ}$ 参数 $k\!=$ min[重传次数，10]，可见当重传次数不超过10时，参数 $k$ 等于重传次数：但当重传次数超过10时， $k$ 就不再增大，而一直等于10。3）当重传达16次仍不成功时，说明网络太拥挤，认为该帧永远无法正确发出，抛弃该帧并向高层报告出错（这个条件也容易忽略，请读者注意）。  

假设适配器首次试图传送一帧，且在传送过程中检测到冲突。第1次重传时， $k\!=\!1$ ，随机数 $r$ 从整数集合{0，1中选择，可选的重传推迟时间是0或 $2\,\tau_{c}$ 。若再次发生冲突，则第二次重传时，随机数 $r$ 从整数集合 $\{0,1,2,3\}$ 中选择，因此重传推迟时间是在 $0,2\tau,4\tau,6\tau$ 这四个时间中随机选取的一个，以此类推。使用截断二进制指数退避算法可使重传需要推迟的平均时间随重传次数的增大而增大（也称动态退避），因此能降低发生冲突的概率，有利于整个系统的稳定。  

CSMA/CD算法的归纳如下：  

$\textcircled{\scriptsize{1}}$ 准备发送：适配器从网络层获得一个分组，封装成帧，放入适配器的缓存。 $\circledcirc$ 检测信道：若信道空闲，则开始发送该帧：若信道忙，则持续检测直至信道空闲。 $\textcircled{3}$ 在发送过程中，适配器仍然持续检测信道。这里只有如下两种可能。）发送成功：在争用期内一直未检测到冲突，该顿肯定能发送成功。  
·发送失败：在争用期内检测到冲突，此时立即停止发送，适配器执行指数退避算法等待一段随机时间后返回到步骤 $\textcircled{2}$ 。若重传16次仍不能成功，则停止重传并向上报错。  

# 4.CSMA/CA协议  

CSMA/CD协议已成功用于使用有线连接的局域网，但在无线局域网环境下不能简单地搬用CSMA/CD协议，特别是冲突检测部分，主要有两个原因：  

1）接收信号的强度往往远小于发送信号的强度，且在无线介质上信号强度的动态变化范围 很大，因此若要实现冲突检测，则硬件上的花费会过大。  

2）在无线通信中，并非所有站点都能够听见对方，即存在“隐蔽站”问题，  

为此，802.11标准定义了广泛用于无线局域网的CSMA/CA协议，它对CSMA/CD协议进行修改，将冲突检测改为冲突避免（CollisionAvoidance，CA）。“冲突避免”并不是指协议可以完全避免冲突，而是指协议的设计要尽量降低冲突发生的概率。因为802.11无线局域网不使用冲突检测，一旦站点开始发送一个帧，就会完全发送该帧，但冲突存在时仍发送整个帧（尤其是长数据帧）会严重降低网络的效率，所以要采用冲突避免技术来降低冲突的概率。  

# 命题追踪需要使用确认方案的MAC协议（2011）  

因为无线信道的通信质量远不如有线信道，所以802.11标准使用链路层确认/重传（ARQ）方案，即站点每通过无线局域网发送完一顺，就要在收到对方的确认顺后才能继续发送下一顺。可见，802.11标准无线局域网采用的停止-等待协议是一种可靠传输协议。  

为了尽量避免冲突，802.11标准规定，所有站完成发送后，必须等待一段很短的时间（继续监听）才能发送下一帧。这段时间称为帧间间隔（InterFrameSpace，IFS）。帧间间隔的长短取决于该站要发送的帧的类型。802.11标准使用了下列三种IFS。  

# 命题追踪 CSMA/CA协议的IFS的特点（2020)  

1）SIFS（短IFS）：最短的IFS，用来分隔属于一次对话的各帧，使用SIFS的帧类型有ACK倾、CTS帧、分片后的数据帧，以及所有回答AP探询的顿等。  

2）PIFS（点协调IFS）：中等长度的IFS，在PCF操作中使用。3）DIFS（分布式协调IFS）：最长的IFS，用于异步帧竞争访问的时延。  

802.11标准还采用了虚拟载波监听机制，即让源站将它要占用信道的持续时间（包括目的站发回ACK顺所需的时间）及时通知给所有其他站，以便使所有其他站在这段时间内都停正发送，这样就大大减少了冲突的机会。“虚拟载波监听”表示其他站并未监听信道，而是因收到了源站的通知才不发送数据，这种效果就像是其他站都监听了信道。  

当信道从忙态变为空闲时，任何一个站要发送数据顿，不仅要等待一个DIFS的间隔，而且要进入争用窗口，计算随机退避时间以便再次试图访问信道，因此降低了冲突发生的概率。当且仅当检测到信道空闲且这个数据顺是要发送的第一个数据帧时，才不使用退避算法，其他所有情况都必须使用退避算法，具体为： $\textcircled{\scriptsize{1}}$ 在发送第一个顺之前检测到信道忙； $\circledcirc$ 每次重传： $\textcircled{3}$ 每次成功发送后要发送下一帧。CSMA/CA的退避算法与CSMA/CD的稍有不同（详见相关的教材）。  

CSMA/CA算法的归纳如下：  

1）若站点最初有数据要发送（而非发送不成功再进行重传），且检测到信道空闲，那么在等待时间DIFS后，就发送整个数据帧。  

2）否则，站点执行CSMA/CA退避算法，选取一个随机退避值。一旦检测到信道忙，退避计时器就保持不变。只要信道空闲，退避计时器就进行倒计时。  
3）当退避计时器减至0时（这时信道只可能是空闲的），站点就发送整个帧并等待确认。4）发送站若收到确认，就知道已发送的帧被目的站正确接收。这时要发送第二帧，就要从步骤2）开始，执行CSMA/CA退避算法，随机选定一段退避时间。若发送站在规定时间（由重传计时器控制）内未收到确认帧ACK，就必须重传该帧，再次使用CSMA/CA协议争用该信道，直到收到确认，或经过若干次重传失败后放弃发送。  

# 处理隐蔽站问题：RTS和CTS  

在图3.22中，站A和站B都在AP的覆盖范围内，但站A和站B相距较远，彼此都听不见对方。当站A和站B检测到信道空闲时，都向AP发送数据，导致冲突发生，这就是隐蔽站问题，  

# 命题追踪CSMA/CA协议进行信道预约的方法（2018）  

为了避免该问题，802.11标准允许发送站对信道进行预约，如图3.23所示。源站要发送数据帧之前，先监听信道，若信道空闲，则等待时间DIFS后，广播一个请求发送RTS（RequestToSend)控制帧，它包括源地址、目的地址和这次通信所需的持续时间。若AP正确收到RTS顿，且信道空闲，则等待时间SIFS后，向源站发送一个充许发送CTS（ClearToSend）控制帧，它也包括这次通信所需的持续时间，源站收到CTS帧后，再等待时间SIFS，就可发送数据帧。若AP正确收到了源站发来的数据，则等待时间SIFS后就向源站发送确认帧ACK。AP覆盖范围内的其他站听到CTS顿后，将在CTS帧中指明的时间内抑制发送。CTS帧有两个目的： $\textcircled{\scriptsize{1}}$ 给源站明确的发送许可； $\circledcirc$ 指示其他站在预约期内不要发送。  

需要说明的是，源站在RTS帧中填写的所需占用信道的持续时间，是从RTS帧发送完毕后，到目的站最后发送完ACK帧为止的时间，即“ $\mathrm{SIFS+CTS+S I F S+}$ 数据帧 $+\;{\mathrm{SIFS}}+$ ACK"而AP在CTS顿中填写的所需占用信道的持续时间，是从CTS顿发送完毕，到目的站最后发送完ACK帧为止的时间，即“ $\mathrm{SIFS+}$ 数据帧 $\mathrm{+\;SIFS+ACK}$ ”。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c3ab7d2f814295e28c23f9b8d7d6e27883b83fde9116c67df227adcbfb64b071.jpg)  
图3.22A站和B站同时向AP发送信号，发生冲突  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/2674c2b5b366aab47d9a818ebdb238e29926b42fa0b01c12631f7f41d08ac0bc.jpg)  
图3.23使用RTS和CTS帧的冲突避免  

使用RTS帧和CTS帧会使网络的通信效率有所下降，但这两种顿都很短，与数据顿相比开销不算大。相反，若不使用这种控制顿，则一旦发生冲突而导致数据帧重发，浪费的时间会更多。信道预约不是强制性规定，各站可自行决定使用或不使用。只有当数据帧长超过某个数值时，使用RTS帧和CTS帧才比较划算。  

CSMA/CD与CSMA/CA主要有如下区别：  

1）CSMA/CD可以检测冲突，但无法避免；CSMA/CA发送数据的同时不能检测信道上有无  
冲突，本结点处没有冲突并不意味着在接收结点处就没有冲突，只能尽量避免。2）传输介质不同。CSMA/CD用于总线形以太网，CSMA/CA用于无线局域网802.11a/b/g/n等。3）检测方式不同。CSMA/CD通过电缆中的电压变化来检测；而CSMA/CA采用能量检测、载波检测和能量载波混合检测三种检测信道空闲的方式。  

总结：CSMA/CA在发送数据帧之前先广播告知其他站点，让其他站点在某段时间内不要发送数据顿，以免发生冲突。CSMA/CD在发送数据顺之前监听，边发送边监听，一旦发生冲突，就立即停止发送。  

# 3.5.3轮询访问：令牌传递协议  

在轮询访问中，用户不能随机地发送信息，而要通过一个集中控制的监控站，以循环方式轮询每个结点，再决定信道的分配。典型的轮询访问控制协议是令牌传递协议。  

在令牌传递协议中，一个令牌（Token）沿着环形总线在各站之间依次传递。令牌是一个特殊的控制帧，它本身并不包含信息，仅控制信道的使用，确保同一时刻只有一个站独占信道。当环上的一个站希望发送帧时，必须等待令牌。站点只有取得令牌后才能发送帧，因此令牌环网络不会发生冲突（因为令牌只有一个）。站点发送完一帧后，应释放令牌，以便让其他站使用。因为令牌在网环上是按顺序依次传递的，所以对所有入网计算机而言，访问权是公平的。  

令牌环网络中令牌和数据的传递过程如下：  

1）当网络空闲时，环路中只有令牌帧在循环传递。2）当令牌传递到有数据要发送的站点时，该站点就修改令牌中的一个标志位，并在令牌中附加自己需要传输的数据，将令牌变成一个数据帧，然后将这个数据帧发送出去。3）数据帧沿着环路传输，接收到的站点一边转发数据，一边查看帧的目的地址。若目的地址和自己的地址相同，则接收站就复制该数据帧，以便进一步处理。4）数据帧沿着环路传输，直到到达该帧的源站点，源站点收到自己发出去的帧后便不再转发。同时，通过检验返回的帧来查看数据传输过程中是否出错，若出错则重传。5）源站点传送完数据后，重新产生一个令牌，并传递给下一站点，交出信道控制权。  

令牌传递协议非常适合负载很高的广播信道，即多个结点在同一时刻发送数据概率很大的信道。若这样的信道采用随机介质访问控制，则发生冲突的概率很大，而采用令牌传递协议则可以很好地满足各站点间的通信需求。令牌传递协议既不共享时间，又不共享空间；它实际上在随机访问介质访问控制的基础上，限定了有权发送数据的结点只能有一个。  

即使是广播信道也可通过介质访问控制机制，使广播信道变为逻辑上的点对点信道，所以说数据链路层研究的是“点到点”之间的通信。  

# 3.5.4 本节习题精选  

# 一、单项选择题  

01.信道划分介质访问控制的核心思想是（）  

A.通过分时、分频、分码等方法，将广播信道变为若干点对点信道B.胜利者通过争用获得信道，从而获得信息的发送权C.通过集中控制方式解决发送信息的次序问题D.通过轮询方式依次询问每个站点是否有数据要发送  

02.将物理信道的总频带宽分割成若干子信道，每个子信道传输一路信号，这种信道复用技术是()。  
A.码分复用B.频分复用C.时分复用D.空分复用  

03.TDM所用传输介质的性质是（）  

A.介质的带宽大于结合信号的位速率B.介质的带宽小于单个信号的带宽C.介质的位速率小于最小信号的带宽D.介质的位速率大于单个信号的位速率  

04.从表面上看，FDM比TDM能更好地利用信道的传输能力，但现在计算机网络更多地使用TDM而非FDM，其原因是（）  

A.FDM实际能力更差B.TDM可用于数字传输而FDM不行C.FDM技术不成熟D.TDM能更充分地利用带宽  

05.在下列复用技术中，（）具有动态分配时隙的功能。  

A.同步时分复用B.统计时分复用C.频分复用D.码分复用  

06.在下列协议中，不会发生冲突的是（）  

A. TDM B.ALOHA C. CSMA D. CSMA/CD  

07.在纯ALOHA协议中，一个站点想要发送数据时（）  

A.必须等待信道空闲B.必须等待下一个时间槽开始C.可以立即发送D.必须先发送RTS帧  

08.以下几种CSMA协议中，（）协议在监听到信道空闲时仍可能不发送。A.1-坚持CSMAB.非坚持CSMAC. $p$ -坚持CSMAD．以上都不是

09.在CSMA的非坚持协议中，当信号忙时，则（）直到介质空闲。  

A.延迟一个固定的时间单位再监听B.继续监听C.延迟一个随机的时间单位再监听D.放弃监听  

10.在CSMA的非坚持协议中，当站点监听到总线信道空闲时，它（）  

A.以概率 $p$ 传送B.马上传送C.以概率 $1\!-\!p$ 传送D.以概率 $p$ 延迟一个时间单位后传送  

11.在CSMA/CD协议的定义中，“争用期”指的是（）  

A.信号在最远两个端点之间往返传输的时间B.信号从线路一端传输到另一端的时间C.从发送开始到收到应答的时间D.从发送完毕到收到应答的时间  

12.在CSMA/CD协议中，若不对帧的长度加以限制，当一个站在发送完毕之前没有检测到冲突，则该站所发送的帧（）和其他站发送的帧发生冲突。  

A.肯定不会B．可能会C.肯定会D.无法判断  

13.在以太网中，当数据传输速率提高时，帧的发送时间相应地缩短，这样可能会影响到冲突的检测。为了能有效地检测冲突，可以使用的解决方案有（）。  

A.减少电缆介质的长度或减少最短帧长B.减少电缆介质的长度或增加最短帧长C.增加电缆介质的长度或减少最短帧长D.增加电缆介质的长度或增加最短帧长  

14.长度为 $10\mathrm{km}$ 、数据传输速率为10Mb/s 的CSMA/CD以太网，信号传播速率为 $200\mathrm{m}/\upmu\mathrm{s}.$ 那么该网络的最小帧长为（)。  

A.20bit B.200bit C.100bit D.1000bit  

15.以太网中若发生信道访问冲突，则按照二进制指数退避算法决定下一次重发的时间。使用二进制指数退避算法的理由是（）  
A.这种算法简单 B.这种算法执行速度快C.这种算法考虑了网络负载对冲突的影响 D.这种算法与网络的规模大小无关  

16.以太网中采用二进制指数退避算法处理冲突问题。下列数据帧重传时再次发生冲突的概率最低的是（）。  

A.首次重传的帧B.发生两次冲突的帧C.发生三次重传的帧 D.发生四次重传的帧  

17.某 $100\mathrm{Mb/s}$ 以太网使用CSMA/CD协议，该以太网中的某个站在发送帧时检测到冲突，并准备进行第二次重传，则所需等待的最大退避时间是（）。  

A. 5.12μus B. 15.36μs C. 25.6μs D.   $51.2\upmu\mathrm{s}$  

18.在以太网的二进制指数退避算法中，在11次冲突之后，站点会在0～（）之间选择一个随机数。  

A. 255 B.511 C.1023 D.2047

 19.与CSMA/CD网络相比，令牌环网络更适合的环境是（）。A.负载轻 B.负载重 C.距离远 D.距离近

 20.根据CSMA/CD协议的工作原理，需要提高最短帧长的是（）。  

A.网络传输速率不变，冲突域的最大距离变短B.冲突域的最大距离不变，网络传输速率提高C.上层协议使用TCP的概率增加D.在冲突域不变的情况下减少线路中的中继器数量  

21.在某CSMA/CD局域网中，使用一个Hub连接所有站点，且限定站点到Hub的最长距离为 $100\mathrm{m}$ ，信号的传播速率为 $200000\mathrm{km/s}$ ，则站点的最长冲突检测时间是（）  

A.  $2\upmu\mathrm{s}$  B.2ms C. 1μs D.1ms  

22.无线局域网不使用CSMA/CD而使用CSMA/CA的原因是，无线局域网（）  

A.不能同时收发，无法在发送时接收信号B.难以实现冲突检测，存在隐蔽站和暴露站问题C.无线信号的广播特性，使得不会出现冲突 D.覆盖范围很小，不进行冲突检测不影响正确性  

23．下列关于CSMA/CA的叙述中，正确的是（）  

A.接收方收到数据帧后，需要向发送方返回确认帧B.CA表示CollisionAvoidance，即冲突避免，因而此类网络中不会出现冲突C.按照载波监听的工作原理，发送站点在检测到信道空闲后立即启动发送D.CSMA/CA和CSMA/CD的区别之一是CSMA/CA不需要使用退避算法  

24.CSMA/CA协议的主要特点是（）  

A.发送前先检测信道，信道空闲就立即发送，信道忙就随机推迟发送B.边发送边检测信道，一旦发现冲突就立即停止发送C.发送前先预约信道，获得信道授权后再发送D.发送后等待确认帧，在规定时间内未收到确认帧就重传  

25.在CSMA/CA协议中，有三种不同的时间参数：短帧间间隔SIFS、分布式协调帧间间隔DIFS和点协调帧间间隔PIFS。它们之间的长度关系是（）。A.  $\mathrm{SIFS}<\mathrm{PIFS}<\mathrm{DIFS}$  B.SIFS  $<$  DIFS<PIFS C.  $\mathrm{PIFS}<\mathrm{SIFS}<\mathrm{DIFS}$  D.PIFS  $<$  DIFS  $<$  SIFS  
26.下列关于令牌环网络的描述中，错误的是（）  

A.令牌环网络存在冲突的可能B.同一时刻，环上只有一个结点的数据在传输C.网上所有结点共享网络带宽D.数据从一个结点到另一结点的时间可以计算  

27.下列关于令牌环网络的说法中，不正确的是（）  

I.信道的利用率比较公平II.重负载下信道利用率高III.结点可以一直持有令牌，直至所要发送的数据传输完毕IV.结点只能持有令牌一段固定的时间，对于没有数据要发送的结点也是如此  

A.I、ⅡI和III B.1II C.III和IV D.IV

 28.在令牌环网络中，当网络空闲时，环路中（）  

A.只有令牌帧在循环传递B.只有数据帧在循环传递C.令牌帧和数据帧都在循环传递D.令牌帧和数据帧都不在循环传递  

29.在令牌环网络中，当一个站点收到自己发出去的数据帧后，它将（）。  

A.不再转发该帧，并重新产生一个令牌B.不再转发该帧，并等待下一个令牌C.继续转发该帧，并重新产生一个令牌D.继续转发该帧，并等待下一个令牌  

30.在令牌环网络中，当所有站点都有数据帧要发送时，一个站点在最坏情况下等待获得令牌和发送数据帧的时间等于（）。  

A.所有站点传送令牌的时间总和B.所有站点传送令牌和发送帧的时间总和C.所有站点传送令牌的时间总和的一半D.所有站点传送令牌和发送帧的时间总和的一半  

31.在一条广播信道上连有4个站点a、b、c、d，采用码分复用技术，当a、b、c要向d发送数据时，设a的码片序列为 $(\ 1,-1,\,1,\,-1$ ），则b和c的码片序列可以为（）。  

A. $(-1,1,1,1\,)$ 和 $(\,-1,\,-1,\,-1\,)$ C. $(-1,1,1,-1)$ 和 $(1,1,-1,-1$ 一B. $(\,-1,\,-1,\,1,\,1\,)$ ）和 $(\,-1,\,1,\,-1,\,1\,)$ D. $(\,-1,\,-1,\,-1\,)$ 和 $(1,1,1,1$ 一  

32.一个广播信道上接有3个站点A、B、C，介质访问控制采用信道划分方法，信道的划分采用码分复用技术，A、B要向C发送数据，设A的码片序列为 $(+1,-1,-1,+1,+1,+1,-1)_{\circ}$ B可以选用的码片序列为（）  

A.  ${-1,-1,+1,-1,+1,+1,+1}$  B.-1,+1，-1,-1,-1,+1，+1,+1 C.  $^{-1,+1,-1,+1,-1,+1,-1,+1}$  D.-1,+1，-1,+1，-1+1,+1，+1  

33.【2009统考真题】在一个采用CSMA/CD协议的网络中，传输介质是一根完整的电缆传输速率为1Gb/s，电缆中的信号传播速率是 $200000\mathrm{km/s}.$ 若最小数据帧长减少800比特，则最远的两个站点之间的距离至少需要（）。  

A.增加 $160\mathrm{m}$ B.增加 $80\mathrm{m}$ XC.减少 $160\mathrm{m}$ D.减少 $80\mathrm{m}$ 34.【2011统考真题】下列选项中，对正确接收到的数据帧进行确认的MAC协议是（）。A.CSMA B.CDMA C.CSMA/CD D.CSMA/CA  
35.【2013统考真题】下列介质访问控制方法中，可能发生冲突的是（）A.CDMA B.CSMA C.TDMA D.FDMA  

36.【2014统考真题】站A、B、C通过CDMA共享链路，A、B、C的码片序列分别是（1，1，1,1)、 $(1,-1,1,-1)\not\approx(1,1,-1,-1)\,.$ 若C从链路上收到的序列是 $(2,0,2,0,0,-2,0,-2,0,2,$ 0.2），则C收到A发送的数据是（）。  

A.000 B.101 C.110 D.111

 37.【2015统考真题】下列关于CSMA/CD协议的叙述中，错误的是（）。  

A.边发送数据帧，边检测是否发生冲突B.适用于无线网络，以实现无线链路共享C.需要根据网络跨距和数据传输速率限定最小帧长D.当信号传播延迟趋近0时，信道利用率趋近 $100\%$  

38.【2016统考真题】如下图所示，在Hub再生比特流的过程中会产生 $1.535\upmu s$ 的延时（Switch和Hub均为100Base-T设备），信号传播速率为 $200\mathrm{m/up}$ ，不考虑以太网帧的前导码，则H3和H4之间理论上可以相距的最远距离是（）  

A.  $200\mathrm{m}$  B.  $205\mathrm{m}$  C.  $359\mathrm{m}$  D.512m  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/ffe167d68f48b41a5c0322f20c21b518249f0912aea33a64e305317bacd857c7.jpg)  

39.【2018统考真题】IEEE802.11无线局域网的MAC协议CSMA/CA进行信道预约的方法是()。  

A.发送确认帧 B.采用二进制指数退避 C.使用多个MAC地址D.交换RTS与CTS帧  

40.【2019统考真题】假设一个采用CSMA/CD协议的 $100\,\mathrm{{Mb/s}}$ 局域网，最小顿长是128B，则在一个冲突域内两个站点之间的单向传播时延最多是（）  

A.  $2.56\upmu\mathrm{s}$  B.  $5.12\upmu\mathrm{s}$  C.  $10.24\upmu\mathrm{s}$  D.  $20.48\upmu s$  

41.【2020统考真题】在某个IEEE802.11无线局域网中，主机H与AP之间发送或接收CSMA/CA帧的过程如下图所示。在H或AP发送帧前等待的帧间间隔时间（IFS）中，最长的是(）。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/4b202800499cc0da8b1ae961497f65fe8cff251df8ad8b6df5249dc85dd04d7c.jpg)  
A.IFS1 B.IFS2 C. IFS3 D.IFS4  

42.【2023统考真题】已知10BaseT以太网的争用时间片为  $51.2\upmu\mathrm{s}.$  若网卡在发送某帧时发 生了连续4次冲突，则基于二进制指数退避算法确定的再次尝试重发该帧前等待的最长时间是（）。  

A.  $51.2\upmu\mathrm{s}$  B.  $204.8\upmu\mathrm{s}$  C.  $768\upmu\mathrm{s}$  D.  $819.2\upmu\mathrm{s}$  

# 二、综合应用题  

01.以太网使用的CSMA/CD协议是以争用方式接入共享信道的，与传统的时分复用（TDM）相比，其优缺点如何？  

02.长度为1km、数据传输速率为 $10\mathrm{Mb/s}$ 的CSMA/CD以太网，信号在电缆中的传播速率为 $200000\mathrm{km/s}.$ 试求能够使该网络正常运行的最小帧长。  

03.考虑建立一个CSMA/CD网，电缆长Ikm，不使用重发器，运行速率为1Gb/s，电缆中的信号速率是 $200000\mathrm{km/s}$ ，最小帧长是多少？  

04.构造一个CSMA/CD总线网，速率为 $100\mathrm{{Mb/s}}$ ，信号在电缆中的传播速率为 $2{\times}10^{5}\mathrm{km/s}$ ,数据帧的最小长度为125字节。试求总线电缆的最大长度（假设总线电缆中无中继器）。  

05.【2010统考真题】某局域网采用CSMA/CD协议实现介质访问控制，数据传输速率为10Mb/s，主机甲和主机乙之间的距离是 $2\mathrm{km}$ ，信号传播速率是 $200000\,\mathrm{km/s}.$ 请回答下列问题，要求说明理由或写出计算过程。  

1）若主机甲和方机乙发送数据时发生冲突，则从开始发送数据的时刻起，到两台主机均检测到冲突为止，最短需要经过多长时间？最长需要经过多长时间（假设主机甲和主机乙在发送数据的过程中，其他主机不发送数据）？  

2）若网络不存在任何冲突与差错，主机甲总以标准的最长以太网数据帧（1518字节）向主机乙发送数据，主机乙每成功收到一个数据帧，就立即向主机甲发送一个64字节的确认帧，主机甲收到确认顿后方可发送下一个数据帧。此时主机甲的有效数据传输速率是多少（不考虑以太网的前导码）？  

# 3.5.5 答案与解析  

# 一、单项选择题  

01.A  

选项B是随机访问介质访问控制的特点，如CSMA/CD协议。选项C是集中式介质访问控制的特点，如主从式协议，它由一个主站控制所有从站的发送顺序，从站只能在主站充许时才能发送数据。选项D是轮询访问介质访问控制的特点，如令牌传递协议。  

02.B  

在物理信道的可用带宽超过单个原始信号所需带宽的情况下，可将该物理信道的总带宽分割成若干与传输单个信号带宽相同（或略宽）的子信道，每个子信道传输一种信号，这就是频分复用。  

03.D  

本题的关键是理解TDM（时分复用）的原理和特点。TDM在发送端将不同用户的信号相互交织在不同的时间片内，沿同一个信道传输，在接收端再将各个时间片内的信号提取出来，还原成原始信号。为了实现TDM，必须满足如下条件： $\textcircled{\scriptsize{1}}$ 介质的位速率（即每秒传输的二进制位数）大于单个信号的位速率： $\circledcirc$ 介质的带宽（即所能传输信号的最高频率与最低频率之差）大于结合信号的带宽（即所有信号经过调制后形成的复合信号的带宽）。  
04.B  

TDM与FDM相比，抗干扰能力强，可以遂级再生整形，避免干扰的积累，而且数字信号比较容易实现自动转换，所以根据FDM和TDM的工作原理，FDM适合传输模拟信号，TDM适合传输数字信号。  

05.B  

时分复用（TDM）分为同步时分复用和异步时分复用（文称统计时分复用）。同步时分复用是一种静态时分复用技术，它预先分配时间片（即时隙），而异步时分复用则是一种动态时分复用技术，它动态地分配时间片（时隙）。  

06.A  

TDM属于静态划分信道的方法，各结点分时使用信道，不发生冲突。而ALOHA、CSMA和CSMIA/CD都属于动态分配信道的方法，都采用检测冲突的策略来应对冲突，因此都可能发生冲突。注意，随机访问介质访问控制和轮询访问介质访问控制，都属于动态分配信道的方法，但是随机访问介质访问控制可能发生冲突，而轮询访问介质访问控制不发生冲突。  

07. C  

在纯ALOHA协议中，一个站点想要发送数据时可以立即发送，而不需要等待信道空闲或下一个时间槽开始，也不需要先发送RTS顿。  

08.C  

$p$ -坚持CSMA协议是1-坚持CSMA协议和非坚持CSMA协议的折中。 $p$ -坚持CSMA检测到信道空闲后，以概率 $p$ 发送数据，以概率 $1\!-\!p$ 推迟到下一个时隙，目的是降低1-坚持CSMA中多个结点检测到信道空闲后同时发送数据的冲突概率：采用坚持“监听”的目的，是克服非坚持CSMA中因随机等待造成延迟时间较长的缺点。  

09.C  

非坚持CSMA：站点在发送数据前先监听信道，若信道忙则放弃监听，等待一个随机时间后再监听，若信道空闲则发送数据。  

10.B 解析同上。  

11.A CSMA/CD协议中定义的争用期是指信号在最远两个端点之间往返传输的时间。  

12.B  

即使一个站在发送完帧之前没有检测到冲突，也不能背定该站所发送的帧不会和其他站发送的帧发生冲突。因为存在这样的可能：当一个站发送完后，另一个站刚好开始发送，而两个站之间的往返传播时延大于帧的发送时间，使得第一个站无法及时检测到冲突。  

13.B  

CSMA/CD协议要求：发送帧的时间 $\geqslant$ 争用期的时间（即信号在最远两个端点之间往返传输的时间）。因此，当数据传输速率提高时，发送顺的时间就缩短，此时可通过增加最短顺长来增加发送帧的时间，或缩短电缆的长度来减少争用期的时间，以便仍然满足“发送顿的时间≥争用期的时间”这个要求。掌握CSMA/CD最短顿长的原理是解决这类问题的关键。  

14. D  

来回路程 $=10000{\times}2\mathrm{m}$ ，往返时间 $\mathrm{RTT}=10000{\times}2/(200{\times}10^{6})=10^{-4}\mathrm{s}$ ，最小帧长 $=W\times\mathrm{RTT=}$ 1000bit。  
15.C  

以太网采用CSMA/CD技术，网络上的流量越大、负载越多时，发生冲突的概率也越大。当工作站发送的数据帧因冲突而传输失败时，将采用二进制指数退避算法后退一段时间再重新发送数据顿。二进制指数退避算法可以动态地适应发送站点的数量，后退时延的取值范围与重发次数 $n$ 形成二进制指数关系。当网络负载小时，后退时延的取值范围也小：当网络负载大时，后退时延的取值范围也随着增大。二进制指数退避算法的优点是，它将后退时延的平均取值与负载的大小联系起来了。因此，二进制指数退避算法考虑了负载对冲突的影响。  

16.D  

根据1正EE802.3标准的规定，以太网采用二进制指数退避算法处理冲突问题。当检测到冲突而停止发送后，一个站必须等待一个随机时间段才能重新尝试发送。这一随机等待时间的目的是减少再次发生冲突的可能性。等待的时间长度按下列步骤计算：  

1）取均匀分布在0至 $2^{\operatorname*{min}(k,\,10)}-1$ 之间的一个随机整数 $r$ ， $k$ 是冲突发生的次数。  

2）发送站等待 $_{r\times2t}$ 长度的时间后才能尝试重新发送，其中t为以太网的端到端延迟。  

从这个计算步骤可以看出， $k$ 值越大，帧重传时再次发生冲突的概率越低。  

17.B  

对于 $100\mathrm{Mb/s}$ 的以太网，争用期与 $10\mathbf{M}\mathbf{b}/\mathrm{s}$ 的以太网相同，仍然是64B的发送时间，即 $512{\mathrm{b}}\div$  $100\,\mathrm{M}\mathrm{b}/\mathrm{s}=5.12\upmu\mathrm{s}.$ ，根据CSMA/CD协议的退避算法，第 $k$ 次重传需要退避的时间为：从整数集合 $\{0,1,\cdots,2^{k}\!-\!1$ 中随机取出一个数 $r$ ，退避时间就是 $r$ 倍的争用期。当重传次数大于10时， $k$ 不再增大，而一直等于10。本题中 $k\!=\!2$ ，问的是最大退避时间，所以取 $r\!=\!3$ ，最大退避时间为 $15.36\upmu\mathrm{s}$  

18.C  

一般来说，在第 $i~\left(i<10\right.$ ）次冲突后，站点会在0到 $2^{i}\!-\!1$ 之间随机选择一个数 $M$ ，然后等待 $M$ 倍的争用期再发送数据。达到10次冲突后，随机数的区间固定在最大值1023上，以后不再增加。若连续超过16次冲突，则丢弃相应的数据顺。  

19.B  

CSMA/CD网络中各站随机发送数据，有冲突产生。当负载很多时，冲突加剧。而令牌环网络各站轮流使用令牌发送数据，无论网络负载如何，都无冲突产生，这是它的突出优点。  

20.B  

CSMA/CD协议要求：发送帧的时间 $\geqslant$ 争用期的时间，当等号成立时，即最短顺长 $=$ 数据传输速率 $\times$ 争用期。对于选项A，最大距离变短会使争用期（最大距离的往返时间）变短，最短顺长变短。对于选项B，数据传输速率提高，最短帧长变长。选项C对最短帧长没有影响。对于选项D，在冲突域不变的情况下减少线路中的中继器数量会降低传播时延，争用期变短，最短喷长变短。  

21. A  

限定站点到集线器（Hub）的最长距离为 $100\mathrm{m}$ ，则两个站点之间的最长距离为 $200\mathrm{m}$ ，最长冲突检测时间等于信号在两个最远站点之间的往返传输时间，即 $2{\times}200\mathrm{m}{\cdot}200000\mathrm{km/s}=2\upmu\mathrm{s}.$  

22.B  

无线局域网不能简单地使用CSMA/CD协议，特别是冲突检测部分，原因如下：第一，在无线局域网的适配器上，接收信号的强度往往远小于发送信号的强度，因此要实现冲突检测，硬件费用就会过大；第二，在无线局域网中，并非所有站点都能听见对方，即存在隐蔽站和暴露站问题（暴露站问题举例：在下图中，假设B站向A站发送数据，而C站又想和D站通信，但C站检测到信道忙，于是就不向D站发送数据，其实B站向A站发送数据并不影响C站向D站发送数据。在无线局域网中，在不发生干扰的情况下，允许同时有多个移动站进行通信，这一点与有线局域网有很大的差别）。而“所有站点都能听见对方”正是实现CSMA/CD协议的前提。选项A是CSMA/CD和CSMA/CA的特点，但不是无线局域网使用CSMA/CA的原因。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/6ba1aa45054a09df11e7bb9d49322ad44cf882f056ee766ae1a7ed10394c3154.jpg)  

23.A  

CSMA/CA只能尽量降低冲突发生的概率，在无线信道中冲突是无法完全避免的。检测到信道空闲后，CSMA/CA规定还必须等待DIFS的时间才能开始发送。无线信道中可能发生冲突，所以CSMA/CA也需要退避算法，但是和CSMA/CD的退避算法有一定的区别。  

24. D  

若检测到信道空闲，则CSMA/CA规定还必须等待DIFS的时间才能开始发送。CSMA/CA不会进行冲突检测。预约信道并不是CSMA/CA的强制规定，在普通模式下不进行预约信道。  

25.A  

SIFS最短，网络中的控制顿和确认顿都采用SIFS作为发送之前的等待时延。DIFS最长，所有的数据帧都采用DIFS作为等待时延。PIFS中等，用于AP发送管理顿或探测顿的等待时延。当源站要发送数据时，先检测信道，在持续检测到信道空闲达到D正S时间后就开始发送。自的站正确收到数据帧后，等待SIFS时间后发出对应的确认帧。若源站在规定时间内未收到确认顿，就必须重传此帧，直到收到确认帧为止，或经过若于重传失败后放充发送。  

26.A  

令牌环网络的拓扑结构为环状，有一个令牌不停地在环中流动，只有获得了令牌的结点才能发送数据，因此不存在冲突，A错误。令牌环网络是一种半双工通信方式，同一时刻只能有一个结点发送数据，其他结点只能接收或转发数据，B正确。令牌环网络中的所有结点都连接到同一个信道上，共享整个信道的带宽，C正确。在令牌环网络中，数据从一个结点到另一结点的时间可根据环上经过的结点数、传输速率和数据帧长来计算，D正确。  

27.C  

令牌环网络使用令牌在各个结点之间传递来分配信道的使用权，每个结点都可在一定的时间内（令牌持有时间）获得发送数据的权限，而并非无限制地持有令牌。在令牌传递过程中，没有数据要发送的结点收到令牌后将立刻传递下去而不能持有。I和ⅡI均为令牌环网络的特点。  

28.A  

在令牌环网络中，当网络空闲时，环路中只有令牌帧在循环传递。当某个站点要发送数据时，必须等待令牌到达，然后修改令牌中的标志位，并附加数据，将令牌变成一个数据帧。  

29.A  

在令牌环网络中，一个站点收到自己发出去的数据帧后，不再转发该帧，而重新产生一个令牌，然后将该令牌发送给下一个站点。这样可以回收数据帧，避免环路上的冗余，并释放传输权限。  

30.B  

令牌环网络在逻辑上采用环状控制结构。因为令牌总沿逻辑环单向逐站传送，所以结点总可在确定的时间内获得令牌并发送数据。在最坏情况下，即在所有结点都要发送数据的情况下，一个结点获得令牌的等待时间等于逻辑环上所有其他结点依次获得令牌，并在令牌持有时间内发送数据的时间之和。  
31.C  

要实现码分复用，a、b、c三个站点的码片序列必须满足正交性，即两两之间的规格化内积等于0，分别计算各选项与（1，-1，1，-1）两两之间的规格化内积，只有选项C满足要求。  

32.D  

B站点选用的码片序列一定要与A站点的码片序列正交，且规格化内积为0。分别计算A、B、C、D，可知只有D符合要求。  

33.D  

有关最短帧长的题要抓住两个公式来分析： $\textcircled{\scriptsize{1}}$ 发送帧的时间 $\geqslant$ 争用期的时间： $\circledcirc$ 最短顿长 $\scriptstyle{\varepsilon}=$ 数据传输速率 $\times$ 争用期时间。题中，最短帧长减少800比特，则发送帧的时间减少 $0.8\upmu\mathrm{s}$ ，要使 $^\mathrm{(d)}$ 和 $\circledcirc$ 依然成立，就需要至少将争用期（信号的往返时间）的时间减少 $0.8\upmu\mathrm{s}$ ，所以往返传播的总距离至少需要减少 $200000\mathrm{km/s}{\times}0.8\mathrm{us}\,{=}\,160\mathrm{m}$ ，即单程距离至少需要减少 $80\mathrm{m}$ 0  

34. D  

CSMA/CA是无线局域网标准802.11中的协议，它在CSMA的基础上增加了冲突避免的功能。ACK帧是CSMA/CA避免冲突的机制之一，也就是说，只有当发送方收到接收方发回的ACK帧时，才确认发出的数据帧已正确到达目的地。  

35.B  

选项A、C和D都是信道划分协议，信道划分协议是静态划分信道的方法，肯定不会发生冲突。CSMA的全称是栽波监听多路访问协议，其原理是站点在发送数据前先监听信道，发现信道空闲后再发送数据，但在发送过程中可能会发生冲突。  

36.B  

将收到的序列分成每4个数一组，即 $(2,\,0,\,2,\,0),\,(0,\,-2,\,0,\,-2),\,(0,\,2,\,0,\,2)$ ，因为题目求的是A站发送的数据，因此将这三组数据与A站的码片序列 $(1,1,1,1)$ 做内积运算，结果分别是 $(2,0,$  $2,\,0)\bullet(1,\,1,\,1,\,1)/4=1,\,\,\,(0,-2,\,0,-2)\bullet(1,\,1,\,1,\,1)/4=-1,\,\,\,(0,\,2,\,0,\,2)\bullet(1,\,1,\,1,\,1)/4=1$ ，所以C站接收到的A站发送的数据是101。  

37.B  

CSMA/CD适用于有线网络，CSMA/CA广泛应用于无线局域网。选项A、C关于CSMA/CD的描述都是正确的。对于选项D，因为在CSMA/CD协议中，信号传播时延会影响冲突检测的效率，若信号传播时延趋于零，则冲突检测就会非常及时，从而减少重传的时间和次数，提高信道利用率。当信号传播时延趋于零时，信道利用率也趋于 $100\%$  

38.B  

有关最短帧长的题要抓住两个公式来分析： $\textcircled{\scriptsize{1}}$ 发送顿的时间 $\geqslant$ 争用期的时间； $\circledcirc$ 最短帧长 $=$ 数据传输速率×争用期时间。要使公式 $\textcircled{\scriptsize{1}}$ 恒成立，就要考虑在最短帧长的情况下公式 $^{(\!\astrosun)}$ 仍成立。对于本题，发送最短帧的时间为 $64\mathrm{B}\!+\!100\mathrm{M}\mathrm{b}/\mathrm{s}\!=\!5.12\upmu\mathrm{s}$ ，根据公式 $\circledcirc$ 可知，该时间即为争用期时间（往返时延）的最大值。本题的特点在于往返时延由两部分组成，即传播时延和Hub产生的转发时延。单程总时延为2.56us，Hub产生的转发时延为1.535us，所以传播时延为 $2.56-1.535\,{=}\,1.025\upmu\mathrm{s}$ ，从而H3与H4之间理论上可以相距的最大距离为 $200\mathrm{m}/\upmu\mathrm{s}\!\times\!1.025\upmu\mathrm{s}\!=\!205\mathrm{m}.$  

39.D  

当CSMA/CA进行信道预约时，主要使用的是请求发送RTS帧和清除发送CTS帧。当一台主机想要发送信息时，先向无线站点发送一个RTS帧，说明要传输的数据及相应的时间。无线站点收到RTS帧后，将广播一个CTS顺作为对此的响应，既给发送方发送许可，又指示其他主机不要在这个时间内发送数据，从而预约信道，避免冲突。发送确认倾的目的主要是保证信息的可靠传输。二进制指数退避算法是CSMA/CD中的一种冲突处理方法。选项C与预约信道无关。  
40.B  

有关最短顿长的题要抓住两个公式来分析： $\textcircled{\scriptsize{1}}$ 发送帧的时间 $\geqslant$ 争用期的时间； $\circledcirc$ 最短顿长 $=$ 数据传输速率 $\times$ 争用期时间。对于本题，数据传输速率为 $100\mathrm{Mb/s}$ ，最短帧长为128B，根据公式 $\circledcirc$ 可得争用期时间（往返时延）为 $128\mathrm{B}{\div}100\mathrm{M}\mathrm{b}/\mathrm{s}\!=\!10.24{\times}10^{-6}\mathrm{s}$ ，所以单向传播时延为 $5.12\upmu\mathrm{s}$ 。  

41. A  

为了尽量避免冲突，I正EE802.11标准规定，所有站完成发送后，必须再等待一段很短的时间（继续监听）才能发送下一帧，这段时间称为帧间间隔（IFS），有三种IFS：DIFS、PIFS和SIFS。倾间间隔的长短取决于该站要发送的帧的类型。网络中的控制顺以及对所接收数据的确认顿都采用SIFS作为发送之前的等待时延。当站点要发送数据时，若载波监听到信道空闲，则需等待DIFS后发送RTS预约信道，图中IFS1对应DIFS，时间最长，图中IFS2、IFS3、IFS4对应SIFS。  

42. C  

10BaseT以太网采用CSMA/CD协议，CSMA/CD采用截断二进制指数退避算法来确定冲突后 重传的时机。从整数集合[ $),1,\cdots,2^{k}-$ 1]中随机取出一个数 $r$ ，参数 $k\!=$ min[重传次数，10]，站点重传所需等待的时间 $=r\times$ 争用期，因此等待的最长时间为 $(2^{4}\!-\!1)\!\times\!51.2\upmu\mathrm{s}=768\upmu\mathrm{s}.$  

# 二、综合应用题  

01.【解答】  

CSMA/CD是一种动态的介质随机接入共享信道方式，而TDM是一种静态的信道划分方式，从对信道的利用率来说，CSMA/CD用户共享信道，更灵活，信道利用率更高。  

TDM不同，它为用户按时隙固定分配信道，当用户没有数据传送时，信道在用户时隙就浪费了；因为CSMA/CD让用户共享信道，所以当同时有多个用户需要使用信道时，就会发生冲突，从而降低信道的利用率：而在TDM中，用户在分配的时隙中不与其他用户发生冲突。对局域网来说，连入信道的是相距较近的用户，通常信道带宽较大。当使用TDM方式时，用户在自己的时隙中没有发送的情况更多，不利于信道的充分利用。  

对于计算机通信来讲，突发式的数据更不利于使用TDM方式。  

02.【解答】  

对于 $1\mathrm{km}$ 长的电缆，单程传播时间为 $1/200000\,{=}\,5\upmu s$ ，来回路程传播时间为 $10\upmu\mathrm{s}\!=\!10^{-5}\mathrm{s}$  

为了使该网络能按照CSMA/CD工作，最小的发送时间不能小于 $10\upmu\mathrm{s}$ 。当以 $10\mathrm{Mb/s}$ 速率工作时， $10^{-5}\mathrm{{s}}$ 内可发送的比特数为 $(10\!\times\!10^{6}\mathrm{b/s})\!\times\!10^{-5}\mathrm{s}\!=\!100$ ，因此最小帧长为 $100\mathrm{bit}$  

# 03.【解答】  

对于 $1\,\mathrm{km}$ 的电缆，单程传播时延是 $1/200000\,{=}\,5{\times}10^{-6}\mathrm{s}$ ，即 $5\upmu\mathrm{s}$ ，往返传播时延是 $10\upmu\mathrm{s}$ 。要能按照CSMA/CD工作，最小帧的发送时间不能小于 $10\upmu\mathrm{s}$ 。当以 $1\mathrm{{Gb/s}}$ 速率工作时， $10\upmu\mathrm{s}$ 内可以发送的比特数为 $(10\!\times\!10^{-6})/(1\!\times\!10^{-9})\!=\!10000$ ，因此最小帧长为 $10000{\mathrm{bit}}$  

# 注意  

假设现在传了一个顿，还未到往返时延就发送完毕，而且在中途出现冲突，这样就检测不出错误；若中途发生冲突，且这个帧还未发送完，则可检测出错误。因此，要保证CSMA/CD正常工作，就必须使发送时间大于或等于来回往返时延（即争用期）。  
04.【解答】  

设总线电缆的长度为  $L$  ，则  

$$
{\frac{125\times8}{100\times10^{6}}}\!=\!2\!\times\!{\frac{L}{2\!\times\!10^{8}}}\,,\;\;L\!=\!{\frac{125\!\times\!8\!\times\!10^{8}}{100\!\times\!10^{6}}}\!\,\mathrm{m}\!=\!1000\mathrm{m}
$$  

05.【解答】  

1）题目问的是当两台主机均检测到冲突时的最短时间和最长时间。首先要理解一个概念，即什么叫“主机检测到冲突”。假设主机甲和主机乙通信，双方发送的数据帧在中途相遇，此时发生了冲突，但甲方要检测到此次冲突，就必须收到乙方发送来的数据帧；同理，乙方要检测到此次冲突，就必须收到甲方发送来的数据帧。若仅考虑一方，则最短时间显然趋于0（即一方在发送数据时，对方的数据即将到达），最长时间显然是往返时延（即争用期）。若同时考虑两台主机，则不难发现，从开始发送数据的时刻起，假设甲方检测到冲突发生的时间为 $T_{1}$ ，乙方检测到冲突发生的时间为 $T_{2}$ ，则 $T_{1}+T_{2}=$ 往返时延。显然，当甲方和乙方同时向对方发送数据时，信号在信道中间发生冲突后，冲突信号继  

续向两个方向传播。这种情况下两台主机均检测到冲突的时间最短：  

$T_{\mathrm{(A)}}\,{=}\,1\,\mathrm{km}/200000\,\mathrm{km/s}\times2\,{=}\,0.01\,\mathrm{ms}\,{=}$ 单程传播时延 $t_{0}$  

设甲方（或乙方）先发送数据，当数据即将到达乙方（或甲方）时，乙方（或甲方）才开始发送数据。此时，乙方（或甲方）将立即检测到冲突，而甲方（或乙方）要检测到冲突，还需等待冲突信号从乙方（或甲方）传播到甲方（或乙方）。两台主机均检测到冲突的时间最长：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/0297c1f8acc8e955916a5dfa673fb9d0599eeee1a58efbea6726c1901921d653.jpg)  
(b）时间最长的情况  

2）甲方发送一个数据帧的时间即发送时延 $t_{1}\!=\!1518\!\times\!8\mathrm{bit\!\div\!10M\mathrm{b/s}}\!=\!1.2144\mathrm{ms}$ ；乙方每成功收到一个数据帧，就向甲方发送一个确认帧，确认帧的发送时延 $t_{2}=64\!\times\!8\mathrm{bit\!-\!10Mb/s}=$  $0.0512\mathrm{ms}$ ：申方收到确认顿后，即发送下一数据帧，因此甲方的发送周期 $T\!=$ 数据帧发送时延  $t_{1}+$  确认帧发送时延  $t_{2}+$  双程传播时延  $2t_{0}\!=\!t_{1}+t_{2}+2t_{0}\!=\!1.2856\mathrm{ms}$  0  

有效数据传输速率 $=$ 信道利用率 $\times$ 信道带宽（最大数据传输速率）；或者有效数据传输速率 $=$ 发送周期内发送的数据量/发送周期。因此，甲方的有效数据传输速率为 $1500\times8/T=$  $12000\mathrm{bit}/1.2856\mathrm{ms}\,{\approx}\,9.33\mathrm{Mb}/\mathrm{s}$ （以太网帧的数据部分为1500B）。  

# 3.6局域网  

# 3.6.1局域网的基本概念和体系结构  

局域网（LocalAreaNetwork，LAN）是指在一个较小的地理范围（如一所学校）内，将各种计算机、外部设备和数据库系统等通过双绞线、同轴电缆等连接介质互相连接起来，组成资源和信息共享的计算机互连网络。主要特点如下：  
1）为一个单位所拥有，且地理范围和站点数目均有限。2）所有站点共享较高的总带宽（即较高的数据传输速率）。3）较低的时延和较低的误码率。4）各站为平等关系而非主从关系。5）能进行广播和多播。  

局域网的特性主要由三个要素决定：拓扑结构、传输介质、介质访问控制方式，其中最重要的是介质访问控制方式，它决定着局域网的技术特性。  

常见的局域网拓扑结构主要有以下4大类： $\textcircled{\scriptsize{1}}$ 星形结构； $\circledcirc$ 环形结构； $\textcircled{3}$ 总线形结构； $\textcircled{4}$ 星形和总线形结合的复合型结构。  

局域网可以使用铜缆、双绞线和光纤等多种传输介质，其中双绞线为主流传输介质。  

局域网的介质访问控制方法主要有CSMA/CD协议、令牌总线协议和令牌环协议，其中前两种协议主要用于总线形局域网，令牌环协议主要用于环形局域网。  

三种特殊的局域网拓扑实现如下：  

以太网（目前使用范围最广）。逻辑拓扑是总线形结构，物理拓扑是星形结构。令牌环（TokenRing，IEEE802.5）。逻辑拓扑是环形结构，物理拓扑是星形结构。FDDI（光纤分布数字接口，IEEE802.8）。逻辑拓扑是环形结构，物理拓扑是双环结构。  

IEEE802标准定义的局域网参考模型只对应于OSI参考模型的数据链路层和物理层，并将数据链路层拆分为两个子层：逻辑链路控制（LLC）子层和介质访问控制（MAC）子层。与接入传输介质有关的内容都放在MAC子层，它向上层屏蔽对物理层访问的各种差异，主要功能包括：组帧和拆卸帧、比特传输差错检测、透明传输。LLC子层与传输介质无关，它向网络层提供无确认无连接、面向连接、带确认无连接、高速传送四种不同的连接服务类型。  

因为在局域网市场中的垄断地位，以太网几乎成为局域网的代名词，而802委员会制定的LLC子层作用已经不大，所以现在许多网卡仅装MAC协议而不装LLC协议。IEEE802协议层与0SI参考模型的比较如图3.24所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/16c71a620ddded21f3ab9edcb32be26696a427239d32f2fc4cc82b8d8ddad874.jpg)  
图3.24IEEE802协议层与OSI参考模型的比较  

# 3.6.2 以太网与1EEE802.3  

以太网规约的第一个版本是DIXV1，它由DEC、Intel和Xerox联合提出。之后，它被修改为第二版规约DIXEthermnetV2，是世界上第一个局域网产品的规约。在此基础上，IEEE802委员会的IEEE802.3工作组制定了第一个IEEE的以太网标准IEEE802.3。  

以太网是目前最流行的有线局域网技术。以太网逻辑上采用总线形拓扑结构，所有计算机共享同一条总线，信息以广播方式发送，以太网使用CSMA/CD方式对总线进行访问控制。  
严格来说，DIX Ether mnet V 2，DIX Ethernet V 2 IEEE802.3标准的差别很小，因此通常将802.3局域网简称为以太网。  

# 命题追踪以太网MAC协议提供的服务类型（2012）  

以太网采用两项措施来简化通信： $\textcircled{\scriptsize{1}}$ 采用无连接的工作方式，既不对发送的数据帧编号，又不要求接收方发送确认，即以太网尽最大努力交付数据，提供的是不可靠服务，对差错的纠正则由高层完成： $\circledcirc$ 发送的数据都使用曼彻斯特编码的信号，每个码元的中间出现一次电压转换，接收方利用这种电压转换方便地将位同步信号提取出来。  

# 1.以太网的传输介质与网卡  

以太网常用的传输介质有4种：粗缆、细缆、双绞线和光纤，它们的适用情况见表3.2。  

表3.2各种传输介质的适用情况
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/3dea384933fe4b050f28d3dbd4a48eedd11df3f4fd270e10c83edbb8a2448575.jpg)  

# 注意  

在上述标准中，10指标准的速率为 $10\mathrm{Mb/s}$ ；Base指基带以太网；早期标准Base之后的5或2指单段最大传输距离不超过 $500\mathrm{m}$ 或 $185\mathrm{m}$ ，Base之后的T指双绞线，F指光纤。  

计算机与外界局域网的连接是通过主板上嵌入的一块网络适配器（Adapter）［又称网络接口卡（NetworkInterfaceCard，NIC）」实现的。适配器上装有处理器和存储器，工作在数据链路层。适配器和局域网的通信是通过电缆或双绞线以事行方式进行的，而适配器和计算机的通信则是通过 计算机的TO总线以并行方式进行的。因此，适配器的重要功能就是进行数据的事并转换。  

适配器不仅能实现与局域网传输介质之间的物理连接和电信号匹配，还涉及顺的发送与接收、顺的封装与拆封、介质访问控制、数据的编码与解码及数据缓存等功能。当适配器收到正确的帧时，就使用中断来通知该计算机，并交付协议栈中的网络层。当计算机要发送1IP数据报时，就由协议栈把IP数据报向下交给适配器，组顿后发送到局域网。  

# 2.以太网的MAC地址  

IEEE802标准为局域网规定了一种48位的全球地址，是指局域网上的每台计算机中固化在适配器的ROM中的地址，称为物理地址或MAC地址（因为这种地址用在MAC顿中），这个地址用于控制主机在网络上的数据通信。全世界所有的局域网适配器都具有不同的地址，一台计算机只要没有更换适配器，不管其地理位置如何变化，其MAC地址都不会变化。  

# 命题追踪以太网MAC地址的长度（2013）  

MAC地址长6字节，一般用由连字符（或冒号)分隔的12个十六进制数表示，如02-60-8c-e4-b1-21。高24位为厂商代码，低24位为厂商自行分配的适配器序列号。  

当路由器通过适配器连接到局域网时，适配器上的MAC地址就用来标志路由器的某个接口。路由器若同时连接到两个网络上，则它需要两个适配器和两个MAC地址。  
适配器从网络上每收到一个MAC帧，首先都要用硬件检查MAC帧中的目的地址。若是发往本站的帧，则收下，否则丢弃该帧。这里“发往本站的帧”包括以下三种帧：  

1）单播帧（一对一），即收到的帧的目的地址与本站的MAC地址相同。2）广播顿（一对全体），即发送给本局域网上所有站点的（全1地址）。3）多播帧（一对多），即发送给本局域网上一部分站点的帧。  

# 3.以太网的MAC帧  

以太网MAC帧格式有两种标准：DIXEthernetV2标准（即以太网V2标准）和IEEE802.3标准。这里只介绍最常用的以太网V2的MAC帧格式，如图3.25所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/335c6fdb9bafd3bdfa0928452310b671659a80125d05ada1c9a171de77cb363b.jpg)  
图3.25以太网V2标准的MAC帧格式  

命题追踪以太网帧首部的内容、首部和尾部的长度（2010、2011）  

在帧前面插入的8字节前导码分为两个字段：第一个字段是7字节的前同步码，用来实现MAC帧的比特同步；第二个字段是1字节的帧开始定界符，表示后面的信息就是MAC帧。  

# 注意  

以太网帧不需要顿结束定界符，因为当以太网传送顿时，各帧之间必须有一定的间隙。因此，接收方只要找到顿开始定界符，其后面连续到达的比特流就都属于同一个顿。实际上，以太网采用了违规编码法的思想，因为以太网使用曼彻斯特编码，所以每个码元中间都有一次电压的跳变。发送方发完一个帧后，发送方网络接口上的电压不再变化，这样接收方就能很容易地找到倾的结束位置，这个位置往前数4字节就是FCS字段，于是就能确定数据字段的结束位置。  

# 命题追踪以太网帧中目的地址和源地址的含义（2018）  

目的地址：6字节，帧在局域网上的目的适配器的MAC地址。源地址：6字节，传输帧到局域网上的源适配器的MAC地址。类型：2字节，指出数据字段中的数据应交给哪个上层协议处理，如网络层的IP协议。命题追踪分析IP首部并判断其以太帧是否需要填充（2012）  

数据： $46\!\sim\!1500$ 字节，承载上层的协议数据单元（如IP数据报）。以太网的最大传输单元是1500字节，若IP数据报超过1500字节，则必须将该IP数据报分片。此外，由于CSMA/CD算法的限制，以太网顿必须满足最小长度是64字节，当数据字段的长度小于46字节时，MAC子层就在数据字段的后面加一个整数字节的填充字段，以确保帧长不小于64字节。  
# 注意  

46是怎么来的？由CSMA/CD可知以太网帧的最短帧长为64B，而MAC帧的首部和尾部的长度为18字节，所以数据字段最短为 $64-18=46$ 字节。  

检验码（FCS）：4字节，检验范围从目的地址段到数据字段，算法采用32位CRC码，不但要检验MAC顿的数据部分，而且要检验目的地址、源地址和类型字段，但不检验前导码。  

802.3顿格式与以太网V2帧格式的不同之处是，用长度域替代了V2帧中的类型域，指出了数据域的长度。在实践中，前述长度/类型两种机制可以并存，因为IEEE802.3数据段的最大字节数是1500，所以长度段的最大值是1500，于是从1501到65535的值可用于类型段标识符。  

# 4.高速以太网  

速率达到或超过 $100\,\mathrm{{Mb/s}}$ 的以太网称为高速以太网，表33列出了几种高速以太网技术。  

表3.3几种高速以太网技术
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c6d6e330faf79cc8e82e7e93152cc261305eb48d81b2a32610c15a7ec1713421.jpg)  

（1）100BASE-T以太网  

命题追踪100BaseT以太网使用的传输介质（2019）  

100BASE-T是在双绞线上传送 $100\mathrm{Mb/s}$ 基带信号的星形拓扑以太网，它仍然使用CSMA/CD协议，又称快速以太网。100BASE-T既支持全双工方式，又支持半双工方式，可在全双工方式下工作而无冲突发生，因此在全双工方式下不使用CSMA/CD协议。  

100BASE-T的MAC帧格式仍然是802.3标准规定的帧格式。保持最短帧长不变，但将一个网段的最大长度减小到 $100\mathrm{m}$ 。帧间最小间隔从原来的 $9.6\upmu\mathrm{s}$ 改为 $0.96\upmu\mathrm{s}$  

（2）吉比特以太网  

吉比特以太网又称千兆以太网，允许在1Gb/s速率下以全双工和半双工两种方式工作。使用802.3协议规定的帧格式。使用双绞线或光纤作为传输介质。在半双工方式下使用CSMA/CD协议，而在全双工方式不使用CSMA/CD协议。与10BASE-T和100BASE-T技术向后兼容。  

（3）10吉比特以太网  

10吉比特以太网的帧格式与10Mb/s、100Mb/s和1Gb/s以太网的顿格式完全相同，还保留了802.3标准规定的以太网最小帧长和最大帧长，以便升级和向后兼容。10吉比特以太网只工作在全双工方式，不存在争用问题，当然也不使用CSMA/CD协议。  

以太网从10Mb/s到10Gb/s的演进证明了以太网是可扩展的（从10Mb/s到10Gb/s）、灵活的（多种传输介质、全/半双工、共享/交换），且易于安装，稳健性好。  

# 3.6.3IEEE802.11无线局域网  

# 1.无线局域网的组成  

无线局域网可分为两大类：有固定基础设施的无线局域网和无固定基础设施的移动自组织网络。所谓“固定基础设施”，是指预先建立的、能覆盖一定地理范围的固定基站。  
# （1）有固定基础设施无线局域网  

对于有固定基础设施的无线局域网，IEEE制定了无线局域网的802.11系列协议标准，包括 $802.11\mathrm{a/b/g/n}$ 等。802.11标准使用星形拓扑，其中心称为接入点（AccessPoint，AP），在MAC层使用CSMA/CA协议。使用802.11系列协议的局域网又称Wi-Fi。  

802.11标准规定无线局域网的最小构件是基本服务集（BasicServiceSet，BSS）。一个基本服务集包括一个接入点和若干移动站。各站在本BSS内的通信，或与本BSS外部站的通信，都必须通过本BSS的AP。上面提到的AP就是基本服务集中的基站（basestation）。安装AP时，必须为其分配一个不超过32字节的服务集标识符（ServiceSetIDentifier，SSID）和一个信道。SSID是指使用该AP的无线局域网的名称。基本服务集覆盖的地理范围称为基本服务区（BasicServiceArea，BSA)，无线局域网的基本服务区的直径一般不超过 $100\mathrm{m}$  

基本服务集可以是孤立的，也可通过AP连接到一个分配系统（DistributionSystem，DS），然后连接到另一个基本服务集，构成一个扩展的服务集（ExtendedServiceSet，ESS）。分配系统的作用是使扩展的服务集对上层的表现就像一个基本服务集。ESS还可通过一种称为Portal（门户）的设备为无线用户提供到有线连接的以太网接入。门户的作用相当于网桥。在图3.26中，移动站A若要和另一个基本服务集中的移动站B通信，则必须经过两个接入点 $\mathrm{AP_{1}}$ 和 $\mathrm{AP}_{2}$ ，即 $\mathrm{A{\rightarrow}A P_{1}{\rightarrow}A P_{2}{\rightarrow}B}$ ，注意 $\mathrm{AP_{1}}$ 到AP2的通信是使用有线传输的。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/9eb5ed824fc2a3b0a59ba485fd71622971ce829bb5fd78ba76982d77f4d615a1.jpg)  
图3.26基本服务集和扩展服务集  

当移动站A从某个基本服务集漫游到另一个基本服务集时（图3.26中的A'），仍可保持与另一个移动站B的通信。但A在不同的基本服务集中使用的AP改变了。  

# （2）无固定基础设施移动自组织网络  

另一种无线局域网是无固定基础设施的无线局域网，又称自组网络（adhocnetwork）。自组网络没有上述基本服务集中的AP，而有由一些平等状态的移动站相互通信组成的临时网络（见图3.27）。各结点之间地位平等，中间结点都为转发结点，因此都具有路由器的功能。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/5e9beabbfb4f9fccf1dcc1a93424962aa72ecf19782692558da976e534935427.jpg)  
图3.27由一些处于平等状态的便携机构成的自组网络  
自组网络通常是这样构成的：一些可移动设备发现在它们附近还有其他的可移动设备，且要求和其他移动设备进行通信。自组网络中的每个移动站都要参与网络中其他移动站的路由发现和维护，同时由移动站构成的网络拓扑可能随时间变化很快，因此在固定网络中行之有效的一些路由选择协议对移动自组网络已不适用，需引起特别的关注。  

自组网络和移动IP并不相同。移动ⅡP技术使漫游的主机可用多种方法连接到因特网，其核心网络功能仍然基于固定网络中一直使用的各种路由选择协议。而自组网络是将移动性扩展到无线领域中的自治系统，具有自己特定的路由选择协议，且可以不和因特网相连。  

# 2.802.11局域网的MAC帧  

802.11帧共有三种类型，即数据帧、控制帧和管理帧。数据帧的格式如图3.28所示。  

802.11数据顺由以下三部分组成：  

1）MAC首部，共30字节。帧的复杂性都在MAC首部。  

2）顿主体，即顿的数据部分，不超过2312字节。它比以太网的最大长度长很多。  

3）顿检验序列FCS是MAC尾部，共4字节。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/3f40c912ceedd23f85edb5439bf521f26f450fa378bb77273726767fa923d3b9.jpg)  

# 命题追踪802.11数据帧前三个地址的含义（2017、2022）  

802.11帧的MAC首部中最重要的是4个地址字段（都是MAC地址）。这里仅讨论前三个地址（地址4用于自组网络）。这三个地址的内容取决于帧控制字段中的“去往AP”和“来自AP”这两个字段的数值。表3.4中给出了802.11帧的地址字段最常用的两种情况。  

表3.4802.11帧的地址字段最常用的两种情况
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f3eaebbc5f5d12579fab4e4c209783bca0171b7a4b8180336806e93b3506e840.jpg)  

地址1是直接接收数据帧的结点地址，地址2是实际发送数据帧的结点地址。1）现在假定从一个BSS中的A站向B站发送数据帧。在A站发往AP的数据帧的帧控制字  

段中，“去往 $\mathrm{AP}\!=\!1$ ”而“来自 $\scriptstyle\mathrm{AP}\,=\,0^{\,\ast}$ ；地址1是AP的MAC地址，地址2是A站的MAC地址，地址3是B站的MAC地址。注意，“接收地址”与“目的地址”并不等同。2）AP接收到数据帧后，转发给B站，此时在数据帧的帧控制字段中，“去往 $\scriptstyle\mathrm{AP}\,=\,0$ ”而“来自 $\mathrm{AP}\!=\!1^{\mathrm{~\prime}}$ "；地址1是B站的MAC地址，地址2是AP的MAC地址，地址3是A站的MAC地址。注意，“发送地址”与“源地址”也不等同。  

对这三个地址的理解方法如下：地址1和地址2分别是无线通信中信道两端的接收地址和发送地址。当主机发往AP时，接收地址不是实际的目的地址，因此用地址3来存放实际的目的地址；当AP发往主机时，发送地址不是实际的源地址，因此用地址3来存放实际的源地址。  
下面讨论一种更复杂的情况。在图3.29中，两个AP有线连接到路由器，现在路由器要向A站发送数据。路由器是网络层设备，它看不见链路层的AP，只认识A站的IP地址。而AP是链路层设备，它只认识MAC地址，而不认识IP地址。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/e7f833269a3e7b7cb8b5ed61e42cde3731f90a609e1648ec60c7c6c56d6e5f14.jpg)  
图3.29链路上的802.11帧和802.3帧  

1）路由器从IP数据报获知A站的IP地址，并用ARP获取A站的MAC地址。获取A站的MAC地址后，路由器接口R1将该IP数据报封装成802.3帧（802.3帧只有两个地址），该帧的源地址字段是R1的MAC地址，目的地址字段是A站的MAC地址。2）AP收到该802.3帧后，将该802.3帧转换为802.11帧，在顿控制字段中，“去往 $\scriptstyle\mathrm{AP}\,=\,0$ 而“来自  $\mathrm{AP}\!=\!1$  "；地址1是A站的MAC地址，地址2是AP的MAC地址，地址3是 R1的MAC地址。这样，A站就可以确定（从地址3）将数据报发送到子网中的路由器接口的MAC地址。  

现在考虑从A站向路由器接口R1发送数据的情况。  

1）A站生成一个802.11帧，在帧控制字段中，“去往 $\mathrm{AP}\!=\!1$ ”而“来自 $\scriptstyle\mathrm{AP}\,=\,0$ "；地址1是AP的MAC地址，地址2是A站的MAC地址，地址3是R1的MAC地址。2）AP收到该802.11帧后，将其转换为802.3帧。该帧的源地址字段是A站的MAC地址，目的地址字段是R1的MAC地址。  

由此可见，地址3在BSS和有线局域网互连中起关键作用，它充许AP在构建以太网帧时确定目的MAC地址。  

802.11帧的MAC首部的其他字段不是考查重点，感兴趣的同学可以翻阅教材。  

# 3.6.4VLAN基本概念与基本原理  

一个以太网是一个广播域，当一个以太网中包含的计算机太多时，往往会导致：  

以太网中出现大量的广播帧，特别是经常使用的ARP和DHCP协议（第4章）。一个单位的不同部门共享一个局域网，对信息保密和安全不利。通过虚拟局域网（VirtualLAN，VLAN)，可将一个较大的局域网分割成一些较小的与地理位置无关的逻辑上的VLAN，而每个VLAN是一个较小的广播域。  

有以下三种划分VLAN的方式：  

1）基于接口。将交换机的若干接口划为一个逻辑组，这种方法最简单、最有效，若主机离开了原来的接口，则可能进入一个新的子网。2）基于MAC地址。按MAC地址将一些主机划分为一个逻辑子网，当主机的物理位置从一个交换机移动到另一个交换机时，它仍属于原来的子网。3）基于IP地址。根据网络层地址或协议划分VLAN，这样的VLAN可以跨越路由器进行扩展，将多个局域网的主机连接在一起。  
802.3ac标准定义了支持VLAN的以太网帧格式的扩展。它在以太网帧中插入一个4字节的标识符（插在源地址字段和类型字段之间），称为VLAN标签，用来指明发送该顿的计算机属于哪个虚拟局域网。插入VLAN标签的帧称为802.1Q顿，如图3.30所示。因为VLAN帧的首部增 加了4字节，所以以太网的最大帧长从原来的1518字节变为1522字节。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/1fa3727e65c66ef56fbed43250bdacfe8219a92ec3a163fb8a0fb3a860dc6465.jpg)  
图3.30插入VLAN标签后变成了802.1Q帧  

VLAN标签的前两个字节总是置为 $0x8100$ ，表示这是一个802.1Q帧。在VLAN标签的后两个字节中，前4位实际上并没什么作用，这里不讨论，后12位是该VLAN的标识符VID，它唯一地标识该802.1Q顺属于哪个VLAN。12位的VID可识别4096个不同的VLAN。插入VLAN标签后，802.1Q帧最后的FCS必须重新计算。  

如图3.31所示，交换机1连接7台计算机，该局域网划分为两个虚拟局域网VLAN-10和VLAN-20，这里的10和20就是802.1Q帧中的VID字段的值，由交换机管理员设定。各主机并不知道自己的VID值（但交换机必须知道），主机与交换机之间交互的都是标准以太网帧。一个VLAN的范围可以跨越不同的交换机，前提是所用的交换机能够识别和处理VLAN。交换机2连接5台计算机，并与交换机1相连。交换机2中的2台计算机加入VLAN-10，另外3台计算机加入VLAN-20。这两个VLAN虽然都跨越了两个交换机，但各自都是一个广播域。  

连接两个交换机接口之间的链路称为汇聚链路或干线链路。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/dd404bb6f4326a5aaef9831d2ab0187e38a5a00c9a33d5c1bef9ca4561b86ddf.jpg)  
图3.31利用以太网交换机构成虚拟局域网  

假定A站向B站发送帧，交换机1根据帧首部的目的MAC地址，识别B站属于本交换机管理的VLAN-10，因此就像在普通以太网中那样直接转发顿。假定A站向E站发送帧，交换机1必须把帧转发到交换机2，但在转发前，要插入VLAN标签，否则交换机2就不知道应把帧转发给哪个VLAN。因此，在于线链路上传送的帧是802.1Q帧。交换机2在向E站转发帧之前，要拿走已插入的VLAN标签，因此E站收到的顿是A站发送的标准以太网帧，而不是802.1Q帧。若A站向C站发送帧，则情况就复杂了，因为这是在不同网络之间的通信，虽然A站和C站都连接到同一个交换机，但是它们已处在不同的网络中（VLAN-10和VLAN-20），需要通过上层的路由器来解决，也可在交换机中嵌入专用芯片进行转发，以便在交换机中实现第3层的转发功能。  

虚拟局域网只是局域网为用户提供的一种服务，并不是一种新型局域网。  
# 3.6.5 本节习题精选  

单项选择题  

01.以下关于以太网的说法中，正确的是（）  

A.以太网的物理拓扑是总线形结构B.以太网提供有确认的无连接服务C.以太网参考模型一般只包括物理层和数据链路层D.以太网必须使用CSMA/CD协议  

02.下列以太网中，采用双绞线作为传输介质的是（）A.10BASE-2 B.10BASE-5 C.10BASE-T D.10BASE-F

 03.下列关于广播式网络的说法中，错误的是（）  

A.共享广播信道B.不存在路由选择问题C.可以不要网络层D.不需要服务接入点  

04.10BaseT以太网采用的传输介质是（）  

A.双绞线B.同轴电缆C.光纤D.微波  

05.若使用5类UTP来设计一个覆盖范围为 $200\mathrm{m}$ 的10BASE-T以太网，则需要采用的设备是（）。  

A.放大器B.中继器C.网桥D.路由器  

06.网卡实现的主要功能在（）  

A.物理层和数据链路层B.数据链路层和网络层C.物理层和网络层D.数据链路层和应用层  

07.每个以太网卡都有自己的时钟，每个网卡在互相通信时为了知道什么时候一位结束、下一位开始，即具有同样的频率，它们采用了（）。  

A.量化机制B.曼彻斯特机制C.奇偶检验机制D.定时令牌机制

08.以下关于以太网地址的描述，错误的是（）  

A.以太网地址就是通常所说的MAC地址 B.MAC地址又称局域网硬件地址C.MAC地址是通过域名解析查得的D.以太网地址通常存储在网卡中  

09.在以太网中，大量的广播信息会降低整个网络性能的原因是（）。  

A.网络中的每台计算机都必须为每个广播信息发送一个确认信息B.网络中的每台计算机都必须处理每个广播信息C.广播信息被路由器自动路由到每个网段D.广播信息不能直接自动传送到目的计算机  

10.同一局域网中的两个设备具有相同的静态MAC地址时，会发生（）。  

A.首次引导的设备排他地使用该地址，第二个设备不能通信B.最后引导的设备排他地使用该地址，另一个设备不能通信C.在网络上的这两个设备都不能正确通信D.两个设备都可以通信，因为它们可以读分组的整个内容，知道哪些分组是发给它们的，而不是发给其他站的  

11.有一个长度为56字节的IP数据报需要通过以太网进行传输，则以太网MAC帧的数据载荷部分需要填充的字节数是（）  
A.0 B.4 C.8 D.12

 12.介质访问控制（MAC）子层的主要功能是（）  

A.提供可靠的数据传输B.控制和协调所有站点对共享介质的访问C.实现数据链路层和物理层之间的接口D.为上层协议提供服务  

13.在以太网中，若网卡发现某个帧的目的MAC地址不是自己的，则（）。  

A.它将该顿递交给网络层，由网络层决定如何处理B.它将丢弃该帧，并向网络层报告错误消息C.它将丢弃该帧，不向网络层报告错误消息D.它将向发送主机发回一个NAK帧  

14.在CSMA/CD以太网中，站点（）进行全双工通信，（）进行半双工通信A.可以，不可以B.可以，可以C.不可以，可以D.不可以，不可以  

15.1EEE802.3标准规定，若采用同轴电缆作为传输介质，在无中继的情况下，传输介质的最大长度不能超过（）。  

A.  $500\mathrm{m}$  B.  $200\mathrm{m}$  C.  $100\mathrm{m}$  D.50m

 16.下面4种以太网中，只能工作在全双工模式下的是（）  

A.10BASE-T以太网B.100BASE-T以太网C.吉比特以太网D.10吉比特以太网  

17.IEEE802局域网标准对应OSI参考模型的（）  

A.数据链路层和网络层B.物理层和数据链路层C.物理层D.数据链路层  

18.在以太网中，实现“给帧加序号”功能的层次是（）  

A.物理层B.介质访问控制子层（MAC）C.逻辑链路控制子层（LLC）D.网络层  

19.快速以太网仍然使用CSMA/CD协议，它采用（）而将最大电缆长度减少到 $100\mathrm{m}$ 的方法，使以太网的数据传输速率提高至100Mb/s。  

A.改变最短帧长B.改变最长帧长C.保持最短帧长不变D.保持最长帧长不变  

20.在传统以太网中，有A、B、C、D四台主机，若A向B发送数据，则除A外（）。  

A.只有B可以接收到数据B.B、C和D都能接收到数据C.只有B不能接收到数据D.B、C和D都不能接收到数据  

21.高速以太网使用的MAC帧格式与标准以太网的帧格式（）A.完全相同B.完全不同C.部分相同D.不确定

22.下列关于吉比特以太网的说法中，错误的是（）。  

A.支持流量控制机制B.采用曼彻斯特编码，利用光纤进行数据传输C.数据的传输时间主要受线路传输延迟的制约D.同时支持全双工模式和半双工模式  

23.下列关于802.1Q帧的描述中，错误的是（）。  

A.在原始的以太网帧中加入一个4字节的标签字段，就构成802.1Q帧B.插入VLAN标签后，以太网的最大帧长也需要保持不变C.VLAN标签中有标识符字段，称为VID，标志该帧属于哪个VLAN D.设置VLAN后，两台主机之间通信也不一定使用802.1Q帧  
24.下列关于VLAN的描述中，错误的是（）。  

A.从数据链路层的角度看，不同VLAN中的主机之间不能直接通信B.属于同一个VLAN中的两个主机可能连接在不同的交换机上C.VLAN只是局域网为用户提供的一种服务，而不是一种新型局域网D.VLAN使用的802.1Q帧的最大长度为1518字节  

25.下列关于虚拟局域网（VLAN）的说法中，不正确的是（）  

A.虚拟局域网建立在交换技术的基础上B.虚拟局域网通过硬件方式实现逻辑分组与管理C.虚拟网的划分与计算机的实际物理位置无关D.虚拟局域网中的计算机可以处于不同的局域网中  

26.划分虚拟局域网（VLAN）有多种方式，（）不是正确的划分方式。  

A.基于交换机接口划分B.基于网卡地址划分C.基于用户名划分D.基于网络层地址划分  

27.下列选项中，（）不是虚拟局域网（VLAN）的优点。  

A.有效共享网络资源B.简化网络管理C.链路聚合D.提高网络安全性  

28.在802.11协议中，MAC帧首部中的地址字段有（）个。A.2B.3C.4D.5

29.在802.11协议中，MAC帧首部中的地址字段的含义和作用取决于（）  

A.帧的类型和子类型B.帧的源和目的站点C.To AP From APD.BS SID S SID  

30.【2012统考真题】以太网的MAC协议提供的是（）  

A.无连接的不可靠服务B.无连接的可靠服务C.有连接的可靠服务D.有连接的不可靠服务  

31.【2017统考真题】在下图所示的网络中，若主机H发送一个封装访问Internet的IP分组的IEEE802.11数据帧F，则帧F的地址1、地址2和地址3分别是（）。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/76b32d8500c84179e2cd5f4dd6a02bb5bc6e98bc61e56531825965f2c3717575.jpg)  

A.00-12-34-56-78-9a,00-12-34-56-78-9b,00-12-34-56-78-9c B.00-12-34-56-78-9b,00-12-34-56-78-9a,00-12-34-56-78-9c C. 00-12-34-56-78-9b,00-12-34-56-78-9c,00-12-34-56-78-9a D.00-12-34-56-78-9a,00-12-34-56-78-9c,00-12-34-56-78-9b  

32.【2019统考真题】100BaseT快速以太网使用的导向传输介质是（）A.双绞线 B.单模光纤 C.多模光纤 D.同轴电缆  
# 3.6.6 答案与解析  

# 单项选择题  

01.C  

以太网的逻辑拓扑是总线形结构，物理拓扑是星形或拓展星形结构，因此A错误。以太网采用两项措施简化通信：采用无连接的工作方式：不对发送的数据帧编号，也不要求接收方发送确认，因此B错误。从相关层次看，局域网仅工作在OSI参考模型的物理层和数据链路层，而广域网工作在OSI参考模型的下三层，且以太网是局域网的一种实现形式，因此C正确。只有当以太网工作于半双工方式下时，才需要CSMA/CD协议来应对冲突问题，速率小于或等于1Gb/s的以太网可工作于半双工或全双工方式，而速率大于或等于10Gb/s的以太网只能工作于全双工方式，因此没有争用问题，不使用CSMA/CD协议，因此D错误。  

02. C  

这里BASE前面的数字代表数据率，单位为 $\mathrm{{MD}}/s$ ：“BASE”指介质上的信号为基带信号（即基带传输，采用曼彻斯特编码）；后面的5或2表示每段电缆的最长长度为 $500\mathrm{m}$ 或 $200\mathrm{m}$ （实际上为 $185\mathrm{m}$ ），T表示双绞线，F表示光纤。  

03.D  

广播式网络使用共享的厂播信道进行通信，通常是局域网的一种通信方式（局域网工作在数据链路层），因此可以不需要网络层，也就不存在路由选择问题。但数据链路层使用物理层的服务必须通过服务接入点，数据链路层向高层提供服务也必须通过服务接入点。  

04.A  

局域网通常采用类似10BaseT的方式来表示，其中第1部分的数字表示数据传输速率，如10表示10Mb/s、100表示 $100\mathbf{M}\mathrm{{b}/\mathrm{{s}}}$ ：第2部分的Base表示基带传输。第3部分若是字母，则表示传输介质，如T表示双绞线、F表示光纤；若是数字，则表示所支持的最大传输距离。  

05.B  

5类无屏蔽双绞线（UTP）所能支持的最大长度是 $100\mathrm{m}$ ，因此若要覆盖范围为 $200\mathrm{m}$ 的以太网，则必须延长UTP所支持的长度。放大器是用来加强宽带信号（用于传输模拟信号）的设备（大多数以太网采用基带传输）；中继器是用来加强基带信号（用于传输数字信号）的设备。  

06.A  

通常情况下，网卡是用来实现以太网协议的。网卡不仅能实现与局域网传输介质之间的物理连接和电信号匹配，还涉及倾的发送与接收、顿的封装与拆封、介质访问控制、数据的编码与解码及数据缓存等功能，因此实现的功能主要在物理层和数据链路层。  

07.B  

10BASE-T以太网使用曼彻斯特编码。曼彻斯特编码提取每个比特中间的电平跳变作为收发双方的同步信号，不需要额外的同步信号，是一种“自含时钟编码”的编码方式。  

08.C  

域名解析用于将主机名解析成对应的IP地址，它不涉及MAC地址。实际上，MAC地址通常是通过ARP协议查得的。  

# 09.B  

因为广播信息的目的地是该网络中的所有计算机，所以网络中的每台计算机都必须花时间来处理这些信息，若网络中存在大量的广播信息，则所有计算机的运行效率都会受到影响，导致网络性能降低。广播信息通常只在一个网络内部传输。以太网提供无确认的无连接服务，每台计算机无须对广播信息进行确认，A错误。路由器可以隔离广播域，C错误。D的说法正确，但这不是大量广播信息而降低网络性能的原因，因此不选D。  
10.C  

在同一个局域网中，两个设备具有相同的MAC地址，若这两个设备通过交换机相互发送帧，则根据交换机的原理，目的MAC地址等于本机MAC地址的顿将被交换机丢弃。当其他设备向这两个设备中的一个发送帧时，另一个设备也收到顺，而网卡在与本机MAC地址比较后，都认为是属于自己的顺。因此，导致这两个设备无法正常通信。  

11. A  

以太网MAC帧的数据载荷部分的长度必须在46字节和1500字节之间，若小于46字节，则需要填充字节来达到最小长度。IP数据报的长度为56字节，因此不需要填充字节。  

12.B  

介质访问控制（MAC）子层的主要功能是控制和协调所有站点对共享介质的访问。能否实现带确认的可靠传输服务与介质访问控制子层无关。  

13. C  

当网卡收到一个帧时，首先检查该顿的目的MAC地址是否与当前网卡的物理地址相同，若相同，则做下一步处理；若不同，则直接丢弃，并不需要向网络层报告错误消息。  

14.C  

CSMA/CD协议是一种用于解决共享介质上的冲突问题的方法，它在半双工通信中使用，而在全双工通信中无须用到CSMA/CD协议。因此站点可以进行半双工通信，不可以进行全双工通信。  

15.A  

以太网常用的传输介质有4种：粗缆、细缆、双绞线和光纤。同轴电缆分50Q基带电缆和75Q宽带电缆两类。基带电缆又分细同轴电缆和粗同轴电缆。  

10Base5：粗缆以太网，数据率为 $10\mathrm{Mb/s}$ ，每段电缆最大长度为 $500\mathrm{m}$ ：使用特殊的收发器连接到电缆上，收发器完成载波监听和冲突检测的功能。10Base2：细缆以太网，数据率为10Mb/s，每段电缆最大长度为 $185\mathrm{m}$ ：使用BNC连接器形成T形连接，无源部件。  

16.D  

10BASE-T以太网、100BASE-T以太网、吉比特以太网都使用CSMA/CD协议，因此可以工作在半双工模式。10吉比特以太网只工作在全双工方式，没有争用问题，也不使用CSMA/CD协议，并且只使用光纤作为传输介质。  

17.B  

IEEE802为局域网制定的标准相当于OSI参考模型的数据链路层和物理层，其中的数据链路层又被进一步分为逻辑链路控制（LLC）和介质访问控制（MAC）两个子层。  

18.C  

以太网没有网络层。物理层的主要功能是：信号的编码和译码、比特的接收和传输；MAC子层的主要功能是：组顿和拆帧、比特差错检测、寻址、竞争处理；LLC子层的主要功能是：建立和释放数据链路层的逻辑连接、提供与高层的接口、差错控制、给帧加序号（待确认的服务）。  

19. C  

快速以太网使用的方法是保持最短帧长不变，将一个网段的最大长度减少到 $100\mathrm{m}$ ，以提高以太网的数据传输速率。  
20.B  

在传统以太网中，若一个结点要发送数据，则它以“广播”方式把数据通过作为公共传输介质的总线发送出去，连在总线上的所有结点都能“听”到发送结点发送的数据信号。  

21.A 高速以太网的MAC帧格式与标准以太网的帧格式完全相同，以便升级和向后兼容。  

22.B  

吉比特以太网的物理层有两个标准：IEEE802.3z和IEEE802.3ab，前者采用光纤通道，后者采用4对UTP5类线。  

23.B  

A和C是VLAN的规定。插入VLAN标签后，以太网的最大帧长变为1522字节。802.1Q倾用于干线链路，若同一个交换机下的同一个VLAN的两台主机通信，则不使用802.1Q帧。  

24.D  

802.1Q帧在以太网帧的基础上增加了4字节的VLAN标签，所以最大长度也增加了4字节。因此，VLAN使用的802.1Q帧的最大长度为1522字节而非1518字节。  

25.B  

VLAN建立在交换技术的基础上，以软件方式实现逻辑分组与管理，VLAN中的计算机不受物理位置的限制。当计算机从一个VLAN转移到另一个VLAN时，只需简单地通过软件设定，而无须改交它在网络中的物理位置。同一个VLAN的计算机不一定连接到相同的物理网段，它们可连接到相同的交换机，也可连接到不同的局域网交换机，只要这些交换机互连即可。  

26.C  

一般有三种划分VLAN的方法： $\textcircled{\scriptsize{1}}$ 基于接口； $\circledcirc$ 基于MAC地址：基于IP地址。  

27. C  

带“虚拟”两个字的基本上都有一个优点，即有效共享资源。通过虚拟局域网，可将一个较大的局域网分割成一些较小的与地理位置无关的逻辑上的虚拟局域网，而每个虚拟局域网都是一个较小的局域网，因此简化了网络管理，提高了信息的保密性和网络的安全性。链路聚合是解决交换机之间的宽带瓶颈问题的技术，而不是虚拟局域网的技术。  

28. C  

802.11顿首部中的地址字段有4个，分别是地址1、地址2、地址3和地址4。  

29. C  

802.11顿首部中的地址字段的含义和作用取决于帧的ToDS和FromDS位。  

30. A  

考虑到局域网信道质量好，以太网来取了两项重要的措施来使通信更简单： $\textcircled{\scriptsize{1}}$ 采用无连接的工作方式； $\textcircled{2}$ 不对发送的数据帧进行编号，也不要求对方发回确认。因此，以太网提供的服务是不可靠的服务，即尽最大努力的交付。差错的纠正由高层完成。  

31.B  

802.11顿首部的地址字段最常用的两种情况如下表所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/90542d4151c6abc30ce3bc463502e3d0646278c72fb3e86373c8b2e156db2f5b.jpg)  
帧F是由H站发送到AP的，即“去往 $\mathrm{AP}\!=\!1$ ”而“来自 $\scriptstyle\mathrm{AP}\,=\,0$ ”。因此，地址1是AP的MAC地址，地址2是H站的MAC地址，地址3是R站的MAC地址。  

32.A  

100Base-T是一种以速率 $100\mathrm{{Mb/s}}$ 工作的快速以太网标准，且使用UTP（非屏蔽双绞线）铜质电缆。100Base-T：100标识传输速率为 $100\mathrm{Mb/s}$ ：base标识采用基带传输：T表示传输介质为双绞线（包括5类UTP或1类STP），为F时表示光纤。  

# 3.7广域网  

# 3.7.1广域网的基本概念  

广域网（WideAreaNetwork，WAN）通常是指覆盖范围很广（远超一个城市的范围）的长距离网络，任务是长距离运送主机所发送的数据。连接厂域网各结点交换机的链路都是高速链路广域网首要考虑的问题是通信容量必须足够大，以便支持日益增长的通信量。  

广域网不等于互联网。互联网可以连接不同类型的网络，通常使用路由器来连接。图3.32显示了由相距较远的局域网通过路由器与广域网相连而成的一个覆盖范围很广的互联网。因此，局域网可以通过广域网与另一个相隔很远的局域网通信。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/fa20b8aff01d6411522b5859a6d1ef29ac82c032e885c56b3830863eac73e4c8.jpg)  
图3.32由局域网和广域网形成的互联网  

广域网由一些结点交换机（注意不是路由器，结点交换机和路由器都用来转发分组，它们的工作原理也类似。结点交换机在单个网络中转发分组，而路由器在多个网络构成的互联网中转发分组）及连接这些交换机的链路组成。结点交换机的功能是存储并转发分组。结点之间都是点到点连接，但为了提高网络的可靠性，通常一个结点交换机往往与多个结点交换机相连。  

从层次上考虑，广域网和局域网的区别很大，因为局域网使用的协议主要在数据链路层（还有少量在物理层），而广域网使用的协议主要在网络层。怎么理解“局域网使用的协议主要在数据链路层，而厂域网使用的协议主要在网络层”这句话呢？若网络中的两个结点要进行数据交换，则结点除了要给出数据，还要给数据“包装”上一层控制信息，用于实现传输控制等功能。若这层控制信息是数据链路层协议的控制信息，则称使用了数据链路层协议：若这层控制信息是网络层的控制信息，则称使用了网络层协议。  

广域网和局域网的区别与联系见表3.5。  
表3.5广域网和局域网的区别与联系
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/5405276467369b2d85907054b6143b147698e5110094dc13809916dce8e72eac.jpg)  

在通信线路质量较差的年代，能实现可靠传输的高级数据链路控制（HDLC）成为当时比较流行的数据链路层协议。但对现在误码率很低的点对点有线链路，更简单的点对点协议（PPP）则是目前使用最广泛的数据链路层协议。HDLC已从最新大纲中删除，所以本书不再介绍。  

# 3.7.2PPP协议  

点对点协议（Point-to-PointProtocol，PPP）是现在最流行的点对点链路控制协议。主要有两种应用： $\textcircled{\scriptsize{1}}$ 用户通常都要连接到某个ISP才能接入互联网，PPP协议就是用户计算机与ISP通信时所用的数据链路层协议： $\circledcirc$ 广泛用于广域网路由器之间的专用线路。  

PPP协议有三个组成部分：  

1）一个链路控制协议（LCP）。用来建立、配置、测试数据链路连接，以及协商一些选项。  

2）一套网络控制协议（NCP）。PPP协议充许采用多种网络层协议，每个不同的网络层协议要用一个相应的NCP来配置，为网络层协议建立和配置逻辑连接。  

3）一种将IP数据报封装到串行链路的方法。IP数据报在PPP帧中就是其信息部分，这个信息部分的长度受最大传送单元（MTU）限制。  

PPP帧的格式如图3.33所示，首部和尾部分别为4个字段和2个字段。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/1e8d91d9da44885d266b032830b73b1f319582eddaad40c563b504eeddffc9ef.jpg)  
图3.33PPP帧的格式  

首部和尾部各有一个标志字段（F），规定为0x7E（01111110），它表示一个帧的开始和结束，即PPP顿的定界符。当标志字段出现在信息段中时，就必须采取一些措施使这种形式上和标志字段一样的比特组合不出现在信息段中。当PPPP使用异步传输时，采用字节填充法，使用的转义字符是0x7D（01111101）。当PPP使用同步传输时，采用零比特填充法来实现透明传输。  

地址字段（A）占1字节，规定为0xFF，控制字段（C）占1字节，规定为0x03，这两个字段的意义暂未定义。PPP是面向字节的，因此所有PPP帧的长度都是整数个字节。  

第四个字段是协议段，占2字节，它表示信息段运载的是什么种类的分组。若为0x0021，则信息字段是IP数据报。若为 $\mathrm{0xC021}$ ，则信息字段是PPP链路控制协议（LCP）的数据。  

第五段信息段的长度是可变的，长度为 $\mathord{0}\mathord{\sim}\!1500$ 字节。  
# 注意  

因为PPP是点对点的，并不是总线形，所以无须使用CSMA/CD协议，自然就不会有最短帧长的限制，所以信息段占 $0\sim1500$ 字节，而不是46\~1500学节。  

第六个字段是顿检验序列（FCS），占2字节，是使用CRC检验的几余码。图3.34给出了PPP协议的状态图。具体解释如下：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/d94ee3aeefa6ea19b8d920eb532cdff20689de0539f58617c2802450a1044797.jpg)  
图3.34PPP协议的状态图  

1）当处于链路静止状态时，通信双方不存在物理层的连接2）当链路一方检测到载波信号并建立物理连接时，进入链路建立状态。  

3）在链路建立状态下，链路控制协议（LCP）开始协商一些配置选项（包括最大顿长、鉴别协议等）。若协商成功，则进入鉴别状态。若协商失败，则退回到链路静止状态。  

4）协商成功后，双方就建立了LCP链路，接着进入“鉴别”状态。若双方无须鉴别或鉴别身份成功，则进入网络层协议状态。若鉴别失败，则进入链路终正状态。  

5）处于网络层协议状态后，双方采用NCP配置网络层，配置协商成功后，进入链路打开状态。6）只要链路处于打开状态，双方就可进行数据通信。  

7）数据传输结束后，链路一方发出终正请求且在收到对方发来的终止确认后，或者链路出现故障时，进入链路终止状态。载波停止后，回到链路静止状态。  

PPP协议的特点如下：  

1）PPP不使用序号和确认机制，只保证无差错接收（CRC检验），因此是不可靠服务。2）PPP只支持全双工的点对点链路，不支持多点线路。3）PPP的两端可以运行不同的网络层协议，但仍可使用同一个PPP进行通信。4）PPP是面向字节的，所有PPP帧的长度都是整数个字节。  

# 3.7.3 本节习题精选  

# 单项选择题  

01.局域网和广域网的差异不仅在于它们所覆盖的范围不同，还主要在于它们（）  

A.所使用的介质不同B.所使用的协议不同C.所能支持的通信量不同D.所提供的服务不同  

A.报文交换技术B.分组交换技术C.文件交换技术D.电路交换技术  
03.广域网所使用的传输方式是（）  

A.广播式B.存储转发式C.集中控制式D.分布控制式  

04.广域网的拓扑结构通常采用（）  

A.星形B.总线形C.网状D.环形  

05.现在大量的计算机是通过诸如以太网这样的局域网连入广域网的，而局域网与广域网的互连是通过（）实现的。  

A.路由器B.资源子网C.桥接器D.中继器06.下列协议中不属于TCP/IP协议族的是（）A.ICMP B.TCP C.FTP D.HDLC 07.为实现透明传输（默认为异步线路），PPP使用的填充方法是（）  

A.位填充 B.字符填充 C.对字符数据使用字符填充，对非字符数据使用位填充D.对字符数据使用位填充，对非字符数据使用字符填充  

08.以下对PPP的说法中，错误的是（）。  

A.具有差错控制能力B.仅支持IP协议C.支持动态分配IP地址D.支持身份验证  

09.PPP协议提供的功能有（）  

A.一种组帧方法B.链路控制协议（LCP）C.网络控制协议（NCP）D.A、B和C都是  

10.PPP协议中的LCP帧的作用是（）  

A.在建立状态阶段协商数据链路协议的选项B.配置网络层协议C.检查数据链路层的错误，并通知错误信息D.安全控制，保护通信双方的数据安全  

11.下列关于PPP协议的叙述中，正确的是（）。  

A.PPP协议是网络层协议B.PPP协议支持半双工或全双工通信C.PPP协议两端的网络层必须运行相同的网络层协议D.PPP协议是面向字节的协议  

12.PPP协议提供的是（）。  

A.无连接的不可靠服务B.无连接的可靠服务C.有连接的不可靠服务D.有连接的可靠服务  

# 3.7.4 答案与解析  

单项选择题  

01.B  

广域网和局域网之间的差异不仅在于它们所覆盖范围的不同，还在于它们所采用的协议和网络技术的不同，广域网使用点对点等技术，局域网使用广播技术。  

02.B  

广域网的通信子网主要使用分组交换技术，将分布在不同地区的局域网或计算机系统互连起来，达到资源共享的目的。  
03.B  

广域网通常指覆盖范围很广的长距离网络，它由一些结点交换机及连接这些交换机的链路组成，其中结点交换机执行分组存储、转发功能。  

04.C  

广域网覆盖范围较广、结点较多，为了保证可靠性和可扩展性，通常需采用网状结构。  

05.A  

中继器和桥接器通常是指用于局域网的物理层和数据链路层的联网设备。目前局域网接入广域网主要是通过称为路由器的互连设备实现的。  

06.D  

TCP/IP TCP、IP、ICMP、IGMP、ARP、RARP、UDP、DNS、FTP、HTTP等。HDLC是ISO提出的一个面向比特型的数据链路层协议，它不属于TCP/IP协议族。  

07.B  

PPP是一种面向字节的协议，所有的帧长都是整数个字节，使用一种特殊的字符填充法完成数据的填充。  

08.B  

PPP提供差错检测功能，但不提供纠错功能。PPP两端的网络层可以运行不同的网络层协议，但仍能使用同一个PPP进行通信。PPP可用于拨号连接，因此支持动态分配IP地址。PPP双方建立LCP链路后，接着进入身份鉴别状态（可选）。  

09.D  

PPP协议主要由三部分组成： $\textcircled{\scriptsize{1}}$ 链路控制协议（LCP）； $\circledcirc$ 网络控制协议（NCP）； $\textcircled{3}$ 一个将IP数据报封装到事行链路的方法。因此，选项A、B、C都正确。  

10.A  

PPP协议顿在默认配置下，地址和控制域总是常量，所以LCP提供了必要的机制，允许双方协商一个选项。在建立状态阶段，LCP协商数据链路协议中的选项，它并不关心这些选项本身，只提供一个协商选择的机制。  

11.D  

PPP协议是数据链路层协议，A错误。根据PPP协议的特点可知B、C错误，D正确  

12.C  

PPP协议是一种面向连接的点对点数据链路层协议，但它是不可靠的，因为它不使用序号和确认机制，因此PPP协议提供的是有连接的不可靠服务。  

# 3.8数据链路层设备  

#  ${\bf\Psi}^{*}3.8.1$ 网桥的基本概念  

使用集线器在物理层扩展以太网会形成更大的冲突域。为了避免这个问题，可以使用网桥在数据链路层扩展以太网，而原来的每个以太网称为一个网段。使用网桥进行扩展时，不会将原本独立的两个冲突域合并成一个更大的冲突域，这是因为网桥具有识别顿和转发顿的能力，根据顺首部中的目的MAC地址和网桥的帧转发表来转发或丢弃所收到的顿，起到了过滤通信量的功能。因为各个网段是相对独立的，所以一个网段的故障不影响另一个网段的运行。  
网络1和网络2通过网桥连接后，网桥接收网络1发送的数据顿，检查数据帧中的地址，若是网络2的地址，则转发给网络2；若是网络1的地址，则将其丢弃，因为源站和目的站处在同一个网段，目的站能够直接收到这个帧，而不需要借助网桥转发。  

网桥是早期的数据链路层设备，现已被以太网交换机取代，最新大纲中已将其删除。  

# 3.8.2以太网交换机  

# 1.交换机的原理和特点  

以太网交换机也称二层交换机，二层是指以太网交换机工作在数据链路层。以太网交换机实质上是一个多接口的网桥，它能将网络分成小的冲突域，为每个用户提供更大的带宽。对于传统使用集线器的共享式10Mb/s以太网，若共有 $N$ 个用户，则每个用户的平均带宽为总带宽（ $10\,\mathrm{{Mb/s}}\,\mathrm{{)}}$ 的1/N。使用以太网交换机（全双工方式）连接这些主机时，虽然从每个接口到主机的带宽还是 $10\mathrm{Mb/s}$ ，但是因为一个用户通信时是独占带宽的（而不是和其他网络用户共享传输介质带宽的），所以拥有 $N$ 个接口的交换机的总容量为 $N{\times}10\mathrm{M}\mathrm{b}/\mathrm{s}$ 。这正是交换机的最大优点。  

# 命题追踪以太网交换机的特点（2015）  

以太网交换机的特点：  

1）当交换机的接口直接与主机或其他交换机连接时，可工作在全双工方式，并能同时连通多对接口，使每对相互通信的主机都能像独占通信介质那样，无冲突地传输数据，这样就不需要使用CSMA/CD协议。2）当交换机的接口连接集线器时，只能使用CSMA/CD协议且只能工作在半双工方式。当前的交换机和计算机中的网卡都能自动识别上述两种情况。3）交换机是一种即插即用设备，其内部的帧转发表是通过自学习算法，基于网络中各主机间的通信，自动地逐渐建立的。4）交换机因为使用专用交换结构芯片，交换速率较高。  

5）交换机独占传输介质的带宽。  

# 命题追踪直通交换方式的转发时延的分析（2013）  

以太网交换机主要采用两种交换模式：  

1）直通交换方式。只检查帧的目的MAC地址，以决定该帧的转发接口。这种方式的交换时延非常小，缺点是它不检查差错就直接转发，因此可能将一些无效顺转发给其他站。直通交换方式不适用于需要速率匹配、协议转换或差错检测的线路。  

2）存储转发交换方式。先将接收到的帧缓存到高速缓存器中，并检查数据是否正确，确认无误后通过查找表转换为输出接口，以便将该帧发送出去。若发现帧有错，则将其丢弃。优点是可靠性高，且能支持不同速率接口间的转换，缺点是时延较大。  

交换机一般都具有多种速率的接口，如10Mb/s、100Mb/s的接口，以及多速率自适应接口。  

# 2.交换机的自学习功能  

# 命题追踪以太网交换机转发决策时使用的PDU地址（2009）  

决定一个顿是转发到某个接口还是丢弃它称为过滤。决定一个帧应被移至哪个接口称为转发。交换机的过滤和转发借助交换表（switchtable）完成。交换表中的一个表项至少包含： $\textcircled{\scriptsize{1}}$ 一个MAC地址； $\textcircled{2}$ 连通该MAC地址的接口。例如，在图3.35中，以太网交换机有4个接口，各连接一台计算机，MAC地址分别为A、B、C和D，交换机的交换表最初为空。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/53ad90e0fe9307244331a3e9fee9dbea78bb5927bafa54f29fc77ee3e117e528.jpg)  
图3.35以太网交换机中的交换表  

# 命题追踪交换机自学习的过程（2014、2016、2021）  

A先向B发送一帧，从接口1进入交换机。交换机收到帧后，查找交换表，找不到MAC地址为B的表项。然后，交换机将该帧的源地址A和接口1写入交换表，并向除接口1外的所有接口广播这个顺（该帧就是从接口1进入的，因此不应将它再从接口1转发出去）。C和D丢弃该顿，因为目的地址不对。只有B才收下这个目的地址正确的帧。交换表中写入（A，1）后，从任何接口收到目的地址为A的帧都应从接口1转发出去。这是因为，既然A发出的顿从接口1进入交换机，那么从接口1转发出去的帧也应能到达A。  

接下来，假定B通过接口3向A发送一帧，交换机查找交换表后，发现有表项（A，1），将该帧从接口1转发给A。显然，此时已没有必要再广播收到的帧。将该帧的源地址B和接口3写入交换表，表明以后若有发送给B的帧，则应从接口3转发出去。  

经过一段时间后，只要C和D也向其他主机发送帧，交换机就把C和D及对应的接口号写入交换表。这样，转发给任何主机的帧，就都能很快地在交换表中找到相应的转发接口。  

因为交换机所连的主机会随时变化，所以需要更新交换表中的表项。为此，交换表中的每个表项都设有一定的有效时间，过期表项将被自动删除。这就保证了交换表中的数据符合当前网络的实际状况。这种自学习算法使得交换机能即插即用，而不必手工配置，因此非常方便。  

# 3.共享式以太网和交换式以太网的对比  

# 命题追踪集线器与交换机连接的网段的区别（2016）  

假设交换机已通过自学习算法遂步建立了完整的转发表，下面举例说明使用集线器的共享式以太网与全部使用交换机的交换式以太网的区别。  

1）主机发送普通顿。对于共享式以太网，集线器将帧转发到其他所有接口，其他各主机中的网卡根据帧的目的MAC地址决定接收或丢弃该帧。对于交换式以太网，交换机收到帧后，根据帧的目的MAC地址和自身的交换表将帧明确地转发给目的主机。  

2）主机发送广播帧。对于共享式以太网，集线器将顿转发到其他所有接口，其他各主机中的网卡检测到帧的目的MAC地址是广播地址时，就接收该顿。对于交换式以太网，  
交换机检测到帧的目的MAC地址是广播地址，于是从其他所有接口转发该顿，其他各主机收到该广播顿后，就接收该帧。两种情况从效果上看是相同的，但它们的原理并不相同。  

3）多对主机同时通信。对于共享式以太网，当多对主机同时通信时，必然产生冲突。对于交换式以太网，交换机能实现多对接口的高速并行交换，因此不会产生冲突。  

# 命题追踪集线器和交换机对冲突域/广播域的隔离（2020、2022）  

可见，集线器既不隔离广播域，又不隔离冲突域，而交换机不隔离广播域，但隔离冲突域。  

# 3.8.3 本节习题精选  

# 单项选择题  

01.下列网络连接设备都工作在数据链路层的是（）。  

A.中继器和集线器 B.集线器和网桥 C.网桥和局域网交换机D.集线器和局域网交换机  

02.下列关于数据链路层设备的叙述中，错误的是（）。  

A.交换机将网络划分成多个网段，一个网段的故障不会影响到另一个网段的运行B.交换机可互连不同的物理层、不同的MAC子层及不同速率的以太网C.交换机的每个接口结点所占用的带宽不会因为接口结点数目的增加而减少，且整个交换机的总带宽会随着接口结点的增加而增加D.利用交换机可以实现虚拟局域网（VLAN），VLAN可以隔离冲突域，但不能隔离广播域  

03.下列（）不是使用交换机分割网络所带来的好处。  

A.减少冲突域的范围B.在一定条件下增加了网络的带宽C.过滤网段之间的数据D.缩小了广播域的范围  

04.下列不能分割冲突域的设备是（）  

A.集线器 B.交换机 C.路由器 D.网桥  

05.局域网交换机实现的主要功能在（）  

A.物理层和数据链路层B.数据链路层和网络层C.物理层和网络层D.数据链路层和应用层  

06.交换机比集线器提供更好的网络性能的原因是（）  

A.交换机支持多对用户同时通信B.交换机使用差错控制减少出错率C.交换机使网络的覆盖范围更大D.交换机无须设置，使用更方便  

07.通过交换机连接的一组工作站（）  

A.组成一个冲突域，但不是一个广播域B.组成一个广播域，但不是一个冲突域C.既是一个冲突域，又是一个广播域D.既不是冲突域，又不是广播域  

08.一个16接口的集线器的冲突域和广播域的个数分别是（）A.16,1 B.16,16 C.1,1 D.1,16

 09.一个16个接口的以太网交换机，冲突域和广播域的个数分别是（）A.1,1 B.16,16 C.1,16 D.16,1  

10.对于由交换机连接的10Mb/s共享式以太网，若共有10个用户，则每个用户能够占有的带宽为（）。  
A.1Mb/s B.2Mb/s C.10Mb/s D.100Mb/s  

11.若一个网络采用一个具有24个 $10\mathrm{Mb/s}$ 接口的半双工交换机作为连接设备，则每个连接点平均获得的带宽为（ $\textcircled{\scriptsize{1}}$ ），该交换机的总容量为（ $\circledcirc$ 一。  

$\textcircled{\scriptsize{1}}$  A.0.417Mb/s B.0.0417Mb/s C.  $4.17\mathrm{Mb/s}$  D.10Mb/s  $\circledcirc$  A.120Mb/s B.240Mb/s C.10Mb/s D.24Mb/s  

12.假设以太网A中 $80\%$ 的通信量在本局域网内进行，其余 $20\%$ 在本局域网与因特网之间进行，而以太网B正好相反。在这两个局域网中，一个使用集线器，另一个使用交换机则交换机应放置的局域网是（）。  

A.以太网A B.以太网B C.任意以太网 D.都不合适

 13.在使用以太网交换机的局域网中，以下（）是正确的。  

A.局域网中只包含一个冲突域B.交换机的多个接口可以并行传输C.交换机可以隔离广播域D.交换机根据LLC目的地址转发  

14.以太网交换机的自学习功能是指（）  

A.记录帧的源MAC地址与该帧进入交换机的接口号B.记录帧的目的MAC地址与该帧进入交换机的接口号C.记录分组的源IP地址与该分组进入交换机的接口号D.记录分组的目的IP地址与该分组进入交换机的接口号  

15.当以太网交换机某接口收到帧时，若在交换表中未找到目的MAC地址，则（）。  

A.将帧发送到特定接口进行ARP查询B.丢弃该帧C.将帧发送到除本接口外的所有接口D.将帧发送给DHCP服务器  

16.某以太网如下图所示，假设交换机1和交换机2的交换表初始为空，各主机之间依次进行以下通信： $\scriptstyle\mathrm{A}\to\mathrm{B}$  $\mathrm{H}{\to}\mathrm{A}$ 、 $\mathrm{E{\rightarrow}X}$ 、 $\mathrm{X}{\rightarrow}\mathrm{E}$ ，则关于上述通信过程叙述错误的是（）。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/ba27d7450a04ac8214ad3de31d179d4d70403ba3895d910c552e169243145951.jpg)  

A.当 $\scriptstyle\mathrm{A}\to\mathrm{B}$ 时，除A外的全部主机都能收到A发送的帧B.当 $\mathrm{H}{\to}\mathrm{A}$ 时，仅A能收到H发送的帧C.当 $\mathrm{E{\rightarrow}X}$ 时，仅X能收到E发送的帧D.当 $\mathrm{X}{\rightarrow}\mathrm{E}$ 时，交换机2收不到X发送的帧  

17.【2009统考真题】以太网交换机进行转发决策时使用的PDU地址是（）。A.目的物理地址B.目的IP地址C.源物理地址D.源IP地址  

18.【2013统考真题】对于 $100\mathrm{Mb/s}$ 的以太网交换机，当输出端口无排队，以直通交换方式转发一个以太网帧（不包括前导码）时，引入的转发时延至少是（）。  

A.  $0\upmu\mathrm{s}$  B.  $0.48\upmu\mathrm{s}$  C.  $5.12\upmu\mathrm{s}$  D.121.44μs  

19.【2014统考真题】某以太网拓扑及交换机的当前转发表如下图所示，主机00-e1-d5-00-23-al 向主机00-e1-d5-00-23-c1发送一个数据帧，主机00-e1-d5-00-23-c1收到该帧后，向主机00-e1-d5-00-23-a1发送一个确认顿，交换机对这两个帧的转发端口分别是（）。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f542b0c161dc246816b210750bbeeea61c12901d2942dfca9869d312663efff5.jpg)  

A.{3}和{1}B.[2,3}和{1} C.{2,3}和{1,2} D.{1,2,3}和1} 20.【2015统考真题】下列关于交换机的叙述中，正确的是（）  

A.以太网交换机本质上是一种多端口网桥B.通过交换机互连的一组工作站构成一个冲突域C.交换机每个接口所连的网络构成一个独立的广播域D.以太网交换机可实现采用不同网络层协议的网络互连  

21.【2016统考真题】若主机H2向主机H4发送一个数据帧，主机H4向主机H2立即发送一个确认帧，则除H4外，从物理层上能够收到该确认帧的主机还有（）。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/8182d9e22671f6aefe3abd2a6958e0a04568010ba6cef7d57f6c065f9faac67d.jpg)  

A.仅H2B.仅H3C.仅H1、H2D.仅H2、H3  

# 3.8.4 答案与解析  

# 单项选择题  

01.C  

中继器和集线器都属于物理层设备，网桥和局域网交换机属于数据链路层设备。  

02.D  

交换机的优点是每个接口结点所占用的带宽不会因为接口结点数目的增加而减少，且整个交换机的总带宽会随着接口结点的增加而增加。另外，利用交换机可以实现虚拟局域网（VLAN），VLAN不仅可以隔离冲突域，而且可以隔离广播域。因此C正确，D错误。  

03.D  

交换机可以隔离信息，将网络划分成多个网段，隔离出安全网段，防正其他网段内的用户非法访问。因为网络分段，各网段相对独立，所以一个网段的故障不影响另一个网段的运行。因此B、C正确。根据交换机的特点可知A正确，D错误。  

04.A  

冲突域是指共享同一信道的各个站点可能发生冲突的范围，又称冲突域。物理层设备集线器不能分割冲突域，数据链路层设备交换机和网桥可以分割冲突域，但不能分割广播域，而网络层设备路由器既可分割冲突域，又可分割广播域。  

05.A  

局域网交换机是数据链路层设备，能实现数据链路层和物理层的功能。  
06.A  

交换机能隔离冲突域，在全双工方式下支持多对结点同时通信，从而提高了网络的效率。  

07.B  

交换机是数据链路层的设备，数据链路层的设备可以隔离冲突域，但不能隔离广播域，因此本题选B。另外，物理层设备（集线器等）既不能隔离冲突域，又不能隔离广播域：网络层设备（路由器）既可以隔离冲突域，又可以隔离广播域。  

08.C 物理层设备（中继器和集线器）既不能分割冲突域，又不能分割广播域。  

09.D  

以太网交换机的各接口之间都是冲突域的终止点，但LAN交换机不隔离广播，所以冲突域的个数是16，广播域的个数是1。  

10.C  

对于普通的10Mb/s共享式以太网，若共有 $N$ 个用户，则每个用户的平均带宽仅为总带宽的1/N。当使用以太网交换机时，虽然从每个接口到主机的带宽还是10Mb/s，但是因为一个用户在通信时是独占带宽的，而不是和其他用户共享传输介质的带宽的，所以每个用户仍可得到10Mb/s的带宽，这正是交换机的最大优点。  

11. D、A  

1）在采用交换机作为连接设备的局域网中，交换机能同时连通多对接口，使每对相互通信的计算机都能像独占该通信介质一样，进行无冲突的数据传输。对于10Mb/s的半双工接口，接口带宽为10Mb/s；若接口速率保持不变，则全双工接口带宽为  $20\mathrm{M}\mathrm{b/s}$  2）若题中没有特别说明交换机的工作方式，则默认为全双工工作方式。本题注明是半双工交换机，因此拥有V对10MIb/s接口的半双工交换机的总容量为 $N{\times}10\mathrm{M}\mathrm{b/s},$ 其中 $N=24/2=$ 12，总容量为 $120\mathrm{Mb/s}$ （注意与前面的全双工交换机的区别）。  

12. A  

交换机能将网络分成较小的冲突域，而集线器连接的设备属于同一个冲突域。当一个局域网中 $80\%$ 的通信量在本局域网内进行时，若使用集线器，则会增加冲突和延迟，降低整个网络的效率，而若使用交换机将不同网段的通信隔升，则可以提高网络性能。  

13.B  

交换机可以隔离冲突域，因此它的每个接口所连接的网段都属于不同的冲突域，A错误。交换机可在同一时段内支持多个接口之间的并行通信，而不会相互干扰，这是因为交换机内部有一条高带宽的背部总线和一个内部交换矩阵，可以根据顺的自的MAC地址快速地将顺转发到相应的接口。交换机不能隔离广播域，C错误。LLC是逻辑链路控制，它在MAC层上，用于向网络提供一个接口，以隐藏各种802网络之间的差异，交换机是按MAC地址转发的，D错误。  

14.A  

以太网交换机的自学习功能是指记录帧的源MAC地址与该顺进入交换机的接口号，并将这些信息存储在交换机的交换表中，以便于后续的转发决策。  

15.C  

当以太网交换机的某个接口收到帧时，若在交换表中未找到目的MAC地址，则将该帧从除本接口外的所有接口发送出去，这种发送方法也称泛洪法。  

16.C 当 $\mathrm{A}{\rightarrow}\mathrm{B}$ 时，交换表都为空，交换机1和交换机2都进行洪泛发送，因此除A外的全部主机都能收到A发送的帧。当 $\mathrm{H}{\to}\mathrm{A}$ 时，因为交换机2已登记A所在的接口为3，所以只向接口3转发，交换机1收到帧后，因为交换机1已登记A所在的接口为1，所以只向接口1转发，因此仅A能收到H发送的顿。当 $\mathrm{E{\rightarrow}X}$ 时，集线器向除输入接口外的所有接口转发该帧，交换机1和交换机2也进行洪泛发送，因此除E外的全部主机都能收到A发送的帧。当 $\scriptstyle\mathrm{X}\to\mathrm{E}$ 时，因为交换机1已登记E所在的接口为2，所以仅登记X所在的接口，并丢弃该顿。  
17.A  

交换机实质上是一个多接口网桥，工作在数据链路层，数据链路层使用物理地址进行转发，而转发到目的地需要使用目的地址。因此PDU地址是目的物理地址。  

# 18.B。  

当直通交换在输入接口检测到一个数据顿时，检查帧首部，获取帧的目的地址，启动内部的动态查找表转换成相应的输出接口，在输入与输出交叉处接通，把数据帧直通到相应接口，实现交换功能。直通交换只检查帧的目的地址，共6B，所以最短传输时延是 $6{\times}8\mathrm{bit{\div}}100\mathrm{M}\mathrm{b/s}\!=\!0.48\upmu\mathrm{s}$  

# 19.B  

当00-e1-d5-00-23-a1向00-e1-d5-00-23-c1发送数据帧时，交换机转发表中没有00-e1-d5-00-23-c1这一项，所以向除接口1外的所有接口广播这个帧，即接口2、3会转发这个帧，同时交换机会把（目的地址00-e1-d5-00-23-al，接口1）这一项加入转发表。而当00-e1-d5-00-23-c1向00-e1-d5-00-23-a1发送确认 帧时，因为转发表中已有00-e1-d5-00-23-a1这一项，所以交换机只向接口1转发。  

20.A  

本质上说，交换机就是一个多接口的网桥（A正确），工作在数据链路层（因此不能实现不同网络层协议的网络互连，D错误），交换机能经济地将网络分成小的冲突域（B错误）。广播域属于网络层概念，只有网络层设备（如路由器）才能分割广播域（C错误）。  

# 21.D  

交换机（Switch）可以隔离冲突域。若H2向H4发送数据帧，则H2及其对应接口就写入交换表。当H4向H2发送确认帧时，交换机查找交换表后，将该确认帧从H2对应的接口转发出去。集线器（Huib）无法隔离冲突域，因此Huib会向所有接口（除输入接口外）广播该确认顿的数据信号。因此，从物理层上能够收到该确认帧的主机有H2和H3。  

# 3.9本章小结及疑难点  

1.说明用 $n$ 比特进行编号时，若接收窗口的大小为1，则仅在发送窗口的大小 $W_{\mathrm{T}}\leqslant2^{n}\!-\!1$ 时，连续ARQ协议才能正确运行。  

假设用3比特进行编号，可表示8个不同的序号，发送窗口的最大值似乎可以为8。但是，实际上，发送窗口的大小设为8将使协议在某些情况下无法工作。下面来证明这一点。  

设发送窗口为8，发送方发送完 $_{0\sim7}$ 号共8个数据帧后，暂停发送。假定这8个数据顿均已正确到达接收方，且接收方对每个数据帧都发回了确认顿。下面考虑两种不同的情况。  

第一种情况：所有确认顿都正确地到达发送方，因此发送方接着又发送8个新的数据顿，其编号应是 $_{0\sim7}$ 。注意，序号是循环使用的。因此序号虽然相同，但8个顿都是新的顿。  

第二种情况：所有确认帧都丢失。经过一段超时计时器控制的时间后，发送方重传这8个旧数据帧，其编号仍为 $_{0\sim7}$  
于是，当接收方第二次收到编号为 $_{0\sim7}$ 的8个数据帧时，就无法判定这是8个新数据顿还是8个重传的旧数据顿。因此，将发送窗口设为8显然是不行的。  

2.为什么PPP协议不使用帧的编号和确认机制来实现可靠传输？PPP不使用序号和确认机制是出于以下考虑：  

若使用能够实现可靠传输的数据链路层协议（如HDLC），开销就会增大。当数据链路层出现差错的概率不大时，使用比较简单的PPP较为合理。  

在因特网环境下，PPP的信息字段放入的数据是IP数据报。假定我们采用了能实现可靠传输但十分复杂的数据链路层协议，当数据帧在路由器中从数据链路层上升到网络层时，仍有可能因网络拥塞而被去弃。因此，数据链路层的可靠传输并不能保证网络层的传输也是可靠的。  

PPP在帧格式中有顿检验序列FCS字段。对于每个收到的帧，PPP都要使用硬件进行CRC检验。若发现差错，则丢弃该帧（一定不能把有差错的顿交给上一层）。端到端的差错控制最后由高层协议负责。因此，PPP可以保证无差错接收。  

3.在标准以太网中，为什么说若有冲突，则冲突一定发生在冲突窗口内？或者说一个帧若在冲突窗口内没有发生冲突，则该帧不会再发生冲突？  

结点在发送数据之前，先监听信道是否有载波，若有，表示信道忙，则继续监听，直至检测到信道空闲为止。一个数据帧在从结点A向最远结点的传输过程中，若有其他结点也在发送数据，则会发生冲突，冲突后的信号经过冲突窗口时间后传回结点A，结点A会检测到冲突，所以说若有冲突，则一定发生在冲突窗口内，若在冲突窗口内没有发生冲突，之后若其他结点再要发送数据，则会监听到信道忙，而不会发送数据，从而不会再发生冲突。  

4.一个以太网的速率从10Mb/s升级到100Mb/s，满足CSMA/CD冲突条件。为使其正常工作，需做哪些调整？为什么？  

100BaseT以太网与 $10\,\mathrm{{Mb}/\mathrm{{s}}}$ 以太网的帧格式相同，唯一不同的参数是帧间最小间隔时间，10Mb/s以太网的顿间最小间隔时间是 $9.6\upmu\mathrm{s}$ ，100BaseT以太网的帧间最小间隔时间是 $0.96\upmu\mathrm{s}$ 。此外，为了保持最短帧长不变，将一个网段的最大长度减小到 $100\mathrm{m}$ 。所有这些调整的原因是速率提高到了原速度的10倍。  

5.关于物理层、数据链路层、网络层设备对于隔离冲突域和广播域的总结。
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/fc3ddde383674d06764c118a9de7de3dffbcff35e7317effddf57d889c61eb8c.jpg)  
# 第4章网络层  

# 【考纲内容】  

（一）网络层的功能  

异构网络互连：路由与转发：SDN基本概念：拥塞控制  

（二）路由算法静态路由与动态路由；距离-向量路由算法；链路状态路由算法；层次路由  

（三）IPv4  

IPv4分组；IPv4地址与NAT；子网划分与子网掩码、CIDR、路由聚合、ARP、DHCP 与ICMP  

（四）IPv6  

IPv6的主要特点：IPv6地址  

（五）路由协议  

自治系统：域内路由与域间路由：RIP路由协议：OSPF路由协议：BGP路由协议  

（六）IP多播  

多播的概念：IP多播地址  

（七）移动IP 移动IP的概念；移动IP通信过程  

（八）网络层设备路由器的组成和功能；路由表与路由转发  

# 【复习提示】  

本章是历年考查的重中之重，尤其是结合第3章、第5章、第6章出综合题的概率很大。其中IPv4和路由的相关知识点是核心，历年真题都有涉及，因此必须牢固掌握其原理，还要多做题，以便灵活应用。本章的其他知识点，如IP多播、移动IP、IPv6也要有所了解。  

# 4.1网络层的功能  

网络层提供主机到主机的通信服务，主要任务是将分组从源主机经过多个网络和多段链路传输到自的主机。该任务可划分为分组转发和路由选择两种重要功能。  

OSI参考模型曾主张在网络层使用面向连接的虚电路服务，认为应由网络自身来保证通信的可靠性。而TCP/IP体系的网络层提供的是无连接的数据报服务，其核心思想是应由用户主机来保证通信的可靠性。虚电路和数据报服务已在2.1节中介绍。  
在互联网采用的TCP/IP体系结构中，网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务。也就是说，所传送的分组可能出错、丢失、重复、失序或超时，这就使得网络中的路由器可以做得比较简单，而且价格低廉。通信的可靠性可以由更高层的传输层来负责。采用这种设计思路的好处是：网络的造价大大降低，运行方式灵活，能够适应多种应用。互联网能够发展到今日的规模，充分证明了当初采用这种设计思想的正确性。  

# 4.1.1异构网络互连  

互联网是由全球范围内数以百万计的异构网络互连起来的。这些网络的拓扑结构、寻址方案、差错处理方法、路由选择机制等都不尽相同。网络层所要完成的任务之一就是使这些异构的网络实现互连。网络互连是指将两个以上的计算机网络，通过一定的方法，用一些中继系统相互连接起来，以构成更大的网络系统。根据所在的层次，中继系统分为以下4种：  

1）物理层中继系统：转发器，集线器。2）数据链路层中继系统：网桥或交换机。3）网络层中继系统：路由器。4）网络层以上的中继系统：网关。  

当使用物理层或数据链路层的中继系统时，只是把一个网络扩大了，而从网络层的角度看，它仍然是同一个网络，一般并不称为网络互连。因此，网络互连通常是指用路由器进行网络连接和路由选择。路由器是一台专用计算机，用于在互联网中进行路由选择。  

# 注意  

由于历史原因，许多有关TCP/IP的文献也将网络层的路由器称为网关。  

TCP/IP在网络互连上采用的做法是在网络层采用标准化协议，但相互连接的网络可以是异构的。图4.1(a)表示用许多计算机网络通过一些路由器进行互连。因为参与互连的计算机网络都使用相同的IP协议，所以可把互连后的网络视为如图4.1(b)所示的一个虚拟IP网络。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/621a3f2136975b86286096e310e22fa48507532f731983586cccced6c926f71f.jpg)  
图4.1IP网络的概念  

虚拟互连网络也就是逻辑互连网络，意思是互连起来的各种物理网络的异构性本来是客观存在的，但是通过IP协议就可使这些性能各异的网络在网络层上看起来像是一个统一的网络。这种使用IP协议的虚拟互连网络可简称为IP网络。  

使用IP网络的好处是：当IP网上的主机进行通信时，就好像在单个网络上通信一样，而看不见互连的各个网络的具体异构细节（如具体的编址方案、路由选择协议等）。  
# 4.1.2 路由与转发  

路由器主要完成两个功能：一是路由选择（确定哪一条路径），二是分组转发（当一个分组到达时所采取的动作）。前者根据路由选择协议构造并维护路由表。后者处理通过路由器的数据流，关键操作是转发表查询、转发及相关的队列管理和任务调度等。  

1）路由选择。根据路由协议构造路由表，同时经常或定期地与相邻路由器交换信息，获取网络最新拓扑，动态更新维护路由表，以决定分组到达目的地结点的最优路径。  

2）分组转发。指路由器根据转发表将分组从合适的端口转发出去。  

路由表是根据路由选择算法得出的，而转发表是从路由表得出的。转发表的结构应当使查找过程最优化，路由表则需要最优化网络拓扑变化的计算。在讨论路由选择的原理时，往往不区分转发表和路由表，而笼统地使用路由表一词。  

# 4.1.3网络层提供的两种服务  

分组交换网根据其通信子网向端点系统提供的服务，还可进一步分为面向连接的虚电路服务和无连接的数据报服务。这两种服务方式都是由网络层提供的。  

# 1.虚电路  

# 命题追踪虚电路网络的特性（2020）  

在虚电路方式中，当两台计算机进行通信时，应当先建立网络层的连接，也就是建立一条逻辑上的虚电路（VirtualCircuit，VC），连接一旦建立，就固定了虚电路对应的物理路径。与电路交换类似，整个通信过程分为三个阶段：虚电路建立、数据传输与虚电路释放。  

每次建立虚电路时，将一个未用过的虚电路号（VCID）分配给该虚电路，以区别于本系统中的其他虚电路，然后双方就沿着已建立的虚电路传送分组。分组的首部仅在连接建立时使用完整的目的地址，之后每个分组的首部只需携带这条虚电路的编号即可。在虚电路网络中的每个结点上都维持一张虚电路表，表中每项记录一个打开的虚电路的信息，包括在接收链路和发送链路上的虚电路号、前一结点和下一结点的标识，它是在虚电路建立过程中确定的。  

虚电路方式的工作原理如图4.2所示。  

1）数据传输前，主机A与主机B先建立连接，主机A发出“呼叫请求”分组，该分组通过中间结点送往主机B，若主机B同意连接，则发送“呼叫应答”分组予以确认。2）虚电路建立后，主机A和主机B就可相互传送数据分组。3）传送结束后，主机A通过发送“释放请求”分组来拆除虚电路，逐段断开整个连接。通过上面的例子，可总结出虚电路服务具有如下特点：1）虚电路通信链路的建立和拆除需要时间开销，对交互式应用和少量的短分组情况显得很浪费，但对长时间、频繁的数据交换效率较高。2）虚电路的路由选择体现在连接建立阶段，连接建立后，就确定了传输路径。3）虚电路提供了可靠的通信功能，能保证每个分组正确且有序到达。此外，还可对两个端点的流量进行控制，当接收方来不及接收数据时，可以通知发送方暂缓发送。4）虚电路有一个致命的弱点，即当网络中的某个结点或某条链路出现故障而彻底失效时，所有经过该结点或该链路的虚电路将遭到破坏。5）分组首部不包含目的地址，包含的是虚电路号，相对于数据报方式，其开销小。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/9233181e79b8ebc96077008ff22adf1f54d99334985fab79c6c81d56c6d3f9fd.jpg)  
图4.2虚电路方式的工作原理  

虚电路之所以是虚，是因为这条电路不是专用的，每个结点到其他结点之间的链路可能同时有若干条虚电路通过，也可能同时在多个结点之间建立虚电路。  

注意，图4.2所示的数据传输过程是有确认的传输（由高层实现），B收到分组后要发回相应分组的确认。网络中的传输是否有确认与网络层提供的两种服务没有任何关系。  

# 2.数据报  

网络在发送分组前不需要先建立连接。源主机的高层协议将报文拆成若干较小的数据段，并加上地址等控制信息后构成分组。中间结点存储分组很短一段时间，找到最佳的路由后，尽快转发每个分组。网络层不提供服务质量的承诺。因为网络不提供端到端的可靠传输服务，所以这就使得网络中的路由器比较简单，且造价低廉（与电话网络相比）。  

下面用图4.3中的例子来说明数据报服务的原理。假定主机A向主机B发送分组。  

1）主机A先将分组逐个发往与它直接相连的交换结点A，交换结点A缓存收到的分组。 2）然后查找自己的转发表。因为不同时刻的网络状态不同，所以转发表的内容可能不完全相同，所以有的分组转发给交换结点C，有的分组转发给交换结点D。3）网络中的其他结点收到分组后，类似地转发分组，直到分组最终到达主机B。当分组正在某一链路上传送时，分组并不占用网络其他部分的资源。因为采用存储转发技术资源是共享的，所以主机A在发送分组时，主机B也可同时向其他主机发送分组。  

通过上面的例子，我们可以总结出数据报服务具有如下特点：  

1）发送分组前不需要建立连接。发送方可随时发送分组，网络中的结点可随时接收分组。2）网络尽最大努力交付，传输不保证可靠性，所以分组可能出错或丢失：网络为每个分组独立地选择路由，转发的路径可能不同，因此分组不一定按序到达自的结点。  
3）发送的分组中要包括发送方和接收方的完整地址，以便可以独立传输。  

4）当分组在交换结点存储转发时，需要排队等候处理，这会带来一定的时延。当网络发生拥塞时，这种时延会大大增加，交换结点还可根据情况丢弃部分分组。5）网络具有冗余路径，当某个交换结点或一条链路出现故障时，可相应地更新转发表，寻找另一条路径转发分组，对故障的适应能力强。  

6）收发双方不独占某条链路，资源利用率较高。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/12567fcdff5ade6c268261075cfc133a5380945b6f92cd8795694b59b3b807a6.jpg)  
图4.3数据报方式转发分组  

采用这种设计思想的好处是：网络的造价大大降低、运行方式灵活、能够适应多种应用。互联网能够发展到今大的规模，充分证明了当初采用这种设计思想的正确性。  

数据报服务和虚电路服务的比较见表4.1。  

表4.1数据报服务和虚电路服务的比较
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f324c7ccd6e10a702d7ac84398e33b642c254c1efe5182a43c73d0e91c714684.jpg)  

# 4.1.4SDN的基本概念  

网络层的主要任务是转发和路由选择。可以将网络层抽象地划分为数据平面（也称转发层面）和控制平面，转发是数据平面实现的功能，而路由选择是控制平面实现的功能。  

软件定义网络（SoftwareDefinedNetwork，SDN）是近年流行的一种创新网络架构，它采用集中式的控制平面和分布式的数据平面，两个平面相互分离，控制平面利用控制-数据接口对数据平面上的路由器进行集中式控制，方便软件来控制网络。传统网络中的路由器既有转发表又有路由选择软件，即既有数据平面又有控制平面。但是在图4.4所示的SDN结构中，路由器都变得简单了，它的路由选择软件都不需要了，因此路由器之间不再相互交换路由信息。在网络的控制平面有一个逻辑上的远程控制器（可由多个服务器组成）。远程控制器掌握各主机和整个网络的状态，为每个分组计算出最佳路由，通过Openflow协议（或其他途径）将转发表（在SDN中称为流表）下发给路由器。路由器的工作很单纯，即收到分组、查找转发表、转发分组。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/8980411f3a345b80986b7d3b5cb90dfa7fc85d40d5af689d3f0e6480ae45beba.jpg)  
图4.4远程控制器确定并分发转发表中的值  

这样，网络又变成集中控制的，而本来互联网是分布式的。SDN并非要把整个互联网都改造成如图4.4所示的集中控制模式，这是不现实的。然而，在某些具体条件下，特别是像一些大型的数据中心之间的广域网，使用SDN模式来建造，就可使网络的运行效率更高。  

# 命题追踪SDN的南向接口的定义（2022）  

SDN的可编程性通过为开发者提供强大的编程接口，使得网络具有很好的编程性。对上层应用的开发者，SDN提供的编程接口称为北向接口，北向接口提供了一系列丰富的API，开发者可以在此基础上设计自己的应用，而不必关心底层的硬件细节。SDN控制器和转发设备建立双向会话的接口称为南向接口，通过不同的南向接口协议（如Openflow），SDN控制器就可兼容不同的硬件设备，同时可在设备中实现上层应用的逻辑。SDN控制器集群内部控制器之间的通信接口称为东西向接口，用于增强整个控制平面的可靠性和可拓展性。  

SDN的优点： $\textcircled{\scriptsize{1}}$ 全局集中式控制和分布式高速转发，既利于控制平面的全局优化，又利于高性能的网络转发。 $\circledcirc$ 灵活可编程与性能的平衡，控制和转发功能分离后，使得网络可以由专有的自动化工具以编程方式配置。 $\textcircled{3}$ 降低成本，控制和数据平面分离后，尤其是在使用开放的接口协议后，就实现了网络设备的制造与功能软件的并发相分离，从而有效降低了成本。  

SDN的问题： $\textcircled{\scriptsize{1}}$ 安全风险，集中管理容易受攻击，若崩溃，则整个网络会受到影响。 $\circledcirc$ 瓶颈问题，原本分布式的控制平面集中化后，随着网络规模扩大，控制器可能成为网络性能的瓶颈。  

# 4.1.5拥塞控制  

因出现过量的分组而引起网络性能下降的现象称为拥塞。判断网络是否进入拥塞状态的方法是，观察网络的吞吐量与网络负载的关系：若随着网络负载的增加，网络的吞吐量明显小于正常的吞吐量，则网络就可能已进入轻度拥塞状态；若网络的吞吐量随着网络负载的增大而下降，则网络就可能已进入拥塞状态。拥塞控制主要解决的问题是如何获取网络中发生拥塞的信息，从而利用这些信息进行控制，以避免因拥塞而出现分组的丢失。  
拥塞控制的作用是确保网络能够承载所达到的流量，这是一个全局性的过程，涉及网络中所有的主机、路由器及导致网络传输能力下降的所有因素。单一地增加资源并不能解决拥塞。  

与流量控制的区别：流量控制往往是指在发送方和接收方之间的点对点通信量的控制。流量控制所要做的是抑制发送方发送数据的速率，以便使接收方来得及接收。  

拥塞控制的方法有两种：  

1）开环控制。在设计网络时事先将有关发生拥塞的因素考虑周到，力求网络在工作时不产生拥塞。这是一种静态的预防方法。一旦整个系统启动并运行，中途就不再需要修改。开环控制手段包括确定何时可接收新流量、何时可丢弃分组及丢弃哪些分组，确定何利调度策略等。所有这些手段的共性是，在做决定时不考虑当前网络的状态。  

2）闭环控制。事先不考虑有关发生拥塞的各种因素，采用监测网络系统去监视，及时检测哪里发生了拥塞，然后将拥塞信息传到合适的地方，以便调整网络系统的运行，并解决出现的问题。闭环控制是基于反馈环路的概念，是一种动态的方法。  

# 4.1.6 本节习题精选  

# 单项选择题  

01.网络层的主要目的是（）。  

A.在邻接结点间进行数据报传输B.在邻接结点间进行数据报可靠传输C.在任意结点间进行数据报传输D.在任意结点间进行数据报可靠传输  

02.路由器连接的异构网络是指（）  

A.网络的拓扑结构不同B.网络中计算机操作系统不同C.数据链路层和物理层均不同D.数据链路层协议相同，物理层协议不同  

03.网络中发生了拥塞，根据是（）  

A.随着通信子网负载的增加，吞吐量也增加B.网络结点接收和发出的分组越来越少C.网络结点接收和发出的分组越来越多D.随着通信子网负载的增加，吞吐量反而降低  

04.在路由器互连的多个局域网的结构中，要求每个局域网（）  

A.物理层协议可以不同，而数据链路层及其以上的高层协议必须相同B.物理层、数据链路层协议可以不同，而数据链路层以上的高层协议必须相同C.物理层、数据链路层、网络层协议可以不同，而网络层以上的高层协议必须相同D.物理层、数据链路层、网络层及高层协议都可以不同  

05.下列设备中，能够分隔广播域的是（）A.集线器B.交换机C.路由器D.中继器06.在互联网中，一个路由器的路由表通常包含（）。  

A.目的网络和到达目的网络的完整路径B.所有目的主机和到达该目的主机的完整路径C.目的网络和到达该目的网络路径上的下一个路由器的IP地址  
D.目的网络和到达该目的网络路径上的下一个路由器的MAC地址  

07.路由器转发分组的根据是报文的（）  

A.端口号 B.MAC地址 C.IP地址 D.域名  

08.路由器在能够开始向输出链路传输分组的第一位之前，必须先接收到整个分组，这种机制称为(）。  

A.存储转发机制B.直通交换机制C.分组交换机制D.分组检测机制

09.在互联网中，IP分组的传输需要经过源主机和中间路由器到达目的主机，通常（）。  

A.源主机和中间路由器都知道IP分组到达目的主机需要经过的完整路径B.源主机和中间路由器都不知道IP分组到达目的主机需要经过的完整路径C.源主机知道IP分组到达目的主机需要经过的完整路径，而中间路由器不知道D.源主机不知道IP分组到达目的主机需要经过的完整路径，而中间路由器知道  

10.下列协议中属于网络层协议的是（）  

I.IP II.TCP III.FTP IV. ICMP A.I和ⅡI B.ⅡI和IⅢI C.IⅢI和IV D.I和IV  

11.在下列数据交换方式中，数据经过网络的传输延迟长而且是不固定的，不能用于语音数据传输的是（）。  

A.电路交换B.报文交换C.数据报交换D.虚电路交换

12.下列关于各种数据交换方式的叙述，错误的是（）。  

A.电路交换不提供差错控制功能B.分组交换的分组有最大长度的限制C.虚电路是面向连接的，它提供的是一种可靠的服务D.在出错率很高的传输系统中，选择虚电路方式更合适  

13.下列有关虚电路服务和数据报服务的叙述中，正确的是（）  

A.虚电路服务和数据报服务都是无连接的服务B.数据报服务中，分组在网络中沿同一条路径传输，并且按发出顺序到达C.虚电路在建立连接后，分组中需携带虚电路标识D.虚电路中的分组到达顺序可能与发出顺序不同  

14.同一报文中的分组可以由不同的传输路径通过通信子网的方法是（）。A.分组交换B.电路交换C.虚电路D.数据报

15.下列有关数据报和虚电路的叙述中，错误的是（）  

A.数据报方式中，某个结点若因故障而丢失分组，则其他分组仍可正常传输B.数据报方式中，每个分组独立地进行路由选择和转发，不同分组之间没有必然联系C.虚电路方式中，属于同一条虚电路的分组按照同一路由转发D.尽管虚电路方式是面向连接的，但它并不保证分组的有序到达  

16.下列关于虚电路和数据报的叙述中，正确的是（）  

A.虚电路是一种分组交换技术，但不能按照存储转发的方式工作B.虚电路的连接是临时性连接，当会话结束时就释放这种连接 C.数据报服务不提供可靠传输，但可以保证分组的有序到达D.数据报服务中，每个分组都必须携带源地址和目的地址  

17．下列关于虚电路的说法中，正确的是（）  

A.虚电路依赖其他协议实现差错控制  
B.采用虚电路方式发送分组时，分组首部都必须包含目的地址C.虚电路结合了电路交换的思想，适合对实时性要求较高的长期通信D.多站点同时使用一段物理链路实行虚电路交换会产生冲突，无法正常通信  

18.下列关于虚电路的说法中，正确的是（）  

A.虚电路和电路交换一样，在数据传输前要建立物理连接B.虚电路中间结点发生故障后，可沿其他路径继续通信，无须重新建立连接C.虚电路只有建立连接的分组需要携带源地址和目的地址D.在虚电路上传送的同一个会话的数据分组可以走不同的路径  

19.下列4种传输方式中，由网络负责差错控制和流量控制，分组按顺序被递交的是（）。  

A.电路交换 B.报文交换 C.虚电路分组交换D.数据报分组交换  

20.下列描述中，（）不是软件定义网络（SDN）的特点。  

A.控制与转发功能分离B.控制平面集中化C.接口开放可编程D.Open flow  

21.下列关于SDN的描述中，错误的是（）  

I.SDN是近年来出现的一种新型物理网络结构II.OpenFlow交换机基于“流表”来转发分组IIl.S DN Open FlowIV.OpenFlow可视为SDN的控制层面与数据层面的通信接口  

A.I和IⅢI B.I和IV C.II和IV D.I、II和IV 22.【2020统考真题】下列关于虚电路网络的叙述中，错误的是（）。  

A.可以确保数据分组传输顺序B.需要为每条虚电路预分配带宽C.建立虚电路时需要进行路由选择 D.依据虚电路号（VCID）进行数据分组转发  

23.【2022统考真题】在SDN网络体系结构中，SDN控制器向数据平面的SDN交换机下发流表时所使用的接口是（）。  

A.东向接口B.南向接口C.西向接口D.北向接口  

# 4.1.7 答案与解析  

单项选择题  

01.C 选项A、B不是网络层的目的，IP提供的是不可靠的服务，因此D错误。  

02.C  

网络的异构性是指传输介质、数据编码方式、链路控制协议及不同的数据单元格式和转发机制，这些特点分别在物理层和数据链路层协议中定义。  

03.D  

拥塞现象是指到达通信子网中某一部分的分组数量过多，使得该部分网络来不及处理，以致这部分乃至整个网络性能下降的现象，严重时甚至导致网络通信业务陷入停顿，即出现死锁现象。选项A的网络性能显然是提高的，选项B、C中网络结点接收和发出的分组多少与网络的吞吐量并不成正比，不能确定网络是否拥塞。  
04.C  

路由器是第三层设备，向传输层及以上层次隐藏下层的具体实现，所以物理层、数据链路层、网络层协议可以不同。而网络层之上的协议数据是路由器所不能处理的，因此网络层以上的高层协议必须相同。本题容易误选B，主要原因是在目前的互联网中广泛使用的是TCPIP协议族，在网络层用的多是IPv4，所以误认为网络层协议必须相同。实际上，使用特定的路由器连接IPv4与IPv6网络，就是典型的网络层协议不同而实现互连的例子。  

05.C  

路由器工作在网络层，不转发广播包（目的地址为255.255.255.255的IP包），因此能够分隔广播域，抑制网络风暴。交换机工作在数据链路层，能够分隔冲突域，但不能分隔广播域。集线器和中继器是物理层设备，既不能分隔广播域，又不能分隔冲突域。  

06.C  

路由器是网络层设备，其任务是转发分组。每个路由器都维护一个路由表以决定分组的转发。为了提高路由器的查询效率并减少路由表维护的内容，路由表只保留到达目的地址的下一个路由器的地址，而不保留整个传输路径的信息。另外，采用目的网络可使每个路由表项包含很多目的主机IP地址，这样可减少路由表中的项目。因此，路由表通常包含目的网络和到达该目的网络路径上的下一个路由器的IP地址。  

07.C  

路由器是网络层设备，网络层通过IP地址标识主机，所以路由器根据IP地址转发分组。  

08.A  

路由器转发一个分组的过程如下：先接收整个分组，然后对分组进行错误检查，若出错，则丢弃错误的分组；否则存储该正确的分组。最后根据路由选择协议，将正确的分组转发到合适的端口，这种机制称为存储转发机制。  

09.B  

每个路由器都根据路由表来选择IP分组的下一跳地址，只有到了下一跳路由器，才知道再下一跳应当怎样走。主机仅知道到达本地网络的路径，到达其他网络的IP分组均转发到路由器。而源主机也只把IP分组发给网关，所以路由器和源主机都不知道IP分组要经过的完整路径。  

10.D  

TCP属于传输层协议，FTP属于应用层协议，只有IP和ICMP属于网络层协议。  

11.B  

在报文交换中，交换的数据单元是报文。因为报文大小不固定，在交换结点中需要较大的存储空间，另外报文经过中间结点的接收、存储和转发时间较长而且不固定，所以不能用于实时通信应用环境（如语音、视频等）。  

12.D  

电路交换不具备差错控制能力，A正确。分组交换对每个分组的最大长度有规定，超过此长度的分组都被分割成几个长度较小的分组后再发送，B正确。  

分组交换又分为数据报和虚电路两种方式。数据报是无连接的，它提供的是不可靠的服务，分组有可能丢失、失序，也不保证到达的时间，但因每个分组独立选择传送路径，当某个结点发生敌障时，后续的分组可另选路径，另外通过高层协议如TCP也可保证其传输的可靠性和有序性。虚电路是面向连接的，它提供的是可靠的服务，能保证数据的可靠性和有序性，但是一旦虚电路中的某个结点出现故障，就必须重新建立一条虚电路，对于出错率高的传输系统，易出现结点故障，这项任务就显得相当艰巨，因此采用数据报方式更合适。C正确、D错误。  
13.C  

虚电路服务是有连接的，属于同一条虚电路的分组，根据该分组的相同虚电路标识，按照同一路由转发，保证分组的有序到达。在数据报服务中，网络为每个分组独立地选择路由，传输既不保证可靠性，又不保证分组的按序到达。  

14.D  

分组交换有两种方式：虚电路和数据报。在虚电路服务中，属于同一条虚电路的分组按照同一路由转发；在数据报服务中，网络为每个分组独立地选择路由，传输既不保证可靠性，又不保证分组的按序到达。  

15.D  

关于虚电路和数据报的比较，请参考表4.1。  

16.D  

虚电路是一种分组交换技术，它可以采用存储转发的方式工作，A错误。虚电路不只是临时性的，它提供的服务包括永久性虚电路（PVC）和交换型虚电路（SVC），其中前者是一种提前定义好的、基本上不需要任何建立时间的端点之间的连接，而后者是端点之间的一种临时性连接，这些连接只持续所需的时间，且在会话结束时就取消这种连接，B错误。数据报服务是无连接的，既然提供可靠性保障，也不保证分组的有序到达，C错误。在数据报服务中，每个分组都必须携带源地址和目的地址：而虚电路服务中，建立连接后，分组只需携带虚电路标识。  

17.C  

虚电路提供的是可靠的通信服务，本身就可实现差错控制。分组仅在连接建立时才需要使用完整的目的地址，之后每个分组只需携带这条虚电路的编号即可。多站点同时使用一段物理链路实现虚电路交换不会产生冲突，因为每个分组都有一个虚电路号来标识所属的虚电路。  

18.C  

虚电路是一种分组交换技术，它在数据传输前要建立逻辑连接而非物理连接，A错误。虚电路的中间结点发生故障后，会导致整条虚电路失效，需要重新建立连接，B错误。虚电路只有建立连接的分组需要携带目的地址，以进行路由选择，之后传送的分组只需携带虚电路号即可。一个会话的虚电路是事先建立好的，因此它的数据分组所走的路径也是固定的，D错误。  

19. C  

电路交换和报文交换不采用分组交换技术。数据报传输方式没有差错控制和流量控制机制，也不保证分组按序交付。虚电路方式提供面向连接的、可靠的、保证分组按序到达的网络服务。  

20.D  

选项A、B和C都是SDN的特点。Openflow协议是控制平面和数据平面之间的接口。在SDN中，路由器之间不再相互交换路由信息，由远程控制器计算出最佳路由。  

21.A  

SDN是一种新型网络体系结构，是一种设计、构建和管理网络的新方法，不是一种新型物理网络结构。在SDN中，完成“匹配 $^+$ 动作”的设备通常也称OpenFlow交换机。相应地，在SDN中取代传统路由器中转发表的是流表。SDN远程控制器是一种控制平面的实现方式，它由一个远程的服务器来计算和分发流表给网络设备，SDN远程控制器不在OpenFlow交换机中。  

22.B  

在建立虚电路的阶段，分组才需要携带完整的目的地址，以进行路由器选择。之后，每个分组只需携带短的虚电路号即可，属于同一条虚电路的分组按照同一路由进行转发，分组到达终点的顺序与发送顺序相同，可以保证有序传输。虚电路只是一条逻辑上的连接，并不是一条物理上的连接，因此不需要为每条虚电路预分配带宽。  
23.B  

SDN对上层开发者提供的编程接口称为北向接口，而南向接口则负责控制平面和数据平面间的通信，所以SDN控制器向数据平面的SDN交换机下发流表时使用南向接口。  

# 4.2 IPv4  

4.2.1IPv4分组  

IPv4（版本4）即现在普遍使用的网际协议（IntemetProtocol，IP）。IP定义数据传送的基本单元一一IP分组及其确切的数据格式。IP也包括一套规则，指明分组如何处理、错误怎样控制。特别是IP还包含非可靠投递的思想，以及与此关联的路由选择的思想。  

# 1.IPv4分组的格式  

# 命题追踪IP首部的分析/各字段的含义（2011、2012）  

一个IP分组（或称IP数据报）由首部和数据部分组成。首部前一部分的长度固定，共20B，是所有IP分组必须具有的。在首部固定部分的后面是一些可选字段，其长度可变，用来提供错误检测及安全等机制。IP数据报的格式如图4.5所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/83f7bc75378b06ceb46c21f71b64717714580f6ea9f486f61f4aca59abefe7d7.jpg)  
图4.5IP数据报的格式  

IPv4首部的部分重要字段含义如下：  

1）版本。占4位。指IP的版本，IPv4数据报中该字段值是4。  

2）首部长度。占4位。以4B为单位，最大可表示的首部长度为60B（ $15\!\times\!4\mathrm{B}$ ）。最常用的首部长度是20B（ $5{\times}4\mathrm{B}$ ），该字段值是5，此时不使用任何可选字段。  

# 注意  

IP首部前两个字节往往以0x45开头，解题时可用于定位IP数据报的开始位置。  

3）总长度。占16位。指首部和数据之和的长度，单位为字节，因此数据报的最大长度为 $2^{16}\!-\!1\!=\!65535\mathrm{B}$ 。以太网帧的最大传送单元（MTU）为1500B，因此当一个IP数据报封装成  
硕时，数据报的总长度（首部加数据）一定不能超过下面的数据链路层的MTU值  

4）标识。占16位。它是一个计数器，每产生一个数据报就加1，并赋值给标识字段。但它并不是“序号”（因为IP是无连接服务）。当一个数据报的长度超过网络的MTU时，必须分片，此时每个数据报片都复制一次标识号，以便能正确地重装成原来的数据报。  

5）标志（Flag）。占3位。标志字段的最低位为MF， ${\mathrm{MF}}\!=\!1$ 表示后面还有分片， ${\mathrm{MF}}\!=\!0$ 表示最后一个分片。标志字段中间的一位是DF，只有当 $\ensuremath{\mathrm{DF}}\!=\!0$ 时才允许分片。  

6）片偏移。占13位。它指出较长的数据报在分片后，某片在原数据报中的相对位置，片偏移以8B为偏移单位。除最后一个分片外，每个分片的长度一定是8B的整数倍。  

# 命题追踪TTL的计算（2014）  

7）生存时间（TTL）。占8位。数据报在网络中可通过的路由器数的最大值，标识数据报在网络中的寿命，以确保数据报不会永远在网络中循环。路由器在转发数据报前，先将TTL减1。若TTL被减为0，则该数据报必须去弃。  

8）协议。占8位。指出此数据报携带的数据使用何种协议，即数据报的数据部分应上交给哪个协议进行处理，如TCP、UDP等。其中值为6表示TCP，值为17表示UDP。  

9）首部检验和。占16位。它只检验数据报的首部，但不包括数据部分。这是因为数据报每经过一个路由器，都要重新计算首部检验和（有些字段，如生存时间、总长度、标志、片偏移、源/目的地址都可能发生变化）。不检验数据部分可减少计算的工作量。  

10）源地址字段。占4B，标识发送方的IP地址。11）目的地址字段。占4B，标识接收方的IP地址。  

# 注意  

$\textcircled{\scriptsize{1}}$ 在IP数据报首部中有三个关于长度的标记，即首部长度、总长度、片偏移，它们的基本单位分别为4B、1B、8B（需要记住）。题中常出现这几个长度之间的加减运算。另外，读者要熟悉IP数据报首部中的各个字段的意义和功能，但不需要记忆IP数据报的首部，正常情况下若需要参考首部，则题目会直接给出。第5章学习的TCP、UDP的首部也是一样的。 $\textcircled{2}$ 在分析IP首部时，IP地址通常是用十六进制表示的，要注意其与十进制之间的转换。  

# 2.IP数据报分片  

一个链路层数据帧能承载的最大数据量称为最大传送单元（MTU)。因为IP数据报被封装在链路层的顿中，因此链路层的MTU严格地限制了IP数据报的长度，而且在IP数据报的源与目的地路径上的各段链路可能使用不同的链路层协议，有不同的MTU。例如，以太网的MTU为1500B，而许多广域网的MTU不超过576B。当IP数据报的总长度大于链路MTU时，就需要将IP数据报中的数据分装在多个较小的IP数据报中，这些较小的数据报称为片。  

# 命题追踪分片时会影响首部中的哪些字段（2011）  

片在目的地的网络层被重新组装。目的主机使用IP首部中的标识、标志和片偏移字段来完成对片的重组。创建一个IP数据报时，源主机为该数据报加上一个标识号。当一个路由器需要将一个数据报分片时，形成的每个数据报（即片）都具有原始数据报的标识号。当目的主机收到来自同一发送主机的一批数据报时，它可通过检查数据报的标识号来确定哪些数据报属于同一个原始数据报的片。IP首部中的标志位占3位，但只有后2位有意义，分别是DF（Don'tFragment)位和MF（More Fragment）位。只有当 $\ensuremath{\mathrm{DF}}\!=\!0$ 时，该IP数据报才可被分片。MF则用来告知目的主机该IP数据报是否为原始数据报的最后一个片。当 ${\mathrm{MF}}=1$ 时，表示相应的原始数据报还有后续的片；当 ${\mathrm{MF}}\!=\!0$ 时，表示该数据报是相应原始数据报的最后一个片。自的主机在对片进行重组时，使用片偏移字段来确定片应放在原始IP数据报的哪个位置。  
# 命题追踪IP分片的原理及相关字段的分析（2021）  

IP分片涉及一定的计算。例如，一个长4000B的IP数据报（首部20B，数据部分3980B）到达一个路由器，需要转发到一条MTU为1500B的链路上。这意味着原始数据报中的3980B数据必须分配到3个独立的片中（每片也是一个IP数据报），每片的数据部分依次为1480B、1480B和1020B。假定原始数据报的标识号为777，则分成的3片如图4.6所示。可见，因为偏移值的单位是8B，所以除最后一个片外，其他所有片中的数据部分都为8B的倍数。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/626e7ffc8ed5ca7c1f4c45679e7d234b783838316cdd440725a7b9512cb99c27.jpg)  
图4.6IP分片的例子  

# 4.2.2 IPv4地址与NAT  

1.IPv4地址  

IP地址是给互联网上的每台主机（或路由器）的每个接口分配的一个在全球范围内唯一的32位标识符。IP地址由互联网名字和数字分配机构ICANN进行分配。  

互联网早期采用的是分类的IP地址，如图4.7所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f2e278ae9a152d96978ffc45243b7b127a36a1cce3578e4c25be1b688bd910d2.jpg)  
图4.7分类的IP地址  

无论哪类IP地址，都由网络号和主机号两部分组成。即IP地址：： $=$ {<网络号>，<主机号>}。其中网络号标志主机（或路由器）所连接到的网络。一个网络号在整个互联网范围内必须是唯一的。主机号标志该主机（或路由器）。一台主机号在它前面的网络号所指明的网络范围内必须是唯一的。由此可见，一个IP地址在整个互联网范围内是唯一的。  

# 命题追踪特殊IP地址0.0.0.0的用途（2017）  

在各类IP地址中，有些IP地址具有特殊用途，不用作主机的IP地址：  
主机号全为0表示本网络本身，如202.98.174.0。主机号全为1表示本网络的广播地址，又称直接广播地址，如202.98.174.255。 $127.\times.\times.\times$ 保留为环回自检（LoopbackTest）地址，此地址表示任意主机本身，目的地址为环回地址的IP数据报永远不会出现在任何网络上。32位全为0，即0.0.0.0表示本网络上的本主机。32位全为1，即255.255.255.255表示整个TCP/P网络的广播地址，又称受限广播地址。实际使用时，因为路由器对广播域的隔离，255.255.255.255等效为本网络的广播地址。常用的三种类别IP地址的使用范围见表4.2。  

表4.2常用的三种类别IP地址的使用范围
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/8e5f99e160787c8b792c1180313a4d2d4e023d0e54160b7414f055ff18773b94.jpg)  

在表4.2中，A类地址可用的网络数为 $2^{7}\!-\!2$ ，减2的原因是：第一，网络号字段全为0的IP地址是保留地址，意思是“本网络"；第二，网络号为127的IP地址是环回自检地址。  

IP地址有以下重要特点：  

1）每个IP地址都由网络号和主机号两部分组成，因此IP地址是一种分等级的地址结构。分等级的好处是： $\textcircled{\scriptsize{1}}$ 地址管理机构在分配ITP地址时只分配网络号，而主机号则由得到该网络的单位自行分配，方便了IP地址的管理： $\textcircled{2}$ 路由器仅根据目的主机所连接的网络号来转发分组（而不考虑目标主机号），从而减小了路由表所占的存储空间。  

2）IP地址是标志一台主机（或路由器）和一条链路的接口。当一台主机同时连接到两个网络时，该主机就必须同时具有两个相应的IP地址，其网络号必须是不同的。因此路由器至少应具有两个或两个以上的IP地址，每个端口都有一个不同网络号的IP地址。  

3）用转发器或桥接器（网桥等）连接的若干LAN仍然是同一个网络（同一个广播域），因此该LAN中所有主机的IP地址的网络号必须相同，但主机号必须不同。  

4）在IP地址中，所有分配到网络号的网络（无论是LAN还是WAN）都是平等的。5）在同一个局域网上的主机或路由器接口的IP地址中的网络号必须是相同的。近年来，因为广泛使用无分类IP地址进行路由选择，这种传统分类的IP地址已成为历史。  

# 2.网络地址转换（NAT）  

网络地址转换（Network Address Translation，NAT）（如Intranet）转换为公用地址（如Intermet），从而对外隐藏内部管理的IP地址。它使得整个专用网只需要一个全球IP地址就可与互联网连通，因为专用网本地IP地址是可重用的，所以NAT大大节省了IP地址的消耗。同时，它隐藏了内部网络结构，从而降低了内部网络受到攻击的风险。  

# 命题追踪私有IP地址访问Internet的处理（2011）  

此外，为了网络安全，划出了部分IP地址为私有IP地址。私有IP地址只用于LAN，不用于WAN连接（因此私有IP地址不能直接用于Intermet，必须通过网关利用NAT把私有IP地址转换为Intermet中合法的全球IP地址后才能出现在Internet上），并且允许私有IP地址被LAN重复使用。这有效地解决了IP地址不足的问题。私有IP地址网段如下：  
A类：1个A类网段，即 $\mathbf{10.0.0.0{\sim}10.255.255.255.}$ B类：16个B类网段，即172.16.0.0\~172.31.255.255。C类：256个C类网段，即192.168.0.0\~192.168.255.255。  

在互联网中的所有路由器，对目的地址是私有地址的数据报一律不进行转发。这种采用私有IP地址的互联网络称为专用互联网或本地互联网。私有IP地址也称可重用地址。  

使用NAT时需要在专用网连接到互联网的路由器上安装NAT软件，NAT路由器至少有一个有效的外部全球IP地址。当使用本地地址的主机和外界通信时，NAT路由器使用NAT转换表进行本地IP地址和全球IP地址的转换。NAT转换表中存放着{本地IP地址：端口}到{全球IP地址：端口}的映射。通过这种映射方式，可让多个私有IP地址映射到一个全球IP地址。  

# 命题追踪NAT的原理和应用（2016、2019、2020、2023）  

如图4.8所示，假设某家庭办理了10Mb/s的电信宽带，那么该家庭就获得一个全球IP地址（如138.76.29.7），而家庭网络内3台主机使用私有地址（如10.0.0.0网段），家庭网关路由器应开启NAT功能。NAT路由器的工作原理： $\textcircled{\scriptsize{1}}$ 假设用户主机10.0.0.1（随机端口3345）向Web服务器128.119.40.186（端口80）发送请求。 $\circledcirc$ NAT路由器收到IP分组后，为该IP分组生成一个新端口号5001，将IP分组的源地址改为138.76.29.7（即NAT路由器的全球IP地址），将源端口号改为5001。NAT路由器在NAT转换表中增加一个表项。 $\textcircled{3}$ Web服务器并不知道刚抵达的IP分组已被NAT路由器改装，更不知道用户的专用地址，它响应的IP分组的自的地址是NAT路由器的全球IP地址138.76.29.7，目的端口号是5001。 $\textcircled{4}$ 响应分组到达NAT路由器后，通过NAT转换表将IP分组的目的IP地址改为10.0.0.1，将目的端口号改为3345。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/e02ffb33271e0f0ef1690c1d80df4b45778e6944f11d8a56baafaeed794a29f0.jpg)  
图4.8NAT路由器的工作原理  

这样，只需要一个全球IP地址，就可让多台主机同时访问互联网。  

# 注意  

普通路由器在转发IP分组时，其源IP地址和目的IP地址都不会改变。而NAT路由器在转发IP分组时，一定要更换其IP地址（转换源IP地址或目的IP地址）。普通路由器仅工作在网络层，而NAT路由器转发数据报时需要查看和转换传输层的端口号。  
# 4.2.3划分子网与路由聚合  

# 1.划分子网  

两级IP地址的缺点：IP地址空间的利用率有时很低：给每个物理网络分配一个网络号会使路由表变得太大，进而使网络性能变坏；两级IP地址不够灵活。  

从1985年起，在IP地址中又增加了一个“子网号字段”，使两级IP地址变成了三级IP地址。这种做法称为划分子网。划分子网已成为互联网的正式标准协议。  

划分子网的基本思路如下：  

划分子网纯属一个单位内部的事情。单位对外仍然表现为没有划分子网的一个网络，划分子网的方法是从网络的主机号借用若干位作为子网号，当然主机号也相应减少了相同的位数。三级IP地址的结构：IP地址： $=$ {<网络号>，<子网号>，<主机号>}。路由器转发分组根据的仍然是IP数据报的目的网络号，本单位的路由器收到TP数据报后，再按目的网络号和子网号找到目的子网。最后把IP数据报交付给目的主机。  

例如，将一个C类网络208.115.21.0划分为4个子网，子网号占用2位，因此主机号就只有6位，各子网的网络地址分别为208.115.21.0、208.115.21.64、208.115.21.128、208.115.21.192。每个子网可分配的IP地址数为 $2^{6}{-}2{=}62$  

# 注意  

$\textcircled{\scriptsize{1}}$ 划分子网只是把IP地址的主机号部分进行再划分，而不改变IP地址原来的网络号。因此，从一个ⅡP地址本身无法判断该主机所连接的网络是否进行了子网划分。 $\textcircled{2}$ 子网中的主机号全0或全1的地址不能被指派，其中主机号全0的地址为子网的网络地址，主机号全1的地址为子网的广播地址。 $\textcircled{3}$ 划分子网增加了灵活性，但减少了能够连接在网络上的主机总数。  

# 2.子网掩码和默认网关  

子网掩码可用来指明分类IP地址的主机号部分被借用了多少位作为子网号。命题追踪根据IP地址和子网掩码求网络地址（2022）  

子网掩码是一个与IP地址相对应的、长32位的二进制串，它由一串1和跟随的一串0组成。其中，1对应于IP地址中的网络号及子网号，而0对应于主机号。主机或路由器只需将IP地址和其对应的子网掩码逐位“与”（AND运算），就可得出相应子网的网络地址。  

# 命题追踪默认网关配置错误对访问局域网和跨网访问的影响（2015）  

# 命题追踪默认网关和子网掩码的配置分析（2016、2019、2022）  

默认网关是子网与外部网络连接的设备，也就是连接本机或子网的路由器接口的IP地址。当主机发送数据时，根据所发送数据的目的IP地址，通过子网掩码来判定目的主机是否在子网中，若自的主机在子网中，则直接发送。若目的主机不在子网中，则将该数据发送到默认网关，由网关（路由器）将其转发到其他网络，进一步寻找目的主机。  

现在的互联网标准规定：所有网络都必须使用子网掩码。若一个网络未划分子网，则该网络的子网掩码就使用默认子网掩码。A、B、C类地址的默认子网掩码分别为255.0.0.0、255.255.0.0、255.255.255.0。例如，某主机的1P地址为192.168.5.56，子网掩码为255.255.255.0，进行逐位“与”运算后，得出该主机所在子网的网络号为192.168.5.0。  

子网掩码是一个网络的重要属性，路由器相互之间交换路由信息时，必须将自己所在网络的子网掩码告诉对方。分组转发时，路由器将分组的自标地址和某网络的子网掩码按位相与，若结果与该网络地址一致，则路面匹配成功，路由器将分组转发至该网络。  
在使用子网掩码的情况下：  

$\textcircled{\scriptsize{1}}$ 一台主机在设置IP地址信息的同时，必须设置子网掩码。 $\circledcirc$ 同属于一个子网的所有主机及路由器的相应端口，必须设置相同的子网掩码。 $\textcircled{3}$ 路由器的路由表中所包含的信息主要内容有目的网络地址、子网掩码、下一跳地址。  

# 3.无分类编址CIDR  

无分类域间路由选择（Classless Inter-Domain Routing，CIDR），提出的一种消除传统A、B、C类地址及划分子网的概念。例如，若一个单位需要2000个地址，则给它分配一个2048地址的块，而不分配一个完全的B类地址，因此可更有效地分配IPv4的地址空间。CIDR使用网络前缀的概念代替网络的概念，与传统分类IP地址最大的区别就是，网络前缀的位数不是固定的，可以任意选取。CIDR的记法是  

IP地址： $=$ {<网络前缀>，<主机号>}。  

# 命题追踪CIDR地址块的分析（2011、2015、2016、2019、2023）  

CIDR还使用斜线记法（或称CIDR记法），即记为“TP地址/网络前缀所占的位数”。其中，网络前缀所占的位数对应网络号的部分，等效于子网掩码中连续1的部分。例如，对于128.14.32.5/20这个地址，它的掩码是20个连续的1和后续12个连续的0，通过逐位“与”的方法可得该地址的网络前缀（或直接截取前20位）：  

IP=10000000.00001110.00100000.00000101 逐位与 掩码  $=$  11111111.11111111.11110000.00000000 网络前缀 $=$ 10000000.00001110.00100000.00000000(128.14.32.0)  

斜线记法不仅能表示其IP地址，而且能表示这个地址块的网络前缀有多少位。  

# 命题追踪地址块的最小地址和最大地址分析（2023）  

CIDR将网络前缀都相同的连续IP地址组成一个CIDR地址块。只要知道CIDR地址块中的任何一个地址，就能知道这个地址块的最小地址和最大地址，以及地址块中的地址数。上例的地址128.14.32.5/20所在CIDR地址块中的最小地址和最大地址为  

最小地址：10000000.00001110.00100000.00000000（128.14.32.0）最大地址：10000000.00001110.00101111.11111111（128.14.47.255）  

主机号全0或全1的地址一般不使用，通常只使用在这两个特殊地址之间的地址。  

CIDR虽然不使用子网，但仍然使用“掩码”一词。“CIDR不使用子网”是指CIDR并没有在32位地址中指明若干位作为子网字段。但分配到一个CIDR地址块的单位，仍可在本单位内根据需要划分出一些子网。例如，某单位分配到地址块/20，就可继续划分为8个子网（从主机号中借用3位来划分子网），这时每个子网的网络前缀就变成了23位。  

# 命题追踪子网广播地址/网络地址的分析（2011、2012、2018、2019）  

CIDR地址块中的地址数一定是2的整数次幂，实际可指派的地址数通常为 $2^{N}\!-\!2$  $N$ 表示主机号的位数，主机号全0代表网络号，主机号全1为广播地址。网络前缀越短，其地址块包含的地址数就越多。而在三级结构的IP地址中，划分子网使网络前缀变长。  
# 4.路由聚合  

因为一个CIDR地址块中有很多地址，所以在路由表中就可利用CIDR地址块来查找目的网络。这种地址的聚合称为路由聚合，也称构成超网，它使得路由表中的一个项自可以表示多个原来传统分类地址的路由，有利于减少路由器之间的信息交换，进而提高网络性能。  

# 命题追踪路由聚合的分析（2009、2011、2013、2014、2018）  

例如，在如图4.9所示的网络中，若不使用路由聚合，则R1的路由表中需要分别有到网络1和网络2的路由表项。不难发现，网络1和网络2的网络前缀在二进制表示的情况下，前16位都是相同的，第17位分别是0和1，并且从R1到网络1和网络2的路由的下一跳皆为R2。若使用路由聚合，则在R1看来，网络1和网络2可以构成一个更大的地址块206.1.0.0/16，到网络1和网络2的两条路由就可聚合成一条到206.1.0.0/16的路由。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/3c327d3febd0959034937d5135371eb34698ee1d81aeb0c0a097b58a53585744.jpg)  
图4.9路由聚合的例子  

# 命题追踪路由器分组转发的最长前缀匹配（2013、2015）  

最长前缀匹配（又称最佳匹配）：使用CIDR时，路由表中的个项由“网络前缀”和“下一跳地址”组成。在查找路由表时可能会得到不止一个匹配结果。此时，应当从匹配结果中选择具有最长网络前缀的路由，因为网络前缀越长，其地址块就越小，因此路由就越具体。  

CIDR查找路由表的方法：为了更有效地查找最长前缀匹配，通常将无分类编址的路由表存放在一种层次式数据结构（通常采用二叉线索）中，然后自上而下地按层次进行查找。  

CIDR的优点在于网络前缀长度的灵活性。因为上层网络的前缀长度较短，所以相应的路由表的项目较少。而内部又可采用延长网络前缀的方法来灵活地划分子网。  

# 5.子网划分的应用举例  

通常有两类划分子网的方法：采用定长的子网掩码，采用变长的子网掩码。  

（1）采用定长的子网掩码划分子网  

当采用定长的子网掩码划分子网时，所划分的每个子网使用相同的子网掩码，并且每个子网所分配的IP地址数量也相同，因此容易造成地址资源的浪费。  

# 命题追踪采用定长子网掩码划分子网的应用（2009、2010、2017、2018）  

假设某单位拥有一个CIDR地址块为208.115.21.0/24，该单位有三个部门，各部门的主机台数分别为50、20、5，采用定长的子网掩码给各部门分配IP地址。  

部门1需要51个IP地址（含一个路由器接口地址）；部门2需要21个IP地址；部门3需要6个IP地址。接下来，从给定地址块208.115.21.0/24的主机号部分借用2位作为子网号，这样可以划分为 $2^{2}{=}4$ 个子网，每个子网可分配的IP地址数为 $2^{8-2}{-}2\!=\!62$ ，可满足各部门的需求。各子网的划分如下（为书写方便，只把IP地址的后8位用二进制展开）：  

208.115.21.00000000～208.115.21.00111111，地址块“208.115.21.0/26”，分配给部门1。208.115.21.01000000\~208.115.21.01111111，地址块“208.115.21.64/26”，分配给部门2。208.115.21.10000000\~208.115.21.10111111，地址块“208.115.21.128/26”，分配给部门3。  
208.115.21.11000000\~208.115.21.11111111，地址块“208.115.21.192/26”，留作以后用。子网掩码：255.255.255.1100000，即255.255.255.192。（2）采用变长的子网掩码划分子网  

命题追踪采用变长子网掩码划分子网的应用（2019、2021）  

采用变长的子网掩码划分子网时，所划分的每个子网可以使用不同的子网掩码，并且每个子网所分配的IP地址数量可以不同，这样就尽可能地减少了对地址资源的浪费。  

假设各种条件与上一节的相同，下面采用变长的子网掩码给该单位分配DP地址。  

部门1的主机号需6位，剩余26（ $(32-6=26\$ ）位作为网络前缀；部门2的主机号需5位，剩余27（ $32-5=27)$ ）位作为网络前缀；部门3的主机号需3位，剩余29 $(32-3=29\$ ）位作为网络前缀。接下来，从地址块 $208.115.21.0/24$ 中划分出3个子网（1个“/26”地址块，1个“727”地址块，1个“/29”地址块），并按需分配给三个部门。每个子网的最小地址只能选取主机号全0的地址。划分方案不唯一，建议从大的子网开始划分。以下是一种划分方案：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/ac44667c05deef529ea237a5beaa962fc08414413a27f237c11d6473ec294d88.jpg)  

再次提醒，子网主机号全0或全1的地址不能分配。对于一段连接两个路由器的链路，可以分配一个“730”地址块，这样可分配地址为2个，恰好可分配给链路两端的路由器接口。  

# 4.2.4网络层转发分组的过程  

分组转发都是基于目的主机所在网络的，这是因为互联网上的网络数远小于主机数，这样可以极大地压缩转发表的大小。当分组到达路由器后，路由器根据目的IP地址的网络前缀来查找转发表，确定下一跳应当到哪个路由器。因此，在转发表中，每条路由必须有下面两条信息：  

（目的网络地址，下一跳地址）  

这样，IP数据报最终一定可以找到目的主机所在目的网络上的路由器（可能要通过多次间接交付），当到达最后一个路由器时，才试图向目的主机进行直接交付。  

采用CIDR编址时，若一个分组在转发表中可以找到多个匹配的前缀，则应当使用最长前缀匹配。为了更快地查找转发表，可以按照前缀的长短，将前缀最长的排在第1行，按前缀长度的降序排列。这样，从第1行最长的开始查找，只要检索到匹配的，就不必再继续查找。  

此外，在路由表中还可以增加两种特殊的路由：  

# 命题追踪特定主机路由的应用（2009）  

1）特定主机路由：对特定目的主机的IP地址专门指明一个路由，以方便网络管理员控制和  
测试网络。若特定主机的IP地址是a.b.c.d，则转发表中对应项的目的网络是a.b.c.d/32。/32表示的子网掩码没有意义，但这个特殊的前缀可以用在转发表中。  

# 命题追踪默认路由的应用（2009、2014）  

2）默认路由：用特殊前缀0.0.0.0/0表示默认路由，全0掩码和任何目的地址进行按位与运算，结果必然为全0，即必然和前缀 $0.0.0.0/0$ 相匹配。只要目的网络是其他网络（不在转发表中），就一律选择默认路由。默认路由通常用于路由器到互联网的路由，互联网包括无数的网络集合，不可能在路由表项中一一列出，因此只能采用默认路由的方式。  

综上所述，归纳出路由器执行的分组转发算法如下：1）从收到的IP分组的首部提取目的主机的IP地址 $D$ （即目的地址）。  

2）若查找到特定主机路由（目的地址为 $D$ ），则按照这条路由的下一跳转发分组；否则从转发表中的下一条（即按前缀长度的顺序）开始检查，执行步骤3）。  

3）将这一行的子网掩码与目的地址 $D$ 逐位“与”（AND操作）。若运算结果与本行的前缀匹配，则查找结束，按照“下一跳”指出的进行处理（或者直接交付本网络上的目的主机，或通过指定接口发送到下一跳路由器）。否则，若转发表还有下一行，则对下一行进行检查，重新执行步骤3）。否则，执行步骤4）。  

4）若转发表中有一个默认路由，则把分组传送给默认路由；否则，报告转发分组出错。  

值得注意的是，转发表（或路由表）并没有给分组指明到某个网络的完整路径（即先经过哪个路由器，然后经过哪个路由器等）。转发表指出，到某个网络应当先到某个路由器（即下一跳路由器），到达下一跳路由器后，再继续查找其转发表，知道再下一步应当到哪个路由器。这样一步一步地查找下去，直到最后到达目的网络。  

# 注意  

得到下一跳路由器的IP地址后，并不是直接将该地址填入待发送的数据报，而是将该IP地址转换成MAC地址（通过ARP），将此MAC地址填入MAC帧首部，然后根据这个MAC地址找到下一跳路由器。在不同网络中传送时，MAC帧的源地址和目的地址要发生变化。  

# 4.2.5地址解析协议 （ARP)  

# 1.IP地址与硬件地址  

IP地址是网络层及网络层之上使用的地址，它是分层式的。硬件地址（MAC地址）是数据链路层使用的地址，它是平面式的。IP地址放在IP数据报的首部，而MAC地址放在MAC帧的首部。把IP数据报封装为MAC帧后，数据链路层看不见IP数据报中的IP地址。  

因为路由器的隔离，IP网络中无法通过广播MAC地址来完成跨网络的寻址，所以在网络层只使用IP地址来完成寻址。寻址时，每个路由器依据其路由表（依靠路由协议生成）选择到目标网络（即主机号全为0的网络地址）需要转发到的下一跳（路由器的物理端口号或下一网络地址），而IP数据报通过多次路由转发到达自标网络后，改为在自标局域网中通过数据链路层的MAC地址以广播方式寻址。这样可以提高路由选择的效率。  

下列几个性质是计算机网络的精髓，有必要特别强调：  

1）在IP层抽象的互联网上只能看到IP数据报。2）虽然在IP数据报首部中有源IP地址，但路由器只根据目的IP地址进行转发。3）在局域网的链路层，只能看见MAC帧。IP数据报被封装在MAC帧中。通过路由器转发  
时，IP数据报在每个网络中都被路由器解封装和重新封装，其MAC帧首部中的源地址和自的地址会不断改变。这也决定了无法使用MAC地址跨网络通信。  

4）尽管互连在一起的网络的硬件地址体系各不相同，但IP层抽象的互联网却屏蔽了下层这些复杂的细节。只要我们在网络层上讨论问题，就能够使用统一的、抽象的IP地址研究主机与主机或路由器之间的通信。  

# 注意  

路由器因为互连多个网络，所以它不仅有多个IP地址，而且有多个硬件地址。  

# 2.地址解析协议  

# 命题追踪  

ARP的功能和应用（2011、2012、2021）  

无论网络层使用什么协议，在实际网络的链路上传送数据顺时，最终必须使用硬件地址。所以需要一种方法来完成IP地址到MAC地址的映射，这就是地址解析协议（AddressResolutionProtocol，ARP）。每台主机都设有一个ARP高速缓存，用来存放本局域网上各主机和路由器的IP地址到MAC地址的映射表，称ARP表。使用ARP来动态维护ARP表。  

# 命题追踪ARP请求帧的目的MAC地址（2011、2015）  

ARP工作在网络层，其工作原理如下：主机A欲向本局域网上的某台主机B发送IP数据报时，先在其ARP高速缓存中查看有无主机B的IP地址。若有，则可以查出其对应的硬件地址，再将此硬件地址写入MAC帧，然后通过局域网将该MAC帧发往此硬件地址。若没有，则通过使用目的MAC地址为FF-FF-FF-FF-FF-FF的帧来封装并广播ARP请求分组（广播发送），使同一个局域网里的所有主机都收到此ARP请求。主机B收到该ARP请求后，向主机A发出ARP响应分组（单播发送），分组中包含主机B的IP地址与MAC地址的映射关系，主机A收到ARP响应分组后就将此映射写入ARP缓存，然后按查询到的硬件地址发送MAC帧。ARP因为“看到了”IP地址，所以它工作在网络层，而NAT路由器因为“看到了”端口，所以它工作在传输层。对于某个协议工作在哪个层次，读者应该能通过协议的工作原理进行推测。  

# 注意  

ARP用于解决同一局域网上的主机或路由器的IP地址和硬件地址的映射问题。若目的主机和源主机不在同一个局域网上，则要通过ARP找到本局域网上的某个路由器的硬件地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络，剩下的工作就由下一个网络来做。尽管ARP请求分组是广播发送的，但ARP响应分组是普通的单播。  

使用ARP的4种典型情况总结如下（见图4.10）。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/9a0240a6e9ad5e98a9ca150689311067f19352ad0f9a539c54df2672c931882b.jpg)  
图4.10使用ARP的4种典型情况  

1）发送方是主机（如 $\mathrm{H}_{1}$ )，要把IP分组发送到本网络上的另一台主机（如 $\mathrm{H}_{2}$ )。这时 $\mathrm{H}_{1}$ 在  
网1用ARP找到目的主机 $\mathrm{H}_{2}$ 的硬件地址。  

2）发送方是主机（如 $\mathrm{H}_{1}$ )，要把IP分组发送到其他网络上的一台主机（如 $\mathrm{H}_{4}.$ ）。这时 $\mathrm{H}_{1}$ 用ARP找到与网1连接的路由器 $\mathsf{R}_{1}$ 的硬件地址（默认网关），剩下的工作由 $\mathsf{R}_{1}$ 来完成。  

命题追踪跨局域网的帧的目的MAC地址（2015）  

# 注意  

开始在 $\mathrm{H}_{1}$ 和 $\mathsf{R}_{1}$ 之间传送时，MAC帧首部中的源地址是 $\mathrm{H}_{1}$ 的MAC地址，目的地址是 $\mathrm{L}_{1}$ 的硬件地址，路由器 $\mathsf{R}_{1}$ 收到此MAC帧后，在数据链路层，要丢弃原MAC的首部和尾部。这时首部中的源地址和目的地址分别为 $\mathrm{L}_{2}$ 和 $\mathrm{L}_{3}$ 的MAC地址。路由器 $\mathrm{R}_{2}$ 收到此帧后，再次更换MAC帧的首部和尾部，首部中的源地址和目的地址分别变为 $\mathrm{L}_{4}$ 和 $\mathrm{H}_{4}$ 的MAC地址。MAC顿首部的这种变化，在上面的IP层中是看不见的。  

3）发送方是路由器（如 $\mathsf{R}_{1}$ )，要把IP分组转发到与 $\mathsf{R}_{1}$ 连接的网络（网2）上的一台主机（如 $\mathrm{H}_{3}$ )。这时 $\mathrm{R_{1}}$ 在网2用ARP找到目的主机 $\mathrm{H}_{3}$ 的硬件地址。4）发送方是路由器（如 $\mathsf{R}_{1}$ ），要把IP分组转发到网3上的一台主机（如 $\mathrm{H}_{4}\mathrm{.}$ 。这时 $\mathrm{R_{1}}$ 在网2用ARP找到与网2连接的路由器 $\mathbb{R}_{2}$ 的硬件地址，剩下的工作由 $\mathbb{R}_{2}$ 来完成。从IP地址到硬件地址的解析是自动进行的，主机的用户并不知道这种地址解析过程。只要主机或路由器和本网络上的另一个已知IP地址的主机或路由器进行通信，ARP就自动地将这个IP地址解析为数据链路层所需要的硬件地址。  

# 4.2.6 动态主机配置协议 (DHCP)  

动态主机配置协议（Dynamic Host Configuration Protocol，DHCP） IP地址，它提供了即插即用的连网机制，这种机制允许一台计算机加入新的网络和自动获取IP地址而不用手工参与。DHCP是应用层协议，它是基于UDP的。  

# 命题追踪DHCP发现报文的作用（2022）  

DHCP的工作原理如下：使用客户/服务器模型。需要IP地址的主机在启动时就向DHCP服务器广播发送发现报文，这时该主机就成为DHCP客户。本地网络上的所有主机都能收到这个广播报文，但只有DHCP服务器才能回答此广播报文。DHCP服务器先在其数据库中查找该计算机的配置信息。若找到，则返回找到的信息；若找不到，则从服务器的IP地址池中取一个地址分配给该计算机。DHCP服务器的回答报文称为提供报文。  

# 命题追踪DHCP发现报文的源地址和目的地址（2015、2022）  

DHCP服务器和DHCP客户的交换过程如下：  

1）DHCP客户广播“DHCP发现”消息，试图找到网络中的DHCP服务器，以便从DHCP服务器获得一个IP地址。源地址为0.0.0.0，目的地址为255.255.255.255。2）DHCP服务器收到“DHCP发现”消息后，广播“DHCP提供”消息，其中包括提供给DHCP客户机的IP地址。源地址为DHCP服务器地址，目的地址为255.255.255.255。3）DHCP客户收到“DHCP提供”消息，若接受该IP地址，则广播“DHCP请求”消息向DHCP服务器请求提供IP地址。源地址为0.0.0.0，目的地址为255.255.255.255。4）DHCP服务器广播“DHCP确认”消息，将IP地址分配给DHCP客户。源地址为DHCP 服务器地址，目的地址为255.255.255.255。  
DHCP允许网络上配置多台DHCP服务器，当DHCP客户发出“DHCP发现”消息时，有可能收到多个应答消息。这时，DHCP客户只会挑选其中的一个，通常挑选最先到达的。  

DHCP服务器分配给DHCP客户的IP地址是临时的，因此DHCP客户只能在一段有限的时间内使用这个分配到的IP地址。DHCP称这段时间为租用期。租用期的数值应由DHCP服务器自己决定，DHCP客户也可在自己发送的报文中提出对租用期的要求。  

DHCP客户和服务器端需要通过广播方式来进行交互，原因是在DHCP执行初期，客户机不知道服务器端的IP地址，而在执行中间，客户机并未被分配IP地址，从而导致两者之间的通信必须采用广播的方式。采用UDP而不采用TCP的原因也很明显：TCP需要建立连接，若连对方的IP地址都不知道，则更不可能通过双方的套接字建立连接。  

DHCP是应用层协议，因为它是通过客户/服务器模式工作的，DHCP客户向DHCP服务器请求服务，而其他层次的协议是没有这两种工作方式的。  

# 4.2.7网际控制报文协议（ICMIP）  

# 命题追踪直接为ICMP提供服务的协议（2012）  

为了有效地转发IP数据报和提高交付成功的机会，在网络层使用了网际控制报文协议（Internet Control Message Protocol，ICMP），。ICMP报文被封装在IP数据报中发送，但ICMIP不是高层协议，而是网络层的协议。  

ICMP报文有两种，即ICMP差错报告报文和ICMP询问报文。  

# 命题追踪ICMP差错报文的类型及含义（2022）  

ICMIP差错报告报文用于目标主机或到目标主机路径上的路由器，向源主机报告差错和异常情况。共有以下5种常用的类型：  

1）终点不可达。当路由器或主机不能交付数据报时，就向源点发送终点不可达报文。2）源点抑制。当路由器或主机因为拥塞而丢弃数据报时，就向源点发送源点抑制报文，使源点知道应当把数据报的发送速率放慢。3）时间超过。当路由器收到生存时间（TTL）为零的数据报时，除丢弃该数据报外，还要向源点发送时间超过报文。当终点在预先规定的时间内不能收到一个数据报的全部数据报片时，就把已收到的数据报片都丢弃，并向源点发送时间超过报文。4）参数问题。当路由器或目的主机收到的数据报的首部中有的字段的值不正确时，就丢弃该数据报，并向源点发送参数问题报文。5）改变路由（重定向）。路由器把改变路由报文发送给主机，让主机知道下次应将数据报发送给另外的路由器（可通过更好的路由）。  

对于以下几种情况，不应发送ICMIP差错报告报文：1）对ICMP差错报告报文，不再发送ICMP差错报告报文。 2）对第一个分片的数据报片的所有后续数据报片，都不发送ICMIP差错报告报文。  

3）对具有多播地址的数据报，都不发送ICMP差错报告报文。4）对具有特殊地址（如127.0.0.0或0.0.0.0）的数据报，不发送ICMP差错报告报文。  

ICMP询问报文有4种类型：回送请求和回答报文、时间戳请求和回答报文、地址掩码请求和回答报文、路由器询问和通告报文，最常用的是前两类。  
ICMP的两个常见应用是分组网间探测PING（用来测试两台主机之间的连通性）和Traceroute （UNIX中的名字，在Windows中是Tracert，可以用来跟踪分组经过的路由）。其中PING使用了ICMP回送请求和回答报文，Traceroute（Tracert）使用了ICMP时间超过报文。  

# 注意  

PING工作在应用层，I CMP；Traceroute/Tracer t。  

# 4.2.8 本节习题精选  

# 一、单项选择题  

01.Internet的网络层含有4个重要的协议，分别为（）。  

A.IP，ICMP，ARP，UDP B.TCP，ICMP,UDP，ARP C.IP，ICMP，ARP，RARP D.UDP,IP，ICMP，RARP  

02.以下关于IP分组结构的描述中，错误的是（）。  

A.IPv4分组头的长度是可变的B.协议字段表示IP的版本，值为4表示IPv4C.分组头长度字段以4B为单位，总长度字段以字节为单位D.生存时间字段值表示一个分组可以经过的最多的跳数  

03.IPv4分组首部中有两个有关长度的字段：首部长度和总长度，其中（）  

A.首部长度字段和总长度字段都以8比特为计数单位B.首部长度字段以8比特为计数单位，总长度字段以32比特为计数单位C.首部长度字段以32比特为计数单位，总长度字段以8比特为计数单位D.首部长度字段和总长度字段都以32比特为计数单位  

04.下列关于IP分组的首部检验和字段的说法中，正确的是（）  

A.检验和字段检查的范围是整个IP分组B.计算检验和的方法是对首部的每个16比特按反码运算求和再取反码C.若网络层发现检验和错误，则丢弃该IP分组并发送ICIMP差错报文D.IP分组的检验和的计算需要加入一个伪首部  

05.当数据报到达目的网络后，要传送到目的主机，需要知道IP地址对应的（）A.逻辑地址B.动态地址C.域名D.物理地址  

06.若IPv4的分组太大，会在传输中被分片，则在（）将对分片后的数据报重组。A.中间路由器B.下一跳路由器C.核心路由器D.目的主机  

07.在IP首部的字段中，与分片和重组无关的字段是（）A.总长度 B.标识 C.标志 D.片偏移 08.以下关于IP分组的分片与组装的描述中，错误的是（）。  

A.IP分组头中与分片和组装相关的字段是：标识、标志与片偏移 B.IP分组规定的最大长度为65535BC.以太网的MTU为1500B D.片偏移的单位是4B  

09.若一个IP分组的片偏移字段的值为100，则意味着（）  

A.该IP分组没有分片B.该IP分组的长度为100B  
C.该1IP分组的第一个字节是分片前的第100个字节D.该IP分组的第一个字节是分片前的第800个字节  

10.以下关于IP分组分片基本方法的描述中，错误的是（）  

A.IP分组长度大于MTU时，就必须对其进行分片B. $\mathrm{DF}\!=\!1$ ，分组的长度又超过MTU时，则丢弃该分组，不需要向源主机报告C.分片的MF值为1表示接收到的分片不是最后一个分片D.属于同一原始IP分组的分片具有相同的标识  

11.某IP分组的片偏移字段值为100，首部长度字段值为5，总长度字段值为100，则该IP 分组的数据部分的第一个字节的编号与最后一个字节的编号是（）。  

A.100,200 B.100,500 C.800,879 D.800,900  

12.路由器R0的路由表见下表。若进入路由器R0的分组的目的地址为132.19.237.5，则该分组应该被转发到（）下一跳路由器。  

A. R1 B.R2 C.R3 D.R4  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/7d1fce7888787482b2694a4bb608ee1d3aca4e2aa8eddf74e21ca8751ac5dab9.jpg)  

13.IP规定每个C类网络最多可以有（）台主机或路由器。  

A.254 B.256 C.32 D.1024  

14.下列地址中，属于子网86.32.0.0/12的地址是（）。  

A.86.33.224.123B.86.79.65.126 C.86.79.65.216 D.86.68.206.154  

15.下列地址中，属于单播地址的是（）  

A.172.31.128.255/18 B.10.255.255.255 C.192.168.24.59/30 D.224.105.5.211  

16.下列地址中，属于本地回路地址的是（）A.10.10.10.1 B.255.255.255.0 C.192.0.0.1 D.127.0.0.1  

17.访问互联网的每台主机都需要分配IP地址（假定采用默认子网掩码），下列可以分配给主机的IP地址是（）。  

A.192.46.10.0 B.110.47.10.0 C.127.10.10.17 D.211.60.256.21  

18.为了提供更多的子网，为一个B类地址指定了子网掩码255.255.240.0，则每个子网最多可以有的主机数是（）。  

A. 16 B.256 C.4094 D.4096  

19.不考虑NAT，在Internet中，IP数据报从源结点到目的结点可能需要经过多个网络和路由器。在整个传输过程中，IP数据报首部中的（）。  

A.源地址和目的地址都不会发生变化B.源地址有可能发生变化而目的地址不会发生变化C.源地址不会发生变化而目的地址有可能发生变化D.源地址和目的地址都有可能发生变化  

20.把IP网络划分成子网，这样做的好处是（）。  

A.增加冲突域的大小B.增加主机的数量C.减少广播域的大小D.增加网络的数量  
21.一个网段的网络号为198.90.10.0/27，最多可以分成（）个子网，每个子网最多具有（）个有效的IP地址。  

A.8,30 B.4,62 C.16, 14 D.32,6  

22.一台主机有两个IP地址，一个地址是192.168.11.25，另一个地址可能是（）。  

A.192.168.11.0 B.192.168.11.26 C.192.168.13.25 D.192.168.11.24  

23.CIDR技术的作用是（）  

A.有效分配IP地址空间，并减少路由表的数目B.把大的网络划分成小的子网C.彻底解决IP地址资源不足的问题D.由多台主机共享同一个网络地址  

24．某个CIDR表示的IPv4地址为126.166.66.99/22，则下面的描述中错误的是（）。  

A.网络前级占用22比特B.主机编号占用10比特C.所在地址块包含的地址数为 $2^{10}$ D.126.166.66.99是所在地址块的第一个地址  

25.某网络的一台主机的IP地址是200.15.10.6/29，其配置的默认网关地址是200.15.10.7，这样配置后发现主机无法PING通任何远程设备，原因是（）  

A.默认网关的地址不属于这个子网B.默认网关的地址是子网中的广播地址C.路由器接口的地址是子网的广播地址D.路由器接口的地址是多播地址  

26.CIDR地址块192.168.10.0/20所包含的IP地址范围是（ $\textcircled{\scriptsize{1}}$ )。与地址192.16.0.19/28同属于一个子网的主机地址是（ $\textcircled{2}$ )。  

$\textcircled{\scriptsize{1}}$  A.192.168.0.0\~192.168.12.255 B.192.168.10.0\~192.168.13.255 C.192.168.10.0 \~192.168.14.255 D.192.168.0.0\~192.168.15.255  $\circledcirc$  A.192.16.0.17B.192.16.0.31 C.192.16.0.15 D.192.16.0.14  

27.路由表错误和软件故障都可能使得网络中的数据形成传输环路而无限转发环路的分组，IPv4协议解决该问题的方法是（）。  

A.报文分片B.设定生命期C.增加检验和D.增加选项字段

28.为了解决IP地址耗尽的问题，可以采用以下一些措施，其中治本的是（）。  

A.划分子网 B.采用无类比编址CIDR C.采用网络地址转换NATD.采用IPv6  

29.下列对IP分组的分片和重组的描述中，正确的是（）。  

A.IP分组可以被源主机分片，并在中间路由器进行重组B.IP分组可以被路径中的路由器分片，并在目的主机进行重组C.IP分组可以被路径中的路由器分片，并在中间路由器上进行重组D.IP分组可以被路径中的路由器分片，并在最后一跳的路由器上进行重组  

30.一个网络中有几个子网，其中一个已分配了子网号74.178.247.96/29，则下列网络前缀中不能再分配给其他子网的是（）。  

A.74.178.247.120/29 B.74.178.247.64/29 C.74.178.247.96/28 D.74.178.247.104/29  

31.主机A和主机B的IP地址分别为216.12.31.20和216.13.32.21，要想让A和B工作在同一个IP子网内，应该给它们分配的子网掩码是（）  

A.255.255.255.0B.255.255.0.0 C.255.255.255.255 D.255.0.0.0  
32.某单位分配了1个B类地址，计划将内部网络划分成35个子网，将来可能增加16个子网，每个子网的主机数目接近800台，则可行的掩码方案是（）。  

A.255.255.248.0 B.255.255.252.0 C. 255.255.254.0 D.255.255.255.0  

33.设有4条路由172.18.129.0/24、172.18.130.0/24、172.18.132.0/24和172.18.133.0/24，若进行路由聚合，则能覆盖这4条路由的地址是（）。  

A.172.18.128.0/21 B.172.18.128.0/22 C.172.18.130.0/22 D.172.18.132.0/23  

34．下列四个地址块中，与地址块172.16.166.192/26不重叠，且与172.16.166.192/26聚合后的地址块不会引入多余地址的是（）。  

A.172.16.166.192/27 B.172.16.166.128/26 C.172.16.166.0/26 D.172.16.166.0/25  

35.在一条点对点链路上，为了减少IP地址的浪费，子网掩码应指定为（）  

A.255.255.255.252 B.255.255.255.248 C.255.255.255.240 D.255.255.255.196  

36.某子网的子网掩码为255.255.255.224，一共给4台主机分配了1P地址，其中一台因1P地址分配不当而存在通信故障。这一台主机的IP地址是（）。  

A.202.3.1.33 B.202.3.1.65 C. 202.3.1.44 D.202.3.1.55  

37.某主机的IP地址是166.66.66.66，子网掩码为255.255.192.0，若该主机向其所在子网发送广播分组，则目的IP地址应该是（）。  

A.166.66.66.255B.166.66.255.255C.166.255.255.255D.166.66.127.255  

38.现将一个IP网络划分成4个子网，若其中一个子网是172.16.1.128/26，则下列网络中，不可能是另外三个子网之一的是（）  

A.172.16.1.0/25 B.172.16.1.64/26C.172.16.1.96/27D.172.16.1.224/27

39.位于不同子网中的主机之间相互通信时，下列说法中正确的是（）。  

A.路由器在转发IP数据报时，重新封装源硬件地址和目的硬件地址B.路由器在转发IP数据报时，重新封装源IP地址和目的IP地址C.路由器在转发IP数据报时，重新封装目的硬件地址和目的IP地址D.源站点可以直接进行ARP广播得到目的站点的硬件地址  

40.路由器收到自的1P地址为255.255.255.255的分组，则路由器的操作是（）  

A.丢弃该IP分组B.从所有其他接口转发该IP分组C.通过路由表中的默认路由转发该IP分组D.通过路由表中的特定主机路由转发该IP分组  

41.根据NAT协议，下列IP地址中（）不允许出现在互联网上。  

A.192.172.56.23B.172.15.34.128 C.192.168.32.17 D.172.128.45.34  

42.下列情况需要启动ARP请求的是（）  

A.主机需要接收信息，但ARP表中没有源IP地址与MAC地址的映射关系B.主机需要接收信息，但ARP表中已有源IP地址与MAC地址的映射关系C.主机需要发送信息，但ARP表中没有目的IP地址与MAC地址的映射关系D.主机需要发送信息，但ARP表中已有目的IP地址与MAC地址的映射关系  
43.ARP的工作过程中，ARP请求是（）发送，ARP响应是（）发送。  

A.单播 B.多播 C.广播  

44.主机发送IP数据报给主机B，途中经过了5个路由器。请问在此过程中总共使用了（）次ARP请求。  

A.5 B.6 C. 10 D.11  

45.某以太网中，甲的1P地址为211.71.136.23，子网掩码为255.255.240.0，已知网关地址为211.71.136.1。若甲向乙（1P地址为211.71.130.25）发送一个1P分组，则（）。  

A.该分组封装成帧后直接发送给乙，帧中目的MAC地址为网关的MAC地址B.该分组封装成帧后直接发送给乙，帧中目的MAC地址为乙的MAC地址C.该分组封装成帧后交由网关转发，帧中目的MAC地址为网关的MAC地址D.该分组封装成顿后交由网关转发，帧中目的MAC地址为乙的MAC地址  

46.可以动态为主机配置IP地址的协议是（）。A.ARP B.RARP C. DHCP D. NAT

 47.若某路由器收到一个TTL值为1的IP数据报，则路由器的操作是（）。  

A.转发该IP数据报B.仅仅丢弃该IP数据报C.丢弃该IP数据报并向源主机发送类型为终点不可达的ICMP差错报告报文D.丢弃该IP数据报并向源主机发送类型为时间超过的ICMP差错报告报文  

48.下列关于ICMP报文的说法中，错误的是（）。  

A.ICIMP报文封装在数据链路层顿中发送B.ICMP报文可以用于报告IP数据报发送错误C.ICMP报文封装在IP数据报中发送D.对于已经携带ICMP差错报文的分组，不再产生ICMP差错报文  

49.下列关于ICMP差错报文的描述中，错误的是（）  

A.ICIMP报文分为差错报告报文和询问报文两类 B.对于已经分片的分组，只对第一个分片产生ICMP差错报文C.PING I CMPD.对于多播的分组，不产生ICMP差错报文  

50.【2010统考真题】某网络的IP地址空间为192.168.5.0/24，采用定长子网划分，子网掩码为255.255.255.248，则该网络中的最大子网个数、每个子网内的最大可分配地址个数分别是(）)。  

A.32,8 B.32，6 C.8,32 D.8,30  

51.【2010统考真题】若路由器R因为拥塞丢弃IP分组，则此时R可向发出该IP分组的源 主机发送的ICMP报文类型是（）。  

A.路由重定向B.目的不可达C.源点抑制D.超时  

52.【2011统考真题】在子网192.168.4.0/30中，能接收目的地址为192.168.4.3的IP分组的最大主机数是（）。  

A.0 B.1 C.2 D. 4  

53.【2011统考真题】某网络拓扑如下图所示，路由器R1只有到达子网192.168.1.0/24的路由。为使R1可以将IP分组正确地路由到图中的所有子网，在R1中需要增加的一条路由（目的网络，子网掩码，下一跳）是（）。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/2b2ca3c304389cb28d16afe4a629fd76a92f6559d09a965119889e86a8b78b20.jpg)  

A.192.168.2.0 255.255.255.128 192.168.1.1 B. 192.168.2.0 255.255.255.0 192.168.1.1 C. 192.168.2.0 255.255.255.128 192.168.1.2 D. 192.168.2.0 255.255.255.0 192.168.1.2  

54.【2012统考真题】某主机的IP地址为180.80.77.55，子网掩码为255.255.252.0。若该主机向其所在子网发送广播分组，则目的地址可以是（）。  

A.180.80.76.0 B.180.80.76.255 C.180.80.77.255 D.180.80.79.255  

55.【2012统考真题】ARP的功能是（）  

A根据IP地址查询MAC地址B.根据MAC地址查询IP地址C.根据域名查询IP地址 D.根据IP地址查询域名  

56.【2012统考真题】在TCP/IP体系结构中，直接为ICMP提供服务的协议是（）A.PPPB.IPC.UDPD.TCP

57.【2015统考真题】某路由器的路由表如下所示：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/4d43da35d033922a93715d4347bede16019bb78881e636b8ada5b88d54e2ee4c.jpg)  

若路由器收到一个目的地址为169.96.40.5的IP分组，则转发该IP分组的接口是（）。A.S1 B.S2 C.S3 D.S4  

58.【2016统考真题】如下图所示，假设H1与H2的默认网关和子网掩码均分别配置为192 168.3.1和255.255.255.128，H3和H4的默认网关和子网掩码均分别配置为192.168.3.254 和255.255.255.128，则下列现象中可能发生的是（）  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/b60ea9a6ea60190b30ab00f4b92897312fcc0110b8f8b39098e7fb66f96375fb.jpg)  

A.H1不能与H2进行正常IP通信B.H 2 H 4 InternetC.H1不能与H3进行正常IP通信D.H3不能与H4进行正常IP通信  
59.【2016统考真题】在上题的图中，假设连接R1、R2和R3之间的点对点链路使用地址201.1.3.x/30，当H3访问Web服务器S时，R2转发出去的封装HTTP请求报文的IP分组是源IP地址和目的IP地址，它们分别是（）。  

A.192.168.3.251，130.18.10.1B.192.168.3.251,201.1.3.9C.201.1.3.8，130.18.10.1 D.201.1.3.10,130.18.10.1  

60.【2017统考真题】若将网络21.3.0.0/16划分为128个规模相同的子网，则每个子网可分配的最大IP地址个数是（）。  

A.254 B.256 C.510 D.512  

61.【2017统考真题】下列IP地址中，只能作为IP分组的源IP地址但不能作为目的IP地址的是()。  

A.0.0.0.0 B.127.0.0.1 C.200.10.10.3 D.255.255.255.255  

62.【2018统考真题】某路由表中有转发接口相同的4条路由表项，其目的网络地址分别为35.230.32.0/21、35.230.40.0/21、35.230.48.0/21和35.230.56.0/21，将该4条路由聚合后的目的网络地址为（）。  

A.35.230.0.0/19 B.35.230.0.0/20 C.35.230.32.0/19 D.35.230.32.0/20  

63.【2018统考真题】路由器R通过以太网交换机S1和S2连接两个网络，R的接口、主机H1和H2的IP地址与MAC地址如下图所示。若H1向H2发送一个IP分组P，则H1发出的封装P的以太网顿的目的MAC地址、H2收到的封装P的以太网顿的源MAC地址分别是（)。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/1ed496b0c307d19b7da10e65909052f6605fe423578dec8242dd22cc7c9a632a.jpg)  

A.00-a1-b2-c3-d4-62,00-1a-2b-3c-4d-52B.00-al-b2-c3-d4-62,00-a1-b2-c3-d4-61 C.00-1a-2b-3c-4d-51,00-1a-2b-3c-4d-52D.00-1a-2b-3c-4d-51,00-a1-b2-c3-d4-61  

64.【2019统考真题】若将101.200.16.0/20划分为5个子网，则可能的最小子网的可分配IP地址数是（）。  

A.126 B.254 C.510 D.1022  

65.【2021统考真题】现将一个IP网络划分为3个子网，若其中一个子网是192.168.9.128/26，则下列网络中不可能是另外两个子网之一的是（）。  

A.192.168.9.0/25B.192.168.9.0/26C.192.168.9.192/26 D.192.168.9.192/27  

66.【2021统考真题】若路由器向 $\mathrm{{MTU}=800B}$ 的链路转发一个总长度为1580B的IP数据报（首部长度为20B）时进行了分片，且每个分片尽可能大，则第2个分片的总长度字段和MF标志位的值分别是（）  

A.796,0 B.796,1 C. 800,0 D.800,1  

67.【2022统考真题】若某主机的IP地址是183.80.72.48，子网掩码是255.255.192.0，则该 主机所在网络的网络地址是（）A.183.80.0.0 B.183.80.64.0 C.183.80.72.0 D.183.80.192.0  
68.【2022统考真题】下图所示网络中的主机 $\mathrm{H}$ 的子网掩码与默认网关分别是（）  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/cb17cb8289028ab2f00536f31c501929a7ae5c9ac0a24be46c80ac503504b131.jpg)  

A.255.255.255.192,192.168.1.1 B.255.255.255.192,192.168.1.62 C.255.255.255.224,192.168.1.1 D.255.255.255.224,192.168.1.62  

69.【2023统考真题】某网络拓扑如下图所示，其中路由器R2实现NAT功能。若主机 $\mathrm{H}$ 向Intermet发送1个IP分组，则经过R2转发后，该IP分组的源IP地址是（）。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c41da9de66d3bbe6f1c6f5bc18d7de2ff654b2dfaa54e85306e2a9c342d24434.jpg)  

A.195.123.0.33 B.195.123.0.35 C.192.168.0.1 D.192.168.0.3  

70.【2023统考真题】主机168.16.84.24/20所在子网的最小可分配IP地址和最大可分配IP地址分别是（）。  

A.168.16.80.1,168.16.84.254B.168.16.80.1，168.16.95.254C.168.16.84.1,168.16.84.254D.168.16.84.1，168.16.95.254  

# 二、综合应用题  

01．一个IP分组报头中的首部长度字段值为101（二进制），而总长度字段值为101000（二进制）。请问该分组携带了多少字节的数据？  

02.一个数据报长度为4000B（固定首部长度）。现在经过一个网络传送，但此网络能够传送的最大数据长度为1500B。试问应当划分为几个短一些的数据报片？各数据片段的数据字段长度、片段偏移字段和MF标志应为何值？  

03．某网络的一台主机产生了一个IP数据报，首部长度为20B，数据部分长度为2000B。该数据报需要经过两个网络到达目的主机，这两个网络所充许的数据链路层的最大传输单位（MTU）分别为1500B和576B。问原IP数据报到达目的主机时分成了几个IP小报文？每个报文的数据部分长度分别是多少？  

04.若到达的分组的片偏移值为100，分组首部中的首部长度字段值为5，总长度字段值为100，则数据部分第一个字节的编号是多少？能确定数据部分最后一个字节的编号吗？  

05.设目的地址为201.230.34.56，子网掩码为255.255.240.0，试求子网地址。  

06.在4个“/24”地址块中进行最大可能的聚合：212.56.132.0/24、212.56.133.0/24、212.56.134.0/24、212.56.135.0/24。  

07.现有一公司需要创建内部网络，该公司包括工程技术部、市场部、售后部、财务部和办公室5个部门，每个部门有20～30台计算机。试问：  

1）若要将几个部门从网络上分开，且分配给该公司使用的地址为一个C类地址，网络地址为192.168.161.0，则如何划分网络？可以将几个部门分开？2）确定各部门的网络地址和子网掩码，并写出分配给每个部门网络中的主机IP地址范围。  

08.某路由器具有右表所示的路由表项。  
1）假设路由器收到两个分组：分组A的目的地址为131.128.55.33，分组B的目的地址为131.128.55.38。确定路由器为这两个分组选择的下一跳，并加以说明。  

2）在路由表中增加一个路由表项，它使以131.128.55.33为目的地址的IP分组选择“A”作为下一跳，而不影响其他目的地址的IP分组的转发。  

3）在路由表中增加一个路由表项，使所有目的地址与该路由表中任何路由表项都不匹配的IP分组被转发到下一跳“E”。4）将131.128.56.0/24划分为4个规模尽可能大的等长子网，给出子网掩码及每个子网的可分配地址范围。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/d1d574b0ea108d7b40bba5e07a0ea05ed2dd2aa3907a2f2c0aa591708e53940d.jpg)  

09.下表是使用无类别域间路由选择（CIDR）的路由选择表，地址字段是用十六进制表示的，试指出具有下列目标地址的IP分组将被投递到哪个下一站？  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/2bf4f8fcce01833e16b176ebb14840f197d95c4da967c1f02c80553e36fe8a8a.jpg)  

1） C4.5E.13.872) C4.5E.22.093 ) C3.41.80.024） 5E.43.91.12  

10．一个自治系统有5个局域网，如下图所示，LAN2至LAN5上的主机数分别为91、150、3和15，该自治系统分配到的IP地址块为30.138.118.0/23，试给出每个局域网的地址块（包括前级）。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/a7bfbade4d967c2e4103a9b5fcb7aa39624b2d39523098defc9e39829ea8d235.jpg)  

11.某个网络地址块192.168.75.0中有5台主机A、B、C、D和E，主机A的IP地址为192.168.75.18，主机B的IP地址为192.168.75.146，主机C的IP地址为192.168.75.158，主机D的IP地址为192.168.75.161，主机E的IP地址为192.168.75.173，共同的子网掩码是255.255.255.240。请回答：  

1）5台主机A、B、C、D、E分属几个网段？哪些主机位于同一网段？主机D的网络地址为多少？2）若要加入第6台主机F，使它能与主机A属于同一网段，则其IP地址范围是多少？3）若在网络中另加入一台主机，其IP地址为192.168.75.164，则它的广播地址是多少？哪些主机能够收到？  

12.一个IPv4分组到达一个结点时，其首部信息（以十六进制表示）为：0x450000540003 $58~50~20~06~\mathrm{FF~F0~}7\mathrm{C}~4\mathrm{E}~03~02~\mathrm{B}4~0\mathrm{E}~0\mathrm{F}~02.$ ，IP分组的首部格式见图4.5。请回答：  

1）分组的源IP地址和目的IP地址各是什么（点分十进制表示法）？2）该分组数据部分的长度是多少？3）该分组是否已经分片？若有分片，则偏移量是多少？  

13.主机A的IP地址为218.207.61.211，MAC地址为00:1d:72:98:1d:fc。A收到一个顿，该帧的前64个字节的十六进制形式和ASCII形式如下图所示。0000001d72981dfc00005e00010188641100 .r... 人..d. 001075890192002145000190f9bf40003306u....!E.....@.3. 0020f315dac76628dacf3dd30050c48fdca6 ....f（..=..P... 0030a296234c44695018000f763d000090b5 ..#LDiP...V=...  
I1分组时自可格式见图4.5，以太网帆时格式参见3.0.2卫。问：1）主机A所在网络的网关路由器的相应端口的MAC地址是多少？2）该1P分组所携带的数据量为多少字节？3）若该分组需要被路由器转发到一条MTU为380B的链路上，则路由器将做何种操作？  

14.某网络拓扑如下图所示，R1和R2为路由器，Switch为交换机，Hub为集线器，Web服 务器S、主机H1\~H6和路由器各接口的IP地址如图中所示。请回答：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/801b91c92c31d1e3a25009bd3f75972d50a89cd628b271175cd59bac330289b4.jpg)  

1）R1的E2接口的IP地址是什么 $?\ \mathrm{H}1$ 和 $\mathrm{H}4$ 配置的默认网关地址分别应是什么？2）为了让R2能正确转发送往  $\mathrm{H1\simH6}$  的IP分组，给R2添加一条路由表项，该路由表 项中的目的网络地址、地址掩码、下一跳地址分别是什么？3）假设H1和R1的ARP缓存初始均为空，交换机的交换表也为空，H1向H6发送一个IP分组P，H6收到P后向H1发送一个响应IP分组A，则能收到封装P的以太网顿的主机，以及能收到封装A的以太网帧的主机分别有哪些？4）为了让H1能够正常访问互联网的Web服务器S，需要R2开启什么服务 $?\ H1$ 发出的封装有HTTP请求报文的IP分组H，首部中的源IP地址和目的IP地址分别是什么？当H从R2转发出去时，首部中的源IP地址和目的IP地址分别是什么？  

15.【2009统考真题】某网络拓扑图如下图所示，路由器R1通过接口E1、E2分别连接局域网1、局域网2，通过接口L0连接路由器R2，并通过路由器R2连接域名服务器与互联网。R1的L0接口的IP地址是202.118.2.1；R2的L0接口的IP地址是202.118.2.2，L1 接口的IP地址是130.11.120.1，E0接口的IP地址是202.118.3.1；域名服务器的IP地址是202.118.3.2。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/251b1617878e8f6f1c9ae4080bba64ce76ea792b7563633e96e4d7b811e1730e.jpg)  

R1和R2的路由表结构如下：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/67b10241fc102031b90e9622f5d4737479d867a34caa5f1d6f203461379ef6d8.jpg)  
1）将1P地址空间202.118.1.0/24划分为两个子网，分别分配给局域网1和局域网2，每个局域网需分配的IP地址数不少于120个。请给出子网划分结果，说明理由或给出 必要的计算过程。2）请给出R1的路由表，使其明确包括到局域网1的路由、局域网2的路由、域名服务器的主机路由和互联网的路由。3）请采用路由聚合技术，给出R2到局域网1和局域网2的路由。  

16.【2015统考真题】某网络拓扑如下图所示，其中路由器内网接口、DHCP服务器、WWW服务器与主机1均采用静态IP地址配置，相关地址信息见图中标注；主机2\~主机 $N$ 通过DHCP服务器动态获取IP地址等配置信息。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c3a86675d0bb211c34ba1c7eaf80b66c8f06e0b810fd02d64d511ae6ae25c496.jpg)  

回答下列问题：  

1）DHCP服务器可为主机 $2\sim N$ 动态分配IP地址的最大范围是什么？主机2使用DHCP获取IP地址的过程中，发送的封装DHCPDiscover报文的IP分组的源IP地址和目的  

IP地址分别是多少？2）若主机2的ARP表为空，则该主机访问Intermet时，发出的第一个以太网帧的目的MAC地址是什么？封装主机2发往Internet的IP分组的以太网帧的目的MAC地址是什么？3）若主机1的子网掩码和默认网关分别配置为255.255.255.0和111.123.15.2，则该主机是否能访问WWW服务器？是否能访问Internet？请说明理由。  

17.【2018统考真题】某公司的网络如下图所示。IP地址空间192.168.1.0/24均分给销售部和技术部两个子网，并已分别为部分主机和路由器接口分配了IP地址，销售部子网的 $\mathrm{{MTU}}\,{=}\,1500\mathrm{{B}}$ ，技术部子网的 $\mathrm{{MTU}}=800\mathrm{{B}}$  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/1b418c9570d56331cc126fd881bcb6a49fa7cf4e6623b8e2518f79e4cb51c447.jpg)  

回答下列问题：  

1）销售部子网的广播地址是什么？技术部子网的子网地址是什么？若每台主机仅分配一个IP地址，则技术部子网还可以连接多少台主机？2）假设主机192.168.1.1向主机192.168.1.208发送一个总长度为1500B的IP分组，1P分组的首部长度为 $20\mathrm{B}$ ，路由器在通过接口F1转发该IP分组时进行了分片。若分片时尽可能分为最大片，则一个最大IP分片封装数据的字节数是多少？至少需要分为几个分片？每个分片的片偏移量是多少？  
18.【2020统考真题】某校园网有两个局域网，通过路由器R1、R2和R3互连后接入InternetS1和S2为以太网交换机。局域网采用静态IP地址配置，路由器部分接口以及各主机的IP地址如下图所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/4028b3e41677768c6c95e2835591af1bec2c0d36e91fd675901ce486f4e4fb7b.jpg)  

假设NAT转换表结构为  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/bf4563f185ac94e4a9a9d619b3c0c8c37186dd8fbed297dd1a8615378e033e2a.jpg)  

请回答下列问题：  

1）为使H2和H3能够访问Web服务器（使用默认端口号），需要进行什么配置？  

2）若H2主动访问Web6服务器时，将HTTP请求报文封装到IP数据报P中发送，则H2发送的P的源IP地址和自的IP地址分别是什么？经过R3转发后，P的源IP地址和自的IP地址分别是什么？经过R2转发后，P的源IP地址和自的IP地址分别是什么？  

19.【2022统考真题】某网络拓扑如下图所示，R为路由器，S为以太网交换机，AP是802.11 接入点，路由器的E0接口和DHCP服务器的IP地址配置如图中所示；H1与H2属于同 一个广播域，但不属于同一个冲突域；H2和H3属于同一个冲突域；H4和H5已经接入网络，并通过DHCP动态获取了IP地址。现有路由器、100BaseT以太网交换机和100BaseT集线器（Hub）三类设备各若干。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/fc4909907a728ae45e5643a69a4ee82fbb06637a2747ec6decd6b384c6d16f92.jpg)  
请回答下列问题。  

1）设备1和设备2应该分别选择哪类设备？  

2）若信号传播速度为 $2{\times}10^{8}\mathrm{m/s}$ ，以太网最小帧长为64B，信号通过设备2时会产生额外的 $1.51\upmu\mathrm{s}$ 的时延，则H2与H3之间可以相距的最远距离是多少？3）在H4通过DHCP动态获取IP地址过程中，H4首先发送了DHCP报文M，M是哪种DHCP报文？路由器EO接口能否收到封装M的以太网帧？S向DHCP服务器转 发的封装 $\mathbf{M}$ 的以太网帧的目的MAC地址是什么？4）若H4向H5发送一个IP分组P，则H5收到的封装P的802.11帧的地址1、地址2和地址3分别是什么？  

# 4.2.9 答案与解析  

# 一、单项选择题  

01. C  

TCP和UDP是传输层协议，IP、ICMP、ARP、RARP（逆地址解析协议）是网络层协议。  

02.B  

协议字段表示使用IP的上层协议，如值为6表示TCP，值为17表示UDP。版本字段表示IP的版本，值为4表示IPv4，值为6表示IPv6。  

03.C  

在首部中有三个关于长度的标记：首部长度、总长度和片偏移，基本单位分别为4B、1B和8B。IP分组的首部长度必须是4B的整数倍，取值范围是 $5\!\sim\!15$ （默认值是5）。因为IP分组的首部长度是可变的，所以首部长度字段必不可少。总长度字段给出IP分组的总长度，单位是字节，包括分组首部和数据部分的长度。数据部分的长度可以从总长度减去分组首部长度计算。  

# 04.B  

检验和字段只检查数据报的首部，不包括数据部分。计算检验和的方法是：先把数据报的首部划分为许多16比特的序列，用反码算术运算把所有16比特相加后，将得到的和的反码写入检验和字段。接收方的网络层发现检验和出错后，就丢弃收到的数据报，但不会发送差错报文。数据报的检验和的计算不需要加入伪首部，伪首部用于计算UDP或TCP检验和。  

05.D  

在数据链路层，MAC地址用来标识主机或路由器，数据报到达具体的目的网络后，需要知道目的主机的MAC地址才能成功送达，因此需要将IP地址转换成对应的MAC地址，即物理地址。  

06.D  

数据报被分片后，每个分片都将独立地传输到目的地，其间有可能会经过不同的路径，而最后在目的端主机分组才能被重组。  

07. A  

在IP首部中，标识字段的用途是让目标机器确认一个新到达的分片是否属于同一个数据报，用于重组分片后的IP数据报。标志字段中的DF表示是否允许分片，MIF表示后面是否还有分片。片偏移则指出分组在分片后某片在原分组中的相对位置。  

08.D  

片偏移标识该分片所携带数据在原始分组所携带数据中的相对位置，以8B为单位。  

09.D 片偏移以8B为偏移单位，它指出数据报在分片后，某片在原数据报中的相对位置。若片偏移值为0，则表示该数据报片是原数据报的第1片，或者该数据报没有分片。若片偏移值为100，则表示该数据报片的第1个字节是原数据报的第800个字节。  
10.B  

若分组长度超过MTU，则当 $\mathrm{DF}\!=\!1$ 时，丢弃该分组，并且要用ICMP（终点不可达报文）向源主机报告差错：当 $\ensuremath{\mathrm{DF}}\!=\!0$ 时，进行分片， ${\mathrm{MF}}\!=\!1$ 表示后面还有分片。  

11. C  

片偏移、首部长度、总长度的单位分别为8B、4B、1B。片偏移值为100，表示该分片的数据部分的第1个字节的编号是800。分组的总长度为100B，首部长度为 $4{\mathrm{B}}{\times}5=20{\mathrm{B}}$ ，所以数据部分的长度为 $80\mathrm{B}$ 。因此，该分片的数据部分的最后一个字节的编号是879。  

12.B  

对于A选项，132.19.237.5的前8位与132.0.0.0/8匹配。而B选项中，132.19.237.5的前11位与132.0.0.0/11匹配。C选项中，132.19.237.5的前22位与132.19.232.0/22不匹配。根据“最长前缀匹配原则”，该分组应该被转发到R2。D选项为默认路由，只有当前面的所有目的网络都不能和分组的目的IP地址匹配时才使用。  

13. A  

在分类的IP网络中，C类地址的前24位为网络位，后8位为主机位，主机位全“0”表示网络号，主机位全“1”表示广播地址，因此最多可以有 $2^{8}\!-\!2\!=\!254$ 台主机或路由器。  

14.A  

CIDR地址块86.32.0.0/12的网络前缀为12位，说明第2个字节的前4位在前缀中，第2个字节32的二进制形式为00100000。给出的4个地址的前8位均相同，而第2个字节的前4位分别是0010,0100,0100,0100，所以本题答案为A。  

15.A  

10.255.255.255为A类地址，主机号全1，代表网络广播，为广播地址。192.168.24.59/30为CIDR地址，只有后面2位为主机号，而59用二进制表示为00111011，可知主机号全1，代表网络广播，为广播地址。224.105.5.211为D类多播地址。  

16.D  

所有形如127.xx.yy.zz的IP地址，都作为保留地址，用于回路测试。  

17.B  

A是C类地址，掩码为255.255.255.0，由此得知A地址的主机号为全0（未使用CIDR），因此不能作为主机地址。C是为回环测试保留的地址。D是语法错误的地址，不允许有256。B为A类地址，其网络号是110，主机号是47.10.0。  

18. C  

因为 $240_{10}\,{=}\,11110000_{2}$ ，所以共有12比特位用于主机地址，且主机位全0和全1不能使用，所以最多可以有的主机数为 $2^{12}\!-\!2\!=\!4094$  

19.A  

在Internet中，IP数据报从源结点到自的结点可能需要经过多个网络和路由器。当一个路由器接收到一个IP数据报时，路由器根据IP数据报首部的目的IP地址进行路由选择，并不改变源IP地址的取值。即使IP数据报被分片时，原IP数据报的源IP地址和目的IP地址也将复制到每个分片的首部，因此在整个传输过程中，IP数据报首部的源IP地址和目的IP地址都不发生变化。  

20.C 划分子网可以增加子网的数量（即把一个大的网络划分成许多小的网络，这是子网划分的结果，并不是目的），子网之间的数据传输需要通过路由器进行，因此减少了广播域的大小，提高网络的效率和安全性。划分子网后，因为各子网中主机号全0和全1的地址不能使用，所以会减少总的主机数量，但划分子网提高了IP地址的利用率。  
21.A  

由题可知，主机号有5位，若主机号只占1位，则没有有效的IP地址可供分配（除去0和1），因此最少2位表示主机号，还剩3位表示子网号，所以最多可以分成8个子网。而当5位都表示主机数，即只有1个子网时，每个子网最多具有30个有效的IP地址（除去全0和全1)。  

22.C  

在网络中，充许一台主机有两个或两个以上的IP地址，若一台主机有两个或两个以上IP地址，则说明这台主机属于两个或两个以上的网络。IP地址192.168.11.25属于C类IP地址，所以与A、B和D属于同一个网络：只有C的网络号不同，表明它属于不同的网络。  

23.A  

CIDR可以更合理地分配IP地址空间，缓解IP地址消耗的速度，但无法彻底解决IP地址耗尽的问题。CIDR通过路由聚合可减少路由表数目，从而减少路由器之间的信息交换，提高了网 络性能。把大的网络划分成小的子网，这是CIDR划分子网的结果，并不是作用。  

24.D  

CIDR表示法是一种用斜线“7”后面加上网络前缀所占的位数来表示IP地址的方法。网络前缀所占的位数是网络号部分，剩下的位数是主机号部分。所在地址块包含的地址数是 $2^{10}\!=1024$ 令主机号全为0，所以126.166.66.99/22所在地址块的第一个地址是126.166.64.0。  

25.B  

200.15.10.7的最后一个字节展开成二进制为00000111，该地址是200.15.10.6/29所在地址块的广播地址，不能使用。若将默认网关设置为广播地址，则导致无法识别网关，而被当作一个广播目标，导致分组无法正确地转发给其他网络，而被分发给本网络上的所有主机。  

26.D、A  

CIDR地址由网络前缀和主机号两部分组成，CIDR将网络前缀都相同的连续IP地址组成“CIDR地址块”。网络前缀的长度为20位，主机号为12位，因此192.168.0.0/20地址块中的地址数为 $2^{12}$ 个。其中，当主机号为全0时，取最小地址192.168.0.0。当主机号全为1时，取最大地址192.168.15.255。注意，这里并不是指可分配的主机地址。  

对于192.16.0.19/28，表示子网掩码为255.255.255.240。IP地址192.16.0.19与IP地址

192.16.0.17所对应的前28位数相同，都是1100000000010000000000000001，所以IP地址

192.16.0.17是子网192.16.0.19/28的一台主机地址。注意，主机号全0和全1的地址不使用。  

27.B  

为每个IP分组设定生存时间（TTL），每经过一个路由器，TTL减1，TTL为O时，路由器就不再转发该分组。因此可以避免分组在网络中无限循环下去。  

28.D  

最初设计的分类IP地址，因为每类地址所能连接的主机数大大超过一般单位的需求量，所以造成了IP地址的浪费。划分子网通过从网络的主机号借用若干比特作为子网号，从而使原来较大规模的网络细分为几个规模较小的网络，提高了IP地址的利用率。  

CIDR是比划分子网更为灵活的一种手段，它消除了A、B、C类地址及划分子网的概念。使用各种长度的网络前缀来代替分类地址中的网络号和子网号，将网络前缀都相同的IP地址组成“CIDR地址块”。网络前缀越短，地址块越大。互联网服务提供者再根据客户的具体情况，分配合适大小的CIDR地址块，从而更加有效地利用IPv4的地址空间。  
采用网络地址转换（NAT），可以使一些使用本地地址的专用网连接到互联网上，进而使得一些机构的内部主机可以使用专用地址，只需给该机构分配一个IP地址即可，并且这些专用地址是可重用的一一其他机构也可使用，所以大大节省了IP地址的消耗。  

尽管以上三种方法可以在一定阶段内有效缓解IP地址耗尽的危机，但无论是从计算机本身发展来看还是从互联网的规模和传输速率来看，现在的IPv4地址已很不适用，所以治本的方法还是使用128比特编址的IPv6地址。  

29.B  

当路由器准备将1IP分组发送到网络上，而该网络又无法将整个分组一次发送时，路由器必须将该分组分片，使其长度能满足这一网络对分组长度的限制。IP分片可以独立地通过各个路径发送，而且在传输过程中仍然存在分片的可能（不同网络的MTU可能不同），因此不能由中间路由器进行重组。分片后的IP分组直至到达目的主机后才能汇集在一起，并且甚至不一定以原先的次序到达。这样，进行接收的主机都要求支持重组能力。  

30. C  

“/29”表明前29位是网络号，4个选项的前3个字节均相同。A中第4个字节120为01111000，前5位为01111；B中第4个字节64为01000000，前5位为01000：C中第4个字节96为01100000，前4位为0110；D中第4个字节104为01101000，前5位为01101。因为已经分配的子网74.178.247.96/29的第4个字节的前5位为01100，这与C中第4个字节的前4位重叠，所以C中的网络前缀不能再分配给其他子网。  

31.D  

本题实际上就是要求找一个子网掩码，使得A和B的IP地址与该子网掩码逐位“与”之后得到相同的结果。D选项与A、B相“与”的结果均为216.0.0.0。  

32.B  

未进行子网划分时，B类地址有16位作为主机位。因为共需要划分51个子网， $2^{5}\!<\!51\!<\!2^{6}$ 所以需要从主机位划出6位作为子网号，剩下的10位可容纳的主机数为1022（即 $2^{10}\!-\!2$ )台主机，满足题目要求。因此子网掩码为255.255.252.0。  

33.A  

4条路由的前24位（3个字节）为网络前缀，前2个字节都一样，因此只需要比较第3个字节即可， $129\!=\!10000001$ ， $130\,{=}\,10000010$ ， $132\,{=}\,10000100$ ， $133=10000101$ 。前5位是完全相同的，因此聚合后的网络的掩码中，1的数量应该是 $8+8+5\!=\!21$ ，聚合后的网络的第3个字节应该是 $1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000$ ，因此答案为172.18.128.0/21。  

34.B  

四个选项中，选项A的地址块在172.16.166.192/26内，也就是有重叠；选项B的地址块与172.16.166.192/26不重叠，聚合后的地址块为172.16.166.128/25，聚合后的地址块没有引入多余地址；选项C的地址块与172.16.166.192/26不重叠，聚合后的地址块为172.16.166.0/24，聚合后的地址块会引入多余地址；选项D的地址块与172.16.166.192/26不重叠，聚合后的地址块为172.16.166.0/24，聚合后的地址块会引入多余地址。  

35.A  

在一条点对点链路中，只需要两个主机IP地址、一个网络地址和一个广播地址的4种组合，主机号只需2位，因此子网掩码应指定为255.255.255.252或用C1DR表示为“/30”。  
36.B  

本题中，某主机不能正常通信意味着它与其他三台主机不在同一个子网，只需判断哪个选项和其他选项不在同一个子网即可。子网掩码为255.255.255.224表示前27位是网络号，可以看出选项B属于子网202.3.1.64/27，其他三项属于子网202.3.1.32/27。或者，后5位是主机号，前3个子网的地址范围为 $202.3.1.1\!\sim\!30,33\!\sim\!\!62,65\!\sim\!94$ （排除全0或全1），据此也能选出答案。  

37.D  

由子网掩码255.255.192.0，可知网络号占18位，主机号占14位，所以该子网的广播地址为置166.66.66.66的后14位主机号为全1，所以目的IP地址为166.66.127.255。  

# 38.C  

类似于哈夫曼编码的思想，可以用高度为32的满二叉树来表示整个IP地址空间，因此每个分支结点都可表示成一个地址块，该分支结点下的所有叶结点的编码都是属于该地址块的IP地址。下图是以地址块“/24”为根结点的二叉树表示，为了简洁，图中省略了共同前缀172.16.2。  

本题要求找出3个子网与题中的子网构成一个更大的网络，对应到二叉树中，需满足两个条件： $\textcircled{14}$ 个子网的地址空间互不重叠，即4个分支结点不存在任何祖先或双亲关系； $\textcircled{2}4$ 个子网刚好能构成一个新的地址空间，即存在一个结点刚好能覆盖这4个结点下的所有子孙。现结合选项分析：选项A、D和110/27可与题中子网聚合成/24网络；选项B、00/26、11/26可与题中子网聚合成/24网络；选项C若要与题中子网聚合成一个更大的网络，则至少还需要00/26、010/27、11/26，共5个子网，与题意不符。注意，上述对子网号的分析都是用的二进制表示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/ea20ba71cc1b6b61197d982c901e83ea64789e02e3a951eb2b126e7487a705cd.jpg)  

39.A  

IP数据报的首部既有源IP地址，又有目的IP地址，但在通信中路由器只会根据目的IP地址进行路由选择。IP数据报在通信过程中，首部的源IP地址和自的IP地址在经过路由器时不会发生改变。ARP广播只在子网中传播，因为相互通信的主机不在同一个子网内，所以不可以直接通过ARP广播得到目的站的硬件地址。硬件地址只具有本地意义，因此每当路由器将IP数据报转发到一个具体的网络中时，都需要重新封装源硬件地址和目的硬件地址。  

# 注意  

路由器接收到分组后，剥离该分组的数据链路层协议头，然后在分组被转发之前，给分组加上一个新的链路层协议头。  

40.A  

255.255.255.255是受限的广播地址，仅用于主机配置过程中1P分组的目的地址。在任何情况下，路由器都不转发自的地址为受限厂播地址的IP分组，这种IP分组仅出现在本地网络中。  

41.C  

NAT协议保留了3段IP地址供内部使用，这3段地址如下： $\mathbf{10.0.0.0{\sim}10.255.255.255.255}$  
B类：16个B类网段，即172.16.0.0～172.31.255.255，主机数1048576。  

C类：256个C类网段，即 $\mathbf{192.168.0.0}\!\sim\!192.168.255.255.$ ，主机数65536。  

所以只有C选项是内部地址，不充许出现在互联网（即公网）上。  

42.C  

当源主机向本地局域网上的某主机发送IP数据报时，先在其ARP高速缓存中查看有无目的IP地址与MAC地址的映射。若有，就把这个硬件地址写入MAC顿，然后通过局域网把该MAC帧发往此硬件地址；若没有，则先通过广播ARP请求分组，在获得目的主机的ARP响应分组后，将目的主机的IP地址与硬件地址的映射写入ARP高速缓存。若目的主机不在本局域网上，则将IP分组发送给本局域网上的路由器，当然要先通过同样的方法获得路由器的IP地址和硬件地址的映射关系。  

43.C、A  

因为不知道目标设备在哪里，所以ARP请求必须使用广播方式。但是ARP请求包中包含有发送方的MAC地址，因此应答时应该使用单播方式。  

44.B  

主机先使用ARP来查询本网络路由器的地址，然后每个路由器使用ARP来寻找下一跳路由的地址，所以主机A和中间的5个路由器都发起了一次ARP请求，共发起6次ARP请求。  

45.B  

先判断乙和甲是否在同一子网内，用IP地址和子网掩码进行按位AND运算，然后检查它们的网络前缀是否相同。若乙和甲在同一子网内，则直接交付，无须经过网关，因此将乙的MAC地址作为帧的目的MAC地址。若乙和甲不在同一子网内，则要通过网关转发，因此将网关的MAC地址作为帧的目的MAC地址。经计算，甲的网络前缀为211.71.128.0/20，乙的网络前缀为211.71.128.0/20，乙和甲在同一子网内，因此帧的目的MAC地址为乙的MAC地址。  

46.C  

DHCP提供了一种机制，使得使用DHCP可自动获得IP的配置信息而无须手工干预  

47.D  

若路由器收到一个TTL值为1的IP数据报，则它会先将TTL值减1，然后判断是否为0。若为0，则丢弃该IP数据报并向源主机发送类型为时间超过的ICMP差错报告报文。  

48.A  

ICMP属于网络层协议，ICMP报文被封装在IP数据报中发送，但ICMP不是高层协议。  

49.C  

PING命令使用了ICMP的询问报文中的回送请求和回答报文。  

50.B  

因为该网络的1P地址为192.168.5.0/24，所以网络号为前24位，后8位为子网号 $^+$ 主机号。子网掩码为255.255.255.248，第4个字节248转换成二进制为11111000，因此后8位中，前5位用于子网号，在CIDR中可以表示 $2^{5}\!=\!32$ 个子网；后3位用于主机号，除去全0和全1的情况，可以表示 $2^{3}\!-\!2\!=\!6$ 台主机地址。  

51.C  

ICMP差错报告报文有5种：终点不可达、源点抑制、时间超过、参数问题、改变路由。其中源点抑制是指当路由器或主机因拥塞而去充数据报时，向源点发送源点抑制报文，使源点知道应当把数据报的发送速率放慢。注意，最新的ICMP标准已不再使用源点抑制报文。  
52.C  

首先分析192.168.4.0/30这个网络，主机号占2位，地址范围为192.168.4.0～192.168.4.3，主机号全1时是广播地址、全0时是本网络地址，因此可容纳 $4-2=2$ 台主机。  

53.D  

要使R1能正确地将分组路由到所有子网，R1中需要有到192.168.2.0/25和192.168.2.128/25192.168.2.0:1100000010101000 00000010 00000000192.168.2.128：11000000101010000000001010000000前24位都相同，于是可以聚合成超网192.168.2.0/24，子网掩码为前24位，即255.255.255.0。下一跳是与R1直接相连的R2的地址，因此是192.168.1.2。  

54.D  

子网掩码的第3个字节为11111100，可知前22位为子网号、后10位为主机号。IP地址的第3个字节为01001101（下画线为子网号的一部分），将主机号（即后10位）全置为1，可以得到广播地址为180.80.79.255。  

55.A  

在实际网络的数据链路层上传送数据时，最终必须使用硬件地址，ARP将网络层的IP地址解析为数据链路层的MAC地址。  

56.B  

ICMP报文作为数据字段封装在IP分组中，因此IP直接为ICMP提供服务。UDP和TCP都是传输层协议，为应用层提供服务。PPP是数据链路层协议，为网络层提供服务。  

57.C  

根据“最长前缀匹配原则”，169.96.40.5与169.96.40.0的前27位匹配最长，因此选C。选项D为默认路由，只有当前面的所有目的网络都不能和分组的目的IFP地址匹配时才使用。  

58.C  

从子网掩码可知H1和H2处于同一网络，H3和 $\mathrm{H}4$ 处于同一网络，因此H1和H2、H3和H4分别可以进行正常的IP通信。因为H1和H2、H3和H4处于不同的网络，所以需要通过路由器才能进行正常的IP通信，而H1和H2的默认网关为192.168.3.1，但R2的E1接口的IP地址为192.168.3.254，因此H1不能与H3进行正常的1P通信。H1、H2、H3、H4要实现正常的跨网络通信，就必须通过路由器，于是配置的默认网关应是R2的E1接口的1P地址192.168.3.254，由R2来实现跨网络的分组的转发，而H2的默认网关为192.168.3.1，所以H2不能访问Internet；H4的默认网关为192.168.3.254，所以H4可以正常访问Intermet。  

59.D  

当内网用户向公网发送IP分组时，NAT路由器会更改IP分组的源地址，因此下一步就是求R1的公网IP地址。连接R1、R2和R3之间的点对点链路使用 $201.1.3._{\mathrm{X}}/30$ 地址，可知该地址块的IP地址的后两位为主机号，而主机号全0和全1的IP地址不能分配，因此若已知路由器之间的点对点链路中的一个路由器接口的IP地址，就可求出另一路由器接口的IP地址。在R1和R2相连的链路中，已知R1端接口的IP地址为201.1.3.9/30，将其后8位展开成二进制为00001001，所以可分配给R2的L0接口的IP地址为201.1.3.10。同理，也可求出R2的L1接口的IP地址为201.1.3.2。访问Web服务器，只能通过R1的接口L0或L1转发，所以经过R1转发后，IP分组的源地址可能为201.1.3.10或201.1.3.2，目的地址为Web服务器的IP地址130.18.10.1。  

60.C  

这个网络有16位的主机号，平均分成128个规模相同的子网，每个子网有7位的子网号，9位的主机号。除去一个网络地址和广播地址，可分配的最大IP地址个数是 $2^{9}\!-\!2\!=\!512\!-\!2\!=\!510$  
61.A  

0.0.0.0/32可以作为本主机在本网络上的源地址。127.0.0.1是回送地址，以它为目的1P地址的数据将被立即返回本机。200.10.10.3是C类IP地址。255.255.255.255是广播地址。  

# 62. C  

对于此类题目，先分析需要聚合的IP地址。观察发现，题中的4个路由地址，前16位完全相同，不同之处在于第3段的8位中，将这8位展开写成二进制，分别如下：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/3d12378d84831f773ecbe2d6c1336c0335596f76d06dcccde7b86ac47d8ad3c6.jpg)  

观察发现，在4个地址的第3段中，从前向后最多有3位相同，因此这3位是能聚合的最大位数。将这些相同的位都保留，将第3段第3位后的所有位都置0，就得到了聚合后的IP地址：35.230.32.0，其网络前缀为 $^{16+3}$ ，即前19位，因此聚合后的网络地址为35.230.32.0/19。  

# 63. D  

在网络的数据传送中，会经常用到两个地址：MAC地址和IP地址。其中，MAC地址会随着数据被发往不同的网络而改变，但IP地址当且仅当数据在私有网络与外部网络之间传递时才会改变。分组P在如题图所示的网络中传递时，首先由主机HI将分组发往路由器R，这时源MAC地址为H1主机本身的MAC地址，即00-1a-2b-3c-4d-52，目的MAC地址为路由器R的MAC地址，即00-1a-2b-3c-4d-51。路由器R收到分组P后，根据分组P的目的IP地址，得知应将分组从另一个端口转发出去，于是会给分组P更换新的MAC地址，此时因为从另外的端口转发出去，所以P的新源MAC地址变为负责转发的端口MAC地址，即00-a1-b2-c3-d4-61，目的MAC地址应为主机H2的MAC地址，即00-a1-b2-c3-d4-62。根据分析过程，题目所问的MAC地址应为路由器R两个端口的MAC地址，因此选D。  

64.B  

网络前缀为20位，将101.200.16.0/20划分为5个子网，为了保证有子网的可分配IP地址数尽可能小，即要让其他子网的可分配IP地址数尽可能大，不能采用平均划分的方法，而要采用变长的子网划分方法，也就是最大子网用1位子网号，第二大子网用2位子网号，以此类推。  

子网1：101.200.00010000.00000001～101.200.00010111.11111110；地址范围为101.200.16.1/21\~

101.200.23.254/21；可分配的IP地址数为2046个。  

子网2：101.200.00011000.00000001～101.200.00011011.11111110；地址范围为101.200.24.1/22\~

101.200.27.254/22；可分配的IP地址数为1022个。  

子网3：101.200.00011100.00000001 $\sim$ 101.200.00011101.11111110：地址范围为101.200.28.1/23\~

101.200.29.254/23；可分配的IP地址数为510个。  

子网4：101.200.00011110.00000001 $\sim$ 101.200.00011110.11111110；地址范围为101.200.30.1/24\~

101.200.30.254/24；可分配的IP地址数为254个。  

子网5：101.200.00011111.00000001\~101.200.00011111.11111110；地址范围为101.200.31.1/24\~

101.200.31.254/24；可分配的IP地址数为254个。  

综上所述，可能的最小子网的可分配IP地址数是254个。65.B  
划分子网的原则是要求划分出来的子网的IP地址空间互不重叠，且原来的IP地址空间不遗漏，求解本题最好的方法是代入选项，观察是否可将原IP地址空间分割为3个互不重叠的子网。根据题意，将1P网络划分为3个子网。其中一个是192.168.9.128/26。可简写成10/26（省略前面相同的24位前缀，其中10是128的二进制10000000的前两位，因为 $26\!-\!24\!=\!2)$ 。同理，选项A可简写成0/25：选项B可简写成00/26：选项C可简写成11/26；选项D可以简写成110/27。采用二叉树形式画出这些子网的地址空间如下图所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/1204f11ecf848ccd6a04d22a4e76dac74775093d20c47d81fb54a577486e1225.jpg)  

对于A和C，可以组成0/25、10/26、11/26这3个互不重叠的子网。对于D，可以组成10/26、110/27、111/27这3个互不重叠的子网。但对于B，要想将一个IP网络划分为几个互不重叠的子网，3个是不够的，至少需要划分为4个子网：00/26、01/26、10/26、11/26。  

66.B  

链路层 $\mathrm{{MTU}\!=\!800B}$ 。IP分组首部长 $^{20\mathrm{B}}$ 。片偏移以8个字节为偏移单位，因此除了最后一个分片，其他每个分片的数据部分长度都是8B的整数倍。所以，最大IP分片的数据部分长度为776B。在总长度为1580B的IP数据报中，数据部分占1560B， $1560\mathrm{B}/776\mathrm{B}\!=\!2.01\cdots$ ，需要分成3片。所以第2个分片的总长度字段为796，MF为1（表示还有后续的分片）。  

67.B  

主机所在网络的网络地址可以通过主机的IP地址和子网掩码逐位“与”得到。子网掩码255.255.192.0的二进制前18位为1、后14位为0，把主机IP地址的后14位变为0，得到的结果为183.80.64.0，即为主机所在网络的网络地址。  

68.D  

默认网关可以理解为到当前主机最近的路由器的端口地址，所以是192.168.1.62，而该主机的子网掩码和网关的子网掩码也相同，727即为255.255.255.224。  

69.A  

H向Intermnet发送IP分组，初始的源IP地址为192.168.0.3，经过NAT路由器的转发后，将源IP地址从私有IP地址改成全球IP地址（R2外部接口的IP地址），因为R2外部接口和195.123.0.34/30处于同一子网，该子网可分配的IP地址范围是 $195.123.0.33\!\sim\!195.123.0.34$ ，所以R2外部接口的IP地址是195.123.0.33，也就是经过R2转发后的源IP地址。  

70.B  

网络号位数为 $20=8{\times}2+4$ ，子网掩码为11111111111111111111000000000000，将它与主机地址168.16.84.24进行逐位“与”，得到网络地址为 $168.16.80.0/20$ ，该网段共有 $2^{12}-2$ 个可供分配的IP地址，地址范围是 $168.16.80.1\!\sim\!168.16.95.254\!\circ$  

# 二、综合应用题  

01.【解答】  

要求出分组所携带数据的长度，就需要分别知道首部的长度和分组的总长度。解题的关键在于弄清首部长度的字段和总长度字段的单位。因为首部长度字段的单位是4B，101的十进制为5，所以首部长度 $=5{\times}4\,{=}\,20\mathrm{B}$ 。而总长度字段的单位是字节，101000的十进制为40，所以总长度为40B，因此分组携带的数据长度为 $40\,{-}\,20\,{=}\,20\mathrm{B}$  
02.【解答】  

数据报长度为 $4000\mathrm{B}$ ，有效载荷为 $4000-20=3980\mathrm{B}$ 。网络能传送的最大有效载荷为 $1500\,{-}\,20\,{=}\,1480\mathrm{B}$ ，因此应分为3个短些的片，各片的数据字段长度分别为1480、1480和1020B。片段偏移字段的单位为8B， $1480/8\,{=}\,185$ ， $(1480\!\times\!2)/8\!=\!370$ ，因此片段偏移字段的值分别为0、185、370。

 ${\mathrm{MF}}=1$ 时，代表后面还有分片： ${\mathrm{MF}}\!=\!0$ 时，代表后面没有分片，因此MF字段的值分别为1、1和0

（注意， ${\mathrm{MF}}\!=\!0$ 不能确定是独立的数据报，还是分片得来的，只有当 ${\mathrm{MF}}\!=\!0$ 且片段偏移字段 $>\!0$ 时，才能确定是分片的最后一个分片）。  

03.【解答】  

在IP层下面的每种数据链路层都有自己的帧格式，其中包括帧格式中的数据字段的最大长度，这称为最大传输单位（MTU）。 $1500\,{-}\,20\,{=}\,1480$ ， $2000-1480\,{=}\,520$ ，所以原IP数据报经过第一个网络后分成了两个IP小报文，第一个报文的数据部分长度是1480B，第二个报文的数据部分长度是520B。  

（除最后一个报片外的）所有报片的有效载荷都是8B的倍数。 $576\!-\!20\!=\!556$ ，但556不能被8整除，所以分片时的数据部分最大只能取552。第一个报文经过第2个网络后， $1480\,{-}\,552\!\times\!2\!=\!376\,{<}$ 576，变成数据长度分别为552B、552B、376B的3个IP小报文；第2个报文 $520<552$ ，因此不用分片。因此到达目的主机时，原2000B的数据被分成数据长度分别为552B、552B、376B、520B的4个小报文。  

# 04.【解答】  

分片的片偏移值表示其数据部分首字节在原始分组的数据部分中的相对位置，单位为8B。首部长度字段以4B为单位，总长度字段以字节为单位。题目中，分组的片偏移值为100，因此其数据部分第一个字节的编号是800。因为分组的总长度为100B，首部长度为 $4\!\times\!5\!=\!20\mathrm{B}$ ，所以数据部分长度为80B。因此该分组的数据部分的最后一个字节的编号是879。  

# 05.【解答】  

通过将目的地址和子网掩码换算成二进制，并进行逐位“与”就可得到子网地址。但是通常在目的地址中，子网掩码为255所对应的部分在子网地址中不变，子网掩码为0所对应的部分在子网地址中为0，其他部分按二进制逐位“与”求得（也可直接截取）。本题中，子网掩码的前两部分为255.255，因此子网地址的前两部分为201.230；子网掩码最后一部分为0，因此子网地址的最后一部分为0；子网地址的第三部分为240，进行换算有 $240\!=\!(11110000)_{2}$  $34\!=\!(00100010)_{2}$ 逐位“与”得 $(00100000)_{2}\!=\!32$ 。因此子网地址为201.230.32.0。  

# 06.【解答】  

因为一个CIDR地址块中可以包含很多地址，所以路由表中就利用CIDR地址块来查找目的网络，这种地址的聚合常称为路由聚合。  

本题已知有212.56.132.0/24、212.56.133.0/24、212.56.134.0/24、212.56.135.0/24地址块，可知第3个字节前6位相同，因此共同前缀为 $8+8+6\!=\!22$ 位，因为这4个地址块的第1、2个字节相同，考虑它们的第3个字节： $132\!=\!(10000100)_{2}$  $133\,{=}\,(10000101)_{2}$  $134\!=\!(10000110)_{2}$  $135\!=\!(1000\,0111)_{2}$ 所以共同的前缀有22位，即1101010000111000100001，聚合的CIDR地址块是212.56.132.0/22。  

07.【解答】  

1）可以采用划分子网的方法对该公司的网络进行划分。因为该公司包括5个部门，所以共需要划分为5个子网。  
2）已知网络地址192.168.161.0是一个C类地址，所需的子网数为5，每个子网的主机数为 $20\sim$ 30。子网号的比特数为3，即最多有 $2^{3}\!=\!8$ 个可分配的子网，主机号的比特数为5，因为主机号不能为全0或全1，所以每个子网最多有 $2^{5}\!-\!2\!=\!30$ 个可分配的IP地址。  

5个部门子网的子网掩码均为255.255.255.224，各部门的网络地址与部门主机的IP地址范围可分配如下：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/de60a2f2ea4d9b3efa1bfb7664521f9a68fbb765626545838f0ce350db9b47f0.jpg)  

# 08.【解答】  

1）使用CIDR时，可能会导致有多个匹配结果，应当从当前匹配结果中选择具有最长网络前缀的路由。下面来一一分析分组A与表中这四项的匹配性：  

$\textcircled{\scriptsize{1}}$ 131.128.56.0/24与31.128.55.33不匹配，因为前24位不同。 $\circledcirc$ 131.128.55.32/28与131.128.55.33的前24位匹配，只需看后面4位是否匹配，32转换为二进制为 $\mathbf{0010}\;0000$ ，33转换为二进制为 $\mathbf{0010\,\mathrm{0001}}$ ，匹配，且匹配了28位。 $\textcircled{3}$ 131.128.55.32/30与131.128.55.33的前24位匹配，只需要看后面6位是否匹配，32转换为二进制为00100000，33转换为二进制为00100001，匹配，且匹配了30位。 $\textcircled{4}$ 131.128.0.0/16与131.128.55.33匹配，且匹配了16位。综上，对于分组A，第2、3、4项都能与之匹配，但根据最长网络前缀匹配原则，应该同理，对于分组B，路由表中第2和4项都能与之匹配，但是根据最长网络前缀匹配原则，应该选择第2个路由表项转发，下一跳路由器为B。  

2）即增加1条特定主机路由：网络前缀131.128.55.33/32；下一跳A。  

3）即增加1条默认路由：网络前缀0.0.0.0/0；下一跳E。  

4）要划分成4个规模尽可能大的子网，需要从主机位中划出2位作为子网位（ $(2^{2}\!=\!4$ ，CIDR广泛使用之后允许子网位可以全0和全1)。子网掩码均为11111111111111111111111111000000，即255.255.255.192。而地址范围中不能包含主机位全0或全1的地址。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/b80eaaf41623c147e243bb933903181f30541733dd1bd4662892a0998354f177.jpg)  

# 09.【解答】  

1）网络号C4.5E.10.0/20（下一站地是B）的第3个字节可以用二进制表示成 $0001\:0000$ 。年目标地址C4.5E.13.87的第3个字节可以用二进制表示成 $0001\;0011$ ，显然取20位掩码与网络号C4.5E.10.0/20相匹配，所以具有该目标地址的IP分组将被投递到下一站地B。  

2）网络号C4.50.0.0/12（下一站地是A）的第2个字节可以用二进制表示成01010000。目标地址C4.5E.22.09的第2个字节可以用二进制表示成01011110，显然取12位掩码与网  
络号C4.50.0.0/12相匹配，所以具有该目的地址的IP分组将被投递到下一站地A。  

3）网络号80.0.0.0/1（下一站地是E）的第1个字节可以用二进制表示成10000000。目标地址C3.41.80.02的第1个字节可以用二进制表示成11000011，显然取1位掩码与网络号80.0.0.0/1相匹配，所以具有该目标地址的IP分组将被投递到下一站地E。  

4）网络号40.0.0.0/2（下一站地是F）的第1个字节可以用二进制表示成01000000。目标地址5E.43.91.12的第1个字节可以用二进制表示成01011110，显然取2位掩码与网络号40.0.0.0/2相匹配，所以具有该目标地址的IP分组将被投递到下一站地F。  

10.【解答】  

分配网络前缀应先分配地址数较多的前缀。已知该自治系统分配到的IP地址块为30.138118/23（注意： $\textcircled{\scriptsize{1}}$ 一个路由器端口也需要占用一个IP地址； $\textcircled{2}$ 子网划分的答案不唯一）。  

LAN3：主机数150，因为 $\iota(2^{7}\!-\!2)<\!150+1<(2^{8}\!-\!2)$ ，所以主机号为8比特，网络前缀为24。取第24位为0，分配地址块30.138.118.0/24。  

LAN2：主机数91，因为 $(2^{6}\!-\!2)<91+1<(2^{7}\!-\!2)$ ，所以主机号为7比特，网络前缀为25。取第24、25位为10，分配地址块30.138.119.0/25。  

LAN5：主机数为15，因为 $(2^{4}\!-\!2)<15+1<(2^{5}\!-\!2)$ ，所以主机号为5比特，网络前缀27。取第24、25、26、27位为1110，分配地址块30.138.119.192/27。  

LAN1：共有3个路由器，再加上一个网关地址，至少需要4个IP地址。因为 $(2^{2}\!-\!2)\!<\!3+1\!<$  $(2^{3}\!-\!2)$ ，所以主机号为3比特，网络前缀为29。取第24、25、26、27、28、29位为111101，分配地址块30.138.119.232/29。  

LAN4：主机数为3，因为 $(2^{2}\!-\!2)<3+1<(2^{3}\!-\!2)$ ，所以主机号为3比特，网络前缀29。取第24、25、26、27、28、29位为111110，分配地址块30.138.119.240/29。  

11.【解答】  

1）共同的子网掩码为255.255.255.240，表示前28位为网络号，同一网段内的IP地址具有相同的网络号。主机A的网络号为192.168.75.16；主机B的网络号为192.168.75.144；主机C的网络号为192.168.75.144；主机D的网络号为192.168.75.160；主机E的网络号为192.168.75.160。因此5台主机A、B、C、D、E分属3个网段，主机B和C在一个网段，主机D和E在一个网段，A主机在一个网段。主机D的网络号为192.168.75.160。  

2）主机F与主机A同在一个网段，所以主机F所在的网段为192.168.75.16，第4个字节16的二进制表示为 $0001\:0000$ ，最后边的4位为主机位，去掉全0和全1。则其IP地址范围为192.168.75.17 $\sim$ 192.168.75.30，并且不能为192.168.75.18。  

3）因为164的二进制为10100100，将最右边的4位全置1，即10101111，则广播地址为192.168.75.175。主机D和主机E可以收到。  

# 12.【解答】  

IPv4的首部格式如下，然后根据首部格式来解析首部各个字段的含义。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/042c71ac7a6d5f533dcb19766b1ef8786a4a0992013a38b69052010abc76d757.jpg)  
1）由上图可知，源IP地址为IP首部的第13、14、15、16个字节，即 $7\mathrm{C}\,4\mathrm{E}\,03\,02$ ，转换为点分十进制表示可得源IP地址为124.78.3.2。目的IP地址为IP首部的第17、18、19、20个字节，即 $\mathrm{B}4\:0\mathrm{E}\:0\mathrm{F}\:02$ ，转换为点分十进制表示可得目的1P地址为180.14.15.2。  

2）分组总长度是IP首部的第3、4个字节，即0054，转换为十进制得该分组总长度为84，单位为字节。而首部长度是IP首部的第 $5{\sim}8$ 位，值为5，单位为4B，因此首部长度为 $4{\mathrm{B}}{\times}5\,{=}\,20{\mathrm{B}}$ 数据部分长度 $=$ 总长度-首部长度 $=84\!-\!20\!=\!64\mathrm{B}$  

3）该分组首部的片偏移字段为第7、8个字节（除去第7个字节的前3位），不等于0，而是二进制值 $1\ 1000\ 0101\ 0000$ ，即十进制数6224，单位是8B。  

另外，分组的标志字段为第7个字节的前3位，即010，中间位 $\mathrm{DF}=1$ 表示不可分片，最后位 ${\mathrm{MF}}\!=\!0$ 表示后面没有分片。  

13.【解答】  

1）根据收到的帧，找出源IP地址为dac76628，表示成十进制为218.199.102.40，是一个C类IP地址，与A的IP地址218.207.61.211不在同一个网络中，所以需经过路由器转发。MAC地址只具有本地意义（ARP也只能工作在同一局域网中）。该帧为A收到的帧，因此目的MAC地址为A的MAC地址，源MAC地址为网关路由器端口的MAC地址（若 为A发出的帧，则目的MAC地址为默认网关的MAC地址）。首先找到目的MAC地址00:1d:72：98:1dfc的位置（在下图中的位置1标出），根据以太网帧的结构，目的MAC地址后面紧邻的是源MAC地址，因此源MAC地址为00:00:5e:00:01:01。  

00001001d72981dfc00005e00010188641100 ..r.....A....d.. 001075890192002145000190f9bf40003306u....!E.....@.3. 0020f315dac76628dacf3dd30050c48fdca6 ..fC..=..P... 0030a296234c446925018000f763d000090b5 .#LDiP. V=.  

2）要求得IP分组所携带的数据量，需要知道首部长度和总长度。218.207.61.211表示成十六进制是da.cf.3d.d3，并且作为分组中的目的IP地址。在图中确定目的IP地址的位置（位置2），再根据IP首部的结构，分别从自的IP的位置向前数14和16个字节，即可我到总长度和首部长度字段的位置。但首部长度字段所在的字节值为045，首部长度字段只有4位，前4位是版本号。因此首部字段的值为5，单位为4B，所以首部长度为20B。总长度字段值为0x0190，十进制为 $400\mathrm{B}$ 。因此分组携带的数据长度为380B。  

3）因为整个IP分组的长度是400B，大于输出链路MTU（380B）。这时需要考虑分片，但是否能够分片还得看IP首部中的标志位。IP首部中的标志字段占3位，从前到后依次为保留位、DF位、MF位。根据IP首部结构找到标志字段所在的字节，其值为0x40，二进制表示为01000000，于是 $\mathrm{DF}=1$ ，不能对该IP分组进行分片。此时，路由器应进行的操作是丢弃该分组，并用ICMP差错报文向源主机报告。  

14.【解答】  

1）网络前缀/30，主机号不能全0或全1，可求出R1接口E2的1P地址为172.16.16.18/30。H1配置的默认网关地址应是R1接口E0的IP地址192.168.0.126。H4配置的默认网关地址应是R1的接口E1的IP地址192.168.0.254。  

2）对R1接口E0的直连网络与接口E1的直连网络进行路由聚合，方法是“找共同前缀”共同的网络前缀为 $192.168.0.0/24$ 。因此给R2添加的一条路由表项为  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/aff6911c55539d03b6a213f88112780e608565d3cdacf4365a1220e22bd15f59.jpg)  

3）在 $\mathrm{Hl\rightarrowRl\rightarrowH6}$ 传送IP分组的过程中，分别使用了两次ARP，交换机进行了相关的自学  
习，还需考虑Hub的广播特性。H1给H6发送一个IP分组P，能收到封装P的以太网帧的主机有H4、H5、H6，其中H4和H5发现帧的目的MAC地址与自身的不同且不是厂播地址，于是丢弃该帧，而H6发现帧的目的MAC地址与自身的相同，于是接收该帧。H6给H1发送一个IP分组A，能收到封装A的以太网帧的主机有H4、H5、H1，其中H4和H5发现帧的目的MAC地址与自身的不同且不是广播地址，于是丢弃该帧，而H1发现帧的目的MAC地址与自身的相同，于是接收该帧。  

4）需要在R2上开启网络地址转换NAT服务。当H1发出H时，其首部中的源IP地址为H1的1P地址192.168.0.11，目的IP地址为Web服务器S的IP地址218.75.230.30。H从 R2转发出去时，其首部中的源IP地址为R2接口E1的IP地址211.67.222.16，目的IP地址为Web服务器S的IP地址218.75.230.30。  

15.【解答】  

1）子网号可以全0或全1，但主机号不能全0或全1。因此若将IP地址空间202.118.1.0/24划分为2个子网，且每个局域网需分配的IP地址个数不少于120个，则子网号至少要占用1位。 由 $2^{6}\!-\!2<\!120<\!2^{7}\!-\!2$ 可知，主机号至少要占用7位。 $^+$   ${\o}=8$  综上可得主机号位数为7，子网号位数为1。因此子网的划分结果为子网1：子网地址为202.118.1.0，子网掩码为255.255.255.128（或子网1：202.118.1.0/25）；子网2：子网地址为202.118.1.128，子网掩码为255.255.255.128（或子网2：202.118.1.128/25）。地址分配方案：子网1分配给局域网1，子网2分配给局域网2：或者子网1分配给局域网2，子网2分配给局域网1。  

2）因为局域网1和局域网2分别与路由器R1的E1、E2接口直接相连，所以在R1的路由表中，目的网络为局域网1的转发路径是直接通过接口E1转发的，目的网络为局域网2的转发路径是直接通过接口E2转发的。因为局域网1、2的网络前缀均为25位，所以它们的子网掩码均为255.255.255.128。  

域名服务器是一台特定的主机，它指明了其IP地址，因此设定1条特定主机路由，该表项的子网掩码为255.255.255.255（只有和全1的子网掩码相与时，才能保证和目的IP地址一样，从而选择该特定路由）。对应的下一跳地址是202.118.2.2，转发接口是L0。  

R1到互联网的路由实质上相当于一个默认路由（即当某一目的IP地址与路由表中其他任何表项都不匹配时，则匹配该默认路由。互联网包括了无数的网络集合，不可能在路由表项中一一列出，因此只能采用默认路由的方式），默认路由一般写为0/0，即目的地址为0.0.0.0，子网掩码为0.0.0.0。对应的下一跳地址是202.118.2.2，转发接口是L0。  

综上可得到路由器R1的路由表如下：  

（若子网1分配给局域网1，子网2分配给局域网2）  

（若子网1分配给局域网2，子网2分配给局域网1）
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/6d8e12b92696d1caf46815042e7fe9b6e3ce3df46a9e58165ce744be9b455941.jpg)  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/6946ebdea841b086720f7c0856bee515b59904783934ca57fd736bd1e6d27fff.jpg)  

3）局域网1和局域网2的地址可以聚合为202.118.1.0/24，而对于路由器R2来说，通往局域网1和局域网2的转发路径都是从L0接口转发的，因此采用路由聚合技术后，路由器R2到局域网1和局域网2的路由如下：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/1a6d50249b6e55ffab696f63a97d92a4a95040385a86cacddb95f89b459e5813.jpg)  

# 16.【解答】  

1）DHCP服务器可为主机 $2{\sim}N$ 动态分配IP地址的最大范围是111.123.15.5\~111.123.15.254；主机2发送的封装DHCPDiscover报文的IP分组的源IP地址和目的IP地址分别是0.0.0.0和255.255.255.255。  

2）主机2发出的第一个以太网帧的目的MAC地址是ff-ff-ff-ff-ff-ff；封装主机2发往Internet的IP分组的以太网帧的目的MAC地址是00-al-al-al-al-al。  

3）主机1能访问WWW服务器，但不能访问Internet。因为主机1的子网掩码配置正确而默认网关IP地址被错误地配置为111.123.15.2（正确IP地址是111.123.15.1），所以主机1可以访问在同一个子网内的WWW服务器，但当主机1访问Intermet时，主机1发出的IP分组会被路由到错误的默认网关（111.123.15.2），从而无法到达目的主机。  

# 17.【解答】  

1）广播地址是网络地址中主机号全1的地址（主机号全0的地址代表网络本身）。销售部和技术部均被分配了192.168.1.0/24的IP地址空间，IP地址的前24位为网络号。于是在后8位中划分部门的子网，选择前1位作为部门子网的网络号。根据已分配的IP地址，销售部子网的网络号为0，技术部子网的网络号为1，则技术部的子网地址为192.168.1.128；销售部的子网地址为192.168.1.0，广播地址为192.168.1.127。  

每台主机仅分配一个IP地址，计算目前还可以分配的主机数，用技术部可以分配的主机数减去已分配的主机数，技术部总共可以分配的计算机主机数为 $2^{7}\!-\!2=\!126$ （减去全0和全1的主机号）。已经分配了 $208-129+1=80$ 台，此外还有1个IP地址（192.168.1.254）分配给了路由器的端口，因此还可以分配 $126-80-1\,{=}\,45$ 台。  

2）判断分片的大小，需要考虑各个网段的MTU，而且注意分片的数据长度必须是8B的整数倍。由题可知，在技术部子网内， $\mathrm{\DeltaMTU=800B}$ ，IP分组首部长20B，最大IP分片封装数据的字节数为 $(800-20)/8\rfloor\!\times\!8=776$ 。至少需要的分片数为 $(1500-20)/776\bigm=2\,\mathrm{s}$ 第1个分片的偏移量为0；第2个分片的偏移量为 $776/8\!=\!97$  

# 18.【解答】  

1）H2和H3与Web服务器处于不同的局域网，路由器R2、R3具有NAT功能。当R2从WAN口收到来自H2或H3发来的HTTP请求时，根据NAT表发送给Web服务器的对应端口。为使外部主机能正常访问Web服务器，应在R2的NAT表中增加一项，外网的IP地址配置为路由器的外端IP地址，内网的IP地址配置为Web服务器的IP地址，HTTP的服务器端的默认端口号为80，因此外网和内网的端口号都需配置为80。只需在R2中  
配置Web服务器的NAT表项，而不用在R3中配置H2和H3的NAT表项，原因在于我们只知道Web服务器的端口号80，而客户端的端口号是随机分配的，无法做静态配置，只能通过自动动态配置实现。R2的NAT表配置如下：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/06ca30ef7a3d3ce631cd6cb3500366e19978fe7921c9ce9bf04a5bfb1e77b7a8.jpg)  

2）因为启用了NAT服务，H2发送的P的源IP地址应该是H2的内网地址，目的地址应该是R2的外网IP地址，源IP地址是192.168.1.2，目的IP地址是203.10.2.2。R3转发后，将P的源IP地址改为R3的外网IP地址，目的IP地址仍然不变，源IP地址是203.10.2.6，目的IP地址是203.10.2.2。R2转发后，将P的目的IP地址改为Web服务器的内网地址，源地址仍然不变，源1P地址是203.10.2.6，目的IP地址是192.168.1.2。  

# 19.【解答】  

1）设备1选择100BaseT以太网交换机，设备2选择100BaseT集线器。因为物理层设备既不能隔离冲突域，又不能隔离广播域，链路层设备可以隔离冲突域但不能隔离广播域。  

2）本题与2016年真题第36题几乎相同，仅修改了几个数字。有关最短帧长的题要抓住两个公式来分析： $\textcircled{\scriptsize{1}}$ 发送帧的时间≥争用期的时间； $\circledcirc$ 最短帧长 $=$ 数据传输速率 $\times$ 争用期时间。要使公式 $\textcircled{\scriptsize{1}}$ 恒成立，就要考虑在最短帧长的情况下公式 $^\mathrm{(\mathrm{d})}$ 仍成立。发送最短帧的时间为 $64\mathrm{B}\!\!+\!\!100\mathrm{M}\mathrm{b}/\mathrm{s}\!=\!5.12\upmu\mathrm{s},$ ，根据公式 $^{(\!\astrosun)}$ 可知，该时间即为争用期时间（往返时延）的最大值。本题的特点在于往返时延由两部分组成，即传播时延和Hub产生的转发时延。单程总时延为 $2.56\upmu\mathrm{s}$ ，Hub产生的转发时延为 $1.51\upmu\mathrm{s}$ ，所以传播时延为 $2.56-1.51=1.05\upmu\mathrm{s}$ ，从而H3与H4之间理论上可以相距的最大距离为 $200\mathrm{m}/\upmu\mathrm{s}\!\times\!1.05\upmu\mathrm{s}\!=\!210\mathrm{m}$  

3）M是DHCP发现报文（DISCOVER报文）。路由器EO接口能收到封装M的以太网帧，因为H4发送的DHCP发现报文是广播的形式，所以同一个广播域内的所有设备和接口都可以收到该以太网帧。因为是广播帧，所以目的MAC地址是全1，S向DHCP服务器转发的封装M的以太网帧的目的MAC地址是FF-FF-FF-FF-FF-FF。  

4）在H5收到的帧中，地址1、地址2和地址3分别是00-11-11-11-11-E1、00-11-11-11-11-C1和00-11-11-11-11-D1。该帧来自AP，地址1是接收方H5的MAC地址，地址2是AP的MAC地址，地址3是发送方H4的MAC地址。  

# 4.3 IPv6  

4.3.1IPv6的特点  

目前广泛使用的IPv4是在20世纪70年代设计的，互联网经过几十年的飞速发展，到2011年2月，IPv4地址已经耗尽，为了解决“IP地址耗尽”问题，有以下三种措施：  

1）采用无类别编址CIDR，使IP地址的分配更加合理。2）采用网络地址转换（NAT）方法以节省全球IP地址。3）采用具有更大地址空间的新版本的IPv6。前两种方法只是延长了IPv4使用寿命，只有第三种方法能从根本上解决IP地址耗尽问题。  
# 命题追踪IPv6的特点（2023）  

IPv6的主要特点如下：  

1）史人时地址工间。这定取里安的。IFV0付地址从IrV4时52位增人到128位，IrV0的地址空间是IPv4的 $2^{128-32}\!=\!2^{96}$ 倍，从长远来看，这些地址是绝对够用的。2）扩展的地址层次结构。IPv6因为地址空间很大，所以可以划分为更多的层次。3）灵活的首部格式。IPv6定义了许多可选的扩展首部，不仅可提供比IPv4更多的功能，而且能提高路由器的处理效率，这是因为路由器对扩展首部不进行处理。IPv4所规定的选项是固定不变的，其选项放在首部的可变部分。6）支持即插即用（即自动配置）。因此IPv6不需要使用DHCP。7）支持资源的预分配。IPv6支持实时音/视频等要求保证一定带宽和时延的应用。8）IPv6只有源主机才能分片，是端到端的，不允许类似IPv4传输路径中的路由分片。9）IPv6首部长度是固定的40B，而IPv4首部长度是可变的（必须是4B的整数倍）。10）增大了安全性。身份鉴别和保密功能是IPv6的扩展首部。  

虽然IPv6与IPv4不兼容，但总体而言它与所有其他的互联网协议兼容，包括TCP、UDP、ICMP、IGMP和DNS等，只是在少数地方做了必要的修改（大部分是为了处理长地址）。  

# 4.3.2IPv6数据报的基本首部  

IPv6数据报由两部分组成：基本首部和有效载荷（也称净负荷）。有效载荷由零个或多个扩展首部（扩展首部不属于IPv6数据报的首部）及其后面的数据部分构成，如图4.11所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f698b67646d9930c64da34e52dc45dad7d35022f8c9f2fdb596f320bf237c685.jpg)  
图4.11具有多个可选扩展首部的IPv6数据报的一般形式  

因为取消了首部中不必要的功能，IPv6基本首部的字段数减少到只有8个，但由于IPv6地址长度为128位，所以IPv6基本首部的长度反而增大到40B，如图4.12所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/03769dd7cc9b50a35c96a4fc7fbf8a9c5757c87a33f21ed45608a52f302efe1f.jpg)  
图4.12IPv6数据报的基本首部的格式  

# 命题追踪IPv6基本首部字段的意义（2023）  

下面简单介绍IPv6基本首部中各字段的含义：  
1）版本。占4位，指明协议的版本，对于IPv6该字段的值是6。2）通信量类。占8位，用来区分不同的IPv6数据报的类别或优先级。  

3）流标号。占20位，IPv6提出流的抽象概念。流是指互联网上从特定源点到特定终点（单 播或多播）的一系列数据报（如实时音/视频传输），而在这个“流”所经过的路径上的路由器都保证指明的服务质量。所有属于同一个流的数据报都具有相同的流标号。  

4）有效载荷长度。占16位，指明IPv6数据报除基本首部以外的字节数（所有扩展首部都算在有效载荷之内）。这个字段的最大值是65535（单位为字节）。  

5）下一个首部。占8位，该字段相当于IPv4首部中的协议字段或可选字段。当IPv6没有扩展首部时，其作用与IPv4的协议字段一样，它指明IPv6数据报所运载的数据是何种协议数据单元；当IPv6带有扩展首部时，它就标识后面第一个扩展首部的类型。  

6）跳数限制。占8位，类似于IPv4首部的TTL字段。源点在每个数据报发出时即设定某个限制值（最大为255）。路由器每次转发时将其值减1，减为零时就将该数据报丢弃。  

7）源地址和目的地址。占128位，是数据报的发送端/接收端的IP地址。  

# 4.3.3IPv6地址  

IPv6数据报的目的地址有以下三种基本类型：  

1）单播。就是传统的点对点通信。  

2）多播。一点对多点的通信，数据报发送到一组计算机中的每一台。  

3）任播。这是IPv6增加的一种类型。任播的终点是一组计算机，但数据报只交付其中的一台计算机，通常是距离最近的一台计算机。  

IPv4地址通常使用点分十进制表示法。若IPv6也使用这种表示法，则地址书写起来将相当长。IPv6标准使用冒号十六进制记法，即把地址中的每4位用一个十六进制数表示，并用冒号分隔每16位，如4BF5:AA12:0216:FEBC:BA5F:039A:BE9A：2170。  

当16位域的开头有一些0时，可以采用一种缩写表示法，但在域中必须至少有一个数字。例如，可以把地址4BF5:0000:0000:0000:BA5F:039A:000A:2176缩写为4BF5:0:0:0:BA5F:39A:A:2176。  

当有相继的0值域时，还可以进一步缩写。这些域可用双冒号缩写（：）。当然，双冒号表示法在一个地址中仅能出现一次，因为0值域的个数没有编码，需要从指定的总的域的个数来推算。这样一来，前述地址可被更紧凑地书写成4BF5:BA5F:39A:A：2176。  

IPv6地址的分类如表4.3所示。  

表4.3IPv6地址的分类
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/471fef216dc17fd584cc9b372fa479feea53d81138258a20d51f969078e66308.jpg)  

对表4.3给出的五类地址简单解释如下：  

1）未指明地址：该地址不能用作目的地址，只能用于还未配置IPv6地址的主机作为源地址。  

2）环回地址：该地址的作用与IPv4的环回地址相同，但IPv6的环回地址仅此一个。  

3）多播地址：该地址的作用和IPv4的一样。这类地址占IPv6地址空间的1/256。  
4）本地链路单播地址：该地址的作用类似于 $\mathrm{IPv4}$ 的私有IP地址。  

5）全球单播地址：用得最多的地址。IPv6全球单播地址采用下图所示的三级结构：第一级为全球路由选择前缀，占48位，用于互联网中的路由选择，相当于IPv4分类地址中的网络号；第二级为子网标识符，占16位，用于各机构构建自己的子网：第三级为接口标识符，用于指明主机或路由器的单个网络接口，相当于IPv4分类地址中的主机号。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/2b339deff31fff0c110cdba987c1a5abd5ca2b0abcb54b14675383edc6b3882a.jpg)  

与IPv4不同，IPv6地址的接口标识符有64位之多，足以对各种接口的硬件地址直接进行编码。这样，IPv6就可直接从128位地址的最后64位中直接提取出相应的硬件地址，而不需要使用地址解析协议（ARP）进行地址解析。  

# 4.3.4 IPv 4 IPv 6  

从IPv4向IPv6过渡只能采用逐步演进的办法，同时还必须使新安装的IPv6系统能够向后兼容。IPv6系统必须能够接收和转发IPv4分组，并且能够为IPv4分组选择路由。  

# 命题追踪IPv4向IPv6过渡的策略（2023）  

从IPv4向IPv6过渡可以采用下列两种策略：  

1）双协议栈，是指在一台设备上同时装有IPv4和IPv6两个协议栈，分别配置了一个IPv4地址和一个IPv6地址，因此这台设备既能和IPv4网络通信，又能和IPv6网络通信。双协议栈主机在与IPv6主机通信时采用IPv6地址，而在与IPv4主机通信时采用IPv4地址，双协议栈主机使用应用层的域名系统（DNS）获知目的主机采用的是哪种地址。若DNS返回的是IPv4地址，则双协议的源主机就使用IPv4地址。若DNS返回的是IPv6地址，则双协议栈的源主机就使用IPv6地址。  

2）隧道技术，是指在IPv6数据报要进入IPv4网络时，把整个IPv6数据报封装成IPv4数据报的数据部分，使原来的IPv6数据报就好像在IPv4网络的隧道中传输。当IPv4数据报离开IPv4网络时，再将其数据部分交给主机的IPv6协议。  

# 4.3.5 本节习题精选  

# 单项选择题  

01.下一代互联网核心协议IPv6的地址长度是（）。  

A.32比特B.48比特C.64比特D.128比特  

02.与IPv4相比，IPv6（）  

A.采用32位IP地址B.增加了首部字段数目C.不提供QoS保障D.没有提供检验和字段  

03.以下关于IPv6地址1A22:120D:0000:0000:72A2:0000:0000:00C0的表示中，错误的是（）。  

A.1A22:120D::72A2:0000:0000:00C0B.1A22:120D:72A2:0:0:C0C.1A22:120D::72A2:00C0D.1A22:120D:0:0:72A2::C0  

04.一个IPv6地址的简化写法为8:：D0:123:CDEF:89A，则其完整地址应该是（）。  

A.8000:0000:0000:0000:00D0:1230:CDEF:89A0 B.0008:0000:0000:0000:00D0:0123:CDEF:89A0  
8000:0000:0000:0000:D000:1230:CDEF:89A0 D.0008:0000:0000:0000:00D0:0123:CDEF:089A  

05.下列关于IPv6的描述中，错误的是（）。  

A：IPv6的首部长度是不可变的B.IPv6不允许分片C.IPv6采用了16B的地址，在可预见的将来不会用完D.IPv6使用了首部检验和来保证传输的正确性  

06.若一个路由器收到的1Pv6数据报因太大而不能转发到链路上，则路由器将把该数据报()。  

A.丢弃 B.暂存 C.分片D.转发至能支持该数据报的链路上  

07.【2023统考真题】下列关于IPv4和IPv6的叙述中，正确的是（）。  

I.IPv6地址空间是IPv4地址空间的96倍 I1.IPv4首部和IPv6基本首部的长度均可变II.IPv4向IPv6过渡可以采用双协议栈和隧道技术IV.IPv 6 Hop Limit IPv 4 TIL  

A.仅I、ⅡIB.仅I、IVC.仅II、IIID.仅III、IV  

# 4.3.6 答案与解析  

# 单项选择题  

01.D  

IPv6的地址用16B（即128比特）表示，比IPv4长得多，地址空间是IPv4的 $2^{96}$ 倍。  

02.D  

IPv6采用128位地址。IPv6减少了首部字段数目，仅包含8个字段。IPv6支持QoS（指在有限的带宽资源下，为业务提供端到端的服务质量保证），以满足实时、多媒体通信的需要。因为自前网络传输介质的可靠性较高，所以出现比特错误的可能性很低，且数据链路层和传输层有自己的检验，为了效率，IPv6没有检验和字段。  

03.C  

使用零压缩法时，双冒号“：”（表示零压缩）在一个地址中只能出现一次。也就是说，当有多处不相邻的0时，只能用“”代表其中的一处。  

04.D  

冒号十六进制记法表示IPv6地址的规则： $\textcircled{\scriptsize{1}}$ 多个连续区域为0，可进行零压缩，但一个地址仅可出现一次零压缩。 $\circledcirc$ 每个区域开头的0可省略，结尾的0不可省略。按照规则先将题中零压缩的部分展开，得到8：0000:0000：0000：D0:123：CDEF：89A；每个区域应该有4位十六进制数，不足4位则表示开头的0被省略，补充后得到0008：0000：0000：0000：00D0：0123：CDEF：089A。  

05.D  

IPv6的首部长度是固定的，因此不需要首部长度字段。IPv6取消了检验和字段，这样就加快了路由器处理数据报的速度。我们知道，数据链路层会去弃检测出差错的倾，传输层也有相应的差错处理机制，因此网络层的差错检测可以精简掉。  

06.A  

IPv6中不允许分片。因此，若路由器发现到来的数据报太大而不能转发到链路上，则丢弃该数据报，并向发送方发送一个指示分组太大的ICMP报文。  
07.D  

IPv4地址占32位，地址空间为  $2^{32}$  ；IPv6地址占128位，地址空间为  $2^{128}$  ，IPv6地址空间是 IPv4地址空间的 $2^{96}$ 倍，I错误。IPv4首部长度是4B的倍数，长度可变；IPv6基本首部长度是40B，不可变，ⅡI错误。IPv4向IPv6过渡可以采用双协议栈（设备同时支持 $\mathrm{IPv4}$ 和IPv6）和隧道技术（IPv6数据报封装 $\mathrm{IPv4}$ 的数据部分），III正确。IPv6首部的HopLimit字段和IPv4首部的TTL字段都用于限制数据报在网络中经过的路由器数量，IV正确。  

# 4.4路由算法与路由协议  

# 4.4.1路由算法  

路由选择协议的核心是路由算法，即需要何种算法来获得路由表中的各个项目。路由算法的目的很简单：给定一组路由器及连接路由器的链路，路由算法要找到一条从源路由器到目的路由 器的“最佳”路径。通常，“最佳”路径是指具有最低费用的路径。  

# 1.静态路由与动态路由  

路由器转发分组是通过路由表转发的，而路由表是通过各种算法得到的。从能否随网络的通信量或拓扑自适应地进行调整变化来划分，路由算法可以分为如下两大类。  

1）静态路由算法。指由网络管理员手工配置每一条路由。2）动态路由算法。根据网络流量负载和拓扑结构的变化来动态调整自身的路由表。  

静态路由算法的特点是简单和开销较小，但不能及时适应网络状态的变化，适用于简单的小型网络。动态路由算法能较好地适应网络状态的变化，但实现复杂，开销也大，适用于较复杂的大网络。常用的动态路由算法可分为两类：距离-向量路由算法和链路状态路由算法。  

# 2.距离-向量路由算法  

距离-向量算法的基础是Belliman-Ford算法，它用于计算单源最短路径。每个结点以自身为源点执行Bellman-Ford算法，所以全局上可以解决任意结点对之间的最短路径问题。  

下面讨论Bellman-Ford算法的基本思想。  

假设 $d_{x}(y)$ 表示从结点 $x$ 到结点 $y$ 的带权最短路径的费用，则有  

式中， $c(x,v)$ 是从 $x$ 到其邻居 $\nu$ 的费用。已知 $x$ 的所有邻居到 $y$ 的最短路径费用后，从 $x$ 到y的最短路径费用是对所有邻居 $v$ 的 $c(x,\nu)+d_{\nu}(y)$ 的最小值，如图4.13所示。所有最短路径算法都依赖于一个性质：“两点之间的最短路径也包含了路径上其他顶点间的最短路径。”  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/12611813d1879774849211636fc146bfc2d29d0e6ae99f100dc9742f52c0fa79.jpg)  
图4.13Bellman-Ford算法的基本思想  
对于距离-向量算法，每个结点 $x$ 维护下列路由信息：  

1）从 $x$ 到每个直接相连邻居 $\nu$ 的链路费用 $c(\boldsymbol{x},\boldsymbol{v})$ 。2）结点 $x$ 的距离向量，即 $x$ 到网络中其他结点的费用。这是一组距离，因此称为距离向量。3）它收到的每个邻居的距离向量，即 $x$ 的每个邻居到网络中其他结点的费用。  

在距离-向量算法中，每个结点定期地向它的每个邻居发送它的距离向量副本。当结点 $x$ 从它的任何一个邻居 $v$ 接收到一个新距离向量时，它首先保存 $v$ 的距离向量，Bellman-Ford公式 $d_{x}(y)=\operatorname*{min}\left\{c(x,v)+d_{v}(y)\right\}$ 更新自己的距离向量。若结点 $x$ 的距离向量因这个更新步骤而改变，则结点 $x$ 接下来继续向它的每个邻居发送其更新后的距离向量。  

下面以图4.14顶部三个结点的简单网络为例，说明距离-向量算法的实现。  

# 命题追踪距离向量路由算法的具体实现（2021）  

图4.14(a)中的各列依次是三个结点的初始化距离向量，此时各结点之间尚未交换过任何路由信息，因此各结点的初始化距离向量就等于它到每个直接相连邻居v的费用。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/768629927fac929d4ab41b84621905d8960be70fc17d30ff64b196f1098835be.jpg)  
图4.14距离向量算法实现的举例  

初始化后，每个结点第一次向它的所有邻居发送其距离向量，在接收到该更新报文后，每个结点重新计算自已的距离向量。例如，结点 $x$ 计算的过程为： $\begin{array}{r}{d_{x}(x)=0\,;\,\,d_{x}(y)=\operatorname*{min}\left\{c(x,y)+d_{y}(y),\right.}\end{array}$  $c(x,z)+d_{z}(y)\}=\operatorname*{min}\{2+0,7+1\}=2$  d()=min{c(x,y)+d(z),  $c(x,z)+d_{z}(z)\}=\operatorname*{min}\{2+1,7+0\}=$   $\underline{{\boldsymbol{\mathfrak{s}}}}_{\circ}$ 注意到结点 $x$ 到结点 $z$ 的最低费用从7变成了3，结点 $z$ 到结点 $x$ 的最低费用也从7变成了3，如图4.14(b)所示。结点的距离向量变化后，再次向它们的邻居发送它们更新的距离向量，而没有变化的结点 $y$ 不用发送更新报文。接收到邻居的更新报文后，结点又重新计算它们的距离向量，此次没有结点更新，因此也无更新报文发送，算法进入静止状态，如图4.14(c)所示。  

显然，更新报文的大小与网络中的结点数目成正比，大型网络将导致很大的更新报文。最常见的距离-向量路由算法是RIP算法，它采用“跳数”作为距离的度量。  

# 3.链路状态路由算法  

链路状态是指本路由器都和哪些路由器相邻，以及相应链路的代价。链路状态算法要求每个结点都具有全网拓扑结构图（这个拓扑结构图在全网范围内是一致的），它们执行下列两项任务：第一，主动测试所有相邻结点的状态：第二，定期地将链路状态传播给所有其他结点。因此每个结点都知道全网共有多少个结点、哪些结点是相连的、其代价是多少等，于是每个结点都可使用Dijkstra最短路径算法计算出到达其他结点的最短路径。  

在链路状态算法中，结点每收到一个链路状态报文，便用其更新自己的网络状态“视野图”一旦链路状态发生变化，就使用Dijkstra算法重新计算到达所有其他结点的最短路径。  
因为一个结点的链路状态只涉及相邻结点的连通状态，而与整个互联网的规模并无直接关系，所以链路状态算法适用于大型的或路由信息变化聚敛的互联网环境。  

链路状态算法的主要优点是，每个结点都使用同样的链路状态数据独立地计算路径，而不依赖中间结点的计算；链路状态报文不加改变地传播，因此采用该算法易于查找敌障。当一个结点从所有其他结点接收到报文时，它就在本地立即计算出正确的路径，保证一步汇聚。最后，因为链路状态报文仅运载来自单个结点关于直接链路的信息，其大小与网络中的结点数目无关，所以链路状态算法比距离-向量算法有更好的规模可伸展性。  

两种路由算法的比较：在距离-向量算法中，每个结点仅与它的直接邻居交谈，向它的邻居发送自己的路由表，其大小取决于网络中的结点数目，代价较大。在链路状态算法中，每个结点通过广播的方式与所有其他结点交谈，但它只告诉它们与它直接相连的链路的费用。  

典型的链路状态路由算法是OSPF算法。  

# 4.4.2分层次的路由选择协议  

互联网采用的是自适应的、分布式路由选择协议。因为互联网的规模非常大，许多联网单位不愿让外界了解自己单位网络的布局细节，所以互联网采用分层次的路由选择协议。  

为此，可以把整个互联网划分为许多较小的自治系统（AutonomousSystem，AS）。自治系统是在单一技术管理下的一组路由器，这些路由器使用一种AS内部的路由选择协议和共同的度量。一个AS对其他AS表现出的是一个单一的和一致的路由选择策略。  

这样，互联网就把路由选择协议划分为两大类  

# 1.内部网关协议（Interior Gateway Protocol，IGP）  

内部网关协议即在一个自治系统内部使用的路由选择协议，它与在互联网中的其他自治系统选用什么路由选择协议无关。自前这类路由选择协议使用得最多，如RIP和OSPF。  

# 2.外部网关协议（External Gateway Protocol，EGP）  

若源主机和目的主机处在不同的自治系统中（两个自治系统可能使用不同的IGP），则当数据报传到一个自治系统的边界时，就需要使用一种协议将路由选择信息传递到另一个自治系统中。这样的协议就是外部网关协议。目前使用最多的外部网关协议是BGP-4。  

自治系统之间的路由选择也称域间路由选择，自治系统内部的路由选择也称域内路由选择。  

图4.15是两个自治系统互连的示意图。每个自治系统自己决定在本自治系统内部运行哪个内部网关协议（例如，可以是RIP或OSPF）。但每个自治系统都有一个或多个路由器（图中的路由器R1和R2）除运行本系统的内部网关协议外，还要运行外部网关协议（如BGP-4）。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/6112522be698219f313ddd9b098f0e24bb2125b01240cce7be446986a2d591b1.jpg)  
图4.15自治系统和内部网关协议、外部网关协议  

# 4.4.3路由信息协议（RIP）  

路由信息协议（Routing Information Protocol，RIP）I GP用的协议。RIP是一种分布式的基于距离向量的路由选择协议。  
1.RIP的规定  

1）网络中的每个路由器都要维护从它自身到其他每个目的网络的距离记录，即距离向量。2）RIP使用跳数（HopCount）（或称距离）来衡量到达目的网络的距离。规定从一路由器到直接连接的网络的距离定义为1；而每经过一个路由器，距离就加1。3）RIP认为好的路由就是它通过的路由器数目少，即距离短或跳数少。  

# 命题追踪RIP中跳数为16的含义（2010）  

4）RIP允许一条路径最多只能包含15个路由器。因此距离等于16时表示网络不可达。可见RIP只适用于小型互联网。距离向量路由可能会出现环路的情况，规定路径上的最高跳数的目的是为了防止分组不断在环路上循环，减少网络拥塞的可能性。5）每个路由表项都有三个关键字段：<目的网络 $N$ ，距离 $d$ ，下一跳路由器地址 $\chi>$  

# 2.RIP的特点  

RIP的每个路由器都要不断与其他路由器交换信息，下面三个特点非常重要。  

1）和谁交换信息：仅和直接相邻的路由器交换信息。2）交换什么信息：交换的信息是本路由器所知道的全部信息，即自己的路由表。3）何时交换信息：按固定的时间间隔（如30秒）交换路由信息。当网络拓扑发生变化时，路由器也及时向相邻路由器通告拓扑变化后的路由信息。  

路由器刚开始工作时，只知道自己到直接相连的几个网络的距离为1。每个路由器仅和相邻路由器周期性地交换并更新路由信息。经过若干次交换和更新后，所有的路由器最终都会知道到达本自治系统内任何网络的最短距离和下一跳路由器的地址，称为收敛。  

# 命题追踪封装RIP报文所采用的协议（2017）  

RIP是应用层协议，它使用UDP传送数据（端口520）。RIP选择的路径不一定是时间最短的，但一定是具有最少的路由跳数，因为它是根据最少跳数进行路径选择的。  

# 3.RIP的距离向量算法  

对每个相邻路由器发送来的RIP报文，执行如下步骤：  

1）对地址为 $X$ 的相邻路由器发来的RIP报文，先修改此报文中的所有项目：把“下一跳”字段中的地址都改为 $X,$ ，并把所有“距离”字段的值加1。  

2）对修改后的RIP报文中的每个项目，执行如下步骤：  

IF（若原来的路由表中没有目的网络 $N)$ 则把该项目添加到路由表中（表明这是新的目的网络）。ELSEIF（若原来的路由表中有目的网络 $N$ ，且下一跳路由器的地址是 $X)$ 用收到的项目替换原路由表中的项目（因为要以更新的消息为准）。ELSEIF（若原来的路由表中有目的网络 $N$ ，且下一跳路由器的地址不是 $X)$ 若收到的项目中的距离 $d$ 小于路由表中的距离，则进行更新。ELSE什么也不做。3）若180秒（RIP默认超时时间）还没有收到相邻路由器的更新路由表，则把此相邻路由器  

记为不可达的路由器，即把距离设置为16（距离为16表示不可达）。  

4）返回。下面举例说明RIP路由条目的更新过程。已知路由器R6和R4互为相邻路由器，表4.4(a)所示为R6的路由表，现在收到相邻路由器R4发来的路由更新信息，如表4.4(b)所示。  
表4.4(a）R6的路由表
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/889f89c59d634d95c1bd9984787004bbb1abfc4ccc76b076c5aebc5983ca6261.jpg)  

表4.4(b）R4发来的路由表
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/91cd1866cfc529d657f0a9580a36d851d3fc8364d3a2201b39819805333824a4.jpg)  

现在试更新R6的路由表。先把 $\mathrm{R_{4}}$ 发来的路由表［表4.4(b)】中各项的距离都加1，并把下一跳路由器都改为R4，得到表4.5(a)。将这个表的每行与R6的路由表[表4.4(a)］进行比较。  

第一行的Netl在表4.4(a)中没有，因此要把这一行添加到表4.4(a)中。第二行的Net2在表4.4(a)中有，且下一跳路由器也是R4，因此要更新（距离增大了）。  

第三行的Net3在表4.4(a)中有，但下一跳路由器不同。于是需要比较距离。新的路由信息的距离是2，小于原表中的4，因此要更新。这样，得出更新后的R6的路由表如表4.5(b)所示。  

表4.5(a)修改R4发来的路由表
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/a97c4d76eb3895ef462128c5897814b8e3366a96be378450b6fc83b80323f2fd.jpg)  

表4.5(b)R6更新后的路由表
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/91b094f046fb1e1478116d0079f503cecbaa272a878d4bac0f8118446d285adb.jpg)  

# 4.RIP的优缺点  

RIP的优点：  

1）实现简单、开销小、收敛过程较快 2）若一个路由器发现了更短的路由，则这种更新信息就传播得很快，在较短时间内便可被传至所有路由器，俗称“好消息传播得快”。  

RIP的缺点：  

1）RIP限制了网络的规模，它能使用的最大距离为15（16表示不可达）。2）路由器之间交换的是路由器中的完整路由表，因此网络规模越大，开销也越大。3）当网络出现故障时，路由器之间需反复多次交换信息才能完成收敛，要经过较长时间才能将故障消息传送到所有路由器（即慢收敛现象），俗称“坏消息传播得慢”。  

下面举例说明RIP“好消息传播得快，坏消息传播得慢”的特点。假设图4.16中的路由器都采用RIP交换路由信息，初始时R1到网络 $N$ 的距离为4，且R1和R2均已收敛。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/fcb2f30da895050fcf0b8687df1e357c43fd6cb3ad48015e8494ffb22c268878.jpg)  
图4.16RIP举例：链路开销改变  

在图4.16(a)中，某时刻R1的某个端口检测到“到 $N$ 更短的链路”（距离由4变为1），R1计算其到 $N$ 的最新距离 $=\operatorname*{min}\lbrace1,1+\mathrm{R}2$ 到 $N$ 的距离 $\}=\operatorname*{min}\{1,1+5\}=1$ ，并通知邻居；R2收到后，更新其到 $N$ 的距离为2，并通知邻居；R1收到后，R1到 $N$ 的最短距离未变，不再发送通知，算法进入静止状态。可见，R2到 $N$ 的距离减少的好消息通过RIP得到了迅速传播。  
# 命题追踪RIP“坏消息传播得慢”的分析（2016）  

在图4.16（b)中，某时刻R1的某个端口检测到“ $^{\circ}N$ 不可达”（即距离变为16），R1计算其到 $N$ 的最新距离 $=\!\operatorname*{min}\{16,1+\mathrm{R}2$ 到 $N$ 的距离 $\}=\operatorname*{min}\{16,1+5\}=6$ 。从网络全局的视角可以看出，经过R2的这个新距离显然是错误的。R1算出到 $N$ 的最新距离后，通知邻居；R2收到后，更新其到 $N$ 的距离为7,通知邻居；R1收到后，计算其到 $N$ 的距离 $=\operatorname*{min}\{16,1+\mathrm{R}2$ 到 $N$ 的距离 $\ell=\operatorname*{min}\{16,$  $1+7\}=8$ ，继续通知邻居…...如此循环，直到R2最终算出它经由R1到达 $N$ 的距离为16为止。可见，RIP关于链路故障或距离增加的坏消息传播得很慢。  

# 4.4.4开放最短路径优先（OSPF）协议  

# 1.OSPF协议的基本特点  

开放最短路径优先（OSPF）协议是使用分布式链路状态路由算法的典型代表，也是内部网关协议（IGP）的一种。OSPF与RIP相比有以下4点主要区别：  

1）OSPF向本自治系统中所有路由器发送信息。这里使用的方法是洪泛法。而RIP仅仅向自己相邻的几个路由器发送信息。2）发送的信息是与本路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息。而在RIP中，发送的信息是本路由器所知道的全部信息，即整个路由表。3）只有当链路状态发生变化时，路由器才用洪泛法向所有路由器发送此信息，并且更新过程收敛得快，不会出现RIP“坏消息传得慢”的问题。而在RIP中，不管网络拓扑是否发生变化，路由器之间都要定期交换路由表的信息。  

# 命题追踪封装OSPF报文所采用的协议（2017）  

4）OSPF是网络层协议，它不用UDP或TCP，而直接用IP数据报传送（其IP数据报首部的协议字段为89）。而RIP是应用层协议，它在传输层使用UDP。  

# 注意  

用UDP传送是指将该信息作为UDP报文的数据部分，而直接使用IP数据报传送是指将该信息直接作为IP数据报的数据部分。RIP报文是作为UDP数据报的数据部分。  

除以上区别外，OSPF还有以下特点：  

1）OSPF充许对每条路由设置成不同的代价，对于不同类型的业务可计算出不同的路由。2）若到同一个目的网络有多条相同代价的路径，则可将通信量分配给这几条路径。3）OSPF分组具有鉴别功能，从而保证仅在可信赖的路由器之间交换链路状态信息。4）OSPF支持可变长度的子网划分和无分类编址CIDR。5）每个链路状态都带上一个32位的序号，序号越大，状态就越新。  

# 2.OSPF的基本工作原理  

因为各路由器之间频繁地交换链路状态信息，所以所有路由器最终都能建立一个链路状态数据库，即全网的拓扑结构图。然后，每个路由器利用链路状态数据库中的数据，使用Dijkstra算法计算自己到达各自的网络的最优路径，构造出自己的路由表。此后，当链路状态发生变化时，每个路由器重新计算到达各目的网络的最优路径，构造出新的路由表。  

# 注意  

虽然使用Dijkstra算法能计算出完整的最优路径，但路由表中不会存储完整路径，而只存储“下一跳”（只有到了下一跳路由器，才能知道再下一跳应当怎样走）。  
为了使OSPF能够用于规模很大的网络，OSPF将一个自治系统再划分为若干更小的范围，称为区域。划分区域的好处是，将利用洪泛法交换链路状态信息的范围局限在每个区域而非整个自治系统，从而减少了整个网络上的通信量。  

# 3.OSPF的五种分组类型  

OSPF共有以下五种分组类型：  

1）问候分组，用来发现和维持邻站的可达性。  

2）数据库描述分组，向邻站给出自己的链路状态数据库中的所有链路状态项目的摘要信息。  

3）链路状态请求分组，尚对方请求发送某些链路状态项目的详细信息。  

4）链路状态更新分组，用洪泛法对全网更新链路状态，它是OSPF最核心的部分。  

5）链路状态确认分组，对链路更新分组的确认。  

在网络中通常传送的OSPF分组大多是问候分组。两个相邻路由器通常每隔10秒要交换一次问候分组，以便知道哪些站可达。若有40秒没有收到某个相邻路由器发来的问候分组，则认为该相邻路由器不可达，应立即修改链路状态数据库，并重新计算路由表。  

在路由器刚开始工作时，OSPF让每个路由器使用数据库描述分组和相邻路由器交换本数据库中已有的链路状态摘要信息。然后，路由器使用链路状态请求分组，向对方请求发送自己所缺少的某些链路状态项目的详细信息。经过一系列的这种分组交换，就建立了全网同步的链路数据库。图4.17给出了OSPF的基本操作，说明了两个路由器需要交换的各种类型的分组。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f0865e7a3e56305b7752f9c75c0c571d220f187b9e36b71961fb01a56f2fc570.jpg)  
图4.17OSPF的基本操作  

在网络运行的过程中，只要一个路由器的链路状态发生变化，该路由器就要使用链路状态更新分组，用洪泛法向全网更新链路状态。其他路由器在收到更新分组后要发送确认。  

为了确保链路状态数据库与全网的状态保持一致，OSPF还规定每隔一段时间（如30分钟）要刷新一次数据库中的链路状态。因为一个路由器的链路状态只涉及与相邻路由器的连通状态，与整个网络的规模并无直接关系，所以当互联网规模很大时，OSPF要比RIP好得多。  

# 4.4.5边界网关协议（BGP）  

# 命题追踪BGP的作用（2013）  

边界网关协议（Border Gateway Protocol，BGP）AS信息的协议，是一种外部网关协议。边界网关协议BGP常用于互联网的网关之间。  

内部网关协议主要是设法使数据报在一个AS中尽可能有效地从源站传送到目的站。在一个AS内部也不需要考虑其他方面的策略。然而BGP使用的环境却不同，主要原因如下：  
1）互联网的规模太大，使得AS之间路由选择非常困难，每个主干网路由器表中的项目数都非常庞大。对于AS之间的路由选择，要寻找最佳路由是很不现实的。  

2）AS之间的路由选择必须考虑政治、安全或经济等有关因素。  

BGP只能是力求寻找一条能够到达目的网络且比较好的路由（不能兜圈子），而并非要寻找一条最佳路由。BGP采用的是路径向量路由选择协议，它与距离向量协议（如RIP）和链路状态协议（如OSPF）都有很大的区别。BGP是应用层协议，它是基于TCP的。  

BGP的工作原理如下：  

1）配置BGP时，每个AS的管理员要选择至少一个路由器，作为该AS的“BGP发言人”BGP发言人往往就是BGP边界路由器。  

# 命题追踪封装BGP报文所采用的协议（2013、2017）  

2）一个BGP发言人与其他AS中的BGP发言人要交换路由信息，就要先建立TCP连接：然后在此连接上交换BGP报文以建立BGP会话，再利用BGP会话交换路由信息。使用TCP连接交换路由信息的两个BGP发言人，彼此成为对方的邻站或对等站。每个BGP发言人除了必须运行BGP外，还必须运行该AS所用的内部网关协议，如OSPF或RIP。图4.18所示为BGP发言人和自治系统AS的关系示意图。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/4ab8772ba2216b0083326b701c09c66e732cf291ac3af19cc38f7fdaebe5ed2b.jpg)  
图4.18BGP发言人和自治系统AS的关系示意图  

3）BGP所交换的网络可达性的信息，就是要到达某个网络所要经过的一系列自治系统。当BGPP发言人互相交换网络可达性的信息后，各BGP发言人就根据所用的策略，从收到的路由信息中找出到达各自治系统的较好路由。  

图4.19给出了一个BGP发言人交换路径向量的例子。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/8f8fe0ecd96d6202cbd624e068791f7ff2d406d6b61dd7bf65606f87db5e3929.jpg)  
图4.19主干网与自治系统间路径向量的交换  

BGP的特点如下：  

1）BGP交换路由信息的结点数量级是AS个数的数量级，这要比这些AS中的网络数少很多。  
2）寻找一条较好的路径，取决于找准正确的BGP发言人，而每个AS中BGP发言人（或边界路由器）的数目是很少的。这样就使得AS之间的路由选择不致过分复杂。3）BGP支持CIDR，因此BGP的路由表也就应当包括目的网络前缀、下一跳路由器，以及4）当BGP刚运行时，BGP的邻站交换整个BGP路由表。但以后只需要在发生变化时更新有变化的部分。这样做对节省网络带宽和减少路由器的处理开销方面都有好处。  

BGP-4共使用4种报文：  

1）打开（Open）报文。用来与相邻的另一个BGP发言人建立关系，使通信初始化。  

2）更新（Update）报文。用来通知某一路由的信息，以及列出要撤销的多条路由。  

3）保活（Keepalive）报文。用来周期性地证实邻站的连通性。  

4）通知（Notification）报文。用来发送检测到的差错。  

若一个BGP发言人想与另一个AS的BGP发言人建立邻站关系，则要向对方发送Open报文，若对方接受这种邻站关系，则用Keepalive报文响应。邻站关系一旦建立，就要继续维持这种关系。为此，这两个BGP发言人彼此要周期性地交换Keepalive报文（一般每隔30秒）。Keepalive报文只有19B，因此不会造成网络上太大的开销。Update报文是BGP的核心内容，BGP发言人可以用Update报文撤销它曾经通知过的路由，也可以宣布增加新的路由。  

RIP、OSPF与BGP的比较如表4.6所示。  

表4.6三种路由协议的比较
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/15cd3d3b0e07729275343dbe5d0888070cbc40ba2780a33c5736517ae359032a.jpg)  

# 4.4.6 本节习题精选  

# 一、单项选择题  

01.动态路由选择和静态路由选择的主要区别是（）。  

A.动态路由远择需要维护整个网络的拓扑结构信息，而静态路由远择只需要维护部分拓扑结构信息B.动态路由选择可随网络的通信量或拓扑变化而自适应地调整，而静态路由选择则需 要手工去调整相关的路由信息C.动态路由选择简单且开销小，静态路由选择复杂且开销大D.动态路由选择使用路由表，静态路由选择不使用路由表  

02.下列关于路由算法的描述中，（）是错误的。  

A.静态路由有时也被称为非自适应的算法B.静态路由所使用的路由选择一旦启动就不能修改C.动态路由也称自适应算法，会根据网络的拓扑变化和流量变化改变路由决策  

D.动态路由算法需要实时获得网络的状态  
03.关于链路状态协议的描述，（）是错误的。  

A.仅相邻路由器需要交换各自的路由表B.全网路由器的拓扑数据库是一致的C.采用洪泛技术更新链路变化信息D.具有快速收敛的优点  

04.在链路状态路由算法中，每个路由器都得到网络的完整拓扑结构后，使用（）算法来找出它到其他路由器的路径长度。  

A.Prim最小生成树算法 B.Dijkstra C.Kruskal D.拓扑排序  

05.下列关于分层路由的描述中，（）是错误的。  

A.采用分层路由后，路由器被划分成区域B.每个路由器不仅知道如何将分组路由到自己区域的目标地址，而且知道如何路由到其他区域C.采用分层路由后，可以将不同的网络连接起来D.对于大型网络，可能需要多级的分层路由来管理  

06.以下关于自治系统的描述中，不正确的是（）  

A.自治系统划分区域的好处是，将利用洪泛法交换链路状态信息的范围局限在每个区域内，而不是整个自治系统B.采用分层划分区域的方法使交换信息的种类增多，同时也使OSPF协议更加简单C.OSPF协议将一个自治系统再划分为若干更小的范围，称为区域D.在一个区域内部的路由器只知道本区域的网络拓扑，而不知道其他区域的网络拓扑的情况  

07.在计算机网络中，路由选择协议的功能不包括（）  

A.交换网络状态或通路信息B.选择到达目的地的最佳路径C.更新路由表D.发现下一跳的物理地址  

08.用于域间路由的协议是（）  

A.RIP B.BGP C.OSPF D.ARP  

09.在RIP协议中，到某个网络的距离值为16，其意义是（）  

A.该网络不可达B.存在循环路由C.该网络为直接连接网络D.到达该网络要经过15次转发  

10.在RIP协议中，假设路由器X和路由器K是两个相邻的路由器，X向K说：“我到目的网络Y的距离为 $N^{\ast}$ ，则收到此信息的K就知道：“若将到网络Y的下一个路由器选为X，则我到网络Y的距离为（）。”（假设 $N$ 小于15）  

A.  $N$  B.N-1 C.1 D.N+1  

11.以下关于RIP的描述中，错误的是（）  

A.RIP是基于距离-向量路由选择算法的B.RIP要求内部路由器将它关于整个AS的路由信息发布出去C.RIP要求内部路由器向整个AS的路由器发布路由信息D.RIP要求内部路由器按照一定的时间间隔发布路由信息  

12.在RIP协议中，当路由器收到相邻路由器发来的路由更新信息时，若发现有更优的路由，则（）。  

A.直接更新自己的路由表B.向相邻路由器发送确认信息后再更新自己的路由表C.向所有相邻路由器发送确认信息后再更新自己的路由表D.不更新自己的路由表  
13.对路由选择协议的一个要求是必须能够快速收敛，所谓“路由收敛”是指（）  

A.路由器能把分组发送到预定的目标B.路由器处理分组的速度足够快 C.网络设备的路由表与网络拓扑结构保持一致D.能把多个子网聚合成一个超网  

14.下列关于RIP和OSPF协议的叙述中，错误的是（）  

A.RIP和OSPF协议都是网络层协议B.在进行路由信息交换时，RIP中的路由器仅向自己相邻的路由器发送信息，OSPF协议中的路由器向本自治系统中的所有路由器发送信息C.在进行路由信息交换时，RIP中的路由器发送的信息是整个路由表，OSPF协议中的路由器发送的信息只是路由表的一部分D.RIP的路由器不知道全网的拓扑结构，OSPF协议的任何一个路由器都知道自己所在区域的拓扑结构  

15.OSPF协议使用（）分组来保持与其邻居的连接。  

A.Hello B.Keepalive C.SPF（最短路径优先）D.LSU（链路状态更新）  

16.以下关于OSPF协议的描述中，最准确的是（）。  

A.OSPF协议根据链路状态法计算最佳路由B.OSPF协议是用于自治系统之间的外部网关协议C.OSPF协议不能根据网络通信情况动态地改变路由D.OSPF协议只适用于小型网络  

17.在OSPF协议中，划分区域的最主要目的是（）  

A.减少路由表的大小B.减少洪泛法交换的通信量C.增加路由选择的灵活性D.增加网络的安全性  

18.以下关于OSPF协议特征的描述中，错误的是（）  

A.OSPF协议将一个自治域划分成若干域，有一种特殊的域称为主干区域B.域之间通过区域边界路由器互连C.在自治系统中有4类路由器：区域内部路由器、主千路由器、区域边界路由器和自 治域边界路由器D.主千路由器不能兼作区域边界路由器  

19.BGP交换的网络可达性信息是（）  

A.到达某个网络所经过的路径B.到达某个网络的下一跳路由器C.到达某个网络的链路状态摘要信息D.到达某个网络的最短距离及下一跳路由器  

20.RIP、OSPF协议、BGP的路由选择过程分别使用（）  

A.路径向量协议、链路状态协议、距离向量协议B.距离向量协议、路径向量协议、链路状态协议C.路径向量协议、距离向量协议、链路状态协议D.距离向量协议、链路状态协议、路径向量协议  

21.从数据封装的角度看，下列（）协议属于TCP/IP参考模型的应用层。  

I.OSPF II.RIP IIl.BGP IV.ICMP A.I、IIB.1I、ⅢIC.I.IVD.I、II、ⅢI、IV  
22.考虑如下图所示的子网，该子网使用了距离向量算法，下面的向量刚刚到达路由器C：来自B的向量为 $(5,0,8,12,6,2)$ ；来自D的向量为（16,12,6,0,9,10)；来自E的向量为（7，6,3，9，0,4）。经过测量，C到B、D和E的延迟分别为6、3和5，则C到达所有结点的最短路径是（）。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/20f4c455b7468424f3c8d55df5f425284247cacd2a885e8b48df294379a7ba55.jpg)  

A.  $(5,6,0,9,6,2)$  B.  $(11,6,0,3,5,8)$  C.  $(5,11,0,12,8,9)$  D.(11,8,0,7,4,9)  

23.某分组交换网络的拓扑如下图所示，各路由器使用OSPF协议且均已收敛，各链路的度量已在图中标注。假设各段链路的带宽均为 $100\mathrm{Mb/s}$ ，分组长度为 $1000\mathrm{B}$ ，其中分组的首部长度为 $^{20\mathrm{B}}$ 。若主机A向主机B发送一个大小为980000B的文件，忽略分组的传播时延和封装/解封时间，从A发送开始到B接收完毕为止，需要的时间是（）。  

A.  $80.08\mathrm{ms}$  B.80.16ms C.  $80.32\mathrm{ms}$  D.  $80.64\mathrm{ms}$  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/46ce26413ee22f8ca11258665367437ec1557cb281f80d69f31f3e643fc7566c.jpg)  

24.【2010统考真题】某自治系统内采用RIP，若该自治系统内的路由器R1收到其邻居路由器R2的距离向量，距离向量中包含信息<net1， $16>$ ，则能得出的结论是（）  

A.R2可以经过R1到达net1，跳数为17B.R2可以到达netl，跳数为16C.R1可以经过R2到达netl，跳数为17D.R1不能经过R2到达net1  

25.【2016统考真题】假设下图中的R1、R2、R3采用RIP交换路由信息，且均已收敛。若R3检测到网络201.1.2.0/25不可达，并向R2通告一次新的距离向量，则R2更新后，其到达该网络的距离是（）。  

A.2B.3C.16D.17  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/9fcae9feb9060f50d98c2ac77a36cca7eb859f56305c73c5b067705e6f1a3a95.jpg)  
26.【2017统考真题】直接封装RIP、OSPF、BGP报文的协议分别是（）  

A.TCP、UDP、IP B.TCP、IP、UDP C.UDP、TCP、IP D.UDP、IP、TCP  

27.【2021统考真题】某网络中的所有路由器均采用距离向量路由算法计算路由。若路由器E与邻居路由器A、B、C和D之间的直接链路距离分别是8、10、12和6，且E收到邻居路由器的距离向量如下表所示，则路由器E更新后的到达目的网络Netl\~Net4的距离分别是（）。  

目的网络A的距离向量B的距离向量C的距离向量D的距离向量
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/2141eb8053d421ff605a7395bbc93f2d4135bc69724b1f0167a81c87861bd74e.jpg)  

A.9,10,12,6 B.9,10,28,20 C.9,20,12,20 D.9,20,28,20  

# 二、综合应用题  

01.RIP使用UDP，OSPF使用IP，而BGP使用TCP。这样做有何优点？为什么RIP周期性地和邻站交换路由信息而BGP却不这样做？  

02.在某个使用RIP的网络中，B和C互为相邻路由器，其中表1为B的原路由表，表2为C广播的距离向量报文 $<$ 目的网络，距离>。心  

表1
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c0339f0039c11353cd437cd967bbefc7612d95857f3282e43fe7f17b2a7883b0.jpg)  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/27b90242fb6870ad99a86df0649a25fb0e0c6a7272e90b7aef0fdea0be05e44e.jpg)  

1）试求路由器B更新后的路由表并说明主要步骤2）当路由器B收到发往网络N2的IP分组时，应该做何处理？  

03.互联网中的一个自治系统的内部结构如下图所示。路由选择协议采用OSPF协议时，计算R6的关于网络N1、N2、N3、N4的路由表。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/bb57d41d4d06acc3e5e57050a0652a9e83e7d6e81682ab6e71bd819716195dd7.jpg)  

注：端口处的数字指该路由器向该链路转发分组的代价。  

04.【2013统考真题】假设Intermet的两个自治系统构成的网络如下图所示，自治系统AS1由路由器R1连接两个子网构成；自治系统AS2由路由器R2、R3互连并连接3个子网构成。各子网地址、R2的接口名、R1与R3的部分接口IP地址如下图所示。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/8b5257afae6bcad6f840ba01274d1a90fb61af3366b2565d98d25b3c63a6db26.jpg)  

请回答下列问题：  

1）假设路由表结构如下表所示。利用路由聚合技术，给出R2的路由表，要求包括到达图中所有子网的路由，且路由表中的路由项尽可能少。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/b8cc1157d7568e6883d4f61967c5de1f4c14a15ab9a26b1190dc2497def10101.jpg)  

2）若R2收到一个目的1P地址为194.17.20.200的IP分组，R2会通过哪个接口转发该IP分组？  

3）R1与R2之间利用哪个路由协议交换路由信息？该路由协议的报文被封装到哪个协议的分组中进行传输？  

05.【2014统考真题】某网络中的路由器运行OSPF路由协议，下表是路由器R1维护的主要链路状态信息（LSI），下图是根据该表及RI的接口名构造的网络拓扑  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/56da70e3bef1f58a4921fb95b91a570558316c3574599e698293a4acb2adbf63.jpg)  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/5fe0335a6da08fc91f50ea75d1e2a37d517df4a2eab6eadbdc8e5f79eaf750a3.jpg)  

请回答下列问题：  

1）假设路由表结构如下表所示，给出图中R1的路由表，要求包括到达图中子网192.1.x.x的路由，且路由表中的路由项尽可能少。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/9f9a02a90e4cdc05b4d2e00f3848c2a08b9299463cec4f2c301def2e5b7c3888.jpg)  

2）当主机192.1.1.130向主机192.1.7.211发送一个 $\mathrm{THz}\!=\!64$ 的IP分组时，R1通过哪个接口转发该IP分组？主机192.1.7.211收到的IP分组的TTL是多少？  

3）若R1增加一条Metric为10的链路连接Internet，则表中R1的LSI需要增加哪些信息？  

# 4.4.7 答案与解析  

# 一、单项选择题  

01.B  

静态路由选择使用手动配置的路由信息，实现简单且开销小，需要维护整个网络的拓扑结构信息，但不能及时适应网络状态的变化。动态路由选择通过路由选择协议，自动发现并维护路由信息，能及时适应网络状态的变化，实现复杂且开销大。动态路由选择和静态路由选择都使用路由表。  

# 02.B  

静态路由又称非自适应算法，它不会估计流量和结构来调整其路由决策。但这并不说明路由选择是不能改变的，事实上用户可以随时配置路由表。而动态路由也称自适应算法，需要实时获取网络的状态，并根据网络的状态适时地改变路由决策。  

03. A  

在链路状态算法中，每个路由器在自己的链路状态变化时，将链路状态信息用洪泛法发送给网络中的其他路由器。发送的链路状态信息包括该路由器的相邻路由器及所有相邻链路的状态。链路状态算法具有快速收敛的优点，它能在网络拓扑发生变化时，立即进行路由的重新计算，并及时向其他路由器发送最新的链路状态信息，使得各路由器的链路状态表能够尽量保持一致。  

# 04.B  

在链路状态算法中，路由器通过交换每个结点到邻居结点的代价来构建一个完整的网络拓扑结构。然后，路由器使用Dikstra最短路径算法来计算到所有结点的最短路径。  

# 05.B  

采用分层路由后，路由器被划分为区域，每个路由器知道如何将分组路由到自己所在区域内的目标地址，但对于其他区域内的结构毫不知情。当不同的网络相互连接时，可将每个网络当作一个独立的区域，这样做的好处是一个网络中的路由器不必知道其他网络的拓扑结构。  

# 06.B  

划分区域的好处是，将利用洪泛法交换链路状态信息的范围局限在每个区域内，而不是整个自治系统。因此，在一个区域内部的路由器只知道本区域的网络拓扑，而不知道其他区域的网络拓扑情况。采用分层次划分区域的方法虽然使交换信息的种类增多了，同时也使OSPF协议更加复杂了，但这样做却能使每个区域内部交换路由信息的通信量大大减少，进而使OSPF协议能够 用于规模很大的自治系统中。  

07.D  

路由选择协议的功能通常包括：获取网络拓扑信息、构建路由表、在网络中更新路由信息、选择到达每个目的网络的最优路径、识别一个网络的无环通路等。发现下一跳的物理地址一般是通过其他方式（如ARP）来实现的，不属于路由选择协议的功能。  
08.B  

BGP（边界网关协议）是域间路由协议。RIP和OSPF是域内路由协议，ARP不是路由协议。  

09.A  

RIP规定的最大跳数为15，16表示网络不可达。  

10.D RIP规定，每经过一个路由器，距离（跳数）加1。  

11.C  

RIP规定一个路由器只向相邻路由器发布路由信息，而不像OSPF那样向整个域洪泛。  

12.A  

在RIP协议中，当路由器收到相邻路由器发来的路由更新信息时，若发现有更优的路由（即跳数更小的路由），则直接更新自己的路由表，并向其他相邻路由器广播自己的新路由。  

所谓收敛，是指当路由环境发生变化后，各路由器调整自己的路由表以适应网络拓扑结构的变化，最终达到稳定状态（路由表与网络拓扑状态保持一致）。收敛越快，路由器就能越快适应网络拓扑结构的变化。  

14.A RIP是应用层协议，它使用UDP传送数据，OSPF才是网络层协议。A错误。  

15.A 此题属于记忆性题目，OSPF协议使用Hello分组来保持与其邻居的连接。  

16.A  

OSPF协议是一种用于自治系统内的路由协议，B错误。它是一种基于链路状态路由选择算法的协议，能适用大型全局IP网络的扩展，支持可变长子网掩码，所以OSPF协议可用于管理一个受限地址域的中大型网络，D错误。OSPF协议维护一张它所连接的所有链路状态信息的邻居表和拓扑数据库，使用多播链路状态更新报文实现路由更新，并且只有当网络发生变化时才传送链路状态更新报文，C错误。OSPF协议不传送整个路由表，而传送受影响的路由更新报文。  

17.B  

链路状态算法让每个路由器都知道整个自治系统的完整拓扑，从而计算出最短路径。若不划分区域，则会导致链路状态数据包的数量和大小非常大，占用大量的网络带宽资源，影响网络效率和稳定性。划分区域后，每个路由器只需要知道自己所在区域内的完整拓扑，把交换链路状态信息的范围局限在每个区域，这样就大大减少了链路状态数据包的数量和大小。  

18.D  

主干区域中，用于连接主干区域和其他下层区域的路由器称为区域边界路由器。只要是在主十区域中的路由器，就都称为主千路由器，因此主干路由器可以兼作区域边界路由器。  

19.A  

因为BGP仅力求寻找一条能够到达目的网络且较好的路由（不能兜圈子），而并非寻找一条最佳路由，所以D选项错误。BGP交换的路由信息是到达某个目的网络所要经过的各个自治系统序列而不仅仅是下一跳，因此选项A正确。  

20.D  

RIP是一种分布式的基于距离向量的路由选择协议，它使用跳数来度量距离。RIP选择的路径不一定是时间最短的，但一定是具有最小距离（最少跳数）的路径。  

OSPF协议使用分布式的链路状态协议，通过与相邻路由器频繁交流链路状态信息，来建立全网的拓扑结构图，然后使用Dijkstra算法计算从自己到各目的网络的最优路径。  
因为BGP仅力求寻找一条能够到达目的网络且较好的路由（不能兜圈子），而并非寻找一条最佳路由，所以它采用的是路径向量路由选择协议。在BGP中，每个自治系统选出一个BGP发信人，这些发言人通过相互交换自己的路径向量（即网络可达性信息）后，就可找出到达各自治系统的较好路由。  

21.B  

RIP和BGP协议属于应用层，OSPF和ICMP协议属于网络层。  

22.B  

距离-向量路由算法要求每个路由器维护一张路由表，该表给出了到达每个自的地址的已知最佳距离（最小代价）和下一步的转发地址。算法要求每个路由器定期与所有相邻路由器交换整个路由表，并更新自己的路由表项。注意从邻接结点接收到路由表不能直接进行比较，而要加上相邻结点传输消耗后再进行计算。C到B的距离是6，于是从C开始通过B到达各结点的最短距离向量是(11,6,14,18,12,8)。同理，通过D和E的最短距离向量分别是(19,15,9,3,12,13)和(12，11,8,14,5，9)。于是，C到所有结点的最短路径应该是 $(11,6,0,3,5,8)$  

23.C  

根据OSPF算法，从A到B转发经过的链路代价依次为2、3、1、1、2，一共经过4个路由器。分组长度为1000B，首部长度为20B，数据长度为980B，所以共有 $980000/980\,=\,1000$ 个分组，每次存储转发时延为 $1000\mathrm{B}{\div}100\mathrm{M}\mathrm{b}/\mathrm{s}=0.08\mathrm{ms}$ ，第一个分组从A到B的时间为 $0.08{\times}5=0.4\mathrm{ms}$ 剩下的999个分组每经过 $0.08\mathrm{ms}$ 就到达一个，所以总时间为 $0.4+0.08{\times}999=80.32\mathrm{ms}$  

24.D  

R1在收到信息并更新路由表后，若需要经过R2到达netl，则其跳数为17，因为距离为16表示不可达，所以R1不能经过R2到达netl，R2也不可能到达net1。选项B、C错误，选项D正确。而题目中并未给出R1向R2发送的信息，因此选项A也不正确。  

25.B  

初始收敛时，R3到网络（201.1.2.0/25）的距离为1，R2到网络的距离为2，R1到网络的距离为2。当R3检测到网络不可达时，因为R3存有其他邻居到网络的路由信息，所以它利用所有邻居的距离向量，用Bellman-Ford公式更新自己的距离向量（易错警告：误以为R3检测到网络不可达时，就把其到网络的距离设置为16），R3重新计算到网络的距离 $=\operatorname*{min}\{16,\mathrm{R}1$ 到网络的距离 $+\,1,\mathrm{R}2$ 到网络的距离 $+\left.1\right\}=\left\{16,2+1,2+1\right\}=3.$ 然后，R3向其所有邻居发送更新报文，“告诉它到网络的距离为3”。R2（及R1）收到R3发来的更新报文后，会利用它保存的所有邻居的距离向量，重新计算自己到网络的距离 $=\operatorname*{min}\{{\mathrm{R1}}$ 到网络的距离 $+\,1,\mathrm{R}3$ 到网络的距离 $+\left.1\right\}=\left\{2+\begin{array}{l l}\end{array}\right.$  $1,3+1\}=3$ ，因此答案为3。与此同时，R1也重新计算自己到网络的距离 $=\operatorname*{min}\{{\mathrm{R}}2$ 到网络的距离 $+\,1,\mathrm{R}3$ 到网络的距离 $+\left.1\right\}=\left\{2+1,\,3+1\right\}=3.$ 如此反复，直至重新收敛。因为RIP的特点“坏消息传得慢”，所以一旦网络出现故障，就要经过较长时间才能将故障消息传送到所有路由器。  

26.D  

RIP是一种分布式的基于距离向量的路由选择协议，它通过广播UDP报文来交换路由信息。OSPF是一个内部网关协议，要交换的信息量较大，应使报文的长度尽量短，所以不使用传输层协议（如UDP或TCP），而直接采用IP。BGP是一个外部网关协议，在不同的自治系统之间交换路由信息，因为网络环境复杂，需要保证可靠传输，所以采用TCP。因此，答案为选项D。  

27.D  

根据距离向量路由算法，E收到相邻路由器的距离向量后，更新它的路由表： $\textcircled{\scriptsize{1}}$ 当原路由表中没有目的网络时，把该项目添加到路由表中。  
$\circledcirc$ 发来的路由信息中有一条到达某个目的网络的路由，该路由与当前使用的路由相比，有较短的距离，就用经过发送路由信息的结点的新路由替换。  

分析题意可知，E与邻居路由器A、B、C和D之间的直接链路距离分别是8,10，12和6。到达Netl～Net4没有直接链路，需要通过邻居路由器。从上述算法可知，E到达目的网络一定是经过A、B、C和D中距离最小的。根据题中所给的距离信息，计算E经邻居路由器到达目的网络 $\mathrm{{Nuel}\!\sim\!\mathrm{{Nuet}}4}$ 的距离，如下表所示，选择到达每个目的网络距离的最短值。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/2c98edc6ec159d059a6047008e7bec9026a74a414f84d9bb44109c347ec0158e.jpg)  

所以距离分别是9,20,28，20。  

# 二、综合应用题  

01.【解答】  

RIP处于UDP的上层，RIP所接收的路由信息都封装在UDP的数据报中；OSPF的位置位于网络层，因为要交换的信息量较大，所以应使报文的长度尽量短，因此采用IP；BGP要在不同的自治系统之间交换路由信息，因为网络环境复杂，需要保证可靠的传输，所以选择TCP。  

内部网关协议主要设法使数据报在一个自治系统中尽可能有效地从源站传送到目的站，在一个自治系统内部并不需要考虑其他方面的策略，然而BGP使用的环境却不同。主要有以下三个原因：第一，互联网规模太大，使得自治系统之间的路由选择非常困难；第二，对于自治系统之间的路由选择，要寻找最佳路由是不现实的：第三，自治系统之间的路由选择必须考虑有关策略。因为上述情况，BGP只能力求寻找一条能够到达目的网络且较好的路由，而并非寻找一条最佳路由，所以BGP不需要像RIP那样周期性地和邻站交换路由信息。  

02.【解答】  

1）根据RIP算法，首先将从C收到的路由信息的下一跳改为C，并且将每个距离都加1，得到右表。  

将题中表2与原路由表项进行比较，根据更新路由表项的规则： $\textcircled{\scriptsize{1}}$ 若目的网络相同，且下一跳路由器相同，则直接更新； $\circledcirc$ 若是新的目的网络地址，则增加表项： $\textcircled{3}$ 若目的网络相同，且下一跳路由器不同，而距离更短，则更新； $\textcircled{4}$ 否则，无操作。更新后的路由表见下表。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/191f4d1c97abfc4666640bda25ef942d88ffc01cce7dd7df1e4b72cb934b0a9a.jpg)  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/10a663113dd459280ab4ae2ced987abfb63e217753cf47d488c4ba39e9728f86.jpg)  

2）在更新后的路由表中，路由器B到N2的距离为16（网络拓扑结构变化导致），这意味着N2网络不可达，这时路由器B应该丢弃该IP分组并向源主机报告自的不可达。  
03.【解答】  

首先，要明白路由器端口旁的数字的含义一一路由器向该链路转发分组的代价，即便是同一段链路的两个不同端点的路由器，转发分组的代价也可能不同。其次，要明白一个网络所连接的几个路由器之间转发分组并不需要经过任何其他中间路由器。例如，R6到网络N1经过的路径和代价计算如下：R6到R3经过的代价是6，R3到R1经过的代价是1，R1到网络N1经过的代价是3，所以R6到网络N1经过的代价是10。根据Dikstra最短路径算法，加入结点的次序之一为(R6,R5，R3，N3，R4，R1，R2,N4，N1,N2），可以得到R6的路由表如下表所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/8e92ef2e53e7e853e5911ed198c1c39d755663a23aebbec097dcad8f0999f813.jpg)  

# 04.【解答】  

1）要求R2的路由表能到达图中的所有子网，且路由项尽可能少，则应对每个路由接口的子网进行聚合。在AS1中，子网153.14.5.0/25和子网153.14.5.128/25可聚合为子网153.14.5.0/24；在AS2中，子网194.17.20.0/25和子网194.17.21.0/24可聚合为子网194.17.20.0/23；子网194.17.20.128/25单独连接到R2的接口E0。  

于是可以得到R2的路由表如下：
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/4dfb2175582c3dce552f3313306db765865d85fe89b9aa9d1bb38f7f5029358b.jpg)  

2）该IP分组的目的IP地址194.17.20.200与路由表中194.17.20.0/23和194.17.20.128/25两 个路由表项均匹配，根据最长匹配原则，R2将通过E0接口转发该IP分组。  

3）R1和R2属于不同的自治系统，因此应使用边界网关协议（BGP或BGP4）交换路由信息；BGP是应用层协议，它的报文被封装到TCP段中进行传输。  

# 05.【解答】  

1）因为题目要求路由表中的路由项尽可能少，所以对从同一接口转发的目的网络进行路由聚合，可以求出子网192.1.6.0/24和192.1.7.0/24都是通过接口L0转发，因此可将这两个子网聚合为子网192.1.6.0/23，其他子网照常，可得到路由表如下：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/cf4ddf048e138ddec474ac62014277fa6bae3b900576bbe39c81b814cb3542f1.jpg)  

2）通过查路由表可知：R1通过L0接口转发该IP分组。因为该分组要经过3个路由器（R1、R2、R4），所以主机192.1.7.211收到的IP分组的TTL是 $64\!-\!3\!=\!61$  

3）互联网（Intemet）包括无数的网络集合，不可能在路由表项中一一列出，因此R1到互联网的路由只能采用默认路由的方式，默认路由的网络前缀为0.0.0.0/0。因此，R1的LSI需要增加一条特殊的直连网络，网络前缀Prefix为· $"0.0.0.0/0"$ ，Metric为10  
# IP多播  

# 4.5.1 多播的概念  

多播是让源主机一次发送的单个分组可以抵达用一个组地址标识的若干目的主机，即一对多的通信。在互联网上进行的多播，称为IP多播。  

与单播相比，在一对多的通信中，多播可大大节约网络资源。假设视频服务器向90台主机传送同样的视频节目，单播与多播的比较如图4.20所示。多播时仅发送一份数据，并且只需发送一次，只有在传送路径出现分岔时才将分组复制后继续转发，因此大大减轻了发送者的负担和网络的负载。多播需要路由器的支持才能实现，能够运行多播协议的路由器称为多播路由器。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/19528b897648d1681e5067d8ed74aca814c66c4a765522f6600af4b81a300c9f.jpg)  
图4.20单播与多播的比较  

# 4.5.2IP多播地址  

多播数据报的源地址是源主机的IP地址，目的地址是IP多播地址。IP多播地址就是IPv4中的D类地址。D类地址的前四位是1110，因此D类地址范围是 $224.0.0.0{\sim}239.255.255.255.255.$ 。每个D类IP地址标志一个多播组，一台主机可以随时加入或离开一个多播组。  

多播数据报和一般的IP数据报的区别是，前者使用D类IP地址作为目的地址，并且首部中的协议字段值是2，表明使用IGMP协议。需要注意的是：  

1）多播数据报也是“尽最大努力交付”，不提供可靠交付。  

2）多播地址只能用于目的地址，而不能用于源地址。  

3）对多播数据报不产生ICMP差错报文。  

IP多播可以分为两种： $\textcircled{\scriptsize{1}}$ 只在本局域网上进行硬件多播； $\circledcirc$ 在互联网的范围内进行多播。目前大部分主机都是通过局域网接入互联网的。因此，在互联网上进行多播的最后阶段，还是要把多播数据报在局域网上用硬件多播交付给多播组的所有成员［见图4.20(b)]。  

多播机制仅应用于UDP，它能将报文同时发送给多个接收者。而TCP是一个面向连接的协议，它意味着分别运行在两台主机的进程之间存在一条连接，因此会一对一地发送。  

# 4.5.3在局域网上进行硬件多播  

因为局域网支持硬件多播，所以只要把IP多播地址映射成多播MAC地址，即可将IP多播数据报封装在局域网的MAC帧中，而MAC顿首部的目的MAC地址字段就设置为由IP多播地址映射成的多播MAC地址。这样，就很方便地利用硬件多播实现了局域网内的IP多播。  
IANA拥有的以太网多播地址的范围是从01-00-5E-00-00-00到01-00-5E-7F-FF-FF。在这些地址中，只有23位可用作多播。这只能和D类IP地址中的23位有一一对应关系。D类IP地址可供分配的有28位，可见在这28位中前5位无法映射到多播MAC地址，如图4.21所示。  

例如，IP多播地址224.128.64.32（即E0-80-40-20）和另一个IP多播地址224.0.64.32（即E0-00-40-20）转换成以太网的硬件多播地址都是01-00-5E-00-40-20。因为多播IP地址与以太网MAC地址的映射关系不是唯一的，所以收到多播数据报的主机，还要在IP层利用软件进行过滤，把不是本主机要接收的数据报丢弃。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/990325a354dd6d4421e60646b9cd97567ed23139bd25859486d30625de05571f.jpg)  
图4.21D类IP地址与以太网多播地址的映射关系  

# 4.5.4IGMP与多播路由协议  

路由器要获得多播组的成员信息，需要利用网际组管理协议（InternetGroupManagementProtocol，IGMP)。连接到局域网上的多播路由器还必须和互联网上的其他多播路由器协同工作，以便把多播数据报用最小代价传送给所有组成员，这就需要使用多播路由选择协议。  

IGMP是让连接到本地局域网上的多播路由器，知道本局域网上是否有主机参加或退出了某个多播组。IGMP并不是在互联网范围内对所有多播组成员进行管理的协议。IGMP不知道IP多播组包含的成员数，也不知道这些成员分布在哪些网络上。  

IGMP报文被封装在IP数据报中传送，但它也向IP提供服务。因此不把IGMP视为一个单独的协议，而视为整个网际协议IP的一个组成部分。IGMP的工作可分为两个阶段。  

第一阶段：当某台主机加入新的多播组时，该主机应向多播组的多播地址发送一个IGMIP报文，声明自己要成为该组的成员。本地的多播路由器收到IGIMP报文后，还要利用多播路由选择协议，把这种组成员关系转发给互联网上的其他多播路由器。  

第二阶段：组成员关系是动态的。本地多播路由器要周期性地探询本地局域网上的主机，以便知道这些主机是否仍继续是组的成员。只要对某个组有一台主机响应，多播路由器就认为这个组是活跃的。但一个组在经过几次探询后仍然没有一台主机响应，多播路由器就认为本网络上的主机都已离开了这个组，因此就不再把这个组的成员关系转发给其他的多播路由器。  

多播路由选择实际上就是要找出以源主机为根结点的多播转发树，其中每个分组在每条链路上只传送一次（即在多播转发树上的路由器不会收到重复的多播数据报）。不同的多播组对应于不同的多播转发树；同一个多播组，对不同的源点也会有不同的多播转发树。  

# 4.5.5 本节习题精选  

# 一、单项选择题  

01.以下关于多播概念的描述中，错误的是（）  
A.在单播路由选择中，路由器只能从它的一个接口转发收到的分组B.在多播路由选择中，路由器可以从它的多个接口转发收到的分组C.用多个单播仿真一个多播时需要更多的带宽D.用多个单播仿真一个多播时时延基本上是相同的  

02.在设计多播路由时，为了避免路由环路，（）  

A.采用了水平分割技术B.构造多播转发树C.采用了IGMPD.通过生存时间（TTL）字段  

03.以太网多播IP地址224.215.145.230应该映射到的多播MAC地址是（）  

A.01-00-5E-57-91-E6B.01-00-5E-D7-91-E6C.01-00-5E-5B-91-E6D.01-00-5E-55-91-E6  

04.下列地址中，（）是多播地址。  

A.10.255.255.255 B.228.47.32.45 C.192.32.44.59 D.172.16.255.255  

# 二、综合应用题  

01.互联网的多播是怎样实现的？为什么互联网上的多播比以太网上的多播复杂得多？  

# 4.5.6 答案与解析  

# 一、单项选择题  

01.D  

多个单播可以仿真多播，但是一个多播所需要的带宽要小于多个单播带宽之和：用多个单播仿真一个多播时，路由器的时延将很大，而处理一个多播分组的时延是很小的。  

# 02.B  

因为树具有不存在环路的特性，所以构造一个多播转发树，通过该转发树既能将多播分组传送到组内的每台主机，又能避免环路［见图4.20（b丁。水平分割用于避免距离-向量路由算法中的无穷计数问题。TTL字段用于防止IP分组因为环路而在网络中无限循环。  

03.A  

以太网多播地址块的范围是01-00-5E-00-00-00\~01-00-5E-7F-FF-FF，而且在每个地址中，只有后23位可用多播。这样，只能和D类IP地址中的后23位有一一对应关系。D类IP地址可供分配的有28位，可见这28位中的前5位不能用来构成以太网硬件地。215的二进制为11010111，其中，在映射过程中最高位为0，因此215.145.230映射的二进制为01010111.10010001.11100110，对应的十六进制数是57-91-E6。  

04.B  

多播地址使用点分十进制表示的范围是224.0.0.0\~239.255.255.255，这4个选项中，只有选项B在这个区间内。  

# 二、综合应用题  

01.【解答】  

互联网的多播是靠路由器来实现的，这些路由器必须增加一些能够识别多播的软件。能够运行多播协议的路由器可以是一个单独的路由器，也可以是运行多播软件的普通路由器。互联网上的多播比以太网上的多播复杂得多，因为以太网本身支持广播和多播，而互联网上当前的路由器和许多物理网络都不支持广播和多播。  
# 4.6 移动IP  

# 4.6.1 移动IP的概念  

移动IP技术是指移动站以固定的IP地址实现跨越不同网络的漫游功能，并保证基于IP的网络权限在漫游过程中不发生任何改变。移动IP的目标是把分组自动地投递给移动站。一个移动站是把其连接点从一个网络或子网改变到另一个网络或子网的主机。  

移动IP定义了三种功能实体：移动结点、本地代理（也称归属代理）和外地代理。1）移动结点。具有永久IP地址的移动主机。2）本地代理。通常就是连接在归属网络（原始连接到的网络）上的路由器。3）外地代理。通常就是连接在被访网络（移动到另一地点所接入的网络）上的路由器。  

值得注意的是，某用户将笔记本关机后从家里带到办公室重新上网，在办公室能很方便地通过DHCP自动获取新的IP地址。虽然笔记本移动了，更换了地点及所接入的网络，但这并不是移动IP。但是，若我们需要在移动中进行TCP传输，则在移动站漫游时，应一直保持这个TCP连接，否则移动站的TCP连接就会断断续续。可见，若要使移动站在移动中的TCP连接不中断，就必须使笔记本的IP地址在移动中保持不变。这就是移动IP要研究的问题。  

# 4.6.2移动IP通信过程  

用一个通俗的例子来描述移动IP的通信原理。例如，在以前科技不那么发达的年代，本科毕业时都将走向各自的工作岗位。因为事先并不知道自己未来的准确通讯地址，所以怎样继续和同学们保持联系呢？实际上也很简单。彼此留下各自的家庭地址（即永久地址）。毕业后若要和某同学联系，只要写信寄到该同学的永久地址，再请其家长把信件转交即可。  

在移动IP中，每个移动站都有一个原始地址，即永久地址（或归属地址），移动站原始连接的网络称为归属网络。永久地址和归属网络的关联是不变的。在图4.22中，移动站A的永久地址是131.8.6.7/16，而其归属网络是131.8.0.0/16。归属代理通常是连接到归属网络上的路由器，然而它实现的代理功能是在应用层完成的。当移动站移动到另一地点，所接入的外地网络也称被访网络。在图4.22中，移动站A被移动到被访网络15.0.0.0/8。被访网络中使用的代理称为外地代理，它通常是连接在被访网络上的路由器。外地代理有两个重要功能： $\textcircled{\scriptsize{1}}$ 要为移动站创建一个临时地址，称为转交地址。在图4.22中，移动站A的转交地址是15.5.6.7/8。转交地址的网络号显然和被访网络一致。 $\circledcirc$ 及时把移动站的转交地址告诉其归属代理。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/4174d26dc508d9296f99faad8d6f94645b3e04daa497b46f1ac2b81540095c98.jpg)  
图4.22移动IP的基本通信过程  
请注意两点：转交地址是供移动站、归属代理及外地代理使用的，各种应用程序都不会使用。外地代理要向连接在被访网络上的移动站发送IP分组时，直接使用移动站的MAC地址。  

在图4.22中，通信者B要和移动站A进行通信。B并不知道A在什么地方，但B使用A的永久地址作为发送的IP分组中的目的地址，移动IP的基本通信流程如下：  

1）移动站A在归属网络时，按传统的TCP/IP方式进行通信。  

2）移动站A漫游到被访网络时，向外地代理进行登记，以获得一个临时的转交地址。外地代理要向A的归属代理登记A的转交地址。3）归属代理知道移动站A的转交地址后，会构建一条通向转交地址的隧道，将截获的发送给A的IP分组进行再封装，并通过隧道发送给被访网络的外地代理。4）外地代理把收到的封装的IP分组进行拆封，恢复成原始的IP分组，然后发送给移动站A，这样A在被访网络就能收到这些发送给它的IP分组。5）移动站A在被访网络对外发送IP分组时，仍然使用自己的永久地址作为IP分组的源地址，此时显然无须通过A的归属代理来转发，而是直接通过被访网络的外部代理。  

6）移动站A移动到另一被访网络时，在新外地代理登记后，然后新外地代理将A的新转交地址告诉其归属代理。无论如何移动，A收到的IP分组都是由归属代理转发的。  

7）移动站A回到归属网络时，A向归属代理注销转交地址。  

为了支持移动性，在网络层中还应增加一些新功能： $\textcircled{\scriptsize{1}}$ 移动站到外地代理的登记协议； $\circledcirc$ 外地代理到归属代理的登记协议： $\textcircled{3}$ 归属代理数据报封装协议； $\textcircled{4}$ 外地代理拆封协议。  

# 4.6.3 本节习题精选  

# 单项选择题  

01.以下关于移动IP基本工作原理的描述中，错误的是（）  

A.移动IP的基本工作过程可以分为代理发现、注册、分组路由与注销4个阶段B.结点在使用移动IP进行通信时，归属代理和外部代理之间需要建立一条隧道C.移动结点到达新的网络后，通过注册过程把自己新的可达信息通知外部代理D.移动IP的分组路由可以分为单播、广播与多播  

02.一台主机移动到了另一个LAN中，若一个分组到达了它原来所在的LAN中，则分组会被转发给（）。  

A.移动IP的本地代理 B.移动IP的外部代理 C.主机 D.丢弃  

03.移动IP为移动主机设置了两个IP地址：主地址和辅地址，（）。  

A.这两个地址都是固定的B.这两个地址随主机的移动而动态改变C.主地址固定，辅地址动态改变 D.主地址动态改变，辅地址固定  

04.若一台主机的IP地址为160.80.40.20/16，则当它移动到另一个不属于 $160.80/16$ 子网的网络时，它将（）。（能否通过被访网络的路由器直接发送/接收数据报）  

A.可以直接接收和直接发送数据报，没有任何影响B.既不可以直接接收数据报，也不可以直接发送数据报C.不可以直接发送数据报，但可以直接接收数据报D.可以直接发送数据报，但不可以直接接收数据报  
# 4.6.4 答案与解析  

# 单项选择题  

01.C  

选项C把移动结点新的可达信息（转交地址）通知归属代理。这样，归属代理就可将发往移动结点的分组通过隧道转到转交地址（外部代理），再由外部代理交付给移动结点。  

02.A  

当一个分组到达用户的本地LAN时，它被转发给某一台与本地LAN相连的路由器。该路由器寻找目的主机，这时本地代理响应该请求，将这些分组封装到一些新IP分组的载荷，并将新分组发送给外部代理，外部代理将原分组解出来后，移交给移动后的主机。  

03.C  

移动主机在原始本地网时，获得的是主地址，当它移动到一个外地网络中时，需获得一个新的临时辅地址，主地址保持不变；当它移动到另一个外地网络或返回本地网络时，辅地址改变或撤销，而主地址仍然保持不变。选项C正确。  

04.D  

当其他主机向该主机发送数据报时，使用永久地址160.80.40.20/16作为数据报的自的地址，因此会发往该主机的归属代理，归属代理知道该主机的转交地址，然后通过隧道技术将数据报发送到该主机的外地代理，由外地代理转交给该主机。当该主机向其他主机发送数据报时，使用永人地址 $160.80.40.20/16$ 作为数据报的源地址，使用其他主机的IP地址作为数据报的目的地址，这个数据报显然没必然再通过该主机的归属代理进行转发，而直接通过外地代理转发。  

# 4.7网络层设备  

# 4.7.1冲突域和广播域  

命题追踪各种中继设备对冲突域/广播域的划分（2010、2020）  

这里的“域”表示冲突或广播在其中发生并传播的区域  

1.冲突域  

冲突域是指连接到同一物理介质上的所有结点的集合，这些结点之间存在介质争用的现象。在OSI参考模型中，冲突域被视为第1层的概念，像集线器、中继器等简单无脑复制转发信号的第1层设备所连接的结点都属于同一个冲突域，也就是说它们不能划分冲突域。而第2层（网桥、交换机）、第3层（路由器）设备都可以划分冲突域。  

2.广播域  

广播域是指接收同样广播消息的结点集合。也就是说，在该集合中的任何一个结点发送一个广播帧，其他能收到这个顿的结点都被认为是该广播域的一部分。在OSI参考模型中，广播域被视为第2层的概念，像第1层（集线器等）、第2层（交换机等）设备所连接的结点都属于同一个广播域。而路由器，作为第3层设备，则可以划分广播域，即可以连接不同的广播域。  

通常所说的局域网（LAN）特指使用路由器分割的网络，也就是广播域。  
# 4.7.2路由器的组成和功能  

命题追踪路由器的功能（2010）  

路由器是一种具有多个输入/输出端口的专用计算机，其任务是连接不同的网络（连接异构网络）并完成分组转发。在多个逻辑网络（即多个广播域）互连时必须使用路由器。  

当源主机向自标主机发送数据报时，路由器先检查源主机与目标主机是否连接在同一个网络上。若源主机和自标主机在同一个网络上，则直接交付而无须通过路由器。若源主机和目标主机不在同一个网络上，则路由器按照转发表（由路由表得出）指出的路由将分组转发给下一个路由器，这称为间接交付。可见，在同一个网络中传递数据无须路由器的参与，而跨网络通信必须通过路由器进行转发。例如，路由器可以连接不同的LAN，连接不同的VLAN，连接不同的WAN，或者把LAN和WAN互连起来。路由器隔离了广播域。  

从结构上看，路由器由路由选择和分组转发两部分构成，如图4.23所示。而从模型的角度看，路由器是网络层设备，它实现了网络模型的下三层，即物理层、数据链路层和网络层。  

# 注意  

若一个存储转发设备实现了某个层次的功能，则它可以互连两个在该层次上使用不同协议的网段（网络）。若网桥实现了物理层和数据链路层，则网桥可以互连两个物理层和数据链路层不同的网段；但中继器实现了物理层后，却不能互连两个物理层不同的网段，这是因为中继器不是存储转发设备，它属于直通式设备。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/a6f3e8013ec6d6e4ad6b99d005103a7ca8fdd09388de0733bec78e66420e84ed.jpg)  
图4.23路由器体系结构  

路由选择部分也称控制部分，核心构件是路由选择处理机，其任务是根据所选定的路由选择协议构造出路由表，同时经常或定期地和相邻路由器交换路由信息而不断更新和维护路由表。  

分组转发部分由三部分组成：交换结构、一组输入端口和一组输出端口。  

交换结构也称交换组织，其作用是根据转发表对分组进行处理，将某个输入端口进入的分组从一个合适的输出端口转发出去。交换结构本身就是一个“在路由器中的网络”。  

路由器的端口中都有物理层、数据链路层和网络层的处理模块。输入端口在物理层接收比特流，在数据链路层提取出帧，剥去帧的首部和尾部后，分组就被送入网络层的处理模块。输出端口执行相反的操作。端口在网络层的处理模块中都设有一个缓冲队列，用来暂存等待处理或已处理完毕待发送的分组，还可用来进行必要的差错检测。若分组处理的速率赶不上分组进入队列的速率，就会使后面进入队列的分组因缓冲区满而只能被去弃。需要说明的是，路由器的端口一般都具有输入和输出的功能，图4.23中分别给出输入和输出端口是为了使读者更容易理解。  
# 4.7.3 路由表与分组转发  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c32894379baf2472f8b38363f02818ea0e57feb363b4efd3bc0fef6a8494738a.jpg)  

根据网络拓扑并利用路由聚合构造出路由表（2009、2013）  

路由表是根据路由选择算法得出的，主要用途是路由选择。从历年统考真题可以看出，标准的路由表有4个项目：目的网络IP地址、子网掩码、下一跳IP地址、接口。在图4.24所示的网络拓扑中，R1的路由表见表4.7，该路由表包含到互联网的默认路由。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/7fb84369cd25807505af80fe6999595f7d65c3f98e6f1977a51f4f5dd572de68.jpg)  
图4.24一个简单的网络拓扑  

# 命题追踪路由表转发分组的分析（2014）  

表4.7R1的路由表
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/83d0ea3113ec3f53e1fd3612ba918f4a07fa3bee9ffe976731a024849b2d0c8e.jpg)  

转发表是从路由表得出的，其表项和路由表项有直接的对应关系。但转发表的格式和路由表的格式不同，其结构应使查找过程最优化（而路由表则需对网络拓扑变化的计算最优化）。转发表中含有一个分组将要发往的目的地址，以及分组的下一跳（即下一步接收者的目的地址，实际为MAC地址）。为了减少转发表的重复项目，可以使用一个默认路由代替所有具有相同“下一跳”的项目，并将默认路由设置得比其他项目的优先级低，如图4.25所示。路由表总是用软件来实现的；转发表可以用软件来实现，甚至也可以用特殊的硬件来实现。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/1454f74c2f1cf79b08cb4f8429965c256b8deb385876c24dc7e65a06f97f8c6a.jpg)  
图4.25未使用默认路由的转发表和使用了默认路由的转发表的对比  

注意转发和路由选择的区别：“转发”是路由器根据转发表把收到的IP数据报从合适的端口转发出去，它仅涉及一个路由器。而“路由选择”则涉及很多路由器，路由表是许多路由器协同工作的结果。这些路由器按照复杂的路由算法，根据从各相邻路由器得到的关于网络拓扑的变化情况，动态地改变所选择的路由，并由此构造出整个路由表。  

路由表不等于转发表，分组的实际转发是靠直接查找转发表，而不是查找路由表，  
# 4.7.4 本节习题精选  

# 一、单项选择题  

01.要控制网络上的广播风暴，可以采用的方法是（）  

A.用网桥将网络分段B.用路由器将网络分段C.将网络转接成10Base-TD.用网络分析仪跟踪正在发送广播信息的计算机  

02.下列关于冲突域的叙述中，正确的是（）  

A.能接收到同一广播帧的所有设备的集合B.能发送同一广播帧的所有设备的集合C.能产生冲突的所有设备的集合D.能隔离冲突的所有设备的集合  

03.一个局域网与在远处的另一个局域网互连，则需要用到（）  

A.物理通信介质和集线器B.网间连接器和集线器C.路由器和广域网技术D.广域网技术  

04.路由器主要实现（）的功能。  

A.数据链路层、网络层与应用层B.网络层与传输层C.物理层、数据链路层与网络层D.物理层与网络层  

05.关于路由器的下列说法中，正确的是（）  

A.路由器处理的信息量比交换机少，因而转发速度比交换机快B.对于同一目标，路由器只提供延迟最小的最佳路由C.通常的路由器可以支持多种网络层协议，并提供不同协议之间的分组转发D.路由器不但能够根据IP地址进行转发，而且可以根据物理地址进行转发  

06.下列关于路由器交付的说法中，错误的是（）  

1.路由选择分直接交付和间接交付II.直接交付时，两台机器可以不在同一个物理网段内III.间接交付时，不涉及直接交付IV.直接交付时，不涉及路由器  

A.I和II B.II和ⅢI C.II和IV D.I和IV  

07.（未使用CIDR）当一个IP分组进行直接交付时，要求发送方和目的站具有相同的（）。  

A.IP地址B.主机号C.端口号D.子网地址  

08.一个路由器的路由表通常包含（）  

A.需要包含到达所有主机的完整路径信息B.需要包含所有到达目的网络的完整路径信息C.需要包含到达目的网络的下一跳路径信息D.需要包含到达所有主机的下一跳路径信息  

09.决定路由器转发表中的值的算法是（）  

A.指数回退算法B.分组调度算法C.路由算法D.拥塞控制算法  

10.路由器中计算路由信息的是（）  

A.输入队列B.输出队列C.交换结构D.路由选择处理机  

11.路由表的分组转发部分由（）组成。  

A.交换结构B.输入端口C.输出端口D.以上都是  

12.路由器转发分组时，需要进行（）A.网络层处理和数据链路层处理B.网络层处理和物理层处理C.数据链路层处理和物理层处理D.网络层处理、数据链路层处理和物理层处理  
13.路由器的路由选择部分包括（）  

A.路由选择处理机B.路由选择协议C.路由表D.以上都是  

14.在下列网络设备中，传输延迟时间最大的是（）A.局域网交换机B.网桥C.路由器D.集线器

15.在路由表中设置一条默认路由，则其目的地址和子网掩码应分别置为（）。  

A.192.168.1.1、255.255.255.0B.127.0.0.0、255.0.0.0C.0.0.0.0、0.0.0.0D.0.0.0.0、255.255.255.255  

16.路由器转发分组（在路由表中已找到匹配的条目）时，会根据路由表中的（）字段来确定输出端口。  

A.目的网络地址B.下一跳地址C.距离度量值D.接口标识符  

17.路由器能够分割广播域的原因是（）  

A.路由器工作在网络层，不转发广播帧B.路由器工作在数据链路层，不转发广播帧C.路由器工作在物理层，不转发广播帧D.路由器工作在传输层，不转发广播帧  

18.不同网络设备传输数据的延迟时间是不同的。下面设备中，传输时延最大的是（）。A.局域网交换机B.网桥C.路由器D.集线器I中继器ⅡI集线器IⅢI网桥IV路由器A.仅I和II B.仅ⅢI C.仅IⅢ和IV D.仅IV

 20.【2012统考真题】下列关于IP路由器功能的描述中，正确的是（）。  

I.运行路由协议，设置路由表II.监测到拥塞时，合理丢弃IP分组III.对收到的IP分组头进行差错检验，确保传输的IP分组不丢失IV.根据收到的IP分组的目的IP地址，将其转发到合适的输出线路上  

A.仅III、IVB.仅I、ⅡI、IIC.仅I、ⅡI、IVD.I、II、II、IV

21.【2020统考真题】下图所示的网络中，冲突域和广播域的个数分别是（）  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/94dc60ae7f81a09f43a4c1a06f5a43fafaa7f6d9f3d4797d9c0b67cfc4e38876.jpg)  
A.2，2B.2，4C.4，2D.4，4  

# 二、综合应用题  

01.某个单位的网点由4个子网组成，结构如下图所示，其中主机H1、H2、H3和H4的IP地址和子网掩码见下表。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/bc88ff372c6071b8ee071fd40f0cf00ed2f14ac4fd4369118fffd00a76e9184b.jpg)  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/b748560595828514b5a65ec01476d744368734eb5b8180dbab236f698e202af6.jpg)  

1）请写出路由器R1到4个子网的路由表2）试描述主机H1发送一个IP数据报到主机H2的过程（包括物理地址解析过程）。  

02.试简述路由器的路由功能和转发功能。  

03.【2019统考真题】某网络拓扑如下图所示，其中R为路由器，主机H1\~H4的IP地址配置以及R的各接口IP地址配置如图中所示。现有若干以太网交换机（无VLAN功能）和路由器两类网络互连设备可供选择  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/163f235d18e2086cb083fc27c7c9d455d6c98a68c5c388095848345ffd4ed835.jpg)  
IP地址：192.168.1.2./26IP地址：192.168.1.3.26IP地址：192.168.1.66.26IP地址：192.168.1.67/26默认网关：192.168.1.1默认网关：192.168.1.1默认网关：192.168.1.65默认网关：192.168.1.65  
请回答下列问题：  

1）设备1、设备2和设备3分别应选择什么类型的网络设备？2）设备1、设备2和设备3中，哪几个设备的接口需要配置IP地址？为对应的接口配置正确的IP地址。3）为确保主机 $\mathrm{H1}\sim\mathrm{H4}$ 能够访问Internet，R需要提供什么服务？4）若主机H3发送一个目的地址为192.168.1.127的IP数据报，网络中哪几个主机会接收该数据报？  

# 4.7.5 答案与解析  

# 一、单项选择题  

01.B  

网桥和交换机是第二层设备，能够分割冲突域，但不能分割广播域。路由器是第三层设备，不转发全网广播（目的地255.255.255.255），因此可以分割广播域。  

02. C  

冲突域是指能产生冲突的所有设备的集合，也就是说，若这些设备同时发送数据，则会发生信号干扰和冲突。冲突域的大小取决于网络拓扑和设备类型。  

03. C 局域网的互连需要路由器作为连接设备，同时是远程的局域网，因此要用到广域网技术。  

04. C  

路由器是网络层设备，所以它也必须要处理网络层以下的功能，即物理层和数据链路层。而传输层和应用层是网络层之上的，它们使用网络层的接口，路由器不实现它们的功能。  

05.C  

路由器是第三层设备，要处理的内容比第二层设备交换机更多，因而转发速度比交换机慢，选项A错误。虽然一些路由协议也将延迟等作为参数进行路由选择，但路由协议使用得最多的参数是传输距离，此外还有一些其他参数，选项B错误。路由器只能根据IP地址进行转发，选项D错误。  

06.B  

路由选择分为直接交付和间接交付，当发送站与目的站在同一网段内时，就使用直接交付，反之使用间接交付，因此I正确、ⅡI错误。间接交付的最后一个路由器肯定直接交付，Ⅲ错误。直接交付在同一网段内，因此不涉及路由器，IV正确。  

07. D  

判断一个IP分组的交付方式是直接交付还是间接交付，路由器需要根据分组的目的IP地址和该路由器接收端口的IP地址是否属于同一个子网来进行判断。具体来说，将该分组的源IP地址和目的IP地址分别与子网掩码进行“与”操作，若得到的子网地址相同，则该分组就采用直接交付方式，否则采用间接交付方式。  

08.C  

路由表中包含到目的网络的下一跳路径信息。由路由表表项的组成也不难得出正确答案为选项C。路由表也不可能包含到达所有主机的下一跳信息，否则路由转发将是不可想象的。  

09.C  

因为转发表是根据路由表生成的，而路由表又是由路由算法得到的，所以路由算法决定了转发表中的值。  

10.D  
路由选择处理机的任务是根据所选定的路由选择协议构造路由表，同时经常或定期地与相邻路由器交换路由信息而不断地更新和维护路由表。  

11.D  

分组转发部分包括3部分： $\textcircled{\scriptsize{1}}$ 交换结构，根据转发表对分组进行处理，将某个输入端口进入的分组从一个合适的输出端口转发出去。 $\circledcirc$ 输入端口，包括物理层、数据链路层和网络层的处理模块。 $\textcircled{3}$ 输出端口，负责从交换结构接收分组，再将其发送到路由器外面的线路上。  

12.D  

路由器的端口中有物理层、数据链路层和网络层的处理模块。输人端口在物理层接收比特流在数据链路层提取出帧，剥去帧的首部和尾部后，分组就被送入网络层的处理模块：输出端口执行相反的操作。网络层处理模块根据分组的目的地址，查找转发表，决定输出端口。  

13.D  

路由器的路由选择部分包括3部分： $\textcircled{\scriptsize{1}}$ 路由选择处理机，它根据所选定的路由选择协议构造路由表，同时和相邻路由器交换路由信息。 $\circledcirc$ 路由选择协议，用来更新路由表的算法。 $\textcircled{3}$ 路由表，它是根据路由算法得出的，一般包括从自的网络到下一跳的映射。  

14. C  

因为路由器是网络层设备，在路由器上实现了物理层、数据链路层和网络层的功能，所以路由器的传输延迟时间最长。  

15.C  

路由表中默认路由的目的地址和子网掩码都是0.0.0.0。  

16.D  

输出端口就是路由器的接口，每个接口都有一个标识符，如G0/0等。路由表中的每个条目都会指定一个接口标识符，路由器转发分组时，根据路由表中的接口标识符来确定输出端口。  

17.A  

交换机会转发广播帧，所以同一台交换机下的所有设备都在一个广播域中。路由器不会转发广播帧，因为路由器工作在网络层，它只关心IP地址，而不关心MAC地址。  

18.C  

路由器具有较大的传输时延，因为它需要根据所接收的每个分组报头中的IP地址决定是否转发分组。这种处理分组报头的任务一般由软件完成，将带来较长的处理时间，也会增加每个分组的传输时延。因为局域网交换机和网桥通常都由硬件进行帧的转发，而且不关心数据链路层以上的数据，所以都具有比路由器要小得多的传输时延。从数量级上看，若局域网交换机的传输时延为儿十微秒，则网桥的传输时延为几百微秒，而路由器的传输时延为几干微秒。集线器的每个接口都具有收发功能，当某个接口收到信号时，立即尚所有其他接口转发，因此其传输时延最小。  

19.D  

中继器和集线器工作在物理层，既不隔离冲突域也不隔离广播域。为了解决冲突域的问题，人们利用网桥和交换机来分隔各个网段中的通信量，建立多个分离的冲突域，但当网桥和交换机接收到一个未知转发信息的数据帧时，为了保证该帧能被目的结点正确接收，将该帧从所有的端口厂播出去，可以看出网桥和交换机的冲突域等于端口个数，厂播域为1。路由器可以隔离厂播域和冲突域，要屏蔽数据链路层的广播顿，当然应该是网络层设备路由器。在此题的选项中，路由器是其中最高层的网络设备，其他设备能隔离的，路由器一定能隔离。  

20.C  

I和IV显然是路由器的功能。对于ⅡI，当路由器监测到拥塞时，可合理去弃IP分组，并向发出该IP分组的源主机发送一个源点抑制的ICMP报文（最新标准已不再使用）。对于IⅢI，路由器对收到的IP分组首部进行差错检验，丢弃有差错首部的报文，但不保证IP分组不丢失。  
21.C  

网络层设备路由器可以隔离广播域和冲突域；数据链路层设备交换机只能隔离冲突域；物理层设备集线器、中继器既不隔离冲突域也不隔离广播域。因此共有2个广播域，4个冲突域。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/3bd3a53a42f3e93b1f2c9245202cb90dceb0e91ce15adcbc69866f3b96ff6394.jpg)  

# 二、综合应用题  

# 01.【解答】  

1）将H1、H2、H3、H4的IP地址分别与它们的子网掩码进行“与”操作，可得到4个子网的网络地址，分别为202.99.98.16、202.99.98.32、202.99.98.48、202.99.98.64，因此路由器R1到4个子网的路由表见下表。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/7b1f4342bf382bf42fc2fa6680386796983134a7977d5ee5138fef074ce8e3e3.jpg)  

2）主机H1向主机H2发送一个IP数据报的过程如下：  

$\textcircled{\scriptsize{1}}$ 主机H1首先构造一个源IP地址为202.99.98.18、目的IP地址为202.99.98.35的IP数据报，主机H1先把本子网的子网掩码与H2的IP地址逐位“与”，所得结果不等于H1的网络地址，因此H1与H2不在同一子网，无法直接交付，然后将该数据报传送给数据链路层。  

$\circledcirc$ 主机H1通过ARP获得路由器R1（202.99.98.17）对应的MAC地址，并将其作为目的MAC地址，将H1的MAC地址作为源MAC地址填入封装有IP数据报的帧，然后将该帧发送出去。  

$\textcircled{3}$ 路由器R1收到该帧后，去掉帧头与帧尾，得到IP数据报，然后根据IP数据报中的目的IP地址（202.99.98.35）去查找路由表，得到下一跳地址为直接相连。  

$\textcircled{4}$ 路由器R1通过ARP得到主机H2的MAC地址，并将其作为目的MAC地址，将R1的MAC地址作为源MAC地址填入封装有IP数据报的帧，然后将该帧发送到子网Net2上。  

$\circledast$ 主机H2将收到的帧，去除顿头与顿尾，并最终得到从主机H1发来的IP数据报。  

# 注意  

在 $\circledcirc$ 中（发出的帧），帧的目的地MAC地址为默认网关的MAC地址；在 $^{(4)}$ 中（接收的帧），倾的源MAC地址为默认网关的MAC地址  
02.【解答】  

转发即当一个分组到达时所采取的动作。在路由器中，每个分组到达时对它进行处理，它在路由表中查找分组所对应的输出线路。通过查得的结果，将分组发送到正确的线路上。  

路由算法是网络层软件的一部分，它负责确定一个进来的分组应该被传送到哪条输出线路上。路由算法负责填充和更新路由表，转发功能则根据路由表的内容来确定当每个分组到来时应该采取什么动作（如从哪个端口转发出去）。  

# 03.【解答】  

1）以太网交换机（无VLAN功能）连接的若干LAN仍然是一个网络（同一个广播域），路由器可以连接不同的LAN、不同的WAN或把WAN和LAN互连起来，隔离了广播域。IP地址192.168.1.2/26与192.168.1.3/26的网络前缀均为192.168.1.0，视为LAN1。IP地址192.168.1.66/26与192.168.1.67/26的网络前缀均为192.168.1.64，视为LAN2。所以设备1为路由器，设备2、3为以太网交换机。  

2）设备1为路由器，其接口应配置IP地址。IF1接口与路由器R相连，其相连接口的IP地址为192.168.1.253/30，253的二进制表示形式为11111101，因此IF1接口的网络前缀也应为192.168.1.111111，已分配192.168.1.253，去除全0全1，IF1接口的IP地址应为192.168.1.254。LAN1的默认网关为192.168.1.1，LAN2的默认网关为192.168.1.65，网关的IP地址是具有路由功能的设备的IP地址，通常默认网关地址就是路由器中的LAN端口地址，设备1的1F2、1F3接口的1P地址分别设置为192.168.1.1和192.168.1.65。  

3）私有地址段：C类192.168.0.0～192.168.255.255，即 $\mathrm{H1\!\sim\!H4}$ 均为私有IP地址，若要能够访问Internet，R需要提供NAT服务，即网络地址转换服务。  

4）主机H3发送一个目的地址为192.168.1.127的IP数据报，主机号全为1，为本网络的广播地址，因为路由器可以隔离广播域，所以只有主机H4会接收到数据报。  

# 4.8本章小结及疑难点  

1.“尽最大努力交付”有哪些含义？  

1）不保证源主机发送的IP数据报一定无差错地交付到目的主机。  

2）不保证源主机发送的IP数据报都在某一规定的时间内交付到目的主机。  

3）不保证源主机发送的IP数据报一定按发送时的顺序交付到目的主机。  

4）不保证源主机发送的IP数据报不会重复交付给目的主机。  

5）不敌意丢弃IP数据报。丢弃IP数据报的情况是：路由器检测出首部检验和有错误；或者因为网络中通信量过大，路由器或目的主机中的缓存已无空闲空间。  

但要注意，IP数据报的首部中有一个“首部检验和”字段。当它检验出IP数据报的首部出现了差错时，就丢弃该数据报。因此，凡交付给目的主机的IP数据报都是IP首部没有差错的或没有检测出差错的。也就是说，在传输过程中，出现差错的IP数据报都被丢弃了。  

现在互联网上绝大多数的通信量都属于“尽最大努力交付”。若数据必须可靠地交付给目的地，则使用IP的高层软件必须负责解决这一问题。  

2.假定在一个局域网中，计算机A广播一个ARP请求分组，希望找出计算机B的硬件地址。试问这时由哪个计算机发送ARP响应分组？将谁的硬件地址告诉计算机A？  

这要区分两种情况。第一，若计算机B和计算机A都连接在同一个局域网上，则计算机B发送ARP响应分组，给出计算机B的硬件地址。第二，若计算机B和计算机A不连接在同一个局域网上，则必须由一个连接计算机A所在局域网的路由器来响应，这时该路由器向计算机A发送ARP响应分组，给出该路由器的硬件地址。  
3.在数据报的首部中只有源IP地址和目的IP地址，而没有中间经过的路由器的IP地址，更没有指明下一跳路由器的IP地址，那么待转发的数据报怎样才能找到下一跳路由器呢？  

当路由器收到一个待转发的数据报时，由路由表得出下一跳路由器的IP地址后，不是把这个地址填入数据报，而是送交数据链路层的网络接口软件。网络接口软件负责把下一跳路由器的IP地转换成硬件地址（使用ARP），并将此硬件地址写入MAC帧的首部，然后根据此硬件地址找到下一跳路由器。可见，当发送一连事的数据报时，上述的查找路由表、用ARP得到硬件地址、把硬件地址写入MAC帧的首部等过程，将不断地重复进行，造成了一定的开销。  

那么，能不能在路由表中不使用IP地址而直接使用硬件地址呢？不行。我们要清楚，使用抽象的IP地址，本来就是为了隐蔽各种底层网络的复杂性而便于分析和研究问题，这样就不可避免地要付出一些代价，例如在选择路由时多了一些开销。反过来，若在路由表中直接使用硬件地址，则因为硬件地址是平面的，将导致路由表极为庞大，从而带来更多的麻烦。  

4.路由器实现了物理层、数据链路层、网络层，这句话的含义是什么？  

第1章中提到了网络中的两个通信结点利用协议栈进行通信的过程。发送方一层一层地把数据“包装”，接收方一层一层地把“包装”拆开，最后上交给用户。路由器实现了物理层，数据链路层和网络层的含义是指路由器有能力对这三层协议的控制信息进行识别、分析以及转换，直观的理解是路由器有能力对数据“包装”这三层协议或者“拆开”这三层协议。自然，路由器就有能力互连这三层协议不同的两个网络。  
# 第5章传输层  

# 【考纲内容】  

（一）传输层提供的服务传输层的功能：传输层寻址与端口：无连接服务和面向连接服务（二）UDPUDP数据报：UDP检验（三）TCPTCP段：TCP连接管理：TCP可靠传输：TCP流量控制与拥塞控制  

# 【复习提示】  

传输层是整个网络体系结构中的关键层次。要求掌握传输层在计算机网络中的功能、工作方式及原理等，掌握UDP及TCP（如首部格式、可靠传输、流量控制、拥塞控制、连接管理等）。其中，TCP报文分析、连接管理、流量控制与拥塞控制机制，出选择题、综合题的概率均较大，因此要将其工作原理透彻掌握，以便能在具体的题目中灵活运用。  

# 5.1传输层提供的服务  

# 5.1.1传输层的功能  

数据链路层提供链路上相邻结点之间的逻辑通信，网络层提供主机之间的逻辑通信。传输层位于网络层之上、应用层之下，它为运行在不同主机上的进程之间提供逻辑通信。传输层属于面向通信部分的最高层，同时也是用户功能中的最低层。显然，即使网络层协议不可靠（网络层协议使分组去失、混乱或重复），传输层同样能为应用程序提供可靠的服务。  

从图5.1可看出，网络的边缘部分的两台主机使用网络的核心部分的功能进行端到端的通信时，只有主机的协议栈才有传输层，而路由器在转发分组时都只用到下三层的功能（即在通信子网中没有传输层，传输层只存在于通信子网以外的主机中）。传输层的功能如下。  

# 1.应用进程之间的逻辑通信  

从网络层来说，通信的双方是两台主机，IP数据报的首部给出了这两台主机的IP地址。但“两台主机之间的通信”实际上是两台主机中的应用进程之间的通信。应用进程之间的通信又称端到端的逻辑通信。IP协议虽然能把分组送到自的主机，但这个分组还停留在主机的网络层，而没有交付给主机中的进程。从传输层来看，通信的真正端点不是主机而是主机中的进程  
# 2.复用和分用  

复用是指发送方不同的应用进程都可以使用同一个传输层协议传送数据。分用是指接收方的传输层在剥去报文的首部后能够把这些数据正确交付到目的应用进程。  

# 注意  

网络层也有复用和分用的功能，但网络层的复用是指发送方不同协议的数据都可被封装成IP数据报发送出去，分用是指接收方的网络层在剥去首部后把数据交付给相应的协议。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/63d78670549561819a300f6b9fc62e30df373cce7e510de756f34b967bc87bb0.jpg)  
图5.1传输层为相互通信的进程提供逻辑通信  

# 3.检错检测  

传输层要对收到的报文（首部和数据部分）进行差错检测。对于TCP协议，若接收方发现报文段出错，则要求发送方重发该报文段。对于UDP协议，若接收方发现数据报出错，则直接丢弃。在网络层，IP数据报首部中的检验和字段只检验首部是否出错，而不检查数据部分。  

# 4.提供面向连接和无连接的传输协议  

传输层向高层用户屏蔽了低层网络核心的细节（如网络拓扑、路由协议等），它使应用进程看见的是在两个传输层实体之间好像有一条端到端的逻辑通信信道，这条逻辑通信信道对上层的表现却因传输层协议不同而有很大的差别。当传输层采用面向连接的TCP协议时，尽管下面的网络是不可靠的（只提供尽最大努力的服务），但这种逻辑通信信道就相当于一条全双工的可靠信道。但当传输层采用无连接的UDP协议时，这种逻辑通信信道仍然是一条不可靠信道。  

而网络层无法同时实现两种协议（即在网络层要么只提供面向连接的服务，如虚电路；要么只提供无连接服务，如数据报，而不可能在网络层同时存在这两种方式）。  

# 5.1.2传输层的寻址与端口  

# 1.端口的作用  

端口能让应用层的各种进程将其数据通过端口向下交付给传输层，以及让传输层知道应当将其报文段中的数据向上通过端口交付给应用层相应的进程。端口在传输层的作用类似于IP地址在网络层的作用，只不过IP地址标识的是主机，而端口标识的是主机中的应用进程。  
数据链路层的服务访问点为顿的“类型”字段，网络层的服务访问点为IP数据报的“协议”字段，传输层的服务访问点为“端口号”字段，应用层的服务访问点为“用户界面”。  

在协议栈层间的抽象的协议端口是软件端口，它与路由器或交换机上的硬件端口是完全不同的概念。硬件端口是不同硬件设备进行交互的接口，而软件端口是应用层的各种协议进程与传输实体进行层间交互的一种地址。传输层使用的是软件端口。  

# 2.端口号  

应用进程通过端口号进行标识，端口号长度为16比特，能够表示65536 $(2^{16}$ ）个不同的端口号。端口号只其有本地意义，即端口号只标识本计算机应用层中的各进程，在因特网中不同计算机的相同端口号是没有联系的。根据端口号范围可将端口分为两类：  

1）服务器端使用的端口号。它又分为两类，最重要的一类是熟知端口号，数值为 $\sim\!1023$ IANA（互联网地址指派机构）把这些端口号指派给了TCP/IP最重要的一些应用程序，让所有的用户都知道。另一类称为登记端口号，数值为 $1024\!\sim\!49151$ ，它是供没有熟知端口号的应用程序使用的，使用这类端口号必须在IANA登记，以防止重复。一些常用的熟知端口号如下：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/e1544960964df4d9da3367ec224ca92c1bb3a1058ebde23539b5c5d0aa0c544a.jpg)  

2）客户端使用的端口号，数值为 $49152\!\sim\!65535$ 。因为这类端口号仅在客户进程运行时才动态地选择，所以又称短暂端口号。当服务器进程收到客户进程的报文时，就知道了客户进程所使用的端口号，因而可以把数据发送给客户进程。通信结束后，刚用过的客户端口号就不复存在，这个端口号就可以供其他客户进程使用。  

# 3.套接字  

在网络中通过IP地址来标识和区别不同的主机，通过端口号来标识和区分一台主机中的不同应用进程，端口号拼接到IP地址即构成套接字（Socket）。在网络中采用发送方和接收方的套接字来识别端点。套接字，实际上是一个通信端点，即  

它唯一地标识网络中的一台主机上的一个应用进程。  

在网络通信中，主机A发给主机B的报文包含目的端口号和源端口号，源端口号是“返回地址”的一部分，即当主机B需要发回一个报文给主机A时，主机B到主机A的报文中的目的端口号便是主机A到主机B的报文中的源端口号（完全的返回地址是主机A的IP地址和源端口号）  

# 5.1.3无连接服务与面向连接服务  

TCP/IP协议族在IP层之上使用了两个传输协议：一个是面向连接的传输控制协议（TCP），采用TCP时，传输层向上提供的是一条全双工的可靠逻辑信道；另一个是无连接的用户数据报协议（UDP），采用UDP时，传输层向上提供的是一条不可靠的逻辑信道。  

TCP提供面向连接的可靠服务，通信双方在传送数据之前必须先建立连接，然后基于此连接进行可靠数据传输，数据传输结束后要释放连接。TCP不提供广播或多播服务。TCP为了实现可靠数据传输，就必须增加许多措施，如确认、流量控制、计时器及连接管理等。这不仅使协议数据单元的首部增大很多，还要占用许多的处理机资源。因此TCP主要适用于可靠性更重要的场合，如文件传输协议（FTP）、超文本传输协议（HTTP）、远程登录（TELNET）等。  

UDP提供无连接的不可靠服务，通信双方在传送数据之前不需要建立连接，接收方的传输层在收到UDP用户数据报后，无须给发送方发回任何确认。UDP在IP层之上仅提供两个附加服务：多路复用和对数据的错误检查。IP层知道怎样把分组投递给一台主机，但不知道怎样把它们投递给主机上的具体应用。UDP在传送数据之前不需要先建立连接，远程主机的传输层收到UDP报文后，不需要给出任何确认。因为UDP比较简单，所以执行速度比较快、实时性好。使用UDP的应用主要包括小文件传送协议（TFTP）、DNS、SNIMP和实时传输协议（RTP）。  
表5.1所示为一些典型互联网应用所用的TCP/IP应用层协议和传输层协议。  

表5.1一些典型互联网应用所用的TCP/IP应用层协议和传输层协议
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/31e145544e04ef12547e4868bcdfac5ddf5c7a417aa2b6348a1ff3570218580d.jpg)  

# 注意  

I)IP数据报和UDP数据报的区别：IP数据报在网络层要经过路由器的存储转发；而UDP数据报在传输层的端到端的逻辑信道中传输，封装成IP数据报在网络层传输时，UDP数据报的信息对路由器是不可见的。  

2）TCP和网络层虚电路的区别：TCP报文段在传输层抽象的逻辑信道中传输，对路由器不可见；虚电路所经过的交换结点都必须保存虚电路状态信息。在网络层若采用虚电 路方式，则无法提供无连接服务；而传输层采用TCP不影响网络层提供无连接服务。  

# 5.1.4 本节习题精选  

# 单项选择题  

01.下列不属于通信子网的是（）  

A.物理层B.数据链路层C.网络层D.传输层  

02.OSI参考模型中，提供端到端的透明数据传输服务、差错控制和流量控制的层是（）。  

A.物理层B.网络层C.传输层D.会话层  

03.传输层为（）之间提供逻辑通信。  

A.主机B.进程C.路由器D.操作系统  

04.关于传输层的面向连接服务的特性是（）。  

A.不保证可靠和顺序交付 B.不保证可靠但保证顺序交付 C.保证可靠但不保证顺序交付 D.保证可靠和顺序交付  

05.在TCP/IP参考模型中，传输层的主要作用是在互联网的源主机和目的主机对等实体之间建立用于会话的（）。  

A.操作连接B.点到点连接C.控制连接D.端到端连接06.可靠传输协议中的“可靠”指的是（）  
A.使用面向连接的会话B.使用尽力而为的传输C.使用滑动窗口来维持可靠性D.使用确认机制来确保传输的数据不丢失  

07.以下（）能够唯一确定一个在互联网上通信的进程。  

A.主机名B.IP地址及MAC地址C.MAC地址及端口号D.IP地址及端口号  

08.在（）范围内的端口号被称为“熟知端口号”并限制使用。这就意味着这些端口号是为常用的应用层协议如FTP、HTTP等保留的。  

A.  $0\!\sim\!127$  B.  $_{0\sim255}$  C.0\~511 D.0\~1023 09.以下哪个TCP熟知端口号是错误的？（）A.TELNET:23 B.SMTP:25 C.HTTP:80 D.FTP:24 10.关于TCP和UDP端口的下列说法中，正确的是（）  

A.TCP和UDP分别拥有自己的端口号，它们互不干扰，可以共存于同一台主机B.TCP和UDP分别拥有自己的端口号，但它们不能共存于同一台主机C.TCP和UDP的端口没有本质区别，但它们不能共存于同一台主机D.当一个TCP连接建立时，它们互不干扰，不能共存于同一台主机  

11.以下说法错误的是（）  

A.传输层是OSI参考模型的第四层B.传输层提供的是主机间的点到点数据传输C.TCP是面向连接的，UDP是无连接的D.TCP进行流量控制和拥塞控制，而UDP既不进行流量控制，又不进行拥塞控制  

12.某应用程序每秒产生一个60B的数据块，每个数据块被封装在一个TCP报文中，然后封装在一个IP数据报中，则最后每个数据报所包含的应用数据所占的百分比是（）。（注意：TCP报文和IP数据报文的首部没有附加字段。）  

A.  $20\%$  B.  $40\%$  C.  $60\%$  D.  $80\%$  

13.在TCP/IP参考模型中，若用户程序使用UDP进行数据传输，则（）层协议必须承担可靠性方面的全部工作。  

A.数据链路层B.网际层C.传输层D.应用层  

# 5.1.5 答案与解析  

单项选择题  

01.D  

通信子网包括物理层、数据链路层和网络层，主要负责数据通信。资源子网是OSI参考模型的上三层，传输层的主要任务是向高层用户屏蔽下面通信子网的细节（如网络拓扑、路由协议等）。  

02.C  

端到端即是进程到进程，物理层只提供在两个结点之间透明地传输比特流，网络层提供主机到主机的通信服务，主要功能是路由选择。此题的条件若换成“TCP/IP参考模型”，答案依然是C。  

03.B 传输层提供的是端到端服务，为进程之间提供逻辑通信。  

面向连接服务是指通信双方在进行通信之前，要先建立一个完整的连接，在通信过程中，整个连接一直可以被实时地监控和管理。通信完毕后释放连接。面向连接的服务可以保证数据的可靠和顺序交付。  
05.D  

TCP/IP参考模型中，网络层及其以下各层所构成的通信子网负责主机到主机或点到点的通信，而传输层的主要作用是在源主机进程和目的主机进程之间提供端到端的数据传输。一般来说，端到端通信是由一段段的点到点信道构成的，端到端协议建立在点到点协议之上（正如TCP建立在IP之上），提供应用进程之间的通信手段。所以答案为选项D。  

06.D  

若一个协议使用确认机制对传输的数据进行确认，则可以认为它是一个可靠的协议；若一个协议采用“尽力而为”的传输方式，则是不可靠的。例如，TCP对传输的报文段提供确认，因此是可靠的传输协议；而UDP不提供确认，因此是不可靠的传输协议。  

07.D  

要在互联网上唯一地确定一个进程，就要使用IP地址和端口号的组合，通常称为套接字（Socket），IP地址确定某主机，端口号确定该主机上的某进程。  

08. D  

熟知端口号的数值为 $\scriptstyle0\sim\!1023$ ，登记端口号的数值是 $1024\!\sim\!49151$ ，客户端使用的端口号的数值是  $49152\!\sim\!65535$  

09.D  

FTP控制连接的端口是21，数据连接的端口是20。  

10.A  

端口号只具有本地意义，即端口号只标识本计算机应用层中的各个进程，且同一台计算机审TCP和UDP分别拥有自己的端口号，它们互不干扰。  

11.B  

传输层是OSI参考模型中的第4层，TCP是面向连接的，它提供流量控制和拥塞控制，保证服务可靠；UDP是无连接的，不提供流量控制和拥塞控制，只能做出尽最大努力的交付。传输层提供的是进程到进程间的传输服务，也称端到端服务。  

12.C  

此题中，一个TCP报文的首部长度是20B，一个IP数据报的首部长度也是20B，再加上60B的数据，一个IP数据报的总长度为100B，可知数据占 $60\%$  

13.D  

传输层协议需要具有的主要功能包括：创建进程到进程的通信；提供流量控制机制。UDP在一个低的水平上完成以上功能，使用端口号完成进程到进程的通信，但在传送数据时没有流量控制机制，也没有确认，而且只提供有限的差错控制。因此UDP是一个无连接、不可靠的传输层协议。若用户应用程序使用UDP进行数据传输，则必须在传输层的上层即应用层提供可靠性方面的全部工作。  

# 5.2UDP 协议  

# 5.2.1UDP数据报  

1.UDP概述  

UDP仅在IP层的数据报服务之上增加了两个最基本的功能：复用和分用，以及差错检测。  
若应用开发者选择UDP而非TCP，则应用程序几乎直接与IP打交道。为什么应用开发者宁愿在UDP之上构建应用，也不选择TCP？既然TCP提供可靠的服务，而UDP不提供，则TCP总是首选吗？答案是否定的，因为有很多应用更适合用UDP，主要因为UDP具有如下优点：  

# 命题追踪UDP协议的特点（2014）  

1）UDP无须建立连接。因此UDP不会引入建立连接的时延。试想若DNS运行在TCP而非UDP上，则DNS的速度会慢很多。HTTP使用TCP而非UDP，是因为对于基于文本数据的Web网页来说，可靠性是至关重要的。2）无连接状态。TCP需要在端系统中维护连接状态。此连接状态包括接收和发送缓存、拥塞控制参数和序号与确认号的参数。而UDP既不维护连接状态，也不跟踪这些参数。因此，当某些专用服务器使用UDP时，一般都能支持更多的活动客户机。3）UDP的首部开销小。TCP有20B的首部开销，而UDP仅有8B的开销。4）UDP没有拥塞控制，因此网络中的拥塞不会影响源主机的发送速率。某些实时应用要求源主机以稳定的速率发送数据，能容忍一些数据的丢失，但不允许有太大的时延。5）UDP支持一对一、一对多、多对一和多对多的交互通信。  

UDP常用于一次性传输较少数据的网络应用，如DNS、SNMP等，因为对于这些应用，若采用TCP，则将为连接创建、维护和拆除带来不小的开销。UDP也常用于多媒体应用（如IP电 话、实时视频会议、流媒体等），显然，可靠数据传输对这些应用来说并不是最重要的，但TCP的拥塞控制会导致数据出现较大的延迟，这是它们不可容忍的。  

UDP不保证可靠交付，但这并不意味着应用对数据的要求是不可靠的，所有维护可靠性的工作可由用户在应用层来完成。应用开发者可根据应用的需求来灵活设计自己的可靠性机制。  

UDP是面向报文的。发送方UDP对应用层交下来的报文，在添加首部后就向下交付给IP层，一次发送一个报文，既不合并，也不拆分，而是保留这些报文的边界；接收方UDP对IP层交上来UDP数据报，在去除首部后就原封不动地交付给上层应用进程，一次交付一个完整的报文。因此报文不可分割，是UDP数据报处理的最小单位。因此，应用程序必须选择合适大小的报文，若报文太长，UDP把它交给IP层后，可能会导致分片：若报文太短，UDP把它交给IP层后，会使IP数据报的首部的相对长度太大，两者都会降低IP层的效率。  

# 2.UDP的首部格式  

UDP数据报包含两部分：首部字段和用户数据字段。UDP首部有8B，由4个字段组成，每个字段的长度都是2B，如图5.2所示。各字段意义如下：  

# 命题追踪UDP首部格式及各字段意义（2018）  

1）源端口。源端口号。在需要对方回信时选用，不需要时可用全0。2）目的端口。目的端口号。这在终点交付报文时必须使用到，  

# 命题追踪 UDP首部的长度（2021)  

3）长度。UDP数据报的长度（包括首部和数据），其最小值是8（仅有首部）。4）检验和。检测UDP数据报在传输中是否有错。有错就丢弃。该字段是可选的，当源主机不想计算检验和时，则直接令该字段为全0。当传输层从IP层收到UDP数据报时，就根据首部中的目的端口，把UDP数据报通过应的端口，上交最后的终点一一应用进程，如图5.3所示。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/da63d7c9b93503146918383294c5c15589fdbdc37358c5de93970ddb49063021.jpg)  
图5.2UDP数据报格式  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/a16cc2056a05a15b10c395b7339bc3ac5fd58814468389f9a0015024fd2be756.jpg)  
图5.3UDP基于端口的分用  

若接收方UDP发现收到的报文中的自的端口号不正确（即不存在对应于端口号的应用进程），则就丢弃该报文，并由ICMP发送“端口不可达”差错报文给发送方。  

# 5.2.2 UDP检验  

在计算检验和时，要在UDP数据报之前增加12B的伪首部，伪首部并不是UDP的真正首部。只是在计算检验和时，临时添加在UDP数据报的前面，得到一个临时的UDP数据报。检验和就是按照这个临时的UDP数据报来计算的。伪首部既不向下传送又不向上递交，而只是为了计算检验和。图5.4给出了UDP数据报的伪首部各字段的内容。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/05fa857d9ae050353446295e04e96bef0c74167c8553e5cf4439dd5c06e12f8d.jpg)  
图5.4UDP数据报的首部和伪首部  

UDP计算检验和的方法和计算IP数据报首部检验和的方法相似。不同的是：IP数据报的检验和只检验IP数据报的首部，但UDP的检验和要将首部和数据部分一起检验。  

UDP计算检验和的方法：发送方首先把全O放入检验和字段并添加伪首部，然后把UDP数据报视为许多16位的字串接起来。若UDP数据报的数据部分不是偶数个字节，则要在末尾填入一个全0字节（但此字节不发送）。然后按二进制反码计算出这些16位字的和，将此和的二进制反码写人检验和字段，并发送。接收方把收到的UDP数据报加上伪首部（若不为偶数个学节，则还需要补上全0字节）后，按二进制反码求这些16位字的和。当无差错时其结果应为全1，否则就表明有差错出现，接收方就应该去弃这个UDP数据报。  

图5.5给出了一个计算UDP检验和的例子。本例中，UDP数据报的长度是15B（不含伪首部），因此需要添加一个全0字节。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/9a474cc8b394cdcf814dda506d8775a8ef67f54081079a382c666e8607f4cb96.jpg)  
图5.5计算UDP检验和的例子  

# 注意  

1）检验时，若UDP数据报部分的长度不是偶数个字节，则需填入一个全0字节，如图5.5所示。但是此字节和伪首部一样，是不发送的。  

2）若UDP检验和检验出UDP数据报是错误的，则可以丢弃，也可以交付给上层，但是需要附上错误报告，即告诉上层这是错误的数据报  

3）通过伪首部，不仅可以检查源端口号、目的端口号和UDP用户数据报的数据部分，还可以检查IP数据报的源IP地址和目的地址。  

这种简单的差错检验方法的校错能力并不强，但它的好处是简单、处理速度快。  

# 5.2.3 本节习题精选  

# 一、单项选择题  

01.使用UDP的网络应用，其数据传输的可靠性由（）负责。A.传输层B.应用层C.数据链路层D.网络层

02.以下关于UDP协议的主要特点的描述中，错误的是（）  

A.UDP报头主要包括端口号、长度、检验和等字段B.UDP长度字段是UDP数据报的长度，包括伪首部的长度C.UDP检验和对伪首部、UDP报文头及应用层数据进行检验D.伪首部包括IP分组报头的一部分  

03.UDP数据报首部不包含（）  

A.UDP源端口号B.UDP检验和C.UDP目的端口号D.UDP数据报首部长度  

04.UDP数据报中的长度字段（）  

A.不记录数据的长度B.只记录首部的长度C.只记录数据部分的长度D.包括首部和数据部分的长度  

05.UDP数据报比IP数据报多提供了（）服务。A.流量控制B.拥塞控制C.端口功能D.路由转发  
06.下列关于UDP的描述，正确的是（）  

A.给出数据的按序投递B.不允许多路复用C.拥有流量控制机制D.是无连接的  

07.接收端收到有差错的UDP用户数据时的处理方式是（）。A.丢弃 B.请求重传 C.差错校正 D.忽略差错

 08.以下关于UDP检验和的说法中，错误的是（）  

A.计算检验和时需按2字节对齐，若数据部分不足，则需用一个全 $0$ 字节填充B.若UDP检验和计算结果为O，则在检验和字段填充0 C.UDP检验和字段的计算包括一个伪首部、UDP首部和携带的用户数据D.UDP检验和的计算方法是二进制反码运算求和再取反  

09.下列关于UDP检验的描述中，（）是错误的。  

A.UDP检验和段的使用是可选的，若源主机不想计算检验和，则该检验和段应为全0B.在计算检验和的过程中，需要生成一个伪首部，源主机需要把该伪首部发送给目的主机C.检验出UDP数据报出错时，可以丢弃或交付给上层D.UDP检验和还能检验IP数据报的源IP地址和目的IP地址  

10.下列网络应用中，（）不适合使用UDP协议。  

A.客户机/服务器领域B.远程调用C.实时多媒体应用D.远程登录  

11.一个UDP数据报的数据字段长度为9192B，如在数据链路层要采用以太网来传送，则应当将其划分为IP数据报片的片数是（）。  

A.6 B.7 C.8 D.9  

12.某应用层数据大小为200B，传输层使用UDP，网际层使用IP（采用最大首部长度），使用以太网进行传输（不考虑前导码和VLAN），则该应用层数据的传输效率是（）  

A.  $82.6\%$  B.  $77.5\%$  C.  $69.9\%$  D.  $67.1\%$  

13.【2014统考真题】下列关于UDP协议的叙述中，正确的是（）  

I.提供无连接服务II1.提供复用/分用服务IIL.通过差错检验，保障可靠数据传输  

A.仅IB.仅I、ⅡIC.仅Ⅱ、ⅢID.I、ⅡI、ⅢI

14.【2018统考真题】UDP协议实现分用时所依据的首部字段是（）。A.源端口号B.目的端口号C.长度D.检验和  

# 二、综合应用题  

01.为什么要使用UDP？让用户进程直接发送原始的IP分组不就足够了吗？  

02.使用TCP对实时语音数据的传输是否有问题？使用UDP传送数据文件时有什么问题？  

03.一个应用程序用UDP，到了IP层将数据报再划分为4个数据报片发送出去。结果前两个数据报片丢失，后两个到达目的站。过了一段时间应用程序重传UDP，而IP层仍然划分为4个数据报片来传送。结果这次前两个到达自的站而后两个丢失。试问：在自的站能否将这两次传输的4个数据报片组装成为完整的数据报？假定目的站第一次收到的后两个数据片仍然保存在目的站的缓存中。  

04.一个UDP首部的信息（十六进制表示）为0xF7210045002CE827。UDP数据报的格式如下图所示。试问：  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/dea0ef9241fcb7261477410d120ab728db6caf8d5c9f1ec57a4e851178d780b5.jpg)  

1）源端口、目的端口、数据报总长度、数据部分长度分别是什么？2）该UDP数据报是从客户发送给服务器还是从服务器发送给客户？使用该UDP服务的程序使用的是哪个应用层协议？  

05.一个UDP用户数据报的数据字段为8192B，要使用以太网来传送。假定IP数据报无选项。试问应当划分为几个IP数据报片？说明每个IP数据报片的数据字段长度和片段偏移字段的值。  

# 5.2.4 答案与解析  

# 一、单项选择题  

01.B  

UDP本身是无法保证传输的可靠性的，并且UDP是基于网络层的IP的，IP的特点是尽最大努力交付，因此无法在网络层及数据链路层提供可靠传输。因此，只能通过应用层协议来实现可靠传输。  

02.B  

伪首部只是在计算检验和时临时添加的，不计入UDP的长度。对于选项D，伪首部包括源IP和目的IP，这是IP分组报头的一部分。  

03.D  

UDP数据报的格式包括UDP源端口号、UDP目的端口号、UDP报文长度和检验和，但不包括UDP数据报首部长度。因为UDP数据报首部长度是固定的8B，所以没有必要再设置首部长度字段。  

04.D  

长度字段记录UDP数据报的长度（包括首部和数据部分），以字节为单位。  

05.C  

虽然UDP协议和IP协议都是数据报协议，但是它们之间还是存在差别。其中，最大的差别是IP数据报只能找到自的主机而无法找到目的进程，UDP提供端口功能及复用和分用功能，可以将数据报投递给对应的进程。  

06.D  

UDP是不可靠的，所以没有数据的按序投递，排除选项A：UDP只在IP层的数据报服务上增加了很少的一点功能，即复用和分用功能及差错检测功能，排除选项B：显然UDP没有流量控制，排除选项C；UDP是传输层的无连接协议，答案为D。  

07.A  

接收端通过检验发现数据有差错，就直接丢弃该数据报，仅此而已。  

08.B  

UDP检验和不是必需的，若不使用检验和，则将检验和字段设置为0。而若检验和的计算结果恰好为0，则将检验和字段置为全1（这个结论了解即可）。  

09.B  

UDP数据报的伪首部包含了IP地址信息，目的是通过数据检验保证UDP数据报正确到达目的主机。伪首部是临时添加的，只是为了计算检验和，既不向下传送又不向上递交。若检验出UDP数据报出错，则可以丢弃，也可以交付给上层，但是需要告诉上层这是错误的数据报。  
10.D  

UDP的特点是开销小，时间性能好且易于实现。在客户/服务器模型中，它们之间的请求报文都很短，使用UDP不仅编码简单，而且只需要很少的消息。远程调用使用UDP的理由和客户/服务器模型的类似。对于实时多媒体应用，需要保证数据及时传送，而比例不大的错误是可以容忍的，所以使用UDP也是合适的，而且使用UDP可以实现多播，给多个客户端服务。而远程登录需要依靠一个客户端到服务器的可靠连接，必须保证数据传输的安全性，使用UDP是不合适的。  

11.B  

UDP数据字段长度9192B，加上UDP首部长度8B，共9200B。每个IP数据报片的最大长度为1500B，减去IP首部20B，剩下1480B用来存放UDP数据报。因此需要将UDP数据报划分为 $\left\lceil9200/1480\right\rceil=7$ 个IP数据报片。每个IP数据报片的数据字段长度为 $1480\mathrm{B}$ ，除了最后一个为1040B。每个IP数据报片的偏移字段的值依次为0,185，370,555，740,925，1110。  

12.C  

以太网MAC帧首部和尾部为18B，网际层IP首部为60B（采用最大首部长度），传输层UDP首部为8B，所以该应用层数据的传输效率为 $200^{+}(200+18+60+8)=69.9\%$  

13.B  

UDP提供的是无连接服务，I正确：同时UDP也提供复用/分用服务，ⅡI正确；UDP虽然有差错检验机制，但UDP的差错检验只是检查数据在传输的过程中有没有出错，出错则直接丢弃，没有重传等机制，不保证可靠传输。使用UDP时，可靠传输必须由应用层实现，IⅢI错误。  

14.B  

传输层分用的定义是，接收方的传输层剥去报文首部后，能把这些数据正确交付到目的进程。C和D显然不符。端口号用来标识主机中的应用进程。对于A和B，源端口号在需要对方回信时选用，不需要时可用全0。目的端口号在终点交付报文时使用，符合题意。  

# 二、综合应用题  

01.【解答】  

仅仅使用IP分组还不够。IP分组包含IP地址，该地址指定一个目的机器。一旦这样的分组到达自的机器，网络控制程序如何知道把它交给哪个进程呢？UDP分组包含一个目的端口，这一信息是必需的，因为有了它，分组才能被投递给正确的进程。此外，UDP可以对数据报做包括数据段在内的差错检测，而IP只对其首部做差错检测。  

02.【解答】  

TCP需要建立连接和维护状态，提供了确认、重传、拥塞控制等机制，虽然保证了传输的可靠性，但也增加了网络延迟和开销，还会导致报文的乱序、重复等现象，影响实时语音数据的实时性、连贯性和清晰度。实时音频/视频传输，不宜重传，可容忍少量数据的丢失或出错，但不允许有太大的时延，因此适合使用UDP。UDP不需要建立连接，没有重传机制，不保证可靠交付，因此不适合可靠性要求高的应用，在传送数据文件时可能会去失数据。对于可靠性要求高但实的性要求低的应用，如文件传输、电子邮件等，适合使用TCP。  

03.【解答】  

不行。重传时，IP数据报的标识字段会有另一个标识符。仅当标识符相同的IP数据报片才能组装成一个IP数据报。前两个IP数据报片的标识符与后两个IP数据报片的标识符不同，因此不能组装成一个IP数据报。  
04.【解答】  

1）第1、2个字节为源端口，即F721，转换成十进制数为63265。第3、4个字节为目的端口，即0045，转换成十进制数为69。第5、6个字节为UDP长度（包含首部和数据部分），即002C，转换成十进制数为44，数据报总长度为44B，数据部分长度为 $44-8\,{=}\,36\mathrm{B}$  

2）由1）可知，该UDP数据报的源端口号为63265，目的端口号为69，前一个为客户端使用的端口号，后一个为熟知的TFTP协议的端口，可知该数据报是客户发给服务器的。  

05.【解答】  

以太网帧的数据段的最大长度是1500B，UDP用户数据报的首部是8B。假定IP数据报无选项，首部长度都是20B。IP数据报的片段偏移指出一个片段在原IP分组中的相对位置，偏移的单位是8B。UDP用户数据报的数据字段为8192B，加上8B的首部，总长度是 $8200\mathrm{B}$ 。应当划分为6个IP报片。各IP报片总长度、数据长度和片偏移如下表所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/eed2b3e0d26ae3b168def3e2031ce57019a9826ec252c206a901e5fa62e25b5f.jpg)  

# 5.3TCP协议  

# 5.3.1TCP协议的特点  

TCP是在不可靠的IP层之上实现的可靠的数据传输协议，它主要解决传输的可靠、有序、无丢失和不重复问题。TCP是TCP/IP体系中非常复杂的一个协议，主要特点如下：  

1）TCP是面向连接的传输层协议，TCP连接是一条逻辑连接。2）每一条TCP连接只能有两个端点，每一条TCP连接只能是一对一的。3）TCP提供可靠交付的服务，保证传送的数据无差错、不丢失、不重复且有序。4）TCP提供全双工通信，允许通信双方的应用进程在任何时候都能发送数据，为此TCP连接的两端都设有发送缓存和接收缓存，用来临时存放双向通信的数据。发送缓存用来暂时存放以下数据： $\textcircled{\scriptsize{1}}$ 发送应用程序传送给发送方TCP准备发送的数据： $\circledcirc$ TCP已发送但尚未收到确认的数据。接收缓存用来暂时存放以下数据： $\textcircled{\scriptsize{1}}$ 按序到达但尚未被接收应用程序读取的数据： $\circledcirc$ 不按序到达的数据。5）TCP是面向字节流的，虽然应用程序和TCP的交互是一次一个数据块（大小不等），但  

TCP把应用程序交下来的数据仅视为一连串的无结构的字节流。  

TCP和UDP在发送报文时所采用的方式完全不同。UDP报文的长度由发送应用进程决定，而TCP报文的长度则根据接收方给出的窗口值和当前网络拥塞程度来决定。若应用进程传送到TCP缓存的数据块太长，则TCP就把它划分得短一些再传送；若太短，则TCP也可等到积累足够多的字节后再构成报文段发送出去。关于TCP报文的长度问题，后面会详细讨论。  

# 5.3.2TCP报文段  

TCP传送的数据单元称为报文段。TCP报文段既可以用来运载数据，又可以用来建立连接、释放连接和应答。一个TCP报文段分为首部和数据两部分，整个TCP报文段作为IP数据报的数据部分封装在IP数据报中，如图5.6所示。其首部的前20B是固定的。TCP首部最短为20B，后面有 $4N$ 字节是根据需要而增加的选项，长度为4B的整数倍。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/4f25e5e7af600a926e06cfbeecdb4d247bc24f97f4e1b6d8267cb4459a094260.jpg)  
图5.6TCP报文段  

TCP的全部功能体现在其首部的各个字段中，各字段意义如下：  

# 命题追踪TCP报文段首部中各字段的分析（2012）  

1）源端口和目的端口。各占2B。分别表示发送方和接收方使用的端口号。  

# 命题追踪TCP首部中序号、确认号的含义（2009、2016）  

2）序号。占4B，范围为 $0{\sim}2^{32}\!-\!1$ ，共 $2^{32}$ 个序号。TCP连接中传送的字节流中的每个字节都要按顺序编号，序号字段值指的是本报文段所发送的数据的第一个字节的序号。例如，一报文段的序号字段值是301，而携带的数据共有100B，表明本报文段的数据的最后一个字节的序号是400，因此下一个报文段的数据序号应从401开始。  

3）确认号。占4B，是期望收到对方下一个报文段的第一个数据字节的序号。若确认号为 $N,$ 则表明到序号 $N\!-\!1$ 为止的所有数据都已正确收到。  

例如，B正确收到了A发送过来的一个报文段，其序号字段是501，而数据长度是200B（序号 $501{\sim}700)$ ，这表明B正确收到了A发送的到序号700为止的数据。因此B期望收到A的下一个数据序号是701，于是B在发送给A的确认报文段中把确认号置为701。  

# 命题追踪TCP首部的最小长度（2021)  

4）数据偏移（即首部长度）。占4位，这里不是1IP数据报分片的那个数据偏移，而是表示首部长度（首部中还有长度不确定的选项字段），它指出TCP报文段的数据起始处距离TCP报文段的起始处有多远。“数据偏移”的单位是32位（以4B为计算单位）。因为4位二进制数能表示的最大值为15，所以TCP首部的最大长度为 $60\mathrm{B}$  

5）保留。占6位，保留为今后使用，但目前应置为0。  

6）紧急位URG。当 $\mathrm{{URG}}\!=\!1$ 时，表明紧急指针字段有效。它告诉系统此报文段中有紧急数据，应尽快传送（相当于高优先级的数据）。紧急数据被插入到报文段数据的最前面，而  
在紧急数据后面的数据仍是普通数据，因此要与首部中的紧急指针字段配合使用。  

7）确认位ACK。仅当 $\mathrm{ACK}\!=\!1$ 时确认号字段才有效。当 $\mathrm{ACK}\!=\!0$ 时，确认号无效。TCP规定，在连接建立后所有传送的报文段都必须把ACK置1。  

8）推送位PSH（Push）。两个应用进程进行交互式通信时，都希望在键入一个命令后立即就能收到对方的响应，此时发送方TCP把PSH置1，接收方TCP收到 $\mathrm{PSH}\!=\!1$ 的报文段后，就尽快交付给接收应用进程，而不再等到整个缓存都填满了后再向上交付。  

9）复位位RST（Reset）。当 $\mathrm{RST}\!=\!1$ 时，表示TCP连接中出现严重差错（如主机崩溃等），必须释放连接，然后重新建立传输连接。此外，它还可用于拒绝一个非法的报文段。  

IU）位DIIN。= $\mathrm{{SYN}}\!=\!1$ 时衣小达定一十迁按请水或迁按按文报义。  

当 $\mathrm{{SYN}}\!=\!1$ ， $\scriptstyle\mathrm{ACK}\,=\,0$ 时，表明这是一个连接请求报文，若对方同意建立连接，则应在响应报文中使用 $\mathrm{{SYN}}\!=\!1$ ， $\mathrm{ACK}\!=\!1$ 。关于连接的建立和释放，下一节会详细讨论。  

11）终止位FIN（Finish）。用来释放一个连接。当 $\mathrm{FIN}\!=\!1$ 时，表明此报文段的发送方的数据已发送完毕，并要求释放传输连接。  

12）窗口。占2B，范围为 $0{\sim}2^{16}\mathrm{-}1$ 。窗口值告诉对方，从本报文段首部中的确认号算起，接收方目前允许对方发送的数据量（以字节为单位）。接收方的数据缓存空间是有限的，因此窗口值作为接收方让发送方设置其发送窗口的依据。例如，设确认号是701，窗口字段是1000。这表明，从701号算起，发送此报文段的一方还有接收1000字节数据（字节序号为 $701\!\sim\!1700$ ）的接收缓存空间。  

13）检验和。占2B。检验和字段检验的范围包括首部和数据两部分。在计算检验和时，和UDP一样，要在TCP报文段的前面加上12B的伪首部（只需将UDP伪首部的协议字段的17改成6，UDP长度字段改成TCP长度，其他的和UDP一样）。  

14）紧急指针。占2B。紧急指针仅在 $\mathrm{{URG}}\!=\!1$ 时才有意义，它指出本报文段中的紧急数据的字节数（紧急数据在报文段数据的最前面）。也就是说，使窗口为零也可以发送紧急数据。  

15）选项。长度可变，最长可达 $40\mathrm{B}$ 。当不使用选项时，TCP首部长度是20B。TCP最初只规定了一种选项，即最大报文段长度（Maximum Segment Size，MSS）。MSS是TCP报文段中的数据字段的最大长度（注意仅仅是数据字段）。  

16）填充。这是为了使整个首部长度是4B的整数倍。  

# 5.3.3TCP连接管理  

TCP是面向连接的协议，因此每个TCP连接都有三个阶段：连接建立、数据传送和连接释放。TCP连接的管理就是使运输连接的建立和释放都能正常进行。  

在TCP连接建立的过程中，要解决以下三个问题：  

1）要使每一方能够确知对方的存在。  

2）要允许双方协商一些参数（如最大窗口值、是否使用窗口扩大选项、时间戳选项等）。  

TCP把连接作为最基本的抽象，每条TCP连接有两个端点，TCP连接的端点不是主机，不是主机的IP地址，不是应用进程，也不是传输层的协议端口。TCP连接的端口即为套接字（Socket），每一条TCP连接唯一地被通信的两个端点（即两个套接字）所确定。还应注意：同一个IP地址可以有多个不同的TCP连接，而同一个端口号也可以出现在多个不同的TCP连接中。TCP连接的建立采用客户/服务器模式。主动发起连接建立的应用进程称为客户（Client），而被动等待连接建立的应用进程称为服务器（Server）。  
# 1.TCP连接的建立  

连接的建立经历以下3个步骤，通常称为“三次握手”，如图5.7所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f3d6b28ee03e01ed9257ed21d0c6482a0056ae9c32f87658dd9c210a0ae313ca.jpg)  
图5.7用“三次握手”建立TCP连接  

连接建立前，服务器处于LISTEN（收听）状态，等待客户的连接请求。命题追踪TCP连接建立的报文段中各字段的分析（2011、2012、2016、2019）  

第一步：客户机的TCP首先向服务器的TCP发送连接请求报文段。这个报文段的首部中的同步位 $\mathrm{{SYN}}\!=\!1$ ，同时选择一个初始序号 ${\mathrm{secq}}\!=\!x$ TCP规定，SYN报文段不能携带数据，但要消耗掉一个序号。这时，客户机进入SYN-SENT（同步已发送）状态。  

第二步：服务器的TCP收到连接请求报文段后，如同意建立连接，则向客户机发回确认，并为该TCP连接分配缓存和变量。在确认报文段中，把SYN位和ACK位都置1，确认号是 $\operatorname{ack}\!=\!x\!+1$ 同时也为自己选择一个初始序号 ${\mathrm{setminus}}=y$ 。注意，确认报文段不能携带数据，但也要消耗掉一个序号。这时，服务器进入SYN-RCVD（同步收到）状态。  

第三步：当客户机收到确认报文段后，还要向服务器给出确认，并为该TCP连接分配缓存和变量。确认报文段的ACK位置1，确认号 $\mathsf{a c k}\!=\!y^{+}\,!$ ，序号 ${\mathrm{sep}}\!=\!x+1$ 。该报文段可以携带数据，若不携带数据则不消耗序号。这时，客户机进入ESTABLISHED（已建立连接）状态。  

当服务器收到来自客户机的确认后，也进入ESTABLISHED状态。  

成功进行以上三步后，就建立了TCP连接，接下来就可以传送应用层数据。TCP提供的是全双工通信，因此通信双方的应用进程在任何时候都能发送数据。  

# 2.TCP连接的释放  

天下没有不散的筵席，TCP同样如此。参与TCP连接的两个进程中的任何一个都能终止该连接。TCP连接释放的过程通常称为“四次挥手”，如图5.8所示。  

第一步：客户机打算关闭连接时，向其TCP发送连接释放报文段，并停止发送数据，主动关闭TCP连接，该报文段的终止位FIN置1，序号 ${\mathrm{setminus}}\!=\!u$ ，它等于前面已传送过的数据的最后一个字节的序号加1，FIN报文段即使不携带数据，也要消耗掉一个序号。这时，客户机进入FIN-WAIT-1（终止等待1）状态。TCP是全双工的，即可以想象为一条TCP连接上有两条数据通路，发送FIN的一端不能再发送数据，即关闭了其中一条数据通路，但对方还可以发送数据。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/55b5809743209b4220cf1a6af47b8f0bad83f3d69d445b181caa5341bfaaae47.jpg)  
图5.8用“四次挥手”释放TCP连接  

第二步：服务器收到连接释放报文段后即发出确认，确认号a $\mathrm{z}\!\stackrel{}{_{=}}\!u+1$ ，序号 ${\mathfrak{s e q}}\!=\!v$ ，等于它前面已传送过的数据的最后一个字节的序号加1。然后服务器进入CLOSE-WAIT（关闭等待）状态。此时，从客户机到服务器这个方向的连接就释放了，TCP连接处于半关闭状态。但服务器若发送数据，客户机仍要接收，即从服务器到客户机这个方向的连接并未关闭。客户机收到来自服务器的确认后，进入FIN-WAIT-2（终正等待2）状态，等待服务器发出的连接释放报文段。  

# 命题追踪TCP连接释放过程中状态的变化（2021）  

第三步：若服务器已经没有要向客户机发送的数据，就通知TCP释放连接，此时，其发出 $\mathrm{FIN}\!=\!1$ 的连接释放报文段。设该报文段的序号为 $w$ （处于半关闭状态的服务器可能又发送了一些数据），还必须重复发送上次已发送的确认号 $\operatorname{ack}\!=\!u\!+1$ 。这时服务器进入LAST-ACK（最后确认）状态。  

# 命题追踪TCP连接释放的过程及状态变化的时间分析（2016、2022）  

第四步：客户机收到连接释放报文段后，必须发出确认，之后进入TIME-WAIT（时间等待）状态。该报文段的确认位ACK置1，确认号 $\operatorname{ack}\!=\!w+1$ ，序号 $\scriptstyle{\mathrm{seq}}\,=\,u\,+\,1$ 。服务器收到该确认报文段后就进入CLOSED（连接关闭）状态。客户机进入TIME-WAIT状态后，还要经过时间等待计 2 MSL（Maximum Segment Lifetime，最长报文段寿命）后，才进入CLOSED状态。若服务器收到连接释放请求后不再发送数据，则从客户机发出FIN报文段时刻算起，客户机释放连接的最短时间为 $1\,\mathrm{RTT}+2\,\mathrm{MSL}$ ，服务器释放连接的最短时间为1.5RTT。  

除时间等待计时器外，TCP还设有一个保活计时器。设想TCP双方已建立连接，但后来客户主机突然出现故障。显然，服务器以后就不能再收到客户发来的数据。因此，应当有措施使服务器不要再白白等待下去，这个问题就可以使用保活计时器来解决。  
对上述TCP连接建立和释放的总结如下：  

1）建立连接。分为3步： $\textcircled{\scriptsize{1}}$   $)\,\mathrm{{SYMN}}\!=\!1$   ${\mathrm{secq}}\!=\!x$   $\begin{array}{r}{\mathrm{(\mathcal{Q})\;S Y N=1,\;\;A C K=1,\;\;s e q=}y,\;\;\mathrm{ack}=x+1\;\mathrm{s}}\end{array}$   $(\!)\operatorname{ACK}\,{=}\,1\,,\,\,\,\operatorname{neq}\,{=}\,x\,{+}\,1\,,\,\,\,\operatorname{ack}\,{=}\,y\,{+}\,1\,.$  

2）释放连接。分为4步  

$\begin{array}{r}{\mathrm{\bf(\mathbb{D})\;F I N}\!=\!1\,,\;\;\mathrm{seq}\!=\!u\!\circ}\end{array}$   $\operatorname{(2)ACK}=1\,,\;\;\operatorname{neq}=\nu\,,\;\;\operatorname{ack}=u+1\,.$   $(\!)\operatorname{FIN}\,{=}\,1\,,\,\,\,\operatorname{ACK}\,{=}\,1\,,\,\,\,\operatorname{sq}\,{=}\,w\,,\,\,\,\operatorname{ack}\,{=}\,u\,{+}\,1\,.$   $(\!4\!)\operatorname{ACK}\,{=}\,1\,,\,\,\,\operatorname{neq}\,{=}\,u\,{+}\,1\,,\,\,\,\operatorname{ack}\,{=}\,w\,{+}\,1\,.$  

选择题喜欢考查（关于连接建立和释放的题目，ACK、SYN、FIN都等于1），请牢记。  

# 5.3.4TCP可靠传输  

TCP在不可靠的IP层之上建立一种可靠数据传输服务。TCP提供的可靠数据传输服务保证接收方从缓存区读出的字节流与发送方发出的字节流完全一样。TCP使用了检验、序号、确认和重传等机制来达到这一目的。其中，TCP的检验机制与UDP一样，这里不再赘述。  

命题追踪TCP的确认机制，序号和确认号的含义（2011、2012、2013）  

1.序号  

TCP首部的序号字段用来保证数据能有序提交给应用层，TCP把数据视为一个无结构但有序的字节流，序号建立在传送的字节流之上，而不建立在报文段之上。  

TCP连接传送的数据流中的每个字节都编上一个序号。序号字段的值是指本报文段所发送的数据的第一个字节的序号。如图5.9所示，假设A和B之间建立了一条TCP连接，A的发送缓存区中共有10B，序号从0开始标号，第一个报文段包含第 $_{0\sim2}$ 个字节，则该TCP报文段的序号是0，第二个报文段的序号是3。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c26ac704f59eca3c51a2c5c371f1336b60b64260c34e4d2227d63e9f9712d1c8.jpg)  
图5.9A的发送缓存区中的数据划分成TCP段  

2.确认  

TCP首部的确认号是期望收到对方的下一个报文段的数据的第一个字节的序号。在图5.9中，若接收方B已收到第一个报文段的数据，此时B希望收到的下一个报文段的数据是从第3个字节开始的，则B发送给A的报文段中的确认号字段应为3。发送方缓存区会继续存储那些已发送但未收到确认的报文段，以便在需要时重传。  

TCP默认使用累积确认，即TCP只确认数据流中至第一个丢失字节为止的字节。例如，在图5.9中，接收方B收到了A发送的包含字节 $_{0\sim2}$ 及字节 $6\!\sim\!7$ 的报文段。由于某种原因，B还未收到字节3～5的报文段，此时B仍在等待字节3（和其后面的字节），因此B到A的下一个报文段将确认号字段置为3。  

# 3.重传  

有两种事件会导致TCP对报文段进行重传：超时和余ACK。  
（1）超时  

TCP每发送一个报文段，就对这个报文段设置一个超时计时器。计时器设置的重传时间到期但还未收到确认时，就要重传这一报文段。  

因为TCP的下层是互联网环境，IP数据报所选择的路由变化很大，所以传输层的往返时延的方差也很大。为了计算超时计时器的重传时间，TCP采用一种自适应算法，它记录一个报文段发出的时间，以及收到相应确认的时间，这两个时间之差称为报文段的往返时间（Round-TripTime，RTT）。TCP维护了RTT的一个加权平均往返时间RTTS，它会随新测量RTT样本值的变化而变化。显然，超时计时器设置的超时重传时间（RetransmissionTime-Out，RTO）应略大于RTTS，但也不能大太多，否则当报文段丢失时，TCP不能很快重传，导致数据传输时延大。  

（2）冗余ACK（冗余确认）  

超时触发重传存在的一个问题是超时周期往往太长。所幸的是，发送方通常可在超时事件发生之前通过注意所谓的冗余ACK来较好地检测丢包情况。冗余ACK就是再次确认某个报文段的ACK，而发送方先前已经收到过该报文段的确认。例如，发送方A发送了序号为1、2、3、4、5的TCP报文段，其中2号报文段在链路中丢失，它无法到达接收方B。因此3、4、5号报文段对于B来说就成了失序报文段。TCP规定每当比期望序号大的失序报文段到达时，就发送一个究余ACK，指明下一个期待字节的序号。在本例中，3、4、5号报文段到达B，但它们不是B所期望收到的下一个报文段，于是B就发送3个对1号报文段的余ACK，表示自己期望接收2号报文段。TCP规定当发送方收到对同一个报文段的3个究余ACK时，就可以认为跟在这个被确认报文段之后的报文段已经丢失。就前面的例子而言，当A收到对于1号报文段的3个究余ACK时，它可以认为2号报文段已经去失，这时发送方A可以立即对2号报文段执行重传，这种技术通常称为快速重传。当然，余ACK还被用在拥塞控制中，这将在后面的内容中讨论。  

# 5.3.5TCP流量控制  

流量控制的功能就是让发送方的发送速率不要太快，以便让接收方来得及接收，因此可以说流量控制是一个速度匹配服务（匹配发送方的发送速率与接收方的读取速率）。  

TCP利用滑动窗口机制来实现流量控制，滑动窗口的基本原理已在第3章中介绍过，这里要介绍的是TCP如何使用窗口机制来实现流量控制。TCP要求发送方维持一个接收窗口（rwnd），接收方根据当前接收缓存的大小，动态地调整接收窗口的大小，其大小反映了接收方的容量。接收方将其放在TCP报文段首部中的“窗口”字段，以通知发送方。发送方的发送窗口不能超过接收方给出的接收窗口值，以限制发送方向网络注入报文的速率。  

# 命题追踪利用接收窗口实现流量控制的过程（2016、2021）  

图5.10说明了如何利用滑动窗口机制进行流量控制。假设数据只从A发往B，而B仅向A发送确认报文段，则B可通过设置确认报文段首部中的窗口字段来将rwnd通知给A。rwnd即接收方允许连续接收的能力，单位是字节。发送方A总是根据最新收到的rwnd值来限制自己发送窗口的大小，从而将未确认的数据量控制在rwnd大小之内，保证A不会使B的接收缓存溢出。设A向B发送数据，在连接建立时，B告诉A：“我的接收窗口rwnd $=400^{\circ}$ ”。接收方B进行了三次流量控制，这三个报文段都设置了 $\mathrm{ACK}\!=\!1$ ，只有在 $\mathrm{ACK}\!=\!1$ 时确认号字段才有意义。第一次把窗口减到rwnd $=300$ ，第二次又减到rwnd $=100$ ，最后减到rwnd $=\!0$ ，即不允许发送方再发送数据。这使得发送方暂停发送的状态将持续到B重新发出一个新的窗口值为止。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/2ea4a8c799f964a7e96572594c00ed4f1536d705a7e0ede4d1ac19178b9e9412.jpg)  
图5.10利用可变窗口进行流量控制举例  

TCP为每个连接设有一个持续计时器，只要发送方收到对方的零窗口通知，就启动持续计时器。若计时器超时，就发送一个零窗口探测报文段，而对方就在确认这个探测报文段时给出现在的窗口值。若窗口仍然为零，则发送方收到确认报文段后就重新设置持续计时器。  

传输层和数据链路层的流量控制的区别是：传输层实现的是端到端，即两个进程之间的流量控制；数据链路层实现的是两个中间的相邻结点之间的流量控制。此外，数据链路层的滑动窗口协议的窗口大小不能动态变化，传输层的窗口大小则可以动态变化。  

# 5.3.6TCP拥塞控制  

拥塞控制是指防止过多的数据注入网络，保证网络中的路由器或链路不致过载。出现拥塞时，端点并不了解拥塞发生的细节，对通信的端点来说，拥塞往往表现为通信时延的增加。  

拥塞控制与流量控制的区别：拥塞控制是让网络能够承受现有的网络负荷，是一个全局性的过程，涉及所有的主机、所有的路由器，以及与降低网络传输性能有关的所有因素。相反，流量控制往往是指点对点的通信量的控制，是个端到端的问题（接收端控制发送端），它所要做的是抑制发送端发送数据的速率，以便使接收端来得及接收。当然，拥塞控制和流量控制也有相似的地方，即它们都通过控制发送方发送数据的速率来达到控制效果。  

例如，某个链路的传输速率为 $10\mathrm{{Gb}}/s$ ，某大型机向一台PC以1Gb/s的速率传送文件，显然网络的带宽是足够大的，因而不存在拥塞问题，但如此高的发送速率将导致PC可能来不及接收，因此必须进行流量控制。但若有100万台PC在此链路上以1Mb/s的速率传送文件，则现在的问题就变为网络的负载是否超过了现有网络所能承受的范围。  

TCP进行拥塞控制的算法有四种：慢开始、拥塞避免、快重传和快恢复。  

发送方在确定发送报文段的速率时，既要考虑接收方的接收能力，又要从全局考虑不要使网络发生拥塞。因此，除了上节介绍的接收窗口，TCP还要求发送方维持一个拥塞窗口（cwnd），其大小取决于网络的拥塞程度，并且动态地变化。发送方控制拥塞窗口的原则：只要网络未出现拥塞，拥塞窗口就再增大一些，以便把更多的分组发送出去，以提高网络的利用率。但只要网络出现拥塞，拥塞窗口就减小一些，以减少注入到网络的分组数，以缓解网络出现的拥塞。  

发送窗口的上限值应取接收窗口rwnd和拥塞窗口cwnd中较小的一个，即  
# 发送窗口的上限值  $=$  min[rwnd, cwnd]  

接收窗口的大小可根据TCP报文首部的窗口字段通知发送方，而发送方如何维护拥塞窗口呢？这就是下面讲解的慢开始和拥塞避免算法。这里假设：数据为单方向传送，对方只传送确认报文；接收方总是有足够大的缓存空间，因而发送窗口的大小由网络的拥塞程度决定。  

为了便于理解，下面采用最大报文段长度MSS作为拥塞窗口大小的单位。  

# 1.慢开始和拥塞避免  

（1）慢开始算法  

慢开始算法的思路是当发送方刚开始发送数据时，因为并不清楚网络的负荷情况，若立即把大量数据注入网络，则有可能引发网络拥塞。具体方法是：先发送少量数据探测一下，若没有发生拥塞，则适当增大拥塞窗口，即由小到大逐渐增大拥塞窗口（即发送窗口）。  

# 命题追踪慢开始算法的实现过程（2014、2015）  

例如，A向B发送数据，发送方先令cwnd $=1$ ，即一个MSS。A发送第一个报文段，A收到B对第一个报文段的确认后，把cwnd从1增大到2。于是A接着发送两个报文段，A收到B对这两个报文段的确认后，把cwnd从2增大到4，下次就可一次发送4个报文段。  

慢开始的“慢”并不是指拥塞窗口cwnd的增长速率慢，而是指在TCP开始发送报文段时先设置cwnd $=1$ ，使得发送方一开始向网络注入的报文段少（目的是试探一下网络的拥塞情况），然后逐渐增大cwnd，这对防止网络出现拥塞是一个非常有力的措施。使用慢开始算法后，每经过一个传输轮次（即往返时延RTT），cwnd就会加倍，即cwnd的值随传输轮次指数增长。为了防止cwnd增长过大而引起网络拥塞，还需要设置一个慢开始门限ssthresh（网值）。这样，当慢开始一直把cwnd增大到一个规定的ssthresh时，然后改用拥塞避免算法。  

（2）拥塞避免算法  

# 命题追踪慢开始和拥塞避免算法的实现过程/慢开始门限的作用（2017、2020、2023）  

拥塞避免算法的思路是让拥塞窗口cwnd缓慢增大，具体做法是：每经过一个往返时延RTT就 把发送方的拥塞窗口cwnd加1，而不是加倍，使拥塞窗口cwnd按线性规律缓慢增长（即加法增大），这比慢升始算法的拥塞窗口增长速率要缓慢得多。  

根据cwnd的大小执行不同的算法，可归纳如下：  

当cwnd<ssthresh时，使用慢开始算法。当cwnd $>$ ssthresh时，停止使用慢开始算法而改用拥塞避免算法。当cwnd $=$ ssthresh时，既可使用慢开始算法，又可使用拥塞避免算法（通常做法）。  

（3）网络拥塞的处理  

无论在慢开始阶段还是在拥塞避免阶段，只要发送方判断网络出现拥塞（未按时收到确认），就要首先把慢开始门限ssthresh设置为出现拥塞时的发送方的cwnd值的一半（但不能小于2），然后把拥塞窗口cwnd重新设置为1，执行慢开始算法。这样做的目的是迅速减少主机发送到网络中的分组数，使得发生拥塞的路由器有足够时间把队列中积压的分组处理完。  

# 命题追踪慢开始和拥塞避免阶段的平均传输速率分析（2016、2023）  

慢开始和拥塞避免算法的实现过程举例如图5.11所示。初始时，拥塞窗口置为1，即cwnd $=1$ ，慢开始门限置为16，即ssthresh $=16$  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/a1450fb7a0a2a7cbc01c8a1dcf0c026c45cb4c81db6c5a4ba5ff6ac97202f4bd.jpg)  
图5.11慢开始和拥塞避免算法的实现过程  

# 命题追踪  

# 慢开始/拥塞避免阶段拥塞窗口的变化分析（2016、2023）  

慢开始阶段，发送方每收到一个对新报文段的确认ACK，就把拥塞窗口cwnd值加1，也即经过每个传输轮次（RTT），cwnd呈指数规律增长。当cwnd增长到慢开始门限ssthresh时（即当cwnd $=16$ 时），就改用拥塞避免算法，cwnd按线性规律增长。  

# 命题追踪当网络超时时，慢开始和拥塞避免算法的实现过程（2009、2022）  

）当cwnd $=24$ 时，网络出现超时，调整ssthresh值为12（即为超时时cwnd值的一半），同时cwnd置为1，并执行慢开始算法，当cwnd $=12$ 时，改为执行拥塞避免算法。  

# 注意  

在慢开始阶段，若2cwnd $>$ ssthresh，RT T cw nd s s thresh,而不等于2cwnd。第16个轮次时cwnd $=8$ 、ssthresh $=12$ ，则第17个轮次时cwnd $=12$ ，而不等于16。  

在慢开始和拥塞避免算法中使用了“乘法减小”和“加法增大”方法。“乘法减小”是指不论是在慢开始阶段还是在拥塞避免阶段，只要出现超时（即很可能出现了网络拥塞），就把慢开始门限值ssthresh设置为当前拥塞窗口的一半（并执行慢开始算法）。当网络频繁出现拥塞时，ssthresh值就下降得很快，以大大减少注入网络的分组数。而“加法增大”是指执行拥塞避免算法后，在收到对所有报文段的确认后（即经过一个RTT），就把拥塞窗口cwnd增加一个MSS大小，使拥塞窗口缓慢增大，以防止网络过早出现拥塞。  

拥塞避免并不能完全避免拥塞。利用以上措施要完全避免网络拥塞是不可能的。拥塞避免是指在拥塞避免阶段把拥塞窗口控制为按线性规律增长，使网络比较不容易出现拥塞。  

# 2.快重传和快恢复  

有时个别报文段会在网络中丢失，但实际上网络并未发生拥塞。若发送方迟迟收不到确认，就会产生超时，并误认为网络发生了拥塞，这就导致发送方错误地启动慢开始算法，从而降低传输效率。采用快重传算法可以让发送方尽早知道发生了个别报文段的丢失。  

（1）快重传  

# 命题追踪快重传算法的原理、重传的时机（2019）  

快重传算法是使发送方尽快（尽早）进行重传，而不等超时计时器超时再重传。这就要求接收方不要等待自已发送数据时才进行捐带确认，而要立即发送确认，即使收到了失序的报文段也要立即发出对已收到报文段的重复确认。发送方一旦连续收到3个冗余ACK（即重复确认），就立即重传相应的报文段，而不等该报文段的超时计时器超时再重传。  
（2）快恢复  

快恢复算法的原理如下：当发送方连续收到3个允余ACK（重复确认）时，执行“乘法减小”方法，把慢开始门限ssthresh调整为当前cwnd的一半。这是为了预防网络发生拥塞。但发送方现在认为网络很可能没有发生（严重）拥塞，否则就不会有几个报文段连续到达接收方，也不会连续收到重复确认。因此与慢开始算法的不同之处是，它把cwnd值也调整为当前cwnd的一半（即等于ssthresh值），然后开始执行拥塞避免算法（“加法增大"），使拥塞窗口缓慢地线性增大。  

因为跳过了拥塞窗口cwnd从1起始的慢开始过程，所以被称为快恢复。快恢复算法的实现过程如图5.12所示，作为对比，虚线为慢开始的处理过程。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/62dd33f004450128a3f441728d804d8b3a69264acb169f32cceb123861070b61.jpg)  
图5.12快恢复算法的实现过程  

实际上，这四种算法同时应用在TCP拥塞控制机制中，它们使用的总结：在TCP连接建立和网络出现超时时，采用慢开始和拥塞避免算法（ssthresh $\b=$ cwnd/2，cwnd $=1$ )；当发送方收到3个冗余ACK时，采用快重传和快恢复算法（ssthresh $=$ cwnd/2，cwnd $=$ ssthresh)。  

在流量控制中，发送方发送数据的量由接收方决定；而在拥塞控制中，则由发送方自己通过检测网络状况来决定。再次提醒读者：接收方的缓存空间总是有限的。因此，发送方发送窗口的大小由流量控制和拥塞控制共同决定。当题目中同时出现接收窗口（rwnd）和拥塞窗口（cwnd）时，发送方发送窗口的实际大小是由rwnd和cwnd中较小的那一个确定的。  

# 5.3.7 本节习题精选  

# 一、单项选择题  

01.下列关于传输层协议中面向连接的描述，（）是错误的。  

A.面向连接的服务需要经历3个阶段：连接建立、数据传输及连接释放B.当链路不发生错误时，面向连接的服务可以保证数据到达的顺序是正确的C.面向连接的服务有很高的效率和时间性能D.面向连接的服务提供了一个可靠的数据流  

02.TCP协议规定HTTP（）进程的端口号为80。A.客户机B.解析C.服务器D.主机03.下列关于TCP的端口的叙述中，错误的是（）  

A.客户端使用的端口号是动态规定的B.端口号长度为16位C.端口号用于在通信中识别进程D.局域网内的计算机不能使用相同端口号  

04.下列（）不是TCP服务的特点。  

A.字节流B.全双工C.可靠D.支持广播  
05.下列哪个属性不是TCP协议的特性（）。  

A.比UDP开销大 B.强制重传错误分组 C.在TCP首部中有目标主机IP地址D.把消息分成段并在目标主机中进行重组  

06.（）字段包含在TCP首部中，而不包含在UDP首部中。A.目的端口号B.序列号（序号）C.检验和D.目的IP地址

07.以下关于TCP报头格式的描述中，错误的是（）  

A.报头长度为 $20\mathrm{\sim}60\mathrm{B}$ ，其中固定部分为20BB.端口号字段依次表示源端口号与目的端口号C.报头长度总是4的倍数个字节 D.TCP检验和伪首部中IP分组头的协议字段为17  

08.当TCP报文段的标志字段中（）为1，表示出现严重错误，必须释放连接  

A.URG B.RST C.ACK D.FIN  

09.TCP报文段首部中窗口字段的值（）  

A.指明自己的拥塞窗口的尺寸B.指明对方的发送窗口的尺寸C.指明自己的接收窗口的尺寸D.指明对方的拥塞窗口的尺寸  

10.在采用TCP连接的数据传输阶段，若发送端的发送窗口值由1000变为2000，则发送端在收到一个确认之前可以发送（）。  

A.2000个TCP报文段 B.2000B C.1000BD.1000个TCP报文段  

11.A和B建立了TCP连接，当A收到确认号为100的确认报文段时，表示（）  

A.报文段99已收到B.报文段100已收到C.末字节序号为99的报文段已收到D.末字节序号为100的报文段已收到  

12.为保证数据传输的可靠性，TCP采用了对（）确认的机制。A.报文段B.分组C.字节D.比特

13.在TCP协议中，发送方的窗口大小取决于（）  

A.仅接收方允许的窗口B.接收方允许的窗口和发送方允许的窗口C.接收方允许的窗口和拥塞窗口D.发送方允许的窗口和拥塞窗口  

14.TCP协议中滑动窗口的作用是（）  

A.流量控制B.拥塞控制C.路由控制D.差错控制  

15.以下关于TCP工作原理与过程的描述中，错误的是（）  

A.TCP连接建立过程需要经过“三次握手”的过程B.TCP传输连接建立后，客户端与服务器端的应用进程进行全双工的字节流传输C.TCP传输连接的释放过程很复杂，只有客户端可以主动提出释放连接的请求D.TCP连接的释放需要经过“四次挥手”的过程  

16.TCP的滑动窗口协议中，规定重传分组的数量最多可以（）。  

A.是任意的 B.1个 C.大于滑动窗口的大小D.等于滑动窗口的大小  
17.TCP中滑动窗口的值设置太大，对主机的影响是（）  

A.由于传送的数据过多而使路由器变得拥挤，主机可能丢失分组B.产生过多的ACK C.由于接收的数据多，而使主机的工作速度加快D.由于接收的数据多，而使主机的工作速度变慢  

18.以下关于TCP窗口与拥塞控制概念的描述中，错误的是（）。  

A.接收窗口（rwnd）通过TCP首部中的窗口字段通知数据的发送方B.发送窗口确定的依据是：发送窗口  $=$  min[接收端窗口，拥塞窗口] C.拥塞窗口是接收端根据网络拥塞情况确定的窗口值D.拥塞窗口大小在开始时可以按指数规律增长  

19.TCP使用三次握手协议来建立连接，设A、B双方发送报文的初始序列号分别为 $X$ 和YA发送 ( $\textcircled{\scriptsize{1}}$ ）的报文给B，B接收到报文后发送（ $\circledcirc$ ）的报文给A，然后A发送一个确认报文给B便建立了连接（注意，ACK的下标为捐带的序号）。  

$\textcircled{\scriptsize{1}}$ A. $\mathrm{{SYN}}\!=\!1$ ，序号 $\mathbf{\mu=}X$ B. $\mathrm{{SYN}}\!=\!1$ ，序号 $=\!X\!+1$  $\mathrm{ACK}_{X}{=}1$ C. $\mathrm{{SYN}}\!=\!1$ ，序号 $=Y$ D. $\mathrm{{SYN}}\!=\!1$ ，序号 $\mathit{\Pi}=Y,\;\;\mathrm{ACK}_{Y+1}=1$  $\circledcirc$ A. $\mathrm{{SYN}}\!=\!1$ ，序号 $=\!X\!+1$ B. $\mathrm{{SYN}}\!=\!1,$ 序号 $=\!X\!+1$ ， $\mathrm{ACK}_{\chi}{=}1$ C. $\mathrm{{SYN}}\!=\!1$ ，序号 $=Y$  $\operatorname{ACK}_{\chi+1}=1$ D. $\mathrm{{SYN}}\!=\!1$ ，序号 $=Y$  $\mathrm{ACK}_{Y+1}\,{=}\,1$  

20.TCP“三次握手”过程中，第二次“握手”时，发送的报文段中（）标志位被置为 $1.$  

A. SYN B.ACK C.ACK和RST D.SYN和ACK  

21.TCP采用三报文握手建立连接，其中第三个报文是（）  

A.TCP连接请求 B.对TCP连接请求的确认 C.对TCP连接请求确认的确认D.TCP普通数据  

22.A和B之间建立了TCP连接，A向B发送了一个报文段，其中序号字段 ${\mathrm{sep}}\!=\!200$ ，确认号字段 $\mathrm{ack}\!=\!201$ ，数据部分有2个字节，则在B对该报文的确认报文段中（）。  

A. ${\mathrm{seg}}\!=\!202$ ， $\mathrm{ack}\!=\!200$ B. ${\bf s e q}\!=\!201$ ， $\mathrm{ack}\!=\!201$ C.  ${\sf s e q}\!=\!201$  ，ack  $=202$  D.  ${\mathrm{secq}}\!=\!202$  ，ack  $=201$  

23．TCP的通信双方，有一方发送了带有FIN标志的数据段后，表示（）  

A.将断开通信双方的TCP连接 B.单方面释放连接，表示本方已经无数据发送，但可以接收对方的数据C.中止数据发送，双方都不能发送数据D.连接被重新建立  

24.假设TCP客户与TCP服务器的通信已结束，端到端的往返时间为RTT。1时刻TCP客户请求断开连接，则从t时刻起TCP服务器释放该连接的最短时间是（）。  

A.0.5RTT B.1RTT C.1.5RTT D.2RTT  

25.甲发起与乙的TCP连接，甲选择的初始序号为200，若甲和乙建立连接过程中最后一个报文段不携带数据，则TCP连接建立后，甲给乙发送的数据报文段的序号为（）。  

A.203 B.202 C. 201 D.200  

26.A发起与B的TCP连接，A选择的初始序号为1666，连接建立过程中未发送任何数据，TCP连接建立后，A给B发送了1000B数据，B正确接收后发送给A的确认序号是（）。  

A.1667 B.2666 C.2667 D.2668  
27.一个TCP连接的数据传输阶段，若发送端的发送窗口值由2000变为3000，则意味着发送端可以（）。  

A.在收到一个确认之前可以发送3000个TCP报文段B.在收到一个确认之前可以发送1000BC.在收到一个确认之前可以发送3000BD.在收到一个确认之前可以发送2000个TCP报文段  

28．甲和乙建立了TCP连接，甲向乙发送了3个连续的TCP段，分别包含200字节、300字节、400字节的有效载荷，第3个段的序号为1000。若乙仅正确接收到第1个和第3个段，则乙发送给甲的确认号是（）。  

A.500 B.600 C.700 D.800  

29.在一个TCP连接中，MSS为1KB，当拥塞窗口为34KB时发生了超时事件。若在接下来的4个RTT内报文段传输都是成功的，则当这些报文段均得到确认后，拥塞窗口的大小是 ( )。  

A.8KB B.9KB C.16KB D.17KB  

30.若甲向乙发起了一条TCP连接，最大段长为1KB，乙每收到一个数据段都会发出一个接收窗口为10KB的确认段，若甲在 $t$ 时刻发生超时，此时拥塞窗口为16KB。则从1时刻起，在不再发生超时的情况下，经过10个RTT后，甲的发送窗口是（）。  

A.10KB B.12KB C.14KB D.15KB  

31.设TCP的拥塞窗口的慢开始门限值初始为8（单位为报文段），当拥塞窗口上升到12时发生超时，TCP开始慢开始和拥塞避免，则第13次传输时拥塞窗口的大小为（）。  

A.4 B.6 C.7 D.8  

32.甲和乙刚建立TCP连接，并约定最大段长为2KB，假设乙总是及时清空缓存，保证接收窗口始终为20KB，ssthresh为16KB，若双向传输时间为 $10\mathrm{ms}$ ，发送时延忍略不计，且没有发生拥塞的情况，则经过（）甲的发送窗口第一次达到 $20\mathrm{KB}$  

A.  $40\mathrm{ms}$  B.50ms C. 60ms D.70ms  

33.假设一个TCP连接的传输过程在慢开始阶段，在IRTT时刻到 $(t+1)\mathrm{RTT}$ 时刻之间发送了 $k$ 个数据段，假设仍然保持在慢开始阶段，预期在 $(t+1)\mathrm{RTT}$ 时刻到 $(t+2)\mathrm{RTT}$ 时刻之间将发送（）个数据段（假设接收方有足够的缓存）。  

A.k B.k+1 C.  $2^{k}$  D.2k  

34.下列关于TCP的拥塞控制机制，描述错误的是（）  

A.TCP刚建立连接进入慢开始阶段B.慢开始阶段拥塞窗口指数级增加C.超时发生时，新门限值（慢开始和拥塞避免阶段的分界点）等于旧门限值的一半D.拥塞避免阶段拥塞窗口线性增加  

35.在一个TCP连接中，MSS为1KB，当拥塞窗口为34KB时收到了3个冗余ACK报文。若在接下来的4个RTT内报文段传输都是成功的，则当这些报文段均得到确认后，拥塞窗口的大小是（）。  

A.8KBB.16KBC.20KBD.21KB  

36.A和B建立TCP连接，MSS为IKB。某时，慢开始门限值为2KB，A的拥塞窗口为4KB，在接下来的一个RTT内，A向B发送了4KB的数据（TCP的数据部分），并且得到了B的确认，确认报文中的窗口字段的值为2KB。在下一个RTT中，A最多能向B发送（）数据。  
A.2KB B.8KB C.5KB D.4KB  

37.假设在没有发生拥塞的情况下，在一条往返时延RTT为 $10\mathrm{ms}$ 的线路上采用慢开始控制策略。若接收窗口的大小为24KB，最大报文段MSS为2KB，则发送方能发送出第一个完全窗口（也就是发送窗口达到24KB）需要的时间是（）。  

A.30ms B.  $40\mathrm{ms}$  C.  $50\mathrm{ms}$  D.60ms  

38.甲向乙发起一个TCP连接，最大段长 $\mathrm{MSS}=\mathrm{1KB}$  $\mathrm{RTT}=3\mathrm{ms}$ ，乙的接收缓存为16KB，且乙的接收缓存仅有数据存入而无数据取出，则甲从连接建立成功至发送窗口达到8KB，需经过的最小时间以及此时乙的接收缓存的可用空间分别为（）。  

A.3ms,15KB B.9ms,9KB C.6ms,13KB D.12ms, 8KB  

39.主机1的进程以端口 $x$ 和主机2的端口 $y$ 建立了一条TCP连接，这时若希望再在这两个端口间建立一个TCP连接，则会（）。  

A.建立失败，不影响先建立连接的传输B.建立成功，且两个连接都可以正常传输C.建立成功，先建立的连接被断开D.建立失败，两个连接都被断开  

40.【2009统考真题】主机甲与主机乙之间已建立一个TCP连接，主机甲向主机乙发送了两个连续的TCP段，分别包含300B和500B的有效载荷，第一个段的序列号为200，主机乙正确接收到这两个数据段后，发送给主机甲的确认序列号是（）。  

A.500 B.700 C.800 D.1000  

41.【2009统考真题】一个TCP连接总以1KB的最大段长发送TCP段，发送方有足够多的数据要发送，当拥塞窗口为16KB时发生了超时，若接下来的4个RTT时间内的TCP段的传输都是成功的，则当第4个RTT时间内发送的所有TCP段都得到肯定应答时，拥塞窗口大小是（）。  

A.7KB B.8KB C.9KB D.16KB  

42.【2010统考真题】主机甲和主机乙之间已建立一个TCP连接，TCP最大段长为1000B若主机甲的当前拥塞窗口为4000B，在主机甲向主机乙连续发送两个最大段后，成功收到主机乙发送的第一个段的确认段，确认段中通告的接收窗口大小为2000B，则此时主机甲还可以向主机乙发送的最大字节数是（）。  

A.1000 B.2000 C.3000 D.4000  

43.【2011统考真题】主机甲向主机乙发送一个（ $\mathrm{{SYN}}\!=\!1$  ${\mathrm{sep}}\!=\!11220$ ）的TCP段，期望与主机乙建立TCP连接，若主机乙接受该连接请求，则主机乙向主机甲发送的正确的TCP段可能是（）。  

A.  $\mathrm{{SYN}\mathrm{{=}\,0,\,\ A C K\mathrm{{=}\,0,\,\ s e q\mathrm{{=}\,11221,\,\ a c k\mathrm{{=}\,11221\,)}}}}}$  B.(  $\mathrm{{SYN}}\!=\!1$  ，  $\mathrm{ACK}=1$  ，  ${\mathrm{seg}}\!=\!11220$  ，ack=11220) C.(  $\mathrm{{SYN}}\!=\!1$  ，  $\mathrm{ACK}\!=\!1$   ${\mathrm{seg}}=11221$  ，ack=11221) D.(  $\mathrm{{SYN\!=\!}}0$  ，  $\scriptstyle\mathrm{ACK}\,=\,0$  ，  ${\mathrm{seg}}=11220$  ，ack=11220)  

44.【2011统考真题】主机甲与主机乙之间已建立一个TCP连接，主机甲向主机乙发送了3个连续的TCP段，分别包含300B、400B和500B的有效载荷，第3个段的序号为900。若主机乙仅正确接收到第1个段和第3个段，则主机乙发送给主机甲的确认序号是（)。A.300 B.500 C.1200 D.1400  
45.【2013统考真题】主机甲与主机乙之间已建立一个TCP连接，双方持续有数据传输，且数据无差错与丢失。若甲收到一个来自乙的TCP段，该段的序号为1913、确认序号为2046、有效载荷为100B，则甲立即发送给乙的TCP段的序号和确认序号分别是（）。  

A.2046、2012B.2046、2013C.2047、2012D.2047、2013  

46.【2014统考真题】主机甲和乙建立了TCP连接，甲始终以 $\mathrm{MSS}=\mathrm{1KB}$ 大小的段发送数据，并一直有数据发送；乙每收到一个数据段都会发出一个接收窗口为10KB的确认段。若甲在 $t$ 时刻发生超时的时候拥塞窗口为8KB，则从 $t$ 时刻起，不再发生超时的情况下，经过10个RTT后，甲的发送窗口是（）。  

A.10KB B.12KB C.14KB D.15KB  

47.【2015统考真题】主机甲和主机乙新建一个TCP连接，甲的拥塞控制初始國值为32KB，甲向乙始终以 $\mathrm{MSS}=\mathrm{1KB}$ 大小的段发送数据，并一直有数据发送；乙为该连接分配16KB接收缓存，并对每个数据段进行确认，忽略段传输延迟。若乙收到的数据全部存入缓存，不被取走，则甲从连接建立成功时刻起，未出现发送超时的情况下，经过4个RTT后，甲的发送窗口是（）。  

A.1KB B.8KB C.16KB D.32KB  

48.【2017统考真题】若甲向乙发起一个TCP连接，最大段长 $\mathrm{MSS}=\mathrm{1KB}$ ， $\scriptstyle{\mathrm{RT}}\,=\,5\mathrm{ms}$ ，乙开辟的接收缓存为64KB，则甲从连接建立成功至发送窗口达到32KB，需经过的时间至少是（）。  

A.  $25\mathrm{ms}$  B.  $30\mathrm{ms}$  C.160ms D.165ms  

49.【2019统考真题】某客户通过一个TCP连接向服务器发送数据的部分过程如下图所示。客户在 $t_{0}$ 时刻第一次收到确认序列号 $\mathrm{ack\_seq}\!=\!100$ 的段，并发送序列号 ${\mathrm{secq}}=100$ 的段，但发生丢失。若TCP支持快速重传，则客户重新发送 ${\mathrm{secq}}\!=\!100$ 段的时刻是（）。  

A.  $t_{1}$  B.  $t_{2}$  C.  $t_{3}$  D.  $t_{4}$  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c624c059ae32c91334ec8bbdf526c028c44489918c1298122975646cf4b64011.jpg)  

50.【2019统考真题】若主机甲主动发起一个与主机乙的TCP连接，甲、乙选择的初始序列号分别为2018和2046，则第三次握手TCP段的确认序列号是（）。  

A.2018 B.2019 C.2046 D.2047  
51.【2020统考真题】若主机甲与主机乙已建立一条TCP连接，最大段长（MSS）为1KB，往返时间（RTT）为 $2\mathrm{ms}$ ，则在不出现拥塞的前提下，拥塞窗口从8KB增长到32KB所需的最长时间是（）。  

A.4ms B.8ms C.   $24\mathrm{ms}$  D.48ms  

52.【2020统考真题】若主机甲与主机乙建立TCP连接时，发送的SYN段中的序号为1000，在断开连接时，主机甲发送给主机乙的FIN段中的序号为5001，则在无任何重传的情况下，甲向乙已经发送的应用层数据的字节数为（）。  

A.4002 B.4001 C. 4000 D.3999  

53.【2021统考真题】若客户首先向服务器发送FIN段请求断开TCP连接，则当客户收到服 务器发送的FIN段并向服务器发送ACK段后，客户的TCP状态转换为（）。  

A. CLOSE_WAIT B.TIME_WAIT C.FIN_WAIT_1 D.FIN_WAIT_2  

54.【2021统考真题】若大小为12B的应用层数据分别通过1个UDP数据报和1个TCP段传输，则该UDP数据报和TCP段实现的有效载荷（应用层数据）最大传输效率分别是（）  

A.  $37.5\%,16.7\%$  B.  $37.5\%,$   $37.5\%$  C.  $60.0\%,$   $16.7\%$  D.  $60.0\%,37.5\%$  

55.【2021统考真题】设主机甲通过TCP向主机乙发送数据，部分过程如下图所示。甲在 $t_{0}$ 时刻发送一个序号 ${\mathrm{seg}}\,{=}\,501$ 、封装200B数据的段,在 $t_{1}$ 时刻收到乙发送的序号 ${\mathrm{seg}}\!=\!601$ a ck seq $=501$ 、接收窗口rcvwnd $=500\mathrm{B}$ 的段，则甲在未收到新的确认段之前，可以继续向乙发送的数据序号范围是（）  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/0406bf978b19feed1af3584db6df7036106aa9d33094559a3ba5cd2d69f85f19.jpg)  

A.  $501\sim1000$  B.601\~1100 C.701\~1000 D.  $801\sim1100$  

56.【2022统考真题】假设主机甲和主机乙已建立一个TCP连接，最大段长 $\mathrm{MSS}=\mathrm{1KB}$ ，甲一直向乙发送数据，当甲的拥塞窗口为16KB时，计时器发生了超时，则甲的拥塞窗口再次增长到16KB所需要的时间至少是（）。  

A.4RTTB.5RTTC.11RTTD.16 RTT  

57.【2022统考真题】假设客户C和服务器S已建立一个TCP连接，通信往返时间 $\mathrm{RTT\!=\!50ms}$ 最长报文段寿命 $\mathrm{MSL}=800\mathrm{ms}$ ，数据传输结束后，C主动请求断开连接。若从C主动向S发出FIN段时刻算起，则C和S进入CLOSED状态所需的时间至少分别是（）。  

A.850ms,50ms B.1650 ms,50ms C.850 ms,75 ms D.1650ms,75 ms  

二、综合应用题  

01.在使用TCP传输数据时，若有一个确认报文段丢失，则也不一定会引起与该确认报文段对应的数据的重传。试说明理由。  

02.若收到的报文段无差错，只是报文段失序，则TCP对此未做明确规定，而是让TCP的实现者自行确定。试讨论两种可能的方法的优劣：1）将失序报文段丢弃。2）先将失序报文段暂存于接收缓存内，待所缺序号的报文段收齐后再一起上交应用层。  
03.一个TCP连接要发送3200B的数据。第一个字节的编号为10010。若前两个报文段各携带1000B的数据，最后一个报文段携带剩下的数据，写出每个报文段的序号。  

04.设TCP发送窗口的最大尺寸为64KB，网络的平均往返时间为 $20\mathrm{ms}$ ，问TCP所能得到的最大数据传输速率是多少？（只考虑单向传输，且假设信道带宽不受限）  

05.在一个TCP连接中，信道带宽为 $100\mathrm{Mb/s}$ ，单个报文大小为1000B，发送窗口固定为60，端到端时延为 $20\mathrm{ms}_{\circ}$ TCP最多能达到的平均数据传输速率是多少？信道利用率是多少？（只考虑单向传输，确认报文的发送时延、各层协议的首部开销均忽略不计。）  

06.主机A基于TCP向主机B连续发送3个TCP报文段。第一个报文段的序号为90，第二个报文段的序号为120，第三个报文段的序号为150。  

1）第一、二个报文段中有多少数据？2）假设第二个报文段丢失而其他两个报文段到达主机B，在主机B发往主机A的确认报文中，确认号应是多少？  

07.考虑在一条TCP连接上采用慢开始拥塞控制而不发生网络拥塞的情况下，接收窗口为24KB，RTT为 $10\mathrm{ms}$ ，最大段长为2KB，则需要多长时间才能发送第一个完全窗口？  

08.设TCP拥塞窗口的慢开始门限值初始为12MSS，当拥塞窗口达到16时出现超时，再次进入慢开始阶段，则从此时起恢复到超时时的拥塞窗口大小，需要多少个往返时延？  

09.假定TCP报文段载荷是1500B，最大分组存活时间是120s，要使得TCP报文段的序列号不会循环回来而重叠，线路允许的最快速度是多大？（不考虑帧长限制）  

10.一个TCP连接使用256kb/s的链路，其端到端时延为 $128\mathrm{ms.}$ 、经测试发现吞吐率只有 $128\mathrm{kb/s}.$ 问窗口是多少？忽略PDU封装的协议开销及接收方应答分组的发送时间（假定应答分组长度很小）  

11.假定TCP最大报文段的长度是1KB，拥塞窗口被置为18KB，并且发生了超时事件。若接着的4次进发量传输都是成功的，则该窗口将是多大？  

12.一个TCP首部的数据信息（十六进制表示）为 $\mathrm{0x0D\,28\,00\,15\,50\,5F\,A9\,06\,00\,00\,00\,00\,70}$  $02\,40\,00\,00\,29\,00\,00$ 。TCP首部的格式如下图所示。请回答：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/6ce5353c97aeafb617bbff6a4c5ca485c4a1cb832df6a42af8784ab88712d2fd.jpg)  

1）源端口号和目的端口号各是多少？2）发送的序列号是多少？确认号是多少？3）TCP首部的长度是多少？4）这是一个使用什么协议的TCP连接？该TCP连接的状态是什么？  

13.【2012统考真题】主机H通过快速以太网连接Intemet，IP地址为192.168.0.8，服务器S的IP地址为211.68.71.80。H与S使用TCP通信时，在 $\mathrm{H}$ 上捕获的其中5个IP分组如表1 所示。  
表1
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/b2c62ba7486654ab75370f9a608c5510e1f70b8f7d692daa5fd2e0d8b72242cd.jpg)  

回答下列问题：  

1）表1中的IP分组中，哪几个是由H发送的？哪几个完成了TCP连接建立过程？哪几个在通过快速以太网传输时进行了填充？2）根据表1中的IP分组，分析S已经收到的应用层数据字节数是多少。3）若表1中的某个IP分组在S发出时的前40B如表2所示，则该IP分组到达H时经过了多少个路由器？  

表2
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/dac0ab98077d5324dedb1b6f8ac9ad8219a741ec07f83967b319f4413379dd8e.jpg)  

IP分组头和TCP段头结构分别如图1和图2所示。  

图1IP分组头结构
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/af84f33ab3a26a3fc8164ff411fce747732bb0295d8ea5e4aefbc5c075215124.jpg)  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/be2143394130ff9248323811be2a0f1d9e7c5d81715a21f70bf9ebe13fb39b7e.jpg)  
14.【2016统考真题】假设下图中的H3访问Web服务器S时，S为新建的TCP连接分配了20KBC $\mathrm{K}=1024$ ）的接收缓存，最大段长 $\mathrm{MSS}=\mathrm{1KB}$ ，平均往返时间 $\scriptstyle{\mathrm{RTT}}\,=\,200{\mathrm{ms}}_{\circ}$ H3建立连接时的初始序号为100，且持续以MSS大小的段向S发送数据，拥塞窗口初始闵值为32KB；S对收到的每个段进行确认，并通告新的接收窗口。假定TCP连接建立完成后，S端的TCP接收缓存仅有数据存入而无数据取出。请回答下列问题：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/331512701164b09cc92e677617121c526cd454f65fc3760e59fb789182d44317.jpg)  

1）在TCP连接建立过程中，H3收到的S发送过来的第二次握手TCP段的SYN和ACK标志位的值分别是多少？确认序号是多少？2）H3收到的第8个确认段所通告的接收窗口是多少？此时H3的拥塞窗口变为多少？H3的发送窗口变为多少？3）H3的发送窗口等于0时，下一个待发送的数据段序号是多少？H3从发送第1个数据段到发送窗口等于0时刻为止，平均数据传输速率是多少？（忽略段的传输延时。）4）若H3与S之间通信已经结束，在 $t$ 时刻H3请求断开该连接，则从1时刻起，S释放该连接的最短时间是多少？  

# 5.3.8 答案与解析  

# 一、单项选择题  

01.C  

因为面向连接的服务需要建立连接，且需要保证数据的有序性和正确性，所以它比无连接的服务开销大，而速度和效率方面也要比无连接的服务差一些。  

02.C  

TCP中端口号8O标识Web服务器端的HTTP进程，客户端访问Web服务器的HTTP进程的端口号由客户端的操作系统动态分配。因此答案为选项C。  

03.D  

客户端使用的端口号仅在客户进程运行时才动态地选择。应用进程通过端口号进行标识，端口号长度为16位。不同计算机的相同端口号是没有联系的，因此选项D错误。  

04.D  

TCP提供的是一对一全双工可靠的字节流服务，所以TCP并不支持广播。  
05.C  

在TCP首部中没有目标主机IP地址，这是IP首部的字段。TCP采用确认机制，并对错误或超时的分组进行重传，以保证数据的可靠性。TCP会根据网络的最大传输单元MTU和最大报文段长度MSS将消息分成适当大小的段（参考本章疑难点），并在目标主机中进行重组。  

06.B  

TCP报文段和UDP数据报都包含源端口、目的端口、检验号。因为UDP提供不可靠的传输服务，不需要对报文编号，所以不会有序列号字段，而TCP提供可靠的传输服务，因此需要设置序列号字段。目的IP地址属于IP数据报中的内容。  

07.D  

TCP伪首部与UDP伪首部一样，包括IP分组首部的一部分。IP首部中有一个协议字段，用于指明上层协议是TCP还是UDP。17代表UDP，6代表TCP，所以选项D错误。对于A选项，因为数据偏移字段的单位是4B，所以当偏移取最大时TCP首部长度为 $15\!\times\!4\!=\!60\mathrm{B}$ 。由于使用填充，所以长度总是4B的倍数，选项C正确。  

08.B  

URG是紧急位，其为1时表示报文段中有紧急数据，需要尽快发送。RST是复位位，其为1时意味着TCP连接必须释放，通常用于出现严重差错的情况。ACK是确认位，其为1时表示确认号（ack）字段有效。FiIN为终止位，其为1时代表发送方请求释放单向连接，此时并没有完全释放连接，只有当接收方发送完数据并同样将FIN位置为1时才会释放连接。  

09.C  

TCP报文段首部中窗口字段的值指的是自己接收窗口的尺寸。  

10.B  

TCP使用滑动窗口机制来进行流量控制。在ACK应答信息中，TCP在接收端用ACK加上接收方允许接收数据范围的最大值回送给发送方，发送方把这个最大值当作发送窗口值，表明发送端在未收到确认之前可以发送的最大字节数，即2000B。  

11.C  

TCP的确认号是指明接收方下一次希望收到的报文段的数据部分第一个字节的编号，可以看出，前一个已收到的报文段的最后一个字节的编号为99，所以选项C正确。报文段的序号是其数据部分第一个字节的编号。选项A、B不正确，因为有可能已收到的这个报文段的数据部分不止一个字节，则报文段的编号就不为99，但可以说编号为99的字节已收到。  

12.A  

虽然TCP是面向字节的，对每个字节都进行编号，但并不是对接收到的每个字节都要发回确认，而是在收到整个报文段后才发回一个确认，确认的序号也是报文段的边界字节序号，并不能只对报文段中的某些字节序号进行确认，所以TCP采用的是对报文段的确认机制。  

13.C  

TCP让每个发送方仅发送正确数量的数据，保持网络资源被利用但又不会过载。为了避免网络拥塞和接收方缓冲区溢出，TCP发送方在任意时刻可以发送的最大数据流是接收方允许的窗口和拥塞窗口中的最小值。  

14.A  

TCP采用大小可变的滑动窗口进行流量控制。拥塞控制和流量控制的区别在于，流量控制是为了保护接收方，而拥塞控制是为了保护网络。滑动窗口是一种实现流量控制的方法，而不是拥塞控制的方法。虽然在拥塞控制的机制中用到了滑动窗口，但这并不是滑动窗口的作用。  
15.C  

参与TCP连接的两个进程中的任何一个都能提出释放连接的请求。  

16.D  

TCP滑动窗口协议中发送方滑动窗口的大小规定了发送方最多能够传送的分组数目，只有窗口滑动了，才能往后继续发送。分组重传的最大值也是发送方能发送数据的最大值，因而重传分组的数量最多也不能超过滑动窗口的大小。  

17.A  

TCP使用滑动窗口机制来进行流量控制，其窗口尺寸的设置很重要，若滑动窗口值设置得太小，则会产生过多的ACK（因为窗口大可以累积确认，因此会有更少的ACK）：若设置得太大，则又会由于传送的数据过多而使路由器变得拥挤，导致主机可能丢失分组。  

18.C  

拥塞窗口是发送端根据网络拥塞情况确定的窗口值。  

19. A、C  

TCP使用三次握手来建立连接，第一次握手A发给B的TCP报文中应置其首部SYN位为1，并选择序号 ${\mathsf{s e q}}\!=\!X$ ，表明传送数据时的第一个数据字节的序号是 $X$ ：在第二次握手中，即B接收到报文后，发给A的确认报文段中应使 $\mathrm{{SYN}}\!=\!1$ ，使 $\mathrm{ACK}\!=\!1$ ，且确认号 $\scriptstyle\mathrm{ACK}\,=\,X\,+\,1$ ，即 $\operatorname{ACK}_{\chi+1}=1$ （ACK的下标为捐带的序号），同时告诉自已选择的序号 ${\mathsf{s e q}}\!=\!Y$  

20.D  

在TCP的“三次握手”中，第二次握手时，SYN和ACK均被置为1。  

21.C  

TCP采用三报文握手建立连接，其中第一个报文是TCP连接请求，第二个报文是对TCP连接请求的确认，第三个报文是对TCP连接请求确认的确认。  

22.C  

在A发向B的报文中，seq表示发送的报文段中数据部分的第一个字节在A的发送缓存区中的编号，ack表示A期望收到的下一个报文段的数据部分的第一个字节在B的发送缓存区中的编号。因此，同一个TCP报文中的seq和ack的值是没有联系的。在B发给A的报文（捐带确认）中，seq值应和A发向B的报文中的ack值相同，即20l；ack值表示B期望下次收到A发出的报文段的第一个字节的编号，应是 $200+2\!=\!202$  

23.B  

FIIN位用来释放一个连接，它表示本方已没有数据要传输。然而，在关闭一个连接后，对方还可以继续发送数据，所以还有可能接收到数据。  

24. C  

t时刻TCP客户请求断开连接，发出连接释放FIN报文段；题目问的是最短时间，所以当TCP服务器收到TCP客户发来的FIN报文段后不再发送数据，因此同时发出确认ACK报文段和连接释放FIN报文段，即直接跳过CLOSE-WAIT状态；TCP客户收到FIN报文段后必须发出确认：TCP服务器收到确认后就进入CLOSED状态，共经历1.5个RTT。  

25.C  

甲选择的初始序号为200，建立TCP连接的第一个报文段不能携带数据，但要消耗一个序号。甲给乙发送的第二个报文段（第三次握手）的序号是201，该报文段可以携带数据，若不携带数据，则不消耗序号，题中该报文段不携带数据，因此下一个数据报文段的序号仍是201。  
26.C  

A的初始序号为1666，建立连接的第一个报文段不携带数据，但要消耗一个序号。A给B发送的第二个报文段的序号是1667，该报文段不携带数据，因此不消耗序号。下一个数据报文段的序号仍是1667，1000B的序号范围是  $1667{\sim}2666$  ，所以B接收后发送给A的确认序 号是2667。  

27. C  

TCP提供的是可靠的字节流传输服务，使用窗口机制进行流量控制与拥塞控制。TCP的滑动窗口机制是面向字节的，因此窗口大小的单位为字节。假设发送窗口的大小为 $N$ ，这意味着发送端可以在没有收到确认的情况下连续发送 $N$ 个字节。  

28.C  

乙仅正确接收到第1个和第3个段，所以乙下次期望收到第2个段，乙发送给甲的确认号即第2个段的序号。第3个段的序号为1000，则第2个段的序号为 $1000-300=700$ ，所以确认号为700。  

29.C  

若在拥塞窗口为34KB时发生了超时事件，则慢开始门限值就被设定为17KB，且cwnd重新设为1KB。按照慢开始算法，第一个RTT后cwnd $=2\mathrm{KB}$ ，RT T cw nd $=4\mathrm{KB}$ ，第三个RTT后cwnd $=8K\mathrm{B}$ 。当第四个RTT发出去的8个报文段的确认都收到后，cwnd $=16\mathrm{KB}$ （此时还未超过慢开始门限值）。注意，题中“这些报文段均得到确认后”这句话很重要。  

30.A  

接收窗口等于10KB。发生超时后，拥塞窗口重设为1，经过10个RTT后，拥塞窗口一定大于10KB。但甲的发送窗口取拥塞窗口和接收窗口中的较小值，即10KB。  

31.C  

在慢开始和拥塞避免算法中，拥塞窗口初始为1，窗口大小开始按指数增长。当拥塞窗口大于慢开始门限后停止使用慢开始算法，改用拥塞避免算法。此处慢开始的门限值初始为8，当拥塞窗口增大到8时改用拥塞避免算法，窗口大小按线性增长，每次增加1个报文段，当增加到12时，出现超时，重新设门限值为6（12的一半），拥塞窗口再重新设为1，执行慢开始算法，到门限值6时执行拥塞避免算法。因此，拥塞窗口大小的变化为1,2,4,8,9,10,11,12,1,2,4,6,7,8,9,·，其中第13次传输时（即第12个传输轮次后）拥塞窗口的大小为7。  

32.D  

当拥塞窗口小于ssthresh时，拥塞窗口以指数方式增长，拥塞窗口从2KB到16KB需经过3个RTT，超过16KB后，每经过一个RTT，拥塞窗口加1，所以从16KB到20KB经过了4个RTT，共经过了7个RTT， $\mathrm{RTT}=10\mathrm{ms}$ ，所以经过 $70\mathrm{ms}$ 后甲的发送窗口第一次为20KB。  

33.D  

在慢开始阶段，每收到一个对新报文段的确认，拥塞窗口就加1，因此每经过一个RTT，拥塞窗口就加倍。在RTT时刻到 $(t+1)\mathrm{RTT}$ 时刻之间发送了 $k$ 个数据段，因此在这个RTT后，拥塞窗口由 $k$ 变为 $2k$ ，所以在下一个RTT内预期将发送 $2k$ 个数据段。  

34.C  

超时发生时，新门限值通常设置为此时拥塞窗口值的一半，而不是旧门限值的一半。  

35.D  

条件“收到了3个究余ACK报文”说明此时应执行快恢复算法，因此慢开始门限值设为17KB，并且此时cwnd也被设为17KB，第一个RTT后cwnd $|\l=18$ ，RT T cw nd $=$ 19KB，第三个RTT后cwnd $=20\mathrm{KB}$ ，第四个RTT后，发出的报文全部得到确认，cwnd再增加1KB，变为21KB。注意cwnd的增加都发生在收到确认报文后。  
36.A  

本题中出现了拥塞窗口和接收端窗口，为了保证B的接收缓存不发生溢出，发送窗口应该取两者的最小值。先看拥塞窗口，由于慢开始门限值为2KB，第一个RTT中A拥塞窗口为4KB，按照拥塞避免算法，收到B的确认报文后，拥塞窗口增长为5KB。再看接收端窗口，B通过确认报文中窗口字段向A通知接收端窗口，则接收端窗口为2KB。因此在下一次发送数据时，A的发送窗口应该为2KB，即一个RTT内最多发送2KB。所以选项A正确。  

37.B  

按照慢开始算法，发送窗口的初始值为拥塞窗口的初始值，即MSS的大小2KB，然后依次增大为4KB、8KB、16KB，然后是接收窗口的大小24KB，即达到第一个完全窗口。因此达到第一个完全窗口所需要的时间为 $4\mathrm{RTT}\!=\!40\mathrm{ms}$  

38.B  

本题要求的是最小时间，且题目未给出拥塞窗口的门限值，所以拥塞窗口一直按指数增长是最快的。拥塞窗口从1KB增长到8KB需要3个RTT，即 $9\mathrm{ms}$ ，并在第1个RTT内发送1KB，在第二个RTT内发送2KB，在第三个RTT内发送4KB，累积发送 $1+2+4\,{=}\,7\mathrm{KB}$ ，这时乙的接收缓存还剩 $16-7\,{=}\,9\mathrm{KB}$ ，此时的发送窗口 $=$ min{拥塞窗口，接收窗口] $\}\,{=}\,8\mathrm{KB}$ ，所以选B。  

39.A  

一条连接使用它们的套接字来表示，因此 $(1,x)$  $(2,y)$ 是在两个端口之间唯一可能的连接。而后建立的连接会被阻止。  

40.D  

返回的确认序列号是接收方期待收到对方下一个报文段数据部分的第一个字节的序号，因此乙在正确接收到两个段后，返回给甲的确认序列号是 $200+300+500=1000$  

41.C  

发生超时后，慢开始门限ssthresh变为 $16\mathrm{KB}/2\,{=}\,8\mathrm{KB}$ ，拥塞窗口变为1KB。在接下来的3个RTT内，执行慢开始算法，拥塞窗口大小依次为2KB、4KB、8KB，因为慢开始门限ssthresh为8KB，所以之后转而执行拥塞避免算法，即拥塞窗口开始“加法增大”。因此第4个RTT结束后，拥塞窗口的大小为9KB。  

42.A  

发送方的发送窗口的上限值取接收窗口和拥塞窗口这两个值中的较小一个，于是此时发送方的发送窗口为 $\operatorname*{min}\{4000,2000\}\,{=}\,2000\mathrm{B}$ 。因为确认段是对第一个段的确认，所以2000B的含义是甲发送第一个段后还能再发送2000B，又因为之前甲连续发送了两个最大段，也就是说，第二个段还未收到确认，所以甲还能继续向乙发送的最大字节数是 $2000-1000=1000\mathrm{B}$  

43.C  

在确认报文段中，同步位SYN和确认位ACK必须都是1；返回的确认号ack是甲发送的初始序号 ${\bf s e q}=11220$ 加1，即 $\mathrm{ack}\!=\!11221$ ；同时乙也要选择并消耗一个初始序号seq，seq值由乙的TCP进程任意给出，它与确认号、请求报文段的序号没有任何关系。  

44.B  

TCP首部的序号字段是指本报文段数据部分的第一个字节的序号，而确认号是期待收到对方下一个报文段的第一个字节的序号。第三个段的序号为900，则第二个段的序号为 $900\,{-}\,400\,{=}\,500$ 现在主机乙期待收到第二个段，因此发给甲的确认号是500。  
45.B  

确认序号ack是期望收到对方下一个报文段的数据的第一个字节的序号，序号seq是指本报文段所发送的数据的第一个字节的序号。甲收到一个来自乙的TCP段，该段的序号 ${\mathrm{sec}}\!=\!1913$ 、确认序号 $\operatorname{ack}\!=\!2046$ 、有效载荷为100B，表明到序号 $1913+100-1\,{=}\,2012$ 为止的所有数据甲均已收到，而乙期望收到下一个报文段的序号从2046开始。因此甲发给乙的TCP段的序号 $\mathtt{s e q}_{1}\!=\!\mathtt{a c k}\!=\!2046$ 和确认序号 $\mathrm{ack}_{1}\,{=}\,\mathrm{secq}+100\,{=}\,2013\,,$  

46.A  

当 $t$ 时刻发生超时时，把sstresh设为8的一半，即4，把拥塞窗口设为1KB。然后经历10个RTT后，拥塞窗口的大小依次为2,4,5,6,7,8,9,10,11,12，而发送窗口取当时的拥塞窗口和接收窗口的最小值，接收窗口始终为10KB，所以此时的发送窗口为10KB。  

实际上，接收窗口一直为10KB，发送窗口必然小于或等于10KB，只有选项A满足条件。  

47.A  

发送窗口 $=$ min{接收窗口，拥塞窗口}。因为乙的接收缓存仅有数据存入而不取走，所以每个RTT后的接收窗口等于接收缓存-累积收到的数据。在前4个RTT中，因为拥塞窗口一直小于接收窗口，所以发送窗口就等于拥塞窗口的大小，4个RTT后，乙收到的数据全部存入缓存不被取走，接收窗口还剩1KB（ $16-1-2-4-8=1$ ）缓存，使得甲的发送窗口为1KB。  

48.A  

发送窗口 $=$ min{接收窗口，拥塞窗口}，题中接收窗口（接收缓存）为64KB，注意本题没有说明“接收缓存仅有数据存入而不取走”，因此不用考虑之前发送的数据占用缓存。按照慢开始算法，初始拥塞窗口为最大报文段长度1KB，每经过一个RTT，拥塞窗口加倍，因此若没有发生超时事件，则至少经过5个RTT，拥塞窗口才能达到32KB。  

49.C  

TCP规定当发送方收到对同一个报文段的3个重复确认时，就可以认为这个被确认报文段之后的报文已丢失，立即执行快速重传算法。 $t_{3}$ 时刻连续收到来自服务器的三个确认序号： $\mathrm{ack\_seq}\!=\!100$ 的段（注意， $t_{0}$ 时刻首次收到的ack_seq $=100$ 的段并不计入余ACK），发送方认为 ${\mathrm{seg}}\,{=}\,100$ 的段已经丢失，执行快速重传算法，重新发送 ${\mathrm{seg}}\,{=}\,100$ 的段。  

50.D  

根据TCP连接建立的“三次握手”原理，第三次握手时甲发出的确认序列号应为第二次握手时乙发出的序列号 $+1$ ，即2047。  

51.D  

因为慢开始门限ssthresh可以根据需求设置，为了求拥塞窗口从8KB增长到32KB所需的最长时间，可以假定慢开始门限小于或等于8KB，只要不出现拥塞，拥塞窗口就都是加法增大，每经历一个传输轮次（RTT），拥塞窗口逐次加1，因此所需的最长时间为 $(32\!-\!8)\!\times\!2\!{\mathrm{ms}}\!=\!48{\mathrm{ms}}.$  

52.C  

甲与乙建立TCP连接时发送的SYN段中的序号为1000（TCP规定，SYN段不能携带数据，但要消耗一个序号），则在数据传输阶段所用起始序号为1001。断开连接时，甲发送给乙的FIN段中的序号为5001（TCP规定，FIN段即使不携带数据，也要消耗一个序号），因此已发送数据的最后一个字节的序号为5000，即甲向乙已发送数据的字节序号为1001\~5000，共4000字节。  
53.B  

TCP连接释放的过程在5.3.3节中介绍。当客户机收到服务器发送的FIN段并向服务器发送ACK段时，客户机的TCP状态变为TIMEWAIT，此时TCP连接还未释放，必须经过时间等待计时器设置的时间2MISL（最长报文段寿命）后，客户机才进人CLOSED（连接关闭）状态。  

54.D  

当应用层数据交给传输层时，放在报文段的数据部分。UDP首部有8B，TCP首部最短有 $^{20\mathrm{B}}$ 为了达到最大传输效率，通过UDP传输时，总长度为20B，最大传输效率是 $12\mathrm{B}/20\mathrm{B}\,{=}\,60\%$ 。通过TCP传输时，总长度为32B，最大传输效率是 $12\mathrm{B}/32\mathrm{B}\!=\!37.5\%.$  

55.C  

主机甲发送200B数据的段后，继续发送数据的段的序号 ${\mathrm{sec}}\,{\mathrm{=}}\,701$ 。因为甲收到乙发来的确认序号为501、接收窗口为500的段，即从序号501开始，甲累积还能发送500B的数据。因为甲此时已发送从序号501开始的200B数据，所以甲在未收到新的确认段之前，还能发送的数据字节数为 $500\,{-}\,200\,{=}\,300\mathrm{B}$ ，还能发送的数据序号范围是 $701\!\sim\!1000$  

56. C  

时刻o发生了超时，门限值ssthresh变为拥塞窗口cwnd的一半即8，同时cwnd置为1，执行慢开始算法，cwnd指数增长，经过3个RTT，增长到ssthresh值；之后执行拥塞避免算法，cwnd线性增长，再经过8个RTT，增长到16，共花费11个RTT，如下表所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/fe15d574668d657b070ebb06cf026cf756a04a8da94b6857bd054dca7ebbd29a.jpg)  

57.D  

TCP连接的释放过程如书中图5.8所示。题目问的是最少时间，所以当服务器S收到客户C发送的FIN请求后不再发送数据，即服务器S同时发出确认ACK报文段和连接释放FIN报文段，忍略FIN-WAIT-2和CLOSE-WAIT状态。C S FIN，进入CLOSED状态还需等到TIME-WAIT结束，总用时至少为 $1\mathrm{RTT}+2\mathrm{MSL}=50+800\times2=1650\mathrm{ms}$ 。服务器S进入CLOSED状态需要经过3次报文段的传输时间，即 $1.5\mathrm{RT}\,{=}\,75\mathrm{ms}$  

# 二、综合应用题  

01.【解答】  

这是因为发送方可能还未重传时，就收到了对更高序号的确认。例如主机A连续发送两个报文段（ ${\mathrm{SEQ}}\!=\!92$ ，DATA共8B）和（ $\mathrm{SEQ}\!=\!100$ ，DATA共20B），均正确到达主机B。B连续发送两个确认（ $\mathrm{back}\,{\mathrm{ACK}}\,{=}\,100$ 和 $\mathrm{ACK}=120$ ），但前一个确认在传送时丢失。例如A在第一个报文段 ${\mathrm{SEQ}}\!=\!92$ ，DATA共8B）超时之前收到了对第二个报文段的确认（ $,\mathrm{ACK}\!=\!120$ )，此时A知道，119号和在119号之前的所有字节均已被B正确接收，因此A不会再重传第一个报文段。  

02.【解答】  

第一种方法将失序报文段丢弃，会引起被丢弃报文段的重复传送，增加对网络带宽的消耗，但由于用不着将该报文段暂存，可避免对接收方缓冲区的占用。  

第二种方法先将失序报文段暂存于接收缓存，待所缺序号的报文段收齐后再一起上交应用层；这样可以减少发送方的重传次数，减少对网络带宽的消耗，但增加了接收方缓冲区的开销。  

03.【解答】  

TCP报文段的序号是指其数据部分的第一个字节的序号。因此第一个报文段的序号是10010，序号范围 $10010\!\sim\!11009$ ：第二个报文段的序号是 $10010+1000=11010$ ，序号范围 $11010\!\sim\!12009$ 第三个报文段的序号为 $11010+1000=12010$ ，序号范围 $12010\!\sim\!13209$  
04.【解答】  

最大数据传输速率表明在一个RTT内将窗口中的字节全部发送完毕。在平均往返时间 $20\mathrm{ms}$ 内，发送的最大数据量为最大窗口值，即 $64{\times}1024\mathrm{B}$  

$$
64\!\times\!1024\!\times\!8\!\div\!(20\!\times\!10^{-3})\!\approx\!26.2{\bf M}{\bf b}/{\bf s}
$$  

因此，所能得到的最大数据传输速率是 $26.2\mathrm{Mb/s}$  

05.【解答】  

发送方发出一个报文所需的时间 $=$ 报文长度/信道带宽 $=1000{\times}8{\div}(100{\times}10^{6})\,{=}\,0.08{\mathrm{ms}}$ （注意单位转换）。发送方发出一个窗口的第一个报文到收到该报文的确认报文所需的时间 $=\!0.08+\mathrm{RTT}\ =$  $0.08\;+\;2\times$ 端到端时延 $\tt=40.08ms$ 。发出一个窗口的所有报文所需的时间 $=60\!\times\!0.08\mathrm{ms}\!=\!4.8\mathrm{ms}$ 。在

 $40.08\mathrm{ms}$ 时间内，发送方可以连续发出一个窗口的所有报文，若所有报文都正确到达接收方，则所能达到的平均数据传输速率为 $1000{\times}60{\times}8{\div}(40.08{\times}10^{-3})\,{=}\,11.98\mathrm{M}\mathrm{b/s}\,.$  

信道利用率 $=$ 平均数据传输速率/信道带宽（最大数据传输速率） $=11.98/100=11.98\%$  

06.【解答】  

1）TCP报文段的序号是指其数据部分的第一个字节的编号。因此第一个报文段中的数据有 $120-90\,{=}\,30\mathrm{B}$ ，第二个报文段中的数据有 $150-120\,{=}\,30\mathrm{B}$ 2）因为TCP使用累积确认策略，所以当第二个报文段丢失后，第三个报文段就成了失序报文，B期望收到的下一个报文段是序号为120的报文段，所以确认号为120。  

07.【解答】  

最大段长是2KB，初始的拥塞窗口是2KB，经过前3个RTT后拥塞窗口依次变为4KB，8KB和16KB，经过第4个RTT后拥塞窗口变为32KB（大于接收窗口24KB），所以此时发送窗口取24KB，即第一个完全窗口。 $10\mathrm{ms}\times4\,{=}\,40\mathrm{ms}$ ，因此需要 $40\mathrm{ms}$ 才能发送第一个完全窗口。  

08.【解答】  

在慢开始和拥塞避免算法中，拥塞窗口初始为1，窗口大小开始按指数增长。当拥塞窗口大于慢开始门限后停止使用慢开始算法，改用拥塞避免算法。此处慢开始的门限值初始为12，当拥塞窗口增大到12时改用拥塞避免算法，窗口大小按线性增长，每次增加1个报文段，当增加到16时，出现超时，重新设门限值为8（16的一半），拥塞窗口再重新设为1，执行慢开始算法，到门限值8时执行拥塞避免算法。  

这样，拥塞窗口的变化就为1,2,4,8,12,13,14,15,16,1,2,4,8,9,10,11,12,13,14,15,16,-。可见从出现超时时拥塞窗口为16到恢复拥塞窗口大小为16，需要的往返时间次数是11。注意，发现超时时，拥塞窗口从16变为1是立即进行的，不会间隔一个RTT。  

09.【解答】  

目标在120s内最多发送 $2^{32}\mathrm{B}$ （序列号为32位），即35791394B/s的载荷。TCP报文段载荷是1500B，因此可以发送23861个报文段。TCP开销是20B，IP开销是20B，以太网开销是26B（18B的首部和尾部，7B的前同步码，1B的帧开始定界符）。这就意味着对于1500B的载荷，必须发送1566B。 $1566\!\times\!8\!\times\!23861\!=\!299\mathbf{M}\mathbf{b}/\mathrm{s}$ ，因此允许的最快线路速率是299Mb/s。比这一速度更快时，就会冒在同一时间内不同的TCP报文段具有相同序号的风险。  

10.【解答】  

来回路程的时延 $128\mathrm{ms}\!\times\!2\!=\!256\mathrm{ms}.$ 设窗口值为 $X$ （注意：单位为字节）。  
假定一次最大发送量等于窗口值，且发送时间等于 $256\mathrm{ms}$ ，则每发送一次都得停下来期待再次得到下一个窗口的确认，以得到新的发送许可。这样，发送时间等于停止等待应答的时间，结果测到的平均吞吐率就等于发送速率的一半，即 $128\mathrm{{kb}/\mathrm{{s}}}$  

$8X\!\!\cdot\!\!(128\!\times\!\!2\!\times\!1000)\!=\!256\!\times\!\!0.001$   $X\!=\!256\!\times\!1000\!\times\!256\!\times\!0.001/8\!=\!256\!\times\!32\!=\!8192$  所以，窗口值为8192。  

11.【解答】  

在TCP的拥塞控制算法中，除使用慢开始的接收窗口和拥塞窗口外，还使用第3个参数，即门槛值。发生超时的时候，该门槛值被设置成当前拥塞窗口值的一半即9KB，而拥塞窗口则重置成一个最大报文段长。然后使用慢开始的算法决定网络可以接受的进发量，一直增长到门槛值为止。从这一点开始，成功的传输线性地增加拥塞窗口，即每次进发传输后只增加一个最大报文段，而不是每个报文段传输后都增加一个最大报文段的窗口值。现在由于发生了超时，下一次传输将是1个最大报文段，然后是2个、4个和8个最大报文段，第四次发送成功，且门限为9B，所以在4次进发量传输后，拥塞窗口将增加为9B。  

12.【解答】  

1）源端口号为第1、2个字节，即0D28，转换为十进制数为3368。目的端口号为第3、4个字节，即0015，转换为十进制数为21。2）第 $5{\sim}8$ 个字节为序列号，即505FA906。第 $9\!\sim\!12$ 个字节为确认号，即 $00\:00\:00\:00$ ，也即十进制数0。3）第13个字节的前4位为TCP首部的长度，这里的值是7（以4B为单位），因此乘以4后得到TCP首部的长度为28B，说明该TCP首部还有8B的选项数据。4）根据目的端口是21可知这是一条FTP连接，而TCP的状态则需要分析第14个字节。第14个字节的值为02，即SYN置为1，而且 $\scriptstyle\mathrm{ACK}\,=\,0$ 表示该数据段没有悄带的确认，这说明是第一次握手时发出的TCP连接。  

13.【解答】  

1）由图1看出，源IP地址为IP分组头的第 $13\!\sim\!16$ 个字节。在表1中，1、3、4号分组的源IP地址均为192.168.0.8（c0a80008H），所以1、3、4号分组是由H发送的。再观察1.3，4号分组的标识字段，分别是9b，9c，9d，标识字段是一个计数器，每产生一个数据报就加1，这也说明主机H先后发送了1.3.4号分组。在表1中，1号分组封装的TCP段的 $\mathrm{{SYN}}\!=\!1$ ， $\scriptstyle\mathrm{ACK}\,=\,0$ ，sec $|\!=\!846\mathrm{b}$ 41c5H；2号分组封装的TCP段的 $\mathrm{{SYN}}\!=\!1$ ， $\mathrm{ACK}\!=\!1$ ， $\mathsf{s e q}=\mathsf{e059}$ 9fefH, ack $\zeta\!=\!8466$ 41c6H；3号分组封装的TCP段的 $\mathrm{ACK}=1$ ， $\mathrm{secq}\,{=}\,846\flat\,41\mathrm{c6H}$ ，ack $\mathbf{\varphi}_{,}\,=\,\mathbf{e}059$ 9ff0H，所以1、2、3号分组完成了TCP连接的建立过程。由于快速以太网数据帧有效载荷的最小长度为46B，表1中3、5号分组的总长度为40（28H）字节，小于46B，其余分组总长度均大于46B。所以3、5号分组通过快速以太网传输时需要填充。2）由3号分组封装的TCP段可知，发送应用层数据初始序号为 ${\mathrm{secq}}=846{\mathrm{b}}\;41{\mathrm{c}}6{\mathrm{H}},$ ，由5号分组封装的TCP段可知，ack为 $\mathrm{secq}\,{=}\,846{\tt b}\,41{\mathrm{c}}$ 16H，所以S已经收到的应用层数据的字节数为 $846\mathrm{b\,41d6H-846b\,41c6H}\,{=}\,10\mathrm{H}\,{=}\,16\mathrm{B}\,\mathrm{c}$ 3）因为S发出的IP分组的标识 $\mathrm{=}\mathrm{6}\mathrm{811H}$ ，所以该分组所对应的是表1中的5号分组。S发出的IP分组的 $\mathrm{THz}\,{=}\,40\mathrm{H}\,{=}\,64$ ，5号分组的 $\mathrm{THz}\!=\!31\mathrm{H}\!=\!49$ ， $64-49=15$ ，所以可以推断该  
IP分组到达H时经过了15个路由器。  

14.【解答】  

1）第二次握手报文段的 $\mathrm{{SYN}}\!=\!1$ ， $\mathrm{ACK}=1$ 。确认序号是第一次握手报文段的序号 $+~1=101$  

2）因为S的TCP接收缓存仅有数据存入而无数据取出，当S收到第8个段时接收缓存还剩12KB，所以H3收到的第8个确认段所通告的接收窗口是12KB。在慢开始阶段，每收到一个对新报文段的确认，拥塞窗口就加1，当收到对第8个报文段的确认后，H3的拥塞窗口变为9KB。H3的发送窗口取接收窗口和拥塞窗口的最小值，即9KB。  

3）H3的发送窗口等于0时，下一个待发送段的序号是 $20\mathrm{K}+101\,{=}\,20{\times}1024+101\,{=}\,20581\,.$ H3从发送第1个段到发送窗口等于0时刻为止，共耗费了5个RTT（每个RTT传输的数据量依次为1KB、2KB、4KB、8KB、5KB），平均数据传输速率是 $20\mathrm{{KB}{\cdot}(5{\times}200\mathrm{{ms})\ =}}$  $20{\times}1024{\times}8{\mathrm{b/s}}\!=\!163.84{\mathrm{kb/s}}\!\cdot\!{\mathrm{s}}\,\mathrm{.}$  

# 注意  

K表示文件大小或描述存储空间时等于1024，这里通常用大写的K；k表示传输速率或描述网络通信时等于1000，这里通常用小写的k。注意区分和转换。  

4）t时刻H3请求断开连接，发出连接释放FIN报文段；S收到后，最短时间的情况是S已没有要发送的数据，所以同时发出确认ACK报文段和连接释放FIN报文段，即S直接跳过CLOSE-WAIT状态：H3收到FIN报文段后必须发出确认，S收到确认后进入CLOSED 状态，共经历1.5个RTT，因此S释放该连接的最短时间是 $1.5{\times}200\mathrm{ms}\,{=}\,300\mathrm{ms}$  

# 5.4本章小结及疑难点  

1.MSS设置得太大或太小会有什么影响？  

规定最大报文段长度MSS，并不是考虑接收方的缓存可能放不下TCP报文段中的数据。实际上，MSS与接收窗口没有关系。TCP报文段的数据部分，至少要加上4OB的首部（TCP首部至少20B和IP首部至少20B），才能组装成一个IP数据报。若选择较小的MSS值，网络的利用率就很低。设想在极端情况下，当TCP报文段只含有1B的数据时，在IP层传输的数据报的开销至少有40B（包括TCP首部和IP首部）。这样，网络的利用率就不会超过1/41。到了数据链路层还要加上一些开销，网络的利用率还会进一步降低。但反过来，若TCP报文段很长，则在IP层传输时有可能要分解成多个短数据报片。在终点还要把收到的各个短数据报片装配成原来的TCP报文段。当传输出错时，还要进行重传。这些也都会使开销增大。  

因此，MSS应尽可能大一些，只要在IP层传输时不要再分片就行。因为IP数据报所经历的路径是动态变化的，所以在一条路径上确定的不需要分片的MSS，若改走另一条路径，则可能需要进行分片。因此最佳的MSS是很难确定的。MSS的默认值为536B，因此在互联网上的所有主机都应能接受的报文段长度是 $536+20$ （TCP固定首部长度） $=556\mathrm{B}$  

2.TCP使用的是GBN还是选择重传？  

这是一个有必要弄清的问题。前面讲过，TCP使用累积确认，这看起来像是GBN的风格。但是，正确收到但失序的报文并不会丢弃，而是缓存起来，并且发送允余ACK指明期望收到的下一个报文段，这是TCP方式和GBN的显著区别。例如，A发送了 $N$ 个报文段，其中第 $k~(k<~N)$ 个报文段丢失，其余 $N{-}1$ 个报文段正确地按序到达接收方B。使用GBN时，A需要重传分组 $k$ ，以及所有后继分组 $k+1,k+2,\cdots,N$ 。相反，TCP却至多重传一个报文段，即报文段 $k$ 。另外，TCP中提供一个SACK（SelectiveACK）选项，即选择确认选项。使用选择确认选项时，TCP看起来就和SR非常相似。因此，TCP的差错恢复机制可视为GBN和SR协议的混合体。  
# 3.为什么超时事件发生时cwnd被置为1，而收到3个冗余ACK时cwnd减半？  

大家可以从如下角度考虑。超时事件发生和收到3个究余ACK，哪个意味看网络拥塞程度更严重？通过分析不难发现，在收到3个冗余ACK的情况下，网络虽然拥塞，但至少还有ACK报文段能被正确交付。而当超时发生时，说明网络可能已经拥塞得连ACK报文段都传输不了，发送方只能等待超时后重传数据。因此，超时事件发生时，网络拥塞更严重，发送方就应该最大限度地抑制数据发送量，所以cwnd置为1：收到3个冗余ACK时，网络拥塞不是很严重，发送方稍微抑制一下发送的数据量即可，所以cwnd减半。  

# 4.为什么不采用“两次握手”建立连接呢？  

这主要是为了防止两次握手情况下已失效的连接请求报文段突然又传送到服务器而产生错误。考虑下面这种情况。客户A向服务器B发出TCP连接请求，第一个连接请求报文在网络的某个结点长时间滞留，A超时后认为报文丢失，于是再重传一次连接请求，B收到后建立连接。数据传输完毕后双方断开连接。而此时，前一个滞留在网络中的连接请求到达服务器B，而B认为A又发来连接请求，此时若使用“三次握手”，则B向A返回确认报文段，因为是一个失效的请求，所以A不予理踩，建立连接失败。若采用的是“两次握手”，则这种情况下B认为传输连接已经建立，并一直等待A传输数据，而A此时并无连接请求，因此不予理踩，这样就造成了B的资源白白浪费。  

5.为什么TCP在建立连接时不能每次都选择相同的、固定的初始序号？  

1）假定主机A和B频繁地建立连接，传送一些TCP报文段后，再释放连接，然后又不断地建立新的连接、传送报文段和释放连接。2）假定每次建立连接时，主机A都选择相同的、固定的初始序号，如选择1。3）假定主机A发出的某些TCP报文段在网络中会滞留较长时间，以致主机A超时重传这些TCP报文段。4）假定有一些在网络中滞留时间较长的TCP报文段最后终于到达主机B，但这时传送该报文段的那个连接早已释放，而在到达主机B时的TCP连接是一条新的TCP连接。  

这样，工作在新的TCP连接的主机B就有可能会接收在旧的连接传送的、已无意义的、过时的TCP报文段（因为这个TCP报文段的序号有可能正好处在当前新连接所用的序号范围之中），结果产生错误。因此，必须使得迟到的TCP报文段的序号不处在新连接所用的序号范围之中。  

这样，TCP在建立新的连接时所选择的初始序号一定要和前面的一些连接所用过的序号不同。因此，不同的TCP连接不能使用相同的初始序号。  

6.假定在一个互联网中，所有链路的传输都不出现差错，所有结点也都不会发生故障。试问在这种情况下，TCP的“可靠交付”功能是否就是多余的？  

不是多余的。TCP的“可靠交付”功能在互联网中起着至关重要的作用。至少在以下的情况下，TCP的“可靠交付”功能是必不可少的。  
1）每个IP数据报独立地选择路由，因此在到达目的主机时有可能出现失序。2）由于路由选择的计算出现错误，导致IP数据报在互联网中转圈。最后数据报首部中的生存时间（TTL）的数值下降到零。这个数据报在中途就被丢失。3）某个路由器突然出现很大的通信量，以致路由器来不及处理到达的数据报。因此有的数据报被丢弃。以上列举的问题表明：必须依靠TCP的“可靠交付”功能才能保证在目的主机的目的进程中收到正确的报文。  
# 第6章应用层  

# 【考纲内容】  

（一）网络应用模型客户/服务器模型；P2P模型  

（二）域名系统（DNS）  

层次域名空间：域名服务器：域名解析过程  

（三）文件传输协议（FTP）FTP的工作原理：控制连接与数据连接  

（四）电子邮件（E-mail）电子邮件系统的组成结构；电子邮件格式与MIME；SMTP与POP3  

# 【复习提示】  

本章内容既可以以选择题的形式考查，又可以结合其他章节的内容出综合题。所以牢固掌握本章的几个典型应用层协议是关键。我们生活中的很多网络应用都是建立在这些协议的基础上的，因此在学习时要注意联系实际，提高学习的兴趣，才会获得更好的学习效果。  

# 6.1网络应用模型  

# 6.1.1客户/服务器模型  

命题追踪C/S模型和P2P模型的特点（2019）  

在客户/服务器（ClientServer，C/S）模型中，有一个总是打开的主机称为服务器，它服务于许多来自其他称为客户机的主机请求。其工作流程如下：  

1）服务器处于接收请求的状态。  

2）客户机发出服务请求，并等待接收结果。  

3）服务器收到请求后，分析请求，进行必要的处理，得到结果并发送给客户机。  

服务器上运行着专门用来提供某种服务的程序，可同时处理多个远程或本地客户的请求。客户程序必须知道服务器程序的地址。服务器启动后就一直不断地运行着，被动等待并接收来自各地客户的请求。因此，服务器程序不需要知道客户程序的地址。  

客户/服务器模型最主要的特征是：客户是服务请求方，服务器是服务提供方。如Web应用程序，其中总是打开的Web服务器服务于运行在客户机上的浏览器的请求。当Web服务器接收到来自客户机对某对象的请求时，它向该客户机发送所请求的对象以做出响应。使用客户/服务器模型的常见应用包括Web、文件传输协议（FTP）、远程登录和电子邮件等。  
客户/服务器模型的主要特点还有：  

1）网络中各计算机的地位不平等，服务器可通过对用户权限的限制来达到管理客户机的目的。整个网络的管理工作由少数服务器担当，因此网络的管理非常集中和方便。2）客户机相互之间不直接通信。例如，在Web应用中两个浏览器并不直接通信。3）可扩展性不佳。受服务器硬件和网络带宽的限制，服务器支持的客户机数有限。  

# 6.1.2P2P模型  

在C/S模型中（图6.1），服务器性能的好坏决定了整个系统的性能，当大量用户请求服务时，服务器就必然成为系统的瓶颈。P2P模型（见图6.2）的思想是整个网络中的传输内容不再被保存在中心服务器上，每个结点都同时具有下载、上传的功能，其权利和义务都是大体对等的。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/0968413e5bed6d57bfeff2b949e4c6ede48faed1adb20a5457f23dced3514fd4.jpg)  
图6.1C/S模型  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/056de45a9156710326d6d90dbab1f59c67aa4d467d7068d514a39ca0ff6589da.jpg)  
图6.2P2P模型  

在P2P模型中，各计算机没有固定的客户和服务器划分。相反，任意一对计算机一一称为对等方（Peer），直接相互通信。实际上，P2P模型从本质上来看仍然使用客户/服务器模型，每个结点既作为客户访问其他结点的资源，又作为服务器提供资源给其他结点访问。  

与C/S模型相比，P2P模型的优点主要体现如下：1）减轻了服务器的计算压力，消除了对某个服务器的完全依赖，可以将任务分配到各个结点上，因此大大提高了系统效率和资源利用率。2）多个客户机之间可以直接共享文档。3）可扩展性好，传统服务器有响应和带宽的限制，因此只能接受一定数量的请求。4）网络健壮性强，单个结点的失效不会影响其他部分的结点。  

P2P模型也有缺点。在获取服务的同时，还要给其他结点提供服务，因此会占用较多的内存，影响整机速度。例如，经常进行P2P下载还会对硬盘造成较大的损伤。据某互联网调研机构统计，当前P2P程序已占互联网 $50\%{\sim}90\%$ 的流量，使网络变得非常拥塞，因此各大ISP（互联网服务提供商，如电信、网通等）通常都对P2P应用持反对态度。  

# 6.1.3 本节习题精选  

# 单项选择题  

01.服务程序在Windows环境下工作，并且运行该服务器程序的计算机也作为客户访问其他计算机上提供的服务，则这种网络应用模型属于（）。  

A.主从式B.对等式C.客户/服务器模型D.集中式  
02.在客户/服务器模型中，客户指的是（）A.请求方B.响应方C.硬件D.软件  

03.用户提出服务请求，网络将用户请求传送到服务器；服务器执行用户请求，完成所要求的操作并将结果送回用户，这种工作模式称为（）  

A.C/S模式B.P2P模式C.CSMA/CD模式D.令牌环模式  

04.下面关于客户/服务器模型的描述，（）存在错误。  

1.客户端必须提前知道服务器的地址，而服务器则不需要提前知道客户端的地址II1.客户端主要实现如何显示信息与收集用户的输入，而服务器主要实现数据的处理IⅢ1.浏览器显示的内容来自服务器IV.客户端是请求方，即使连接建立后，服务器也不能主动发送数据  

A. I、IVB.II、IVC.只有IVD.只有IⅢI  

05.下列关于客户/服务器模型的说法中，不正确的是（）  

A.服务器专用于完成某些服务，而客户机则作为这些服务的使用者B.客户机通常位于前端，服务器通常位于后端C.客户机和服务器通过网络实现协同计算任务D.客户机是面向任务的，服务器是面向用户的  

06.以下关于P2P概念的描述中，错误的是（）。  

A.P2P是网络结点之间采取对等方式直接交换信息的工作模式B.P2P通信模式是指P2P网络中对等结点之间的直接通信能力C.P2P网络是指与互联网并行建设的、由对等结点组成的物理网络D.P2P实现技术是指为实现对等结点之间直接通信的功能所需要设计的协议、软件等  

07.【2019统考真题】下列关于网络应用模型的叙述中，错误的是（）。  

A.在P2P模型中，结点之间具有对等关系B.在客户/服务器（C/S）模型中，客户与客户之间可以直接通信C.在C/S模型中，主动发起通信的是客户，被动通信的是服务器D.在向多用户分发一个文件时，P2P模型通常比C/S模型所需的时间短  

# 6.1.4 答案与解析  

单项选择题  

01.B  

在P2P模型中，各用户计算机共享资源，从而提供比单个用户所能提供的多得多的资源。这里，各个计算机没有固定的客户和服务器划分，任意一对计算机称为对等方。  

02.A 客户机既不是硬件又不是软件，只是服务的请求方，服务器才是响应方。  

03.A  

用户提出服务请求，网络将用户请求传送到服务器；服务器执行用户请求，完成所要求的操作并将结果送回用户，这种工作模型称为客户/服务器模型。  

04.C  

在连接未建立前，服务器在某一个端口上监听。客户端是连接的请求方，客户端必须事先知道服务器的地址才能发出连接请求，而服务器则从客户端发来的数据包中获取客户端的地址。一旦连接建立，服务器就能响应客户端请求的内容，服务器也能主动发送数据给客户端，用于一些消息的通知，如一些错误的通知。所以只有IV错误。  
05.D  

客户机的作用是根据用户需求向服务器发出服务请求，并将服务器返回的结果呈现给用户，因此客户机是面向用户的，服务器是面向任务的。  

06.C  

P2P可以理解为一种通信模型、一种逻辑网络模型。物理网络是指在网络中由各种设备（主机、交换机等）和介质（双绞线等）连接而形成的网络，它看得见摸得着。而这个网络中所使用的协议，或网络结构，都是靠逻辑网络来划分的。P2P网络是一个构建在IP网络上的覆盖网络，是一种动态的逻辑网络。对等结点之间具有直接通信的能力是P2P的显著特点。  

# 07.B  

在P2P模型中，每个结点的权利和义务是对等的。在C/S模型中，客户是服务发起方，服务器被动接受各地客户的请求，但客户之间不能直接通信，例如We应用中两个浏览器之间并不直接通信。P2P模型减轻了对某个服务器的计算压力，可以将任务分配到各个结点上，极大提高了系统效率和资源利用率。  

# 6.2域名系统(DNS)  

# 命题追踪DNS向下依次使用的协议（2018、2021）  

域名系统（DomainNameSystem，DNS）是因特网使用的命名系统，用来把便于人们记忆的具有特定含义的主机名（如www.cskaoyan.com）转换为便于机器处理的IP地址。相对于IP地址，人们更喜欢使用具有特定含义的字符串来标识因特网上的计算机。值得注意的是，DNS系统采用客户/服务器模型，其协议运行在UDP之上，使用53号端口。  

从概念上可将DNS分为三部分：层次域名空间、域名服务器和解析器。  

# 6.2.1层次域名空间  

因特网采用层次树状结构的命名方法。采用这种命名方法，任何一个连接到因特网的主机或路由器，都有一个唯一的层次结构名称，即域名（DomainName）。域（Domain）是名字空间中一个可被管理的划分。域可以划分为子域，而子域还可以继续划分为子域的子域，这样就形成了顶级域、二级域、三级域等。每个域名都由标号序列组成，而各标号之间用点（“.”）隔开。一个典型的例子如图6.3所示，它是王道论坛用于提供WWW服务的服务器的域名，它由三个标号组成，其中标号com是顶级域名，标号cskaoyan是二级域名，标号www是三级域名。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/335d7e57f36898e0a60c2df2cb3fd7fdafea1eee6aa0d4604bcebd67d4068da1.jpg)  
图6.3一个域名的例子  

关于域名中的标号有以下几点需要注意：1）标号中的英文不区分大小写。  
2）标号中除连字符（-）外不能使用其他的标点符号。3）每个标号不超过63个字符，多标号组成的完整域名最长不超过255个字符。4）级别最低的域名写在最左边，级别最高的顶级域名写在最右边。顶级域名（Top Level Domain，TLD）分为如下三大类  

1）国家（地区）顶级域名（nTLD）。国家和某些地区的域名，如“.cn”表示中国，“us”表示美国，“uk”表示英国。2）通用顶级域名（gTLD）。常见的有“.com”（公司）、“net”（网络服务机构）、“org”（非营利性组织）、“edu”（教育机构）、和“gov”（国家或政府部门）等。  

3）基础结构域名（arpa）。用于反向域名解析，即IP地址反向解析为域名。  

图6.4展示了域名空间的树状结构。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c7c571a79927f4b59ecf1e91a76adf8317ac05d76b12b5a344e3d21ebb103c82.jpg)  
图6.4域名空间的树状结构  

在域名系统中，各级域名由其上一级的域名管理机构管理，顶级域名由因特网名称与数字地址分配机构（ICANN）管理。国家顶级域名下注册的二级域名均由该国家自行确定，每个组织都可以将它的域再分成一定数目的子域，并将这些子域委托给其他组织去管理。例如，管理cn域的中国将edu.cn子域授权给中国教育和科研计算机网（CERNET）来管理。  

# 6.2.2域名服务器  

域名到TP地址的解析是由运行在域名服务器上的程序完成的，一个服务器所负责管辖的（或有权限的）范围称为区（小于或等于“域”），一个区中的所有结点必须是能够连通的，每个区设置相应的权限域名服务器，用来保存该区中的所有主机的域名到DP地址的映射。每个域名服务器不但能够进行一些域名到ITP地址的解析，而且还必须具有连向其他域名服务器的信息。当自己不能进行域名到IP地址的转换时，能够知道到什么地方去找其他域名服务器。  

DNS使用了大量的域名服务器，它们以层次方式组织。没有一台域名服务器具有因特网上所有主机的映射，相反，该映射分布在所有的域名服务器上。有4种类型的域名服务器。  

# 1.根域名服务器  

根域名服务器是最高层次的域名服务器，所有的根域名服务器都知道所有的顶级域名服务器的域名和IP地址。根域名服务器是最重要的域名服务器，不管是哪个本地域名服务器，要对因特网上任何一个域名进行解析，只要自己无法解析，就首先要求助于根域名服务器。因特网上有13个根域名服务器，尽管我们将这13个根域名服务器中的每一个都视为单个服务器，但每个“服务器”实际上是究余服务器的集群，以提供安全性和可靠性。需要注意的是，根域名服务器用来管辖顶级域（如.com），通常它并不直接把待查询的域名直接转换成IP地址，而是告诉本地域名服务器下一步应当找哪个顶级域名服务器进行查询。  
# 2.顶级域名服务器  

这些域名服务器负责管理在该顶级域名服务器注册的所有二级域名。收到DNS查询请求时，就给出相应的回答（可能是最后的结果，也可能是下一步应当查找的域名服务器的IP地址）。  

# 3.权限域名服务器（授权域名服务器）  

每台主机都必须在权限域名服务器处登记。为了更加可靠地工作，一台主机最好至少有两个权限域名服务器。实际上，许多域名服务器都同时充当本地域名服务器和权限域名服务器。权限域名服务器总能将其管辖的主机名转换为该主机的IP地址。  

# 4.本地域名服务器  

本地域名服务器对域名系统非常重要。每个因特网服务提供者（ISP），或一所大学，甚至一所大学中的各个系，都可以拥有一个本地域名服务器。当一台主机发出DNIS查询请求时，这个查询请求报文就发送给该主机的本地域名服务器。事实上，我们在Windows系统中配置“本地连接”时，就需要填写DNS地址，这个地址就是本地DNS（域名服务器）的地址。  

DNS的层次结构如图6.5所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/5629d8bb8fb5177ee3e9a1ab880774ec6a90aeab599acde76f7da73da3ff2f16.jpg)  
图6.5DNS的层次结构  

# 6.2.3域名解析过程  

命题追踪DNS协议的作用（2021)  

域名解析是指把域名转化为IP地址的过程。当客户端需要域名解析时，通过本机的DNS客户端构造一个DNS请求报文，以UDP数据报方式发往本地域名服务器。  

域名解析有两种方式：递归查询和选代查询。（1）主机向本地域名服务器的查询都采用递归查询  

递归查询是指若主机所询问的本地域名服务器不知道被查询域名的IP地址，则本地域名服务器就以DINS客户的身份，向根域名服务器继续发出查询请求报文（即替该主机继续查询），而不是让该主机自己进行下一步的查询。两种查询方式的这一步是相同的。  

（2）本地域名服务器向其他域名服务器采用递归查询或选代查询  
# 命题追踪递归查询DNS的工作原理（2010）  

递归查询的过程如图6.6（a所示，本地域名服务器只需向根域名服务器查询一次，后面的几次查询都是递归地在其他几个域名服务器之间进行的［步骤 $\scriptstyle(\mathbf{\mathcal{B}}\sim\left(\mathbf{\mathcal{C}}\right)$ ]。在步骤 $\circleddash$ 中，本地域名服务器从根域名服务器得到了所需的ⅡP地址，最后在步骤 $^\mathrm{\textregistered}$ 中，本地域名服务器把查询结果告诉发起查询的主机。因为该方法给根域名服务器造成的负载过大，所以实际中几乎不使用。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/2663a99a9e96d72925ec8df3f3c96270b6c7942f0010e486c7694ed8830a3713.jpg)  
图6.6两种域名解析方式工作原理  

# 命题追踪选代查询DNS的工作原理（2016、2020）  

本地域名服务器向根域名服务器的查询通常是采用送代查询。当根域名服务器收到本地域名服务器发出的选代查询请求报文时，要么给出所要查询的IⅡP地址，要么告诉本地域名服务器：“你下一步应当向哪个顶级域名服务器进行查询”。然后让本地域名服务器进行后续的查询（而不替本地域名服务器进行后续的查询），如图6.6(b)所示。同样，顶级域名服务器收到查询报文后，要么给出所要查询的IP地址，要么告诉本地域名服务器下一步应当向哪个权限域名服务器查询。最后，知道了所要解析的域名的IP地址后，把这个结果返回给发起查询的主机。  

下面举例说明域名解析的过程。假定某客户机想获知域名为y.abc.com主机的IP地址，域名解析的过程（最多需要使用8个UDP报文：4个查询报文和4个回答报文）如下：  

$\textcircled{\scriptsize{1}}$ 客户机向其本地域名服务器发出DNS请求报文（递归查询）。 $\circledcirc$ 本地域名服务器收到请求后，查询本地缓存，若没有该记录，则以DINS客户的身份向根域名服务器发出解析请求报文（迭代查询）。 $\textcircled{3}$ 根域名服务器收到请求后，判断该域名属于.com域，将对应的顶级域名服务器dns.com的IP地址返回给本地域名服务器。 $\textcircled{4}$ 本地域名服务器向顶级域名服务器dns.com发出解析请求报文（迭代查询）。 $\circledast$ 顶级域名服务器dns.com收到请求后，判断该域名属于abc.com域，因此将对应的权限域名服务器dns.abc.com的IP地址返回给本地域名服务器。 $^\mathrm{\textregistered}$ 本地域名服务器向权限域名服务器dns.abc.com发起解析请求报文（选代查询）。 $\circleddash$ 权限域名服务器dns.abc.com收到请求后，将查询结果返回给本地域名服务器。 $\circledast$ 本地域名服务器将查询结果保存到本地缓存，同时返回给客户机。  

为了提高DINS的查询效率，并减少因特网上的DNS查询报文数量，在域名服务器中广泛地使用了高速缓存，用来缓存最近查询过的域名的相关映射信息。这样，当另一个相同的域名查询到达该DINIS服务器时，该服务器就能直接提供所要求的IP地址。因为主机名和IP地址之间的映射不是永久的，所以DNS服务器将在一段时间后去弃高速缓存中的信息。在主机中同样也很需要高速缓存，许多主机在启动时从本地域名服务器下载域名和地址的全部数据库，维护存放自己最近使用的域名的高速缓存，并且只在从缓存中找不到域名时才使用域名服务器。  
# 6.2.4 本节习题精选  

# 一、单项选择题  

01.域名与（）具有一一对应的关系。  

A.IP地址B.MAC地址C.主机D.以上都不是  

02.下列说法错误的是（）  

A.Internet上提供客户访问的主机一定要有域名B.同一域名在不同时间可能解析出不同的IP地址C.多个域名可以指向同一台主机IP地址D.IP子网中的主机可以由不同的域名服务器来维护其映射  

03.DNS是基于（）模型的分布式系统。  

A.C/SB.B/SC.P2PD.以上均不正确  

04.域名系统（DNS）的组成不包括（）  

A.域名空间B.分布式数据库C.域名服务器D.从内部IP地址到外部IP地址的翻译程序  

05.互联网中域名解析依赖于由域名服务器组成的逻辑树。在域名解析过程中，主机上请求域名解析的软件不需要知道（）信息。  

1.本地域名服务器的IPII.本地域名服务器父结点的IPII.域名服务器树根结点的IP  

A.I和IⅡIB.I和IIIC.II和IIID.I、I和ⅢI06.在DNS的递归查询中，由（）给客户端返回地址。  

A.最开始连接的服务器B.最后连接的服务器C.目的地址所在服务器D.不确定  

07.当本地域名服务器向根域名服务器查询一个域名时，根域名服务器返回一个负责该域名的顶级域名服务器的IP地址，让本地域名服务器再向该域名服务器查询，这种查询方式称为(）)。  

A.递归查询B.迭代查询C.重定向查询D.广播查询  

08.一台主机要解析www.cskaoyan.com的IP地址，若这台主机配置的域名服务器为202.120.66.68，因特网顶级域名服务器为11.2.8.6，而存储www.cskaoyan.com的1P地址对应关系的域名服务器为202.113.16.10，则这台主机解析该域名通常首先查询（）。  

A.202.120.66.68域名服务器B.11.2.8.6域名服务器C.202.113.16.10域名服务器D.可以从这3个域名服务器中任选一个  

09.（）可以将其管辖的主机名转换为主机的IP地址。  

A.本地域名服务器B.根域名服务器C.权限域名服务器D.代理域名服务器  
10.若本地域名服务器无缓存，用户主机采用递归查询向本地域名服务器查询另一网络某主机域名对应的IP地址，而本地域名服务器采用迭代查询向其他域名服务器进行查询，则用户主机和本地域名服务器发送的域名请求条数分别为（）。  

A.1条，1条B.1条，多条C.多条，1条D.多条，多条  

11.【2010统考真题】若本地域名服务器无缓存，则在采用递归方法解析另一网络某主机域名时，用户主机和本地域名服务器发送的域名请求条数分别为（）。  

A.1条，1条B.1条，多条C.多条，1条D.多条，多条  

12.【2016统考真题】假设所有域名服务器均采用迭代查询方式进行域名解析。当主机访问规范域名为www.abc.xyz.com的网站时，域名服务器在完成该域名解析的过程中，可能发出DNIS查询的最少和最多次数分别是（）。  

A.0, 3 B.1,3 C. 0, 4 D.1, 4 13.【2018统考真题】下列TCP/IP应用层协议中，可以使用传输层无连接服务的是（）。A.FTP B.DNS C. SMTP D. HTTP  

14.【2020统考真题】假设下图所示网络中的本地域名服务器只提供递归查询服务，其他域名服务器均只提供选代查询服务；局域网内主机访问Internet上各服务器的往返时间(RTT）均为 $10\mathrm{ms}$ ，忽略其他各种时延。若主机H通过超链接http://www.abc.com/indexhtml请求浏览纯文本Web页index.html,则从单击超链接开始到浏览器接收到index.html 页面为止，所需的最短时间与最长时间分别是（）。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/cfd24fd15d9757c380846ae4353a5c548543c5a76b1a84e086e67dcced7871d8.jpg)  

A.  $10\mathrm{ms}$  ，  $40\mathrm{ms}$  B.10ms,50ms C. 20ms, 40ms D.  $20\mathrm{ms}$  50ms  

# 二、综合应用题  

01.一台具有单个DNS名称的机器可以有多个IP地址吗？为什么？02．一台计算机可以有两个属于不同顶级域的DNS名字吗？若可以，则举例说明。03.DNS使用UDP而非TCP，若一个DNS分组丢失，没有自动恢复，则这会引起问题吗？若会，则应如何解决？04.为何要引入域名的概念？举例说明域名转换过程。域名服务器中的高速缓存有何作用？  

# 6.2.5 答案与解析  

# 一、单项选择题  

01.D  

若一台主机通过两块网卡连接到两个网络（如服务器双线接入），则就具有两个IP地址，每个网卡对应一个MAC地址，显然这两个IP地址可以映射到同一个域名上。此外，多台主机也可以映射到同一个域名上（如负载均衡），一台主机也可以映射到多个域名上（如虚拟主机）。因此，A、B和C和域名均不具有一一对应的关系。  
02.A  

Intermnet上提供访问的主机一定要有IP地址，而不一定要有域名，A错误。域名在不同的时间可以解析出不同的IP地址，因此可以用多台服务器来分担负载，B正确。可以把多个域名指向同一台主机IP地址，C正确。IP子网中主机也可以由不同的域名服务器来维护其映射，D正确。  

03.A  

DNS是一个基于C/S模型的分布式数据库系统，主要用于域名和TIP地址的映射。  

04.D  

DNS提供从域名到IP地址或从IP地址到域名的映射服务。它被设计成为一个联机分布式数据库系统，并采用客户/服务器模式。域名的解析是由若干域名服务器程序完成的。从内部IP地址到外部IP地址的映射是由NAT实现的，用于缓解IPv4地址紧缺的问题，与域名系统无关。  

05.C  

正常情况下，客户机只需把域名解析请求发往本地域名服务器，其他事情都由本地域名服务器完成，并把最后结果返回给客户机。所以主机只需要知道本地域名服务器的IFP。  

06.A  

在递归查询中，每台不包含被请求信息的服务器都转到其他地方去查找，然后它再往回发送结果，所以客户端最开始连接的服务器最终将返回正确的信息。  

07. B  

选代查询是指当一个域名服务器收到本地域名服务器发出的查询请求报文时，要么给出所要查询的IP地址，要么告诉本地服务器：“你下一步应当向哪个DNS服务器进行查询。”然后让本地域名服务器进行后续的查询（而不替本地域名服务器进行后续的查询）。  

08.A  

当这台主机发出对www.cskaoyan.com的DNS查询报文时，这个查询报文首先被送往该主机的本地域名服务器202.120.66.68。本地域名服务器不能立即回答该查询时，就以DNS客户的身份向某一根域名服务器查询。但不管采用何种查询方式，首先都要查询本地域名服务器。  

09.C  

每台主机都必须在权限域名服务器处注册登记，权限域名服务器一定能够将其管辖的主机名 转换为该主机的IP地址。  

10.A  

采用递归查询时，若主机所询问的本地域名服务器不知道被查询域名的IP地址，则本地域名服务器就以DNIS客户的身份，向根域名服务器继续发出查询请求报文，而不是让该主机自己进行下一步的查询。因此，采用这种方法时，用户主机和本地域名服务器发送的域名请求条数均为1。因此答案为A。  

11.B  

用户主机向本地域名服务器采用递归查询，所以只会向本地域名服务器发送1条DNS请求。本地域名服务器向其他域名服务器采用选代查询，所以本地域名服务器会分别向根域名服务器、顶级域名服务器、权限域名服务器发送DNS请求，所以会发出多条DINS请求。  

12.C  

最少情况：当本地域名服务器中有该域名的DNS信息时，不需要查询任何其他域名服务器，最少发出0次DINS查询。最多情况：因为均采用选代查询方式，在最坏情况下，本地域名服务器需要依次选代地向根域名服务器、顶级域名服务器（.com）、权限域名服务器（xyz.com）、权限域名服务器（abc.xyz.com）发出DNS查询请求，因此最多发出4次DNS查询。  
13.B  

FTP用来传输文件，SMTP用来发送电子邮件，HTTP用来传输网页文件，都对可靠性的要求较高，因此在传输层都采用有连接的TCP服务。无连接的UDP服务效率更高、开销小，DNS在传输层采用无连接的UDP服务。  

14.D  

题中RTT均为局域网内主机（主机H、本地域名服务器）访问Intermet上各服务器的往返时间，且忽略其他时延，因此H向本地域名服务器的查询时延忽略不计。最短时间：H有该域名到IP地址映射的记录，因此没有DNS查询时延，直接和www.abc.com服务器建立TCP连接再进行资源访问，TCP连接建立的三次握手需要1.5个RTT，并在第3次握手报文中捐带了对资源的请求，然后服务器返回所请求的资源需要0.5个RTT，共2个RTT，即 $20\mathrm{ms}$ 。最长时间：H递归查询本地域名服务器（延时忽略），本地域名服务器依次迭代查询根域名服务器、com顶级域名服务器、abc.com域名服务器，共3个RTT，查询到IP地址后，返回给主机，H和www.abc.com服务器建立TCP连接再进行资源访问，共2个RTT，合计 $3+2=5$ 个RTT，即 $50\mathrm{ms}$  

# 二、综合应用题  

01.【解答】  

可以，IP地址由网络号和主机号两部分构成。若一台机器有两个以太网卡，则它就可同时连到两个不同的网络上（网络号不能相同，否则发生冲突）；若是这样，则它就需要两个IP地址。  

02.【解答】  

可以，例如www.cskaoyan.com和www.cskaoyan.cn属于不同的顶级域（.com和.cn），但它们可以有同样的IP地址。用户输入这两个不同的DNS名字，访问的都是同一台服务器。  

03.【解答】  

DNS使用传输层的UDP而非TCP，因为它不需要使用TCP在发生传输错误时执行的自动重传功能。实际上，对于DINS服务器的访问，多次DNS请求都返回相同的结果，即做多次和做一次的效果一样。因此DNS操作可以重复执行。当一个进程做一次DNS请求时，它启动一个定时器。若定时器计满而未收到回复，则它就再请求一次，这样做不会有害处。  

04.【解答】  

IP地址很难记忆，引入域名是为了便于人们记忆和识别。  

域名解析可以把域名转换成IP地址。域名转换过程是向本地域名服务器申请解析，若本地域名服务器查不到，则向根域名服务器进行查询。若根域名服务器中也查不到，则向根域名服务器中保存的顶级域名服务器和相应权限域名服务器进行查询，一定可以查找到。  

域名服务器中高速缓存的作用：将近期访问过的域名信息保存在高速缓存，再次访问时会从缓存中读取，不需要重新解析，这样就可以加快域名解析的响应速度。  

# 6.3文件传输协议(FTP)  

# 6.3.1FTP的工作原理  

文件传输协议（FileTransferProtocol，FTP）是因特网上使用得最广泛的文件传输协议。FTP提供交互式的访问，充许客户指明文件的类型与格式，并充许文件具有存取权限。它屏蔽了各计算机系统的细节，因而适合于在异构网络中的任意计算机之间传送文件。  
FTP提供以下功能：  

$\textcircled{\scriptsize{1}}$ 提供不同种类主机系统（硬、软件体系等都可以不同）之间的文件传输能力。 $\circledcirc$ 以用户权限管理的方式提供用户对远程FTP服务器上的文件管理能力。 $\textcircled{3}$ 以匿名FTP的方式提供公用文件共享的能力。  

# 命题追踪FTP在传输层所使用的协议（2009、2018）  

FTP采用客户/服务器的工作方式，使用TCP可靠的传输服务。一个FTP服务器进程可同时为多个客户进程提供服务。FTP的服务器进程由两大部分组成：一个主进程，负责接收新的请求：另外有若干从属进程，负责处理单个请求。其工作步骤如下：  

$\textcircled{\scriptsize{1}}$ 打开熟知端口21（控制端口），使客户进程能够连接上。  

$\circledcirc$ 等待客户进程发连接请求。 $\textcircled{3}$ 启动从属进程处理客户进程发来的请求。从属进程对客户进程的请求处理完毕后即终止。  

$\textcircled{4}$ 回到等待状态，继续接收其他客户进程的请求。主进程与从属进程是并发执行的。  

FTP服务器必须在整个会话期间保留用户的状态信息。特别是服务器必须把指定的用户账户与控制连接联系起来，服务器必须追踪用户在远程目录树上的当前位置。  

# 6.3.2控制连接与数据连接  

# 命题追踪控制连接和数据连接的特点（2017、2023）  

FTP在工作时使用两个并行的TCP连接（见图6.7）：一个是控制连接（服务器端口号21），一个是数据连接（服务器端口号20）。使用两个不同的端口号可以使协议更容易实现。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c1f0808dc3aeb3e8fa2e341b8a51d60ebf4df40ec50c263cab6b38816315d50f.jpg)  
图6.7控制连接和数据连接  

# 1.控制连接  

# 命题追踪控制连接的作用（2009）  

服务器监听21号端口，等待客户连接，建立在这个端口上的连接称为控制连接，用来传输控制信息（如连接请求、传送请求等）。FTP客户发出的传送请求，通过控制连接发送给服务器端的控制进程，但控制连接并不用来传送文件。在传输文件时还可以使用控制连接（如客户在传输中途发一个中止传输的命令），因此控制连接在整个会话期间一直保持打开状态。  

# 2.数据连接  

服务器端的控制进程在接收到FTP客户发送来的文件传输请求后，就创建“数据传送进程”和“数据连接”。数据连接用来连接客户端和服务器端的数据传送进程，数据传送进程实际完成文件的传送，在传送完毕后关闭“数据传送连接”并结束运行。  

数据连接有两种传输模式：主动模式PORT和被动模式PASV。PORT模式的工作原理：客户端连接到服务器的21端口，登录成功后要读取数据时，客户端随机开放一个端口，并发送命令告知服务器，服务器收到PORT命令和端口号后，通过20端口和客户端开放的端口连接，发送数据。PASV模式的不同点是，客户端要读取数据时，发送PASV命令到服务器，服务器在本地随机开放一个端口，并告知客户端，客户端再连接到服务器开放的端口进行数据传输。可见，是用PORT模式还是PASV模式，选择权在客户端。简单概括为，主动模式传送数据是“服务器”连接到“客户端”的端口；被动模式传送数据是“客户端”连接到“服务器”的端口。  
# 注意  

# 很多教材并未介绍这两种模式，如无特别说明可默认为采用主动模式。  

因为FTP使用了一个分离的控制连接，所以也称FTP的控制信息是带外（Out-ofband）传送的。使用FTP时，要修改服务器上的文件，就需要先将此文件传送到本地主机，然后将修改后的文件副本传送到原服务器，来回传送耗费很多时间。网络文件系统（NFS）采用另一种思路，它允许进程打开一个远程文件，并能在该文件的某个特定位置开始读写数据。这样，NFS可使用户只复制一个大文件中的一个很小的片段，而不需要复制整个大文件。  

# 6.3.3 本节习题精选  

# 一、单项选择题  

01.文件传输协议（FTP）的一个主要特征是（）  

A.允许客户指明文件的类型但不允许指明文件的格式B.不允许客户指明文件的类型但允许指明文件的格式C.允许客户指明文件的类型与格式D.不允许客户指明文件的类型与格式  

02.以下关于FTP工作模型的描述中，错误的是（）  

A.FTP使用控制连接、数据连接来完成文件的传输B.用于控制连接的TCP连接在服务器端使用的熟知端口号为21C.用与控制连接的TCP连接在客户端使用的端口号为20D.服务器端由控制进程、数据进程两部分组成  

03.控制信息是带外传送的协议是（）  

A.HTTP B.SMTP C.FTP D. POP  

04.下列关于FTP连接的叙述中，正确的是（）。  

A.控制连接先于数据连接被建立，并先于数据连接被释放B.数据连接先于控制连接被建立，并先于控制连接被释放C.控制连接先于数据连接被建立，并晚于数据连接被释放D.数据连接先于控制连接被建立，并晚于控制连接被释放  

05.FTP客户发起对FTP服务器连接的第一阶段是建立（）A.传输连接B.数据连接C.会话连接D.控制连接06.FTP中作为服务器一方的进程，通过监听（）端口得知有无服务请求。A.53 B.80 C. 20 D.21  

07.下列关于FTP的叙述中，错误的是（）。A.FTP可以实现异构网络中计算机之间的文件传送  
B.在进行文件传输时，FTP客户端和服务器之间需建立两个连接C.FTP服务器主进程在20端口上监听客户端的连接请求 D.FTP使用TCP进行可靠传输  

08.一个FTP用户发送了一个LIST命令来获取服务器的文件列表，这时服务器应通过（）端口来传输该列表。  

A.21 B.20 C.22 D.19  

09.下列关于FTP的叙述中，错误的是（）  

A.FTP可以在不同类型的操作系统之间传送文件B.FTP并不适合用在两个计算机之间共享读写文件C.控制连接在整个FTP会话期间一直保持D.客户端默认使用端口20与服务器建立数据传输连接  

10.当一台计算机从FTP服务器下载文件时，在该FTP服务器上对数据进行封装的5个转换步骤是（)。  

A.比特，数据帧，数据报，数据段，数据B.数据，数据段，数据报，数据帧，比特C.数据报，数据段，数据，比特，数据帧D.数据段，数据报，数据帧，比特，数据  

11.匿名FTP访问通常使用（）作为用户名。A.guest B.E-mail地址 C.anonymous D.主机id  

12.FTP支持两种方式的传输：ASCII方式和Binary（二进制）方式。通常文本文件的传输采用（）方式，而图像、声音等非文本文件采用（）方式传输。  

A.ASCIl,BinaryB.Binary,ASCII C.ASCII,ASCII D.Binary,Binary  

13.【2009统考真题】FTP客户和服务器间传递FTP命令时，使用的连接是（）  

A.建立在TCP之上的控制连接B.建立在TCP之上的数据连接C.建立在UDP之上的控制连接D.建立在UDP之上的数据连接  

14.【2017统考真题】下列关于FTP的叙述中，错误的是（）  

A.数据连接在每次数据传输完毕后就关闭B.控制连接在整个会话期间保持打开状态C.服务器与客户端的TCP20端口建立数据连接D.客户端与服务器的TCP21端口建立控制连接  

# 二、综合应用题  

01.文件传输协议的主要工作过程是怎样的？主进程和从属进程各起什么作用？  

02.为什么FTP要使用两个独立的连接，即控制连接和数据连接？  

03.主机A想下载文件ftp://flp.abc.edu.cn/file，大致描述下载过程中主机和服务器的交互过程。  

04.【2023统考真题】某网络拓扑如题04图所示，主机H登录FTP服务器后，向服务器上传一个大小为18000B的文件F。假设H为传输F建立数据连接时，选择的初始序号为100，  $\mathrm{MSS}=\ensuremath{\mathrm{1000B}}$  ，拥塞控制初始國值为4MSS，  $\mathrm{RTT}=10\mathrm{ms}$  ，忽略TCP段的传 输时延；在F的传输过程中， $\mathrm{H}$ 均以MSS段向服务器发送数据，且未发生差错、丢包和乱序现象。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/511a3927eb28a50a6659b9687a36758f69dd5f7e2d2ef85f06cc5dca71bbb8ae.jpg)  
题04图  

请回答下列问题。  

1）FTP的控制连接是持久的还是非持久的？FTP的数据连接是持久的还是非持久的？当H登录FTP服务器时，建立的TCP连接是控制连接还是数据连接？2）当H通过数据连接发送F时，F的第一个字节的序号是多少？在断开数据连接过程中，FTP服务器发送的第二次挥手ACK段的确认序号是多少？3）在H通过数据连接发送F的过程中，当H收到确认序号为2101的确认段时，H的拥塞窗口调整为多少？收到确认序号为7101的确认段时，H的拥塞窗口调整为多少？4）H从请求建立数据连接开始，到确认F已被服务器全部接收为止，至少需要多长时间？期间应用层数据平均发送速率是多少？  

# 6.3.4 答案与解析  

# 一、单项选择题  

01. C  

FTP提供交互式访问，充许客户指明文件的类型与格式，并充许文件具有存取权限，  

02.C  

在服务器端，控制连接使用TCP的21号端口，数据连接使用TCP的20号端口；而在客户端，控制连接和数据连接的TCP端口号都是由客户端系统自动分配的。需要注意的是，当我们说FTP使用20、21号端口，HTTP使用80号端口，SMTP使用25号端口时，都是指相应协议的服务器端所使用的端口号，而客户端使用系统自动分配的端口号向这些服务的熟知端口发起连接。  

03.C  

带外传送是指控制信息与数据信息通过不同的逻辑信道传送。例如，FTP使用一个单独的控制连接来传输控制信息，而数据连接用于传送文件。带内传送是指控制信息与数据信息通过同一个逻辑信道传送。例如，HTTP的请求和响应报文都是在同一个TCP连接上进行的。  

04.C  

FTP客户首先连接服务器的21号端口，建立控制连接（控制连接在整个会话期间一直保持打开），然后建立数据连接，在数据传送完毕后，数据连接最先释放，控制连接最后释放。  

# 05. D  

FTP工作时使用两个连接：控制连接和数据连接。FTP客户对FTP服务器发起连接时，首先建立控制连接，即向服务器的21号TCP端口发起连接：然后建立数据连接（20号TCP端口）。FTP并没有传输连接和会话连接的说法。  

06.D  

FTP服务器通过监听熟知端口21（控制端口）得知有无服务请求。  

07. C  

因为FTP屏蔽了各计算机系统的细节，所以FTP适用于异构网络中计算机之间的文件传送。当进行文件传输时，FTP客户端和服务器之间需建立两个并行的控制连接和数据连接。FTP服务器主进程在熟知端口21上监听客户端的服务请求。FTP在传输层使用TCP进行可靠传输。  
08.B  

FTP中数据连接的端口是20，而文件的列表是通过数据连接来传输的。  

09.D  

控制连接建立后，服务器进程用自己传送数据的熟知端口20与客户进程所提供的端口号建立数据传输连接（默认为PORT模式），即客户进程的端口号是客户进程自已提供的。  

10.B  

FTP服务器的数据要经过应用层、传输层、网络层、数据链路层及物理层。因此，对应的封装是数据、数据段、数据报、数据顿，最后是比特。  

11.C  

针对文件传输FTP，系统管理员建立了一个特殊的用户ID，名为anonymous，即匿名用户。Intermet上的任何人在任何地方都可以使用该用户ID，只是在要求提供用户ID时必须输入anonymous，该用户ID的密码可以是任何字符串。  

12.A  

FTP支持ASCII和Binary两种方式的传输，通常非加密文本文件采用ASCⅡI方式传输，而图像、声音等非文本文件采用Binary方式传输。本题可能有所超纲，了解即可。  

13.A  

对于FTP文件传输，为了保证可靠性，选择TCP，排除C和D。FTP的控制信息是带外传送的，即FTP使用了一个分离的控制连接来传送命令，因此答案为A。  

14.C  

FTP使用控制连接和数据连接，控制连接存在于整个FTP会话过程中，数据连接在每次文件传输时才建立，传输结束就关闭，A和B正确。默认情况（PORT模式）下FTP服务器使用TCP20端口进行数据连接，使用TCP21端口进行控制连接，这里的端口号是指FTP服务器的端口号，因此C错误、D正确。此外还需要注意的是，FTP服务器是否使用TCP20端口建立数据连接与传输模式有关，PORT模式使用TCP20端口，PASV模式由服务器随机选定。  

二、综合应用题  

01.【解答】  

FTP的主要工作过程如下：在进行文件传输时，FTP客户所发出的传送请求通过控制连接发送给服务器端的控制进程，并在整个会话期间一直保持打开，但控制连接不用来传送文件。服务器端的控制进程在接收到FTP客户发送来的文件传输请求后，就创建数据传送进程和数据连接，数据连接用来连接客户端和服务器端的数据传输进程，数据传送进程实际完成对文件的传送，在传送完毕后关闭“数据传送连接”，并结束运行。  

FTP的服务器进程由两大部分组成：一个主进程，负责接收新的请求；若干从属进程，负责处理单个请求。  

02.【解答】  

在FTP的实现中，客户与服务器之间采用了两条传输连接，其中控制连接用于传输各种FTP命令，而数据连接用于文件的传送。之所以这样设计，是因为使用两条独立的连接可使FTP变得更加简单、更容易实现、更有效率。同时在文件传输过程中，还可以利用控制连接控制传输过程，如客户可以请求终止、暂停传输等。  

03.【解答】大致过程如下：  
$\textcircled{\scriptsize{1}}$ 建立一个TCP连接到服务器ftp.abc.edu.cn的21号端口，然后发送登录账号和密码。 $\circledcirc$ 服务器返回登录成功信息后，主机A打开一个随机端口，并将该端口号发送给服务器。 $\textcircled{3}$ 主机A发送读取文件命令，内容为getfile，服务器使用20号端口建立一个TCP连接到主机A的随机打开的端口。  

$\textcircled{4}$ 服务器把文件内容通过第二个连接发送给主机A，传输完毕后连接关闭。  

# 04.【解答】  

1）在FTP会话期间，控制连接一直处于保持状态，是持久的。当每次需要传输文件时，FTP客户和服务器之间会建立一个临时的数据连接，用于传输文件数据，是非持久的。控制连接用于传输命令和控制信息，登录操作涉及身份验证、发送命令等控制信息，因此H登录FTP服务器时建立的TCP连接是控制连接。  

2）建立连接时，FTP客户发送的第一次握手SYN段要消耗一个序号，选择的初始序号为100，因此发送文件F时，第一个字节的序号为101。文件F共有18000个字节，需占用18000个序号，释放连接时，FTP客户发送的第一次挥手FIN段也要消耗一个序号，所以该FIIN段的序号为18101，因此TCP服务器发送的第二次挥手ACK段的确认序号是18102。  

3）拥塞窗口在每个传输轮次后的变化如下表所示。前两个传输轮次，拥塞窗口小于闽值，拥塞窗口按指数增长；第2个传输轮次结束后，拥塞窗口增长到4MSS，此后每经过一个传输轮次，拥塞窗口增加1MSS。当 $\mathrm{H}$ 收到确认序号为2101的确认段时，表示服务器已收到2000B数据，即2个报文段，此时还处在第2个传输轮次（慢开始阶段），拥塞窗口还未达到值，发送方每收到一个确认，拥塞窗口就加1，所以此时拥塞窗口为  $2+1=$  3MSS。当 $\mathrm{H}$ 收到确认序号为7101的确认段时，表示服务器已收到7个报文段，第3轮传输结束后，发送方共发送了 $1+2+4=7\mathrm{MSS}$ 数据，所以拥塞窗口大小为5MSS。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/a28262cad80c78a1bbd00465a1d6d9c31658901c369174b35a8d441d25b4a33b.jpg)  

4）每个传输轮次传输的数据量如下表所示，文件F的大小 $18000\mathbf{B}=18\mathbf{MSS}$ ，则发送完F要经过5个RTT，此外还要1个额外的RTT用来建立TCP连接。因此，H从请求建立数据连接开始，到确认F已被服务器全部接收为止，至少需要 $6\mathrm{RTT}=6{\times}10\mathrm{ms}=60\mathrm{ms}.$ ：期间应用层数据平均发送速率是 $18000\mathrm{B}{\cdot}60\mathrm{ms}=300{\times}10^{3}\mathrm{B}/\mathrm{s}=0.3\mathrm{MB/s}=2.4\mathrm{M}\mathrm{b}/\mathrm{s}.$  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/88738137ba9b15b74040a9dcdfbd10c148cc225e31ac237bcc74178cefd02b6b.jpg)  

# 6.4电子邮件  

# 6.4.1电子邮件系统的组成结构  

自从有了因特网，电子邮件就在因特网上流行起来。电子邮件是一种异步通信方式，通信时不需要双方同时在场。电子邮件把邮件发送到收件人使用的邮件服务器，并放在其中的收件人邮箱中，收件人可以随时上网到自已使用的邮件服务器进行读取。  

一个电子邮件系统应具有图6.8所示的三个最主要的组成构件，即用户代理（UserAgent）、邮件服务器和电子邮件使用的协议，如SMTP、POP3（或IMAP）等。  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/dfcc3f07d050e1a4bd109677dfc892e5090689da8a858b59b160fa23ab313e71.jpg)  
图6.8电子邮件系统最主要的组成构件  

用户代理（UA）：用户与电子邮件系统的接口。用户代理向用户提供一个很友好的接口来发送和接收邮件，用户代理至少应当具有撰写、显示和邮件处理的功能。通常情况下，用户代理就是一个运行在PC上的程序（电子邮件客户端软件），常见的有Outlook和Foxmail等。  

邮件服务器：它的功能是发送和接收邮件，同时还要向发件人报告邮件传送的情况（已交付、被拒绝、丢失等）。邮件服务器以客户/服务器模式工作，但它必须能够同时充当客户和服务器。例如，当邮件服务器A向邮件服务器B发送邮件时，A就作为SMTP客户，而B是SMTP服务器；反之，当B向A发送邮件时，B就是SMTP客户，而A就是SMTP服务器。  

# 命题追踪邮件发送协议和读取协议的应用（2012）  

邮件发送协议和读取协议：邮件发送协议用于用户代理向邮件服务器发送邮件或在邮件服务器之间发送邮件，如SMTP；邮件读取协议用于用户代理从邮件服务器读取邮件，如POP3。注意，SMTP用的是“推”（Push）的通信方式，即用户代理向邮件服务器发送邮件及在邮件服务器之间发送邮件时，SMTP客户将邮件“推”送到SMTP服务器。而POP3用的是“拉”（PulI）的通信方式，即用户读取邮件时，用户代理向邮件服务器发出请求，“拉”取用户邮箱中的邮件。  

电子邮件的发送、接收过程可简化为如图6.9所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/6ca073f4d9e5db6d02912d03369337bbc2dd68d517d1196365f94c02d9453f0b.jpg)  
图6.9电子邮件的发送、接收过程  

下面简单介绍电子邮件的收发过程。  

$\textcircled{\scriptsize{1}}$ 发件人调用用户代理来撰写和编辑要发送的邮件。  

$\circledcirc$ 邮件撰写完后，发件人点击“发送邮件”按钮，把发送邮件的工作全都交给用户代理来完成，就什么都不用管了。用户代理用SMTP把邮件传送给发送端邮件服务器。  

$\textcircled{3}$ 发送端邮件服务器将邮件放入邮件缓存队列中，等待发送。  

$\textcircled{4}$ 发送端邮件服务器的SMTP客户与接收端邮件服务器的SMTP服务器建立TCP连接，然后就把邮件缓存队列中的邮件依次发送出去。注意，邮件是直接传送给接收端邮件服务器的，而不会在互联网的某个中间邮件服务器落地。  

$\circledast$ 运行在接收端邮件服务器中的SMTP服务器进程收到邮件后，将邮件放入收件人的用户邮箱，等待收件人在方便时进行读取。  
$\textcircled{6}$ 收件人打算收信时，调用用户代理，使用POP3（或IMAP）协议将自己的邮件从接收端邮件服务器的用户邮箱中取回（如果邮箱中有来信的话）。  

# 6.4.2电子邮件格式与MIME  

# 1.电子邮件格式  

一个电子邮件分为信封和内容两大部分，邮件内容又分为首部和主体两部分。RFC822规定了邮件的首部格式，而邮件的主体部分则让用户自由撰写。用户写好首部后，邮件系统自动地将信封所需的信息提取出来并写在信封上，用户不需要亲自填写信封上的信息。  

邮件内容的首部包含一些首部行，每个首部行由一个关键字后跟冒号再后跟值组成。有些关键字是必需的，有些则是可选的。最重要的关键字是To和Subject。  

To是必填的关键字，后面填入一个或多个收件人的电子邮件地址。电子邮件地址的格式为：收件人邮箱名 $^{\textit{\textregistered}}$ 邮箱所在主机的域名，如abc@cskaoyan.com，abc cska oy an.com这个邮件服务器上必须是唯一的。这也就保证了该邮件地址在整个因特网上是唯一的。  

Subjiect是可选关键字，是邮件的主题，反映了邮件的主要内容。  

当然，还有一个必填的关键字是From，但它通常由邮件系统自动填入。首部与主体之间用一个空行进行分割。典型的邮件内容如下：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/ad6c7d88b4818d5ccfd48b3f5f46a9fdfe4b14571fa005e2fce9eb9bd53a5b58.jpg)  

# 2.多用途因特网邮件扩展（MIME）  

命题追踪SMTP直接传输的内容（2018）  

因为SMTP只能传送7位ASCII码文本邮件，许多其他非英语国家的文字（如中文、俄文，甚至带重音符号的法文或德文）就无法传送，且无法传送可执行文件及其他二进制对象，所以提（Multipurpose Internet Mail Extensions，MIME）。  

MIME并未改动SMTP或取代它。当发送端发送的邮件中包含有非ASCII码数据时，不能直接使用SMTP进行传送，而要通过MIME进行转换，将非ASCII码数据转换为ASCII码数据。之后，就可以使用SMTP进行传送。接收端也要使用MIME对接收到的ASCII码数据进行逆转换，以便可以得到包含有非ASCII码数据的邮件。MIME与SMTP的关系如图6.10所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/b50f6aad5d70911c62bdd8542a01a0e00833e19a2ac698dac6e472b48a6ca867.jpg)  
图6.10SMTP与MIME的关系  
MIME主要包括以下三部分内容：  

$\textcircled{\scriptsize{1}}$ 5个新的邮件首部字段，包括MIME版本、内容描述、内容标识、传送编码和内容类型。  

$\circledcirc$ 定义了许多邮件内容的格式，对多媒体电子邮件的表示方法进行了标准化。  

$\textcircled{3}$ 定义了传送编码，可对任何内容格式进行转换，而不会被邮件系统改变。  

# 6.4.3 SMTP和POP3  

# 命题追踪  

1.SMTP  

# 命题追踪  

SMTP和POP3在传输层所使用的服务（2015、2018）  

SMTP的用途及特点（2013、2014）  

简单邮件传输协议（Simple Mail Transfer Protocol，SMTP）件传输的协议，它控制两个相互通信的SMTP进程交换信息。因为SMTP采用客户/服务器模式工作，所以负责发送邮件的SMTP进程就是SMTP客户，而负责接收邮件的SMTP进程就是SMTP服务器。SMTP用的是TCP连接，端口号为25。SMTP通信有以下三个阶段。  

（1）连接建立  

发件人的邮件发送到发送方邮件服务器的邮件缓存中后，SMTP客户就每隔一定时间对邮件缓存扫描一次。如发现有邮件，就与接收方邮件服务器的SMTP服务器建立TCP连接，SMTP服务器使用的熟知端口号为25。连接建立后，接收方SMTP服务器发出220Serviceready（服务就绪）。然后SMTP客户向SMTP服务器发送HELO命令，附上发送方的主机名。  

SMTP不使用中间的邮件服务器。TCP连接总是在发送方和接收方这两个邮件服务器之间直接建立，而不管它们相隔多远，不管在传送过程中要经过多少个路由器。当接收方邮件服务器因故障暂时不能建立连接时，发送方的邮件服务器只能等待一段时间后再次尝试连接。  

（2）邮件传送  

连接建立后，就可开始传送邮件。邮件的传送从MAIL命令开始，MAIL命令后面有发件人的地址。如MAILFROM:<fh@hit.edu.cn>。若SMTP服务器已准备好接收邮件，则回答250OK。下面跟着一个或多个RCPT命令，格式为RCPTTO：<收件人地址>。每发送一个RCPT命令，都应有相应的信息从SMTP服务器返回，如250OK或 $550\,\mathrm{No}$ such user here（无此用户）。  

RCPT命令的作用是，先弄清接收方系统是否已做好接收邮件的准备，然后才发送邮件，以便不至于发送了很长的邮件后才知道地址错误，进而避免浪费通信资源。  

获得OK的回答后，客户端就使用DATA命令，表示要开始传送邮件的内容。正常情况下，SMTP 354 Start mail input;endwith<CRLF>.<CRLF>。<CRLF>表示回车换行。此时SMTP客户就可开始传送邮件内容，并用<CRLF>.<CRLF>表示邮件内容的结束。  

（3）连接释放  

邮件发送完毕后，SMTP客户应发送QUIT命令。SMTP服务器返回的信息是221（服务关闭），表示SMITP同意释放TCP连接。邮件传送的全部过程就此结束。  

2.P0P3和IMAP  

邮局协议（PostOficeProtocol，POP）是一个非常简单但功能有限的邮件读取协议，现在使用的版本是POP3。POP也采用客户/服务器模式，在传输层使用TCP，端口号为110。  

接收方的用户代理必须运行POP客户程序，而接收方的邮件服务器中则运行POP服务器程序。POP有两种工作方式：“下载并保留”和“下载并删除”。在“下载并保留”方式下，用户从邮件服务器上读取邮件后，邮件依然会保存在邮件服务器上，用户可再次从服务器上读取该邮件：  
而使用“下载并删除”方式时，邮件一旦被读取，就被从邮件服务器上删除。  

另一个邮件读取协议是因特网报文存取协议（IMAP），它比POP复杂得多，IMAP为用户提供了创建文件夹、在不同文件夹之间移动邮件及在远程文件夹中查询邮件等联机命令，为此IMAP服务器维护了会话用户的状态信息。IMAP的另一特性是允许用户代理只获取报文的某些部分，例如可以只读取一个报文的首部，或多部分MIM正报文的一部分。这非常适用于低带宽的情况，用户可能并不想取回邮箱中的所有邮件，尤其是包含很多音频或视频的大邮件。  

此外，随着万维网的流行，目前出现了很多基于万维网的电子邮件，如Hotmail、Gmail等。这种电子邮件的特点是，用户浏览器与Hlotmail或Gmail的邮件服务器之间的邮件发送或接收使用的是HTTP，而仅在不同邮件服务器之间传送邮件时才使用SMTP。  

# 6.4.4 本节习题精选  

# 一、单项选择题  

01.因特网用户的电子邮件地址格式必须是（）。  

A.用户名 $@$ 单位网络名B.单位网络名 $\textit{\textcenttextcenttextcent}$ 用户名C.邮箱所在主机的域名 $^{(a)}$ 用户名D.用户名 $\textit{\textcenttextcenttextcent}$ 邮箱所在主机的域名  

02.SMTP基于传输层的（）协议，POP3基于传输层的（）协议。  

A.TCP, TCP B.TCP, UDP C.UDP, UDP D.UDP,UDP  

03.SMTP服务器使用的端口号是（）  

A.21 B.25 C. 80 D.110  

04.用Firefox（浏览器）在Gmail中向邮件服务器发送邮件时，使用的是（）协议  

A.HTTP B.POP3 C. P2P D.SMTP  

05.用户代理只能发送而不能接收电子邮件时，可能是（）地址错误。  

A.POP3 B.SMTP C. HTTP D. Mail  

06.不能用于用户从邮件服务器接收电子邮件的协议是（）  

A.HTTP B.POP3 C. SMTP D.IMAP  

07.下列关于电子邮件格式的说法中，错误的是（）。  

A.电子邮件内容包括邮件头与邮件体两部分B.邮件头中发信人地址（From:）、发送时间、收信人地址（To:）及邮件主题（Subject:）是由系统自动生成的C.邮件体是实际要传送的信函内容D.MIME允许电子邮件系统传输文字、图像、语音与视频等多种信息  

08.下列关于POP3协议的说法，（）是错误的。  

A.由客户端而非服务器选择接收后是否将邮件保存在服务器上B.登录到服务器后，发送的密码是加密的C.协议是基于ASCII码的，不能发送二进制数据D.一个账号在服务器上只能有一个邮件接收目录  

09.【2012统考真题】若用户1与用户2之间发送和接收电子邮件的过程如下图所示，则图中 $\textcircled{\scriptsize{1}}$ 、 $\circledcirc$ 、 $\textcircled{3}$ 阶段分别使用的应用层协议可以是（）。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/8803df7a0e661031ebbc60607a6161d919f6a355e443574047be37178e554911.jpg)  
A.SMTP、SMTP、SMTPB.POP3、SMTP、POP3C.POP3、SMTP、SMTPD.SMTP、SMTP、POP3  

10.【2013统考真题】下列关于SMTP的叙述中，正确的是（）  

I.只支持传输7比特ASCII码内容II.支持在邮件服务器之间发送邮件III.支持从用户代理向邮件服务器发送邮件IV.支持从邮件服务器向用户代理发送邮件  

A.仅I、IⅡI和IⅢIB.仅I、II和IVC.仅I、IⅢI和IVD.仅II、IⅢI和IV11.【2015统考真题】通过P0P3协议接收邮件时，使用的传输层服务类型是（）。  

A.无连接不可靠的数据传输服务B.无连接可靠的数据传输服务C.有连接不可靠的数据传输服务D.有连接可靠的数据传输服务  

12.【2018统考真题】无须转换即可由SMTP直接传输的内容是（）。A.JPEG图像B.MPEG视频C.EXE文件D.ASCII文本  

# 二、综合应用题  

01.电子邮件系统使用TCP传送邮件，为什么有时会遇到邮件发送失败的情况？为什么有时对方会收不到发送的邮件？  

02.MIME与SMTP的关系是怎样的？  

03.用户主机上的电子邮件用户代理与邮件服务器建立了连接，现截获一个TCP报文段，如下图所示。图中显示了该报文段的前126个字节的十六进制及ASCII码内容。TCP首部长度为20B。请回答：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/5765f2da757a0c0f2150abeb474a4b17e779493cf32bbfc16a218d17e25dc177.jpg)  

# 6.4.5 答案与解析  

# 一、单项选择题  

01.D  

电子邮件是因特网最基本、最常用的服务功能。要使用电子邮件服务，首先要拥有自己的电子邮件地址，其格式为：用户名 $\textit{\textcenttextcenttextcent}$ 邮箱所在主机的域名。  

02.A  

SMTP和POP3都是基于TCP的协议，提供可靠的邮件通信。  

03.B  

SMTP服务器使用的熟知端口号是25。  
04.A  

在基于万维网的电子邮件中，用户浏览器与Hotmail或Gmail的邮件服务器之间的邮件发送或接收使用的是HTTP，而仅在不同邮件服务器之间传送邮件时才使用SMTP。  

05.A  

用户代理使用POP3协议接收邮件。通常用户在配置电子邮件用户代理时需要设置邮件服务器的POP3地址（如pop3.gmail.com），若这个地址设置错误，则会导致用户无法接收邮件。用户代理中的SMTP地址错误时会导致无法发送邮件。收件人E-mail地址错误时，可能会发错人，也可能会导致投递失败（不存在的地址）。  

06.C  

SMTP是一种“推”协议，用于发送方用户代理与发送方服务器之间及发送方服务器与接收方服务器之间，不能用于接收方用户从服务器上读取邮件。常用的邮件读取协议有POP3、HTTP和IMAP。大家平时通过浏览器登录163邮箱、Gmail邮箱时，使用的邮件读取协议就是HTTP。IMAP是另一个专用于读取邮件的协议，它要比POP3复杂得多，功能也更为强大。  

07.B  

邮件头是由多项内容构成的，其中一部分是由系统自动生成的，如发信人地址（From:）、发送时间；另一部分是由发件人输入的，如收信人地址（To:）、邮件主题（Subject:）等。  

08.B  

POP3协议在传输层是使用明文来传输密码的，并不对密码进行加密。所以B错误。POP3协议基于ASCII码，若要传输非ACSII码的数据，则要使用MIME将数据转换成ASCII码形式。  

09.D  

SMTP采用“推”的通信方式，即用户代理向邮件服务器及邮件服务器之间发送邮件时，SMTP客户主动将邮件“推”送到SMTP服务器。而POP3采用“拉”的通信方式，即用户读取邮件时，用户代理向邮件服务器发出请求，“拉”取用户邮箱中的邮件。  

10.A  

根据6.4.1节可知，SMTP用于用户代理向邮件服务器发送邮件，或在邮件服务器之间发送邮件。SMTP只支持传输7比特的ASCII码内容。  

11.D  

POP3建立在TCP连接上，使用的是有连接可靠的数据传输服务。  

12.D  

电子邮件出现得较早，当时的数据传输能力较弱，使用者往往也不需要传输较大的图片、视频等，因此SMTP具有一些目前来看较为老旧的性质，如限制所有邮件报文的体部分只能采用7位ASCⅡI码来表示。在如今的传输过程中，若传输了非文本文件，则往往需要将这些多媒体文件重新编码为ASCⅡI码再传输。因此无须转换即可传输的是ASCII文本，答案为D。  

二、综合应用题  

01.【解答】  

有时对方的邮件服务器不工作，邮件就发送不出去。对方的邮件服务器出故障也会使邮件去失。有时网络非常拥塞，路由器丢弃大量的IP数据报，导致通信中断。  

02.【解答】  

因为SMTP存在一些缺点和不足，所以通过MIME并非改变或取代SMTP。MIME继续使用RFC822格式，但增加了邮件主体的结构，并定义了传送非ASCII码的编码规则。也就是说，MIME邮件可在已有的电子邮件和协议下传送。  
03.【解答】  

1）本题中并未明确告诉这个报文段是从用户代理发往服务器还是从服务器发往用户代理。分析TCP首部格式可知，源端口为49382（0xc0e6），目的端口为25（0x0019），因此该应用层协议为SMTP。  

2）因为使用的是SMTP，且服务器端口25作为目的端口，所以源端口49382为用户代理所使用的端口。  

3）因为SMTP的协议字段都是用ASCII码表示的，所以发件人的关键字是FROM，从截图AS ClI FROM:cska oy an 2012  $\textit{\textcenttextcenttextcent}$  163.com  

# 6.5 万维网 (www)  

# 6.5.1WWW的概念与组成结构  

万维网（WorldWideWeb，WWW）是一个分布式、联机式的信息存储空间，在这个空间中：一样有用的事物称为一样“资源”，并由一个全域“统一资源定位符”（URL）标识。这些资源通过超文本传输协议（HTTP）传送给使用者，而后者通过单击链接来获取资源。  

万维网使用链接的方法能非常方便地从因特网上的一个站点访问另一个站点，从而主动地按需获取丰富的信息。超文本标记语言使得万维网页面的设计者很方便地用一个超链接从本页面的某处链接到因特网上的任何一个页面，并能在自己的计算机屏幕上显示这些页面。  

# 命题追踪HTTP在传输层所使用的协议（2018）  

万维网的内核部分是由三个标准构成的：  

1）统一资源定位符（URL）。负责标识万维网上的各种文档，并使每个文档在整个万维网的范围内具有唯一的标识符URL。2）超文本传输协议（HTTP）。一个应用层协议，它使用TCP连接进行可靠的传输，HTTP是万维网客户程序和服务器程序之间交互所必须严格遵守的协议。3）超文本标记语言（HTML）。一种文档结构的标记语言，它使用一些约定的标记对页面上的各种信息（包括文字、声音、图像、视频等）、格式进行描述。URL是对可以从因特网上得到的资源的位置和访问方法的一种简洁表示。URL相当于一个  

文件名在网络范围的扩展。URL的一般形式是：  

<协议>指用什么协议来获取万维网文档，常见的协议有htp、ftp等；<主机>是存放资源的主机在因特网中的域名或IP地址；<端口>和<路径 $\scriptscriptstyle\dot{>}$ 有时可省略。在URL中不区分大小写。  

万维网以客户/服务器模式工作。浏览器是在用户主机上的万维网客户程序，而万维网文档所驻留的主机则运行服务器程序，这台主机称为万维网服务器。客户程序向服务器程序发出请求服务器程序向客户程序送回客户所要的万维网文档。工作流程如下：  

1）Web用户使用浏览器（指定URL）与Web服务器建立连接，并发送浏览请求。  

2）Web服务器把URL转换为文件路径，并返回信息给Web浏览器。  

3）通信完成，关闭连接。  

万维网是无数个网络站点和网页的集合，它们在一起构成了因特网最主要的部分（因特网也包括电子邮件、Usenet和新闻组）。  
# 6.5.2超文本传输协议（HTTP）  

HTTP定义了浏览器（万维网客户进程）怎样向万维网服务器请求方维网文档，以及服务器怎样把文档传送给浏览器。从层次的角度看，HTTP是面向事务（Transaction-oriented）的应用层协议，它规定了在浏览器和服务器之间的请求和响应的格式与规则，是方维网上能够可靠地交换文件（包括文本、声音、图像等各种多媒体文件）的重要基础。  

# 1.HTTP的操作过程  

从协议执行过程来说，浏览器要访问WWW服务器时，首先要完成对WWW服务器的域名解析。一旦获得了服务器的IP地址，浏览器就通过TCP向服务器发送连接建立请求。  

万维网的大致工作过程如图6.11所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/363a6b1080e3e78e9e80684b408b2662a0e895391584428207a067d33fa28931.jpg)  
图6.11万维网的工作过程  

每个方维网站点都有一个服务器进程，它不断地监听TCP的端口80（默认），当监听到连接请求后便与浏览器建立TCP连接。然后，浏览器就向服务器发送请求获取某个Web页面的HTTP请求。服务器收到请求后，将构建所请求W6页的必需信息，并通过HTTP响应返回给浏览器。浏览器再将信息进行解释，然后将Web页显示给用户。最后，TCP连接释放。  

# 命题追踪访问Web时可能用到的协议（2014、2021）  

用户单击鼠标后所发生的事件按顺序如下（以访问清华大学的网站为例）：  

1）URL（http://www.tsinghua.edu.cn/chn/index.htm）。2）DNS www.tsinghua.edu.cn的IP地址。3）域名系统DNS解析出清华大学服务器的IP地址。4）浏览器与该服务器建立TCP连接（默认端口号为80）。5）HTTP：GET/chn/index.htm 6）服务器通过HTTP响应把文件index.htm发送给浏览器。  

7）释放TCP连接。  

8）浏览器解释文件index.htm，并将Web页显示给用户。  

上述过程是一个简化过程，实际过程涉及TCP/IP体系结构中应用层的DHCP、DNS和HTTP，传输层的UDP和TCP，网际层的IP和ARP，数据链路层的CSMA/CD或PPP（若涉及ISP接入或广域网传输）。本节主要介绍HTTP。  
2.HTTP的特点  

HTTP使用TCP作为传输层协议，保证了数据的可靠传输。HTTP不必考虑数据在传输过程中被丢弃后又怎样被重传。但是，HTTP本身是无连接的（务必注意）。也就是说，虽然HTTP使用了TCP连接，但通信的双方在交换HTTP报文之前不需要先建立HTTP连接。  

HTTP是无状态的。也就是说，同一个客户第二次访问同一个服务器上的页面时，服务器的响应与第一次被访问时的相同，因为服务器并不记得曾经服务过的这个客户。  

HTTP的无状态特性简化了服务器的设计，使之更易支持大量并发的请求。在实际应用中，通常使用Cookie加数据库的方式来跟踪用户的活动（如记录用户最近浏览的商品等）。Cookie的工作原理：当用户初次浏览某个使用Cookie的网站时，该网站服务器就为用户产生一个唯一的Cookie识别码，如“12345”，并以此为索引在后端数据库中创建一个项目，用来记录用户访问该网站的各种信息。接着在给用户的响应报文中添加一个Set-cookie的首部行“Setcookie:12345”，用户收到响应后，就在它管理的特定Cookie文件中添加该服务器的主机名和Cookie识别码。当用户再次浏览这个网站时，会取出这个网站的识别码，并在请求报文中添加一个Cookie首部行“Cookie:12345”。服务器根据Cookie识别码就能从数据库中查询到该用户的活动记录，进而执行一些个性化的工作，如根据用户的历史浏览记录向其推荐新商品等。  

HTTP既可以使用非持续连接（HTTP/1.O），也可以使用持续连接（HTTP/1.1支持）。  

# 命题追踪HTTP页面请求时间的分析（2020）  

对于非持续连接，每个网页元素对象（如JPEG图形、Flash等）的传输都需要单独建立一个TCP连接，如图6.12所示（第三次握手的报文段中梢带了客户对万维网文档的请求）。请求一个万维网文档所需的时间是该文档的传输时间（与文档大小成正比）加上两倍往返时间RTT（一个RTT用于TCP连接，另一个RTT用于请求和接收文档）。每请求一个对象都导致 $2{\times}\mathrm{RTT}$ 的开销，此外每次建立新的TCP连接都要分配缓存和变量，使万维网服务器的负担很重。  

所谓持续连接，是指万维网服务器在发送响应后仍然保持这条连接，使同一个客户和该服务器可以继续在这条TCP连接上传送后续的HTTP请求报文和响应报文，如图6.13所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/08b82f7f1d88b1f3b0c9eb1da958e256c83631e22d81d9985f204e369daec97d.jpg)  
图6.12请求一个万维网文档所需的时间  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/d8a1e5c5841bd5690047250af1122856a1bed175683d0f7181aa958511f8ee4e.jpg)  
图6.13使用持续连接（非流水线）  
# 命题追踪HTTP/1.1页面请求时间的分析（2011、2022）  

HTTP/1.1默认使用持续连接。持续连接又分为非流水线和流水线两种工作方式。对于非流水线方式，客户在收到前一个响应后才能发出下一个请求，服务器在发送完一个对象后，其TCP连接就处于空闲状态，浪费了服务器资源。对于流水线方式，客户可以连续发出对各个对象的请求，服务器就可连续响应这些请求。若所有的请求和响应都是连续发送的，则引用所有对象共计经历1个RTT延迟，而不是像非流水线方式那样，每个对象都必须有1个RTT延迟。这种方式减少了TCP连接中的空闲时间，提高了效率。当然，在流水线方式中，服务器在每个RTT连续发送的数据量还受到TCP发送窗口的限制。  

# 3.HTTP的报文结构  

# 命题追踪  

# HTTP请求报文中各种方法的意义（2015）  

HTTP是面向文本的（Text-Oriented），因此报文中的每个字段都是一些ASCⅡI码串，并且每个字段的长度都是不确定的。有两类HTTP报文：  

请求报文：从客户向服务器发送的请求报文，如图6.14(a)所示。响应报文：从服务器到客户的回答，如图6.14(b)所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/dc22417e8a5262e7d4371c0540322afc2b85b46a41a3f4dc747d385dd38e9c24.jpg)  
图6.14HTTP的报文结构  

从图6.14可以看出，两种报文都由三个部分组成，两者格式的区别就是开始行不同。  

开始行：在请求报文中的开始行称为请求行，而在响应报文中的开始行称为状态行。开始行的三个字段之间都以空格分隔，最后的“CR”和“LF”分别代表“回车”和“换行”。  

首部行：用来说明浏览器、服务器或报文主体的一些信息。首部可以有几行，但也可以不使用。在每个首部行中都有首部字段名和它的值，每一行的结束都要有“回车”和“换行”。整个首部行结束时，还有一空行将首部行和后面的实体主体分开。  

实体主体：在请求报文中一般不用这个字段，而在响应报文中也可能没有这个字段。  

请求报文的“请求行”有三个内容：方法、请求资源的URL及HTTP的版本。其中，“方法”是对所请求对象进行的操作，这些方法实际上也就是一些命令。表6.1列出了常用的几种方法。  

表6.1HTTP请求报文中常用的几个方法
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/92d53ee3242092e4b08f0650c3127b1480828e42ece80aeb9314973ae11db4ab.jpg)  
下面是一个典型的HTTP请求报文：  

GET/bbs/index.htmHTTP/1.1指明方法“GET”、相对URL、HTTP版本}Host:www.cskaoyan.com 指明服务器的域名 Connection: Keep-Alive要求服务器在发送完被请求的文档后保持这条连接User-Agent:Mozilla/5.0{表明用户代理是浏览器Mozilla/5.0}Accept-Language: cn{表示用户希望优先得到中文版本的文档}  

第1行是请求行，它使用了相对URL，因为下面的首部行给出了服务器的域名。第3行告诉服务器使用持续连接，表示浏览器要求服务器在发送完被请求的文档后保持这条TCP连接，若要求使用非持续连接，则对应首部行应为“Connection:close”。  

HTTP响应报文的第1行是状态行，它包含三个内容：HTTP的版本、状态码、解释状态码的短语。下面是HTTP响应报文中常见的三种状态行：  

HTTP/1.1 202 Accepted{接受请求}HTTP/1.1 400Bad Request {错误的请求} HTTP/1.1404 Not Found{找不到页面}  

# 4.HTTP请求报文举例  

图6.15所示为Wireshark捕获的一个HTTP请求报文。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/515e751b14db49afc2fe22d36d3a943c3fb0480756f37eda47cc30973bd9d976.jpg)  
图6.15用Wireshark捕获的一个HTTP请求报文  

根据帧的结构定义，在图6.15的以太网数据帧中，第 $1\!\sim\!6$ 个字节为目的MAC地址（默认网关地址），即00-0f-e2-3f-27-3f；第 $7\!\sim\!12$ 个字节为本机MAC地址，即00-27-13-67-73-8d；第 $13\!\sim\!14$ 个字节 $08\!\sim\!00$ 为类型字段，表示上层使用的是IP数据报协议。第 $15{\sim}34$ 个字节（共20B）为IP数据报的首部，其中第 $27\!\sim\!30$ 个字节为源IP地址，即db-df-d2-70，转换成十进制为219.223.210.112：第 $31\!\sim\!34$ 个字节为目的IP地址，即71-69-4e-0a，转换成十进制为113.105.78.10。第 $35\!\sim\!54$ 个字节（共20B）为TCP报文段的首部。  

从第55个字节开始才是TCP数据部分（阴影部分），即从应用层传递下来的数据（本例中即请求报文），GET对应请求行的方法，/face/20.gif对应请求行的URL， $\mathrm{HTTP}/1.1$ 对应请求行的版本，左边数字是对应字符的ASCII码，如 $\mathrm{'G'}\,{=}\,0\mathrm{x}47$ 、 ${}^{\prime}\mathrm{E^{\prime}}\!=\!0\mathrm{x}45$ 、 $\mathrm{{'T'}}\!=\!0\mathrm{{x}}54$ 等。图6.15的请求报文中首部行字段内容的含义，建议读者自行了解，也可以自己动手抓包分析。  
常见应用层协议小结如表6.2所示。  

表6.2常见应用层协议小结
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/6a17e3acc5e24d05afd103b899739bb177a17668a96e0a1d020cb0a76d5289c1.jpg)  

# 6.5.3 本节习题精选  

# 一、单项选择题  

01.下面的（）协议中，客户机与服务器之间采用面向无连接的协议进行通信。A. FTP B.SMTP C. DNS D. HTTP 02.从协议分析的角度，WWW服务的第一步操作是浏览器对服务器的（）  

A.请求地址解析B.传输连接建立C.请求域名解析D.会话连接建立  

03.TCP和UDP的一些端口保留给一些特定的应用使用。为HTTP保留的端口号为（）。  

A.TCP的80端口B.UDP的80端口C.TCP的25端口D.UDP的25端口  

04.从某个已知的URL获得一个万维网文档时，若该万维网服务器的IP地址开始时并不知道，则需要用到的应用层协议有（ $\textcircled{\scriptsize{1}}$ )，需要用到的传输层协议有（）。  

$\textcircled{\scriptsize{1}}$  A.FTP、HTTP B.DNS、FTP C.DNS、HTTP D.TELNET、HTTP  $\textcircled{2}$  A.UDP B.TCP C.UDP、TCP D.TCP、IP  

05.万维网上的每个页面都有一个唯一的地址，这些地址统称（）。  

A.IP地址B.域名地址C.统一资源定位符D.WWW地址  

06.使用鼠标单击一个万维网文档时，若该文档除有文本外，还有三幅gif图像，则在HTTP/1.0中需要建立（）次TCP连接。  

A.41 B.3 C. 2 D.2  

07.仅需Web服务器对HTTP报文进行响应，但不需要返回请求对象时，HTTP请求报文应该使用的方法是（）。  

A.GET B.PUT C. POST D.HEAD  

08.假设主机的浏览器使用HTTP/1.1协议以持续的非流水线方式工作，向Web服务器请求包含有3个JPEG小图像的demo.html页面，一次请求-响应时间为RTT，则从发出第一个Web请求开始到收到全部内容为止，经过RTT的数量为（）。  

A.3 B.4 C. 5 D.6  

09.假设主机H通过 $\mathrm{HTTP}/1.1$ Web S Web rfc.html，rfc.html引l用了同目录下的3个JPEG小图像（假设只有在收到rfc.html后才能发送对其引用图像的请求），一次请求响应的时间为RTT，忽略其他各种时延，不考虑拥塞控制和流量控制，则从发出HTTP请求报文开始到收到全部内容为止，所耗费的时间是（）。  
A.2RTTB.2.5RTTC.4RTTD.4.5RTT  

10.仅需Web服务器对HTTP报文进行响应，但不需要返回请求对象时，HTTP请求报文应该使用的方法是（）。  

A.GET B.PUT C.POST D.HEAD

 11.HTTP是一个无状态协议，然而Web站点经常希望能够识别用户，这时需要用到（）。A.Web缓存 B.Cookie C.条件GET D.持续连接

 12.下列关于Cookie的说法中，错误的是（）  

A.Cookie存储在服务器端B.Cookie是服务器产生的C.Cookie会威胁客户的隐私D.Cookie的作用是跟踪用户的访问和状态  

13.以下关于非持续连接HTTP特点的描述中，错误的是（）。  

A.HTTP支持非持续连接与持续连接 B.HTTP/1.0使用非持续连接，而 $\mathrm{HTTP}/1.1$ 的默认方式为持续连接C.非持续连接中对每次请求/响应都要建立一次TCP连接D.非持续连接中读取一个包含100个图片对象的Web页面，需要打开和关闭100次TCP连接  

14.假定一个NAT路由器的公网地址为205.56.79.35，并且有如下表项：  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/86093d4861b4dd42f94a860540fd7e4026928c53512ec89be4ee670d611746cf.jpg)  

它收到一个源1P地址为192.168.32.56、源端口为80的分组，其动作是（）A.转换地址，将源IP变为205.56.79.35，端口变为2056，然后发送到公网B.添加一个新的条目，转换IP地址及端口然后发送到公网C.不转发，丢弃该分组 D.直接将分组转发到公网  

15.【2014统考真题】使用浏览器访问某大学的Web网站主页时，不可能使用到的协议是（）A.PPPB.ARPC.UDPD.SMTP

16.【2015统考真题】某浏览器发出的H11P请求报文如下：  

GET/index.htmlHTTP/1.1 Host:www.test.edu.cn Connection:Close Cookie:123456  

下列叙述中，错误的是（）。A.index.html B.index.html存放在www.test.edu.cn上C.该浏览器请求使用持续连接D.该浏览器曾经浏览过www.test.edu.cn  

17.【2022统考真题】假设主机H通过HTTP/1.1请求浏览某Web服务器S上的Web页news408.html，news408.html引用了同目录下的1幅图像， $\mathrm{news408.hpml}$ 文件大小为1MSS（最大段长），图像文件大小为3MSS，H访问S的往返时间 $\mathrm{RTT}\,{=}\,10\;\mathrm{ms}$ 忽略HTTP响应报文的首部开销和TCP段传输时延。若H已完成域名解析，则从H请求与S建立TCP连接时刻起，到接收到全部内容止，所需的时间至少是（）。  
A.30ms B.40ms C.  $50\mathrm{ms}$  D.60ms  

# 二、综合应用题  

01.在浏览器中输入http://cskaoyan.com并按回车，直到王道论坛的首页显示在其浏览器中请问在此过程中，按照TCP/IP参考模型，从应用层到网络层都用到了哪些协议？  

02.在如下条件下，计算使用非持续方式和持续方式请求一个Web页面所需的时间  

1）测试的RTT的平均值为 $150\mathrm{ms}$ ，一个gif对象的平均发送时延为 $35\mathrm{ms}$ 2）一个Web页面中有10幅gif图片，Web页面的基本HTML文件、HTTP请求报文、TOP握手报文大小忽略不计。3）TCP三次握手的第三步中捎带一个HTTP请求。4）使用非流水线方式。  

03.【2011统考真题】某主机的MAC地址为00-15-C5-C1-5E-28，IP地址为10.2.128.100（私 有地址）。图1是网络拓扑，图2是该主机进行Web请求的一个以太网数据顿前80B的十六进制及ASCII码内容。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/2ab7538dd9349f013b47c916608be1c7237177ec01922dd6f1807c9cb3091dc3.jpg)  
图1网络拓扑  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/4e8ba72c9d0b98d546e73584fcabf1b11662354040dead8ed970b94cc8cb8b66.jpg)  

请参考图中的数据回答以下问题。  

1）Web服务器的IP地址是什么？该主机的默认网关的MAC地址是什么？2）该主机在构造图2的数据帧时，使用什么协议确定目的MAC地址？封装该协议请求报文的以太网帧的目的MAC地址是什么？3）假设HTTP/1.1协议以持续的非流水线方式工作，一次请求-响应时间为RTT，rfc.html页面引用了5幅JPEG小图像。问从发出图2中的Web请求开始到浏览器收到全部内容为止，需要多少个RTT？4）该帧封装的IP分组经过路由器R转发时，需修改IP分组头中的哪些字段？注：以太网数据帧结构和IP分组头结构分别如图3和图4所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/2a39ff4eb33d76cf310347e3b7ae7a5dfe0023352e3114f1c4de7164e993d790.jpg)  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/0980ced835d23fea9be7d5a379cc02d4683ec35eea451cadaf2790f776b4309f.jpg)  
图4IP分组头结构  

04.【2021统考真题】某网络拓扑如下图所示，以太网交换机S通过路由器R与Intermet互连。路由器部分接口、本地域名服务器、H1、H2的IP地址和MAC地址如图中所示。在 $t_{0}$ 时刻HI的ARP表和S的交换表均为空，H1在此刻利用浏览器通过域名www.abc.com Web，在 $t_{1}$ 时刻 $(t_{1}\!>\!t_{0}$ )S第一次收到了封装HTTP请求报文的以太网帧，假设从 $t_{0}$ 到 $t_{1}$ 期间网络未发生任何与此次Web访问无关的网络通信。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/17632f519a29fdd2a7d3e4de03c815f5dd1ed3eb2de7d2702f02d0e810e381cb.jpg)  

请回答下列问题。  

1）从 $t_{0}$ 到 $t_{1}$ 期间，H1除了HTTP，还运行了哪个应用层协议？从应用层到数据链路层，该应用层协议报文是通过哪些协议进行逐层封装的？2）若S的交换表结构为<MAC地址，端口>，则 $t_{1}$ 时刻S交换表的内容是什么？3）从 $t_{0}$ 到 $t_{1}$ 期间，H2至少接收到几个与此次Web访问相关的帧？接收的是什么帧？帧的目的MAC地址是什么？  

# 6.5.4 答案与解析  

# 一、单项选择题  

01.C  

DNS采用UDP来传送数据，UDP是一种面向无连接的协议。  

02.C  

建立浏览器与服务器之间的连接需要知道服务器的IP地址和端口号（80端口是熟知端口），而访问站点时浏览器从用户那里得到的是WWW站点的域名，所以浏览器必须首先向DNS请求域名解析，获得服务器的IP地址后，才能请求建立TCP连接。  
03.A  

HTTP在传输层使用TCP，端口号为80。TCP的25号端口是为SMTP保留的。  

04.①C  $\mathrm{@C}$  因为不知道服务器的IP地址，所以先要用DNIS进行域名解析，然后使用HTTP进行用户和服务器之间的交互。需要用到的传输层协议是UDP（DNS使用）和TCP（HTTP使用）。  

05.C  

统一资源定位符负责标识万维网上的各种文档，并使每个文档在整个万维网的范围内具有唯一的标识符URL。  

06.A  

HTTP在传输层用的是TCP。HTTP1.O只支持非持续连接，所以每请求一个对象需要建立一次TCP连接，传输1个基本html对象和3个gif对象，共需建立4次TCP连接。  

07. D  

使用HEAD方法时服务器可对HTTP报文进行响应，但不会返回请求对象，其作用主要是调试。另外三个选项中的方法的作用请查看本章中的表6.1。  

08.B  

从发出第一个Web请求开始，所以此时TCP连接已经建立。当采用持续的非流水线方式工作时，服务器发送响应后仍在一段时间内保持这条连接，客户收到前一个请求的响应后才能发出下一个请求，因此请求 $\mathrm{html}$ 页面和3个小图像共需要4个RTT。  

09.A  

从发出HTTP请求报文开始，所以此时TCP连接已经建立。 $\mathrm{HTTP}/1.1$ 默认使用持久连接。第1个RTT请求并收到html页面，收到html页面后才能发送对其引用图像的请求，所以第2个RTT请求并收到3个JPEG图像，合计耗费2个RTT。  

10.D  

使用HEAD方法时服务器可对HTTP报文进行响应，但不会返回请求对象，其作用主要是调试。另外三个选项中的方法的作用请查看本章中的表6.1。  

11.B 可以在HTTP中使用Cookie保存HTTP服务器和客户之间传递的状态信息。  

12.A  

Cookie是一个存储在用户主机中的文本文件。它由服务器产生，作为识别用户的手段。服务器的后端数据库记录了用户在Web站点上的活动，因此这些信息（如用户的个人信息及购物的偏好等）有可能被出卖给第三方，从而威胁到用户的隐私。  

13. D  

非持续连接对每次请求/响应都建立一次TCP连接。在浏览器请求一个包含100个图片对象的Web页面时，服务器需要传输1个基本HTML文件和100个图片对象，因此一共是101个对象，需要打开和关闭TCP连接101次。  

14.C  

熟知端口号80是HTTP的服务器端口号，因此说明IP地址为192.168.32.56（私有地址）的主机是Web服务器，源端口号为80说明该分组是Web服务器发出的HTTP响应分组。若该HTTP响应分组是对外网主机发出的HTTP请求的响应，则TAT表中一定存在相应的表项（否则HTTP请求分组不可能到达Web服务器），但在NAT表中找不到。所以只可能是对内网主机发出的HTTP请求的响应，该分组不需要通过路由器转发，因此路由器丢弃该分组。  
15.D  

接入网络时可能会用到PPP，A可能用到；计算机不知道某主机的MAC地址时，用IP地址查询相应的MAC地址会用到ARP，B可能用到：访问Web网站时，若DNS缓冲没有存储相应域名的IP地址，用域名查询相应的IP地址时要使用DNS，而DNS是基于UDP的，所以C可能用到；SMTP只有使用邮件客户端发送邮件，或邮件服务器向其他邮件服务器发送邮件时才会用到，单纯地访问Web网页不可能用到，选D。  

16.C  

Connection:连接方式，Close，keep-alive。Cookie值由服务器产生，HTTP请求报文中有Cookie方法表示曾访问过www.test.edu.cn服务器。  

17.B  

HTTP/1.1默认使用持续连接，所有请求都是连续发送的。要求最少时间，理想的情况是TCP在第3次握手的报文段中带了HTTP请求，以及传输过程中的慢开始阶段不考虑拥塞。假设接收方有足够大的缓存空间，即发送窗口等同于拥塞窗口，共需要经过：第1个RTT，进行TCP连接建立的前两次握手；第2个RTT，主机C发送第3次握手报文并捎带了对html文件的HTTP请求，TCP连接刚建立时服务器S的发送窗口 $=$ 1MSS，服务器S发送大小为1MSS的html文件；第3个RTT，主机C发送对htmI文件的确认并梢带了对图形文件的HTTP请求，服务器S收到确认后发送窗口变为2MSS，然后服务器S发送大小为2MSS的图像文件；第4个RTT，主机C向服务器S发送对收到的部分图像文件的确认，服务器S收到确认后发送窗口变为4IMISS，然后服务器S发送剩下的1IMISS图像文件，完成传输，共需要4个RTT，即 $40\mathrm{ms}$ 。整个传输过程如下图所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/558c064c217668d8f7593521e6dd0bf57aa1ba5b1bcac11d42912c311cb6c496.jpg)  

# 二、综合应用题  

01.【解答】  

1）应用层。HTTP：WWW访问协议；DNS：域名解析服务。2）传输层。TCP：HTTP提供可靠的数据传输；UDP：DNS使用UDP传输。3）网络层。IP：IP包传输和路由选择；ICMP：提供网络传输中的差错检测；ARP：将本机的默认网关IP地址映射成物理MAC地址。  

02.【解答】  

每次进行TCP三次握手时，前两次握手消耗一个 $\mathrm{RTT}\,{=}\,150\mathrm{ms}$ ，第3次握手的报文段梢带客户对HTIML文件的请求，因此请求和接收基本HTML文件耗时一个 $\mathrm{RTT}\,{=}\,150\mathrm{ms}$ （其大小忽略不计时，发送时延为 $0\mathrm{ms}\,.$  
在非持续连接方式下：  

第一次建立TCP连接并传送html文件所需的时间为 $t_{\mathrm{hpml}}\!=\!150+150\!=\!300\mathrm{ms}$ 每次建立TCP连接并传送一个gif文件所需的时间为 $t_{\mathrm{gif}}\!=\!150+150+35\!=\!335\mathrm{ms},$ 所以总时间 $t_{\perp}=t_{\mathrm{hpm}}+t_{\mathrm{gif}}\times10=300+335{\times}10=3650\mathrm{ms}$  

在持续连接方式下：  

只需要建立一次TCP连接，然后传送html文件和10个gif文件。总时间 $t_{\mathrm{g}}\!=\!t_{\mathrm{g}\times\mathrm{TCP}}+t_{\mathrm{hpml}}+t_{\mathrm{gif}}\!\times\!10\!=\!150+150+(150+35)\!\times\!10\!=\!2150\mathrm{ms}\,\mathrm{cm}$  

03.【解答】  

1）以太网帧的数据部分是IP数据报，只要数出相应字段所在的字节即可。由图3可知以太网帧首部有 $6+6+2\,{=}\,14\mathrm{B}$ ，由图4可知IP数据报首部的目的IP地址字段前有 $4{\times}4=16\mathrm{B}$ 从图2的帧第1字节开始数 $14+16\,{=}\,30\mathrm{B}$ ，得到目的IP地址为40.aa.62.20（十六进制），转换成十进制为 $64.170.98.32\$ 。由图2可知以太网帧的前6字节00-21-27-21-51-ee是目的MAC地址，即为主机的默认网关10.2.128.1端口的MAC地址。  

2）ARP用于解决IP地址到MAC地址的映射问题。主机的ARP进程在本以太网以广播形式发送ARP请求分组，在以太网上广播时，以太网帧的目的地址为全1，即FF-FF-FF-FF-FF-FF。  

3）HTTP/1.1协议以持续的非流水线方式工作时，服务器发送响应后仍在一段时间内保持这段连接，客户机在收到前一个请求的响应后才能发出下一个请求。注意题目说的是从发出Web请求开始，所以此时TCP连接已经建立。第一个RTT用于请求Web页面，客户机收到第一个请求的响应后（还有五个请求未发送），每访问一次对象就用去一个RTT。因此共需 $1+5=6$ 个RTT后浏览器收到全部内容。  

4）私有地址和Intermnet上的主机通信时，须由NAT路由器进行网络地址转换，把IP数据报的源IP地址（本题为私有地址10.2.128.100）转换为NAT路由器的一个全球IP地址（本题为101.12.123.15）。因此，源IP地址字段 $\mathrm{0a\,02~80~64}$ 变为 $65~\mathrm{0c\:7b\:0f.}$ IP数据报每经过一个路由器，TTL值就减1，并重新计算首部检验和。若IP分组的长度超过输出链路的MTU，则总长度字段、标志字段、片偏移字段也会发生变化。  

04.【解答】  

1）从 $t_{0}$ 到 $t_{1}$ 期间，除了HTTP，H1还运行了DNS应用层协议，以将域名转换为IP地址。DNS运行在UDP之上，UDP将应用层交付的DNS报文添加首部后，向下交付给IP层，IP层使用IP数据报进行封装，封装好后，向下交付给数据链路层，数据链路层使用CSMA/CD硕进行封装。因此，逐层封装关系如下：DNS报文→UDP数据报一IP数据报→CSMA/CD帧。传统以太网在数据链路层采用CSMA/CD协议，因此使用CSMA/CD顿进行封装。提示：在数据链路层对该报文的封装解释为以太网V2帧（或以太网帧）会更合适，标准答案给出的CSMA/CD帧相对而言并不算特别合适。CSMA/CD协议更多地用在以传统集线器互连的以太网中。交换机可工作于全双工方式，通常不采用CSMA/CD协议。  

2） $t_{0}$ 时刻，H1的ARP表和S的交换表为空。H1利用浏览器通过域名请求访问Web服务器。因为要先解析域名，查询该域名对应的IP地址，所以要先向本地域名服务器发送DNIS查询报文。ARP表为空，因此需要先发送ARP请求分组，查询本地域名服务器对应的MAC地址，这个帧的目的MAC地址是FF-FF-FF-FF-FF-FF。S接收到这个帧，在交换表中记录MAC地址为00-11-22-33-44-cc，位于端口4，然后广播该顿。当本地域名服务器收到ARP  
请求后，向H1发送ARP响应分组。S接收到这个帧，在交换表中记录MAC地址为00-11-22-33-44-bb，位于端口1，然后将该帧从端口4发送出去。  

得到了域名对应的ITP地址，发现不在本局域网中，需要通过路由表转发。  

H1的ARP表中没有路由器对应的MAC地址，因此需要先发送ARP请求分组，查询路由器对应的MAC地址，这个帧的目的MAC地址是FF-FF-FF-FF-FF-FF。S接收到这个帧，广播该顿。当路由器收到ARP请求后，尚H1发送ARP响应分组。S接收到这个帧，在交换表中记录MAC地址为00-11-22-33-44-aa，位于端口2，然后将该帧从端口4发送出去。现在，H1就能发送HTTP请求。在整个过程中，并没有涉及H2，H2没有主动发送数据，因此S不会记录H2的MAC地址和端口， $t_{1}$ 时刻S的交换表如下所示。  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c046c6833540ed09095415c098813d1ba5e0e7ea2e210182000eb7de249ba649.jpg)  

3）由步骤2）的分析可知，H2至少会接收到2个和此次Web访问相关的帧。接收到的均是封装ARP查询报文的以太网帧：这些帧的目的MAC地址均是FF-FF-FF-FF-FF-FF。  

# 6.6本章小结及疑难点  

1.如何理解客户进程端口号与服务器进程端口号？  

通常我们所说的熟知端口号是指应用层协议在服务器端的默认端口号，而客户端进程的端口号是由客户端进程任意指定的（临时的）。  

当客户进程向服务器进程发出建立连接请求时，要寻找连接服务器进程的熟知端口号，同时还要告诉服务器进程自己的临时端口号。接着，服务器进程就用自己的熟知端口号与客户进程所提供的端口号建立连接。  

2.因特网和万维网的区别是什么？  

因特网（Intemet）是指在ARPA网基础上发展而来的世界上最大的全球性互连网络，它采用TCP/IP协议族作为通信规则。  

万维网（WWW）是无数个网络站点和网页的集合，它们一起构成了因特网最主要的部分（因特网也包括电子邮件、Usenet和新闻组）。  
# 参考文献  

[1]谢希仁.计算机网络[M].第8版.北京：电子工业出版社，2021.

[2]JamesF.Kurose，KeithW.Ross.计算机网络：自顶向下方法[M].北京：机械工业出版社，2018

[3]本书编写组.全国硕士研究生入学统一考试计算机专业基础综合考试大纲解析[M].北京：高等教育出版社，2023.

[4]黄传河：计算机网络考研指导[M].北京：机械工业出版社，2009.

[5]鲁士文.计算机网络习题与解析[M].北京：清华大学出版社，2005

[6]张沪寅，黄传河，吴黎兵，等，计算机网络联考辅导教程[M].北京：清华大学出版社，2010.

[7]翔高教育.计算机学科专业基础综合复习指南[M].上海：复旦大学出版社，2010.

[8]崔巍.2011全国硕士研究生入学统考计算机学科专业基础综合辅导讲义[M].北京：原子能出版社，2009.  
